import{p as Pe,l as Ya,c as wf}from"./react-toastify.esm-BT0dCY3z.js";import{z as bf,y as Pn}from"./components-CE_o6jZX.js";var ii=function(){return ii=Object.assign||function(e){for(var n,r=1,s=arguments.length;r<s;r++){n=arguments[r];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},ii.apply(this,arguments)};function HE(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(n[r[s]]=t[r[s]]);return n}function _f(t,e,n,r){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function a(d){try{c(r.next(d))}catch(h){i(h)}}function l(d){try{c(r.throw(d))}catch(h){i(h)}}function c(d){d.done?o(d.value):s(d.value).then(a,l)}c((r=r.apply(t,e||[])).next())})}function xf(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,s,o,i=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return i.next=a(0),i.throw=a(1),i.return=a(2),typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function a(c){return function(d){return l([c,d])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(n=0)),n;)try{if(r=1,s&&(o=c[0]&2?s.return:c[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,c[1])).done)return o;switch(s=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return n.label++,{value:c[1],done:!1};case 5:n.label++,s=c[1],c=[0];continue;case 7:c=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){n=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){n.label=c[1];break}if(c[0]===6&&n.label<o[1]){n.label=o[1],o=c;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(c);break}o[2]&&n.ops.pop(),n.trys.pop();continue}c=e.call(t,n)}catch(d){c=[6,d],s=0}finally{r=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Ef(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function KE(t,e,n){if(n||arguments.length===2)for(var r=0,s=e.length,o;r<s;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))}var Qa="vercel.ai.error",kf=Symbol.for(Qa),Xa,Sf=class ec extends Error{constructor({name:e,message:n,cause:r}){super(n),this[Xa]=!0,this.name=e,this.cause=r}static isInstance(e){return ec.hasMarker(e,Qa)}static hasMarker(e,n){const r=Symbol.for(n);return e!=null&&typeof e=="object"&&r in e&&typeof e[r]=="boolean"&&e[r]===!0}};Xa=kf;var le=Sf,tc="AI_APICallError",nc=`vercel.ai.error.${tc}`,Af=Symbol.for(nc),rc,st=class extends le{constructor({message:e,url:n,requestBodyValues:r,statusCode:s,responseHeaders:o,responseBody:i,cause:a,isRetryable:l=s!=null&&(s===408||s===409||s===429||s>=500),data:c}){super({name:tc,message:e,cause:a}),this[rc]=!0,this.url=n,this.requestBodyValues=r,this.statusCode=s,this.responseHeaders=o,this.responseBody=i,this.isRetryable=l,this.data=c}static isInstance(e){return le.hasMarker(e,nc)}};rc=Af;var sc="AI_EmptyResponseBodyError",oc=`vercel.ai.error.${sc}`,Cf=Symbol.for(oc),ic,Tf=class extends le{constructor({message:e="Empty response body"}={}){super({name:sc,message:e}),this[ic]=!0}static isInstance(e){return le.hasMarker(e,oc)}};ic=Cf;function ac(t){return t==null?"unknown error":typeof t=="string"?t:t instanceof Error?t.message:JSON.stringify(t)}var cc="AI_InvalidArgumentError",lc=`vercel.ai.error.${cc}`,If=Symbol.for(lc),uc,Rf=class extends le{constructor({message:e,cause:n,argument:r}){super({name:cc,message:e,cause:n}),this[uc]=!0,this.argument=r}static isInstance(e){return le.hasMarker(e,lc)}};uc=If;var dc="AI_InvalidPromptError",fc=`vercel.ai.error.${dc}`,$f=Symbol.for(fc),pc,Of=class extends le{constructor({prompt:e,message:n,cause:r}){super({name:dc,message:`Invalid prompt: ${n}`,cause:r}),this[pc]=!0,this.prompt=e}static isInstance(e){return le.hasMarker(e,fc)}};pc=$f;var hc="AI_InvalidResponseDataError",mc=`vercel.ai.error.${hc}`,Bf=Symbol.for(mc),gc,qt=class extends le{constructor({data:e,message:n=`Invalid response data: ${JSON.stringify(e)}.`}){super({name:hc,message:n}),this[gc]=!0,this.data=e}static isInstance(e){return le.hasMarker(e,mc)}};gc=Bf;var yc="AI_JSONParseError",vc=`vercel.ai.error.${yc}`,Pf=Symbol.for(vc),wc,zn=class extends le{constructor({text:e,cause:n}){super({name:yc,message:`JSON parsing failed: Text: ${e}.
Error message: ${ac(n)}`,cause:n}),this[wc]=!0,this.text=e}static isInstance(e){return le.hasMarker(e,vc)}};wc=Pf;var bc="AI_LoadAPIKeyError",_c=`vercel.ai.error.${bc}`,Nf=Symbol.for(_c),xc,Nn=class extends le{constructor({message:e}){super({name:bc,message:e}),this[xc]=!0}static isInstance(e){return le.hasMarker(e,_c)}};xc=Nf;var Ec="AI_NoSuchModelError",kc=`vercel.ai.error.${Ec}`,Mf=Symbol.for(kc),Sc,Df=class extends le{constructor({errorName:t=Ec,modelId:e,modelType:n,message:r=`No such ${n}: ${e}`}){super({name:t,message:r}),this[Sc]=!0,this.modelId=e,this.modelType=n}static isInstance(t){return le.hasMarker(t,kc)}};Sc=Mf;var Ac="AI_TooManyEmbeddingValuesForCallError",Cc=`vercel.ai.error.${Ac}`,Uf=Symbol.for(Cc),Tc,Lf=class extends le{constructor(e){super({name:Ac,message:`Too many values for a single embedding call. The ${e.provider} model "${e.modelId}" can only embed up to ${e.maxEmbeddingsPerCall} values per call, but ${e.values.length} values were provided.`}),this[Tc]=!0,this.provider=e.provider,this.modelId=e.modelId,this.maxEmbeddingsPerCall=e.maxEmbeddingsPerCall,this.values=e.values}static isInstance(e){return le.hasMarker(e,Cc)}};Tc=Uf;var Ic="AI_TypeValidationError",Rc=`vercel.ai.error.${Ic}`,Ff=Symbol.for(Rc),$c,jf=class ps extends le{constructor({value:e,cause:n}){super({name:Ic,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${ac(n)}`,cause:n}),this[$c]=!0,this.value=e}static isInstance(e){return le.hasMarker(e,Rc)}static wrap({value:e,cause:n}){return ps.isInstance(n)&&n.value===e?n:new ps({value:e,cause:n})}};$c=Ff;var Jn=jf,Oc="AI_UnsupportedFunctionalityError",Bc=`vercel.ai.error.${Oc}`,Hf=Symbol.for(Bc),Pc,Ee=class extends le{constructor({functionality:e,message:n=`'${e}' functionality not supported.`}){super({name:Oc,message:n}),this[Pc]=!0,this.functionality=e}static isInstance(e){return le.hasMarker(e,Bc)}};Pc=Hf;let lo=(t,e=21)=>(n=e)=>{let r="",s=n|0;for(;s--;)r+=t[Math.random()*t.length|0];return r};var ve={},$r={};$r.byteLength=qf;$r.toByteArray=zf;$r.fromByteArray=Zf;var Ye=[],Ue=[],Kf=typeof Uint8Array<"u"?Uint8Array:Array,qr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var jt=0,Vf=qr.length;jt<Vf;++jt)Ye[jt]=qr[jt],Ue[qr.charCodeAt(jt)]=jt;Ue[45]=62;Ue[95]=63;function Nc(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");n===-1&&(n=e);var r=n===e?0:4-n%4;return[n,r]}function qf(t){var e=Nc(t),n=e[0],r=e[1];return(n+r)*3/4-r}function Gf(t,e,n){return(e+n)*3/4-n}function zf(t){var e,n=Nc(t),r=n[0],s=n[1],o=new Kf(Gf(t,r,s)),i=0,a=s>0?r-4:r,l;for(l=0;l<a;l+=4)e=Ue[t.charCodeAt(l)]<<18|Ue[t.charCodeAt(l+1)]<<12|Ue[t.charCodeAt(l+2)]<<6|Ue[t.charCodeAt(l+3)],o[i++]=e>>16&255,o[i++]=e>>8&255,o[i++]=e&255;return s===2&&(e=Ue[t.charCodeAt(l)]<<2|Ue[t.charCodeAt(l+1)]>>4,o[i++]=e&255),s===1&&(e=Ue[t.charCodeAt(l)]<<10|Ue[t.charCodeAt(l+1)]<<4|Ue[t.charCodeAt(l+2)]>>2,o[i++]=e>>8&255,o[i++]=e&255),o}function Jf(t){return Ye[t>>18&63]+Ye[t>>12&63]+Ye[t>>6&63]+Ye[t&63]}function Wf(t,e,n){for(var r,s=[],o=e;o<n;o+=3)r=(t[o]<<16&16711680)+(t[o+1]<<8&65280)+(t[o+2]&255),s.push(Jf(r));return s.join("")}function Zf(t){for(var e,n=t.length,r=n%3,s=[],o=16383,i=0,a=n-r;i<a;i+=o)s.push(Wf(t,i,i+o>a?a:i+o));return r===1?(e=t[n-1],s.push(Ye[e>>2]+Ye[e<<4&63]+"==")):r===2&&(e=(t[n-2]<<8)+t[n-1],s.push(Ye[e>>10]+Ye[e>>4&63]+Ye[e<<2&63]+"=")),s.join("")}var uo={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */uo.read=function(t,e,n,r,s){var o,i,a=s*8-r-1,l=(1<<a)-1,c=l>>1,d=-7,h=n?s-1:0,p=n?-1:1,g=t[e+h];for(h+=p,o=g&(1<<-d)-1,g>>=-d,d+=a;d>0;o=o*256+t[e+h],h+=p,d-=8);for(i=o&(1<<-d)-1,o>>=-d,d+=r;d>0;i=i*256+t[e+h],h+=p,d-=8);if(o===0)o=1-c;else{if(o===l)return i?NaN:(g?-1:1)*(1/0);i=i+Math.pow(2,r),o=o-c}return(g?-1:1)*i*Math.pow(2,o-r)};uo.write=function(t,e,n,r,s,o){var i,a,l,c=o*8-s-1,d=(1<<c)-1,h=d>>1,p=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,g=r?0:o-1,v=r?1:-1,b=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,i=d):(i=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-i))<1&&(i--,l*=2),i+h>=1?e+=p/l:e+=p*Math.pow(2,1-h),e*l>=2&&(i++,l/=2),i+h>=d?(a=0,i=d):i+h>=1?(a=(e*l-1)*Math.pow(2,s),i=i+h):(a=e*Math.pow(2,h-1)*Math.pow(2,s),i=0));s>=8;t[n+g]=a&255,g+=v,a/=256,s-=8);for(i=i<<s|a,c+=s;c>0;t[n+g]=i&255,g+=v,i/=256,c-=8);t[n+g-v]|=b*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(t){const e=$r,n=uo,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=d,t.SlowBuffer=$,t.INSPECT_MAX_BYTES=50;const s=2147483647;t.kMaxLength=s;const{Uint8Array:o,ArrayBuffer:i,SharedArrayBuffer:a}=globalThis;d.TYPED_ARRAY_SUPPORT=l(),!d.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function l(){try{const m=new o(1),u={foo:function(){return 42}};return Object.setPrototypeOf(u,o.prototype),Object.setPrototypeOf(m,u),m.foo()===42}catch{return!1}}Object.defineProperty(d.prototype,"parent",{enumerable:!0,get:function(){if(d.isBuffer(this))return this.buffer}}),Object.defineProperty(d.prototype,"offset",{enumerable:!0,get:function(){if(d.isBuffer(this))return this.byteOffset}});function c(m){if(m>s)throw new RangeError('The value "'+m+'" is invalid for option "size"');const u=new o(m);return Object.setPrototypeOf(u,d.prototype),u}function d(m,u,f){if(typeof m=="number"){if(typeof u=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return v(m)}return h(m,u,f)}d.poolSize=8192;function h(m,u,f){if(typeof m=="string")return b(m,u);if(i.isView(m))return S(m);if(m==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof m);if(Ge(m,i)||m&&Ge(m.buffer,i)||typeof a<"u"&&(Ge(m,a)||m&&Ge(m.buffer,a)))return A(m,u,f);if(typeof m=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const y=m.valueOf&&m.valueOf();if(y!=null&&y!==m)return d.from(y,u,f);const x=O(m);if(x)return x;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof m[Symbol.toPrimitive]=="function")return d.from(m[Symbol.toPrimitive]("string"),u,f);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof m)}d.from=function(m,u,f){return h(m,u,f)},Object.setPrototypeOf(d.prototype,o.prototype),Object.setPrototypeOf(d,o);function p(m){if(typeof m!="number")throw new TypeError('"size" argument must be of type number');if(m<0)throw new RangeError('The value "'+m+'" is invalid for option "size"')}function g(m,u,f){return p(m),m<=0?c(m):u!==void 0?typeof f=="string"?c(m).fill(u,f):c(m).fill(u):c(m)}d.alloc=function(m,u,f){return g(m,u,f)};function v(m){return p(m),c(m<0?0:B(m)|0)}d.allocUnsafe=function(m){return v(m)},d.allocUnsafeSlow=function(m){return v(m)};function b(m,u){if((typeof u!="string"||u==="")&&(u="utf8"),!d.isEncoding(u))throw new TypeError("Unknown encoding: "+u);const f=F(m,u)|0;let y=c(f);const x=y.write(m,u);return x!==f&&(y=y.slice(0,x)),y}function w(m){const u=m.length<0?0:B(m.length)|0,f=c(u);for(let y=0;y<u;y+=1)f[y]=m[y]&255;return f}function S(m){if(Ge(m,o)){const u=new o(m);return A(u.buffer,u.byteOffset,u.byteLength)}return w(m)}function A(m,u,f){if(u<0||m.byteLength<u)throw new RangeError('"offset" is outside of buffer bounds');if(m.byteLength<u+(f||0))throw new RangeError('"length" is outside of buffer bounds');let y;return u===void 0&&f===void 0?y=new o(m):f===void 0?y=new o(m,u):y=new o(m,u,f),Object.setPrototypeOf(y,d.prototype),y}function O(m){if(d.isBuffer(m)){const u=B(m.length)|0,f=c(u);return f.length===0||m.copy(f,0,0,u),f}if(m.length!==void 0)return typeof m.length!="number"||Vr(m.length)?c(0):w(m);if(m.type==="Buffer"&&Array.isArray(m.data))return w(m.data)}function B(m){if(m>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return m|0}function $(m){return+m!=m&&(m=0),d.alloc(+m)}d.isBuffer=function(u){return u!=null&&u._isBuffer===!0&&u!==d.prototype},d.compare=function(u,f){if(Ge(u,o)&&(u=d.from(u,u.offset,u.byteLength)),Ge(f,o)&&(f=d.from(f,f.offset,f.byteLength)),!d.isBuffer(u)||!d.isBuffer(f))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(u===f)return 0;let y=u.length,x=f.length;for(let k=0,C=Math.min(y,x);k<C;++k)if(u[k]!==f[k]){y=u[k],x=f[k];break}return y<x?-1:x<y?1:0},d.isEncoding=function(u){switch(String(u).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},d.concat=function(u,f){if(!Array.isArray(u))throw new TypeError('"list" argument must be an Array of Buffers');if(u.length===0)return d.alloc(0);let y;if(f===void 0)for(f=0,y=0;y<u.length;++y)f+=u[y].length;const x=d.allocUnsafe(f);let k=0;for(y=0;y<u.length;++y){let C=u[y];if(Ge(C,o))k+C.length>x.length?(d.isBuffer(C)||(C=d.from(C)),C.copy(x,k)):o.prototype.set.call(x,C,k);else if(d.isBuffer(C))C.copy(x,k);else throw new TypeError('"list" argument must be an Array of Buffers');k+=C.length}return x};function F(m,u){if(d.isBuffer(m))return m.length;if(i.isView(m)||Ge(m,i))return m.byteLength;if(typeof m!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof m);const f=m.length,y=arguments.length>2&&arguments[2]===!0;if(!y&&f===0)return 0;let x=!1;for(;;)switch(u){case"ascii":case"latin1":case"binary":return f;case"utf8":case"utf-8":return Kr(m).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return f*2;case"hex":return f>>>1;case"base64":return oi(m).length;default:if(x)return y?-1:Kr(m).length;u=(""+u).toLowerCase(),x=!0}}d.byteLength=F;function N(m,u,f){let y=!1;if((u===void 0||u<0)&&(u=0),u>this.length||((f===void 0||f>this.length)&&(f=this.length),f<=0)||(f>>>=0,u>>>=0,f<=u))return"";for(m||(m="utf8");;)switch(m){case"hex":return ne(this,u,f);case"utf8":case"utf-8":return me(this,u,f);case"ascii":return pe(this,u,f);case"latin1":case"binary":return we(this,u,f);case"base64":return se(this,u,f);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return df(this,u,f);default:if(y)throw new TypeError("Unknown encoding: "+m);m=(m+"").toLowerCase(),y=!0}}d.prototype._isBuffer=!0;function Z(m,u,f){const y=m[u];m[u]=m[f],m[f]=y}d.prototype.swap16=function(){const u=this.length;if(u%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let f=0;f<u;f+=2)Z(this,f,f+1);return this},d.prototype.swap32=function(){const u=this.length;if(u%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let f=0;f<u;f+=4)Z(this,f,f+3),Z(this,f+1,f+2);return this},d.prototype.swap64=function(){const u=this.length;if(u%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let f=0;f<u;f+=8)Z(this,f,f+7),Z(this,f+1,f+6),Z(this,f+2,f+5),Z(this,f+3,f+4);return this},d.prototype.toString=function(){const u=this.length;return u===0?"":arguments.length===0?me(this,0,u):N.apply(this,arguments)},d.prototype.toLocaleString=d.prototype.toString,d.prototype.equals=function(u){if(!d.isBuffer(u))throw new TypeError("Argument must be a Buffer");return this===u?!0:d.compare(this,u)===0},d.prototype.inspect=function(){let u="";const f=t.INSPECT_MAX_BYTES;return u=this.toString("hex",0,f).replace(/(.{2})/g,"$1 ").trim(),this.length>f&&(u+=" ... "),"<Buffer "+u+">"},r&&(d.prototype[r]=d.prototype.inspect),d.prototype.compare=function(u,f,y,x,k){if(Ge(u,o)&&(u=d.from(u,u.offset,u.byteLength)),!d.isBuffer(u))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof u);if(f===void 0&&(f=0),y===void 0&&(y=u?u.length:0),x===void 0&&(x=0),k===void 0&&(k=this.length),f<0||y>u.length||x<0||k>this.length)throw new RangeError("out of range index");if(x>=k&&f>=y)return 0;if(x>=k)return-1;if(f>=y)return 1;if(f>>>=0,y>>>=0,x>>>=0,k>>>=0,this===u)return 0;let C=k-x,z=y-f;const ae=Math.min(C,z),oe=this.slice(x,k),ce=u.slice(f,y);for(let X=0;X<ae;++X)if(oe[X]!==ce[X]){C=oe[X],z=ce[X];break}return C<z?-1:z<C?1:0};function re(m,u,f,y,x){if(m.length===0)return-1;if(typeof f=="string"?(y=f,f=0):f>2147483647?f=2147483647:f<-2147483648&&(f=-2147483648),f=+f,Vr(f)&&(f=x?0:m.length-1),f<0&&(f=m.length+f),f>=m.length){if(x)return-1;f=m.length-1}else if(f<0)if(x)f=0;else return-1;if(typeof u=="string"&&(u=d.from(u,y)),d.isBuffer(u))return u.length===0?-1:ie(m,u,f,y,x);if(typeof u=="number")return u=u&255,typeof o.prototype.indexOf=="function"?x?o.prototype.indexOf.call(m,u,f):o.prototype.lastIndexOf.call(m,u,f):ie(m,[u],f,y,x);throw new TypeError("val must be string, number or Buffer")}function ie(m,u,f,y,x){let k=1,C=m.length,z=u.length;if(y!==void 0&&(y=String(y).toLowerCase(),y==="ucs2"||y==="ucs-2"||y==="utf16le"||y==="utf-16le")){if(m.length<2||u.length<2)return-1;k=2,C/=2,z/=2,f/=2}function ae(ce,X){return k===1?ce[X]:ce.readUInt16BE(X*k)}let oe;if(x){let ce=-1;for(oe=f;oe<C;oe++)if(ae(m,oe)===ae(u,ce===-1?0:oe-ce)){if(ce===-1&&(ce=oe),oe-ce+1===z)return ce*k}else ce!==-1&&(oe-=oe-ce),ce=-1}else for(f+z>C&&(f=C-z),oe=f;oe>=0;oe--){let ce=!0;for(let X=0;X<z;X++)if(ae(m,oe+X)!==ae(u,X)){ce=!1;break}if(ce)return oe}return-1}d.prototype.includes=function(u,f,y){return this.indexOf(u,f,y)!==-1},d.prototype.indexOf=function(u,f,y){return re(this,u,f,y,!0)},d.prototype.lastIndexOf=function(u,f,y){return re(this,u,f,y,!1)};function te(m,u,f,y){f=Number(f)||0;const x=m.length-f;y?(y=Number(y),y>x&&(y=x)):y=x;const k=u.length;y>k/2&&(y=k/2);let C;for(C=0;C<y;++C){const z=parseInt(u.substr(C*2,2),16);if(Vr(z))return C;m[f+C]=z}return C}function ue(m,u,f,y){return Bn(Kr(u,m.length-f),m,f,y)}function de(m,u,f,y){return Bn(mf(u),m,f,y)}function fe(m,u,f,y){return Bn(oi(u),m,f,y)}function Q(m,u,f,y){return Bn(gf(u,m.length-f),m,f,y)}d.prototype.write=function(u,f,y,x){if(f===void 0)x="utf8",y=this.length,f=0;else if(y===void 0&&typeof f=="string")x=f,y=this.length,f=0;else if(isFinite(f))f=f>>>0,isFinite(y)?(y=y>>>0,x===void 0&&(x="utf8")):(x=y,y=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const k=this.length-f;if((y===void 0||y>k)&&(y=k),u.length>0&&(y<0||f<0)||f>this.length)throw new RangeError("Attempt to write outside buffer bounds");x||(x="utf8");let C=!1;for(;;)switch(x){case"hex":return te(this,u,f,y);case"utf8":case"utf-8":return ue(this,u,f,y);case"ascii":case"latin1":case"binary":return de(this,u,f,y);case"base64":return fe(this,u,f,y);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Q(this,u,f,y);default:if(C)throw new TypeError("Unknown encoding: "+x);x=(""+x).toLowerCase(),C=!0}},d.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function se(m,u,f){return u===0&&f===m.length?e.fromByteArray(m):e.fromByteArray(m.slice(u,f))}function me(m,u,f){f=Math.min(m.length,f);const y=[];let x=u;for(;x<f;){const k=m[x];let C=null,z=k>239?4:k>223?3:k>191?2:1;if(x+z<=f){let ae,oe,ce,X;switch(z){case 1:k<128&&(C=k);break;case 2:ae=m[x+1],(ae&192)===128&&(X=(k&31)<<6|ae&63,X>127&&(C=X));break;case 3:ae=m[x+1],oe=m[x+2],(ae&192)===128&&(oe&192)===128&&(X=(k&15)<<12|(ae&63)<<6|oe&63,X>2047&&(X<55296||X>57343)&&(C=X));break;case 4:ae=m[x+1],oe=m[x+2],ce=m[x+3],(ae&192)===128&&(oe&192)===128&&(ce&192)===128&&(X=(k&15)<<18|(ae&63)<<12|(oe&63)<<6|ce&63,X>65535&&X<1114112&&(C=X))}}C===null?(C=65533,z=1):C>65535&&(C-=65536,y.push(C>>>10&1023|55296),C=56320|C&1023),y.push(C),x+=z}return Y(y)}const qe=4096;function Y(m){const u=m.length;if(u<=qe)return String.fromCharCode.apply(String,m);let f="",y=0;for(;y<u;)f+=String.fromCharCode.apply(String,m.slice(y,y+=qe));return f}function pe(m,u,f){let y="";f=Math.min(m.length,f);for(let x=u;x<f;++x)y+=String.fromCharCode(m[x]&127);return y}function we(m,u,f){let y="";f=Math.min(m.length,f);for(let x=u;x<f;++x)y+=String.fromCharCode(m[x]);return y}function ne(m,u,f){const y=m.length;(!u||u<0)&&(u=0),(!f||f<0||f>y)&&(f=y);let x="";for(let k=u;k<f;++k)x+=yf[m[k]];return x}function df(m,u,f){const y=m.slice(u,f);let x="";for(let k=0;k<y.length-1;k+=2)x+=String.fromCharCode(y[k]+y[k+1]*256);return x}d.prototype.slice=function(u,f){const y=this.length;u=~~u,f=f===void 0?y:~~f,u<0?(u+=y,u<0&&(u=0)):u>y&&(u=y),f<0?(f+=y,f<0&&(f=0)):f>y&&(f=y),f<u&&(f=u);const x=this.subarray(u,f);return Object.setPrototypeOf(x,d.prototype),x};function be(m,u,f){if(m%1!==0||m<0)throw new RangeError("offset is not uint");if(m+u>f)throw new RangeError("Trying to access beyond buffer length")}d.prototype.readUintLE=d.prototype.readUIntLE=function(u,f,y){u=u>>>0,f=f>>>0,y||be(u,f,this.length);let x=this[u],k=1,C=0;for(;++C<f&&(k*=256);)x+=this[u+C]*k;return x},d.prototype.readUintBE=d.prototype.readUIntBE=function(u,f,y){u=u>>>0,f=f>>>0,y||be(u,f,this.length);let x=this[u+--f],k=1;for(;f>0&&(k*=256);)x+=this[u+--f]*k;return x},d.prototype.readUint8=d.prototype.readUInt8=function(u,f){return u=u>>>0,f||be(u,1,this.length),this[u]},d.prototype.readUint16LE=d.prototype.readUInt16LE=function(u,f){return u=u>>>0,f||be(u,2,this.length),this[u]|this[u+1]<<8},d.prototype.readUint16BE=d.prototype.readUInt16BE=function(u,f){return u=u>>>0,f||be(u,2,this.length),this[u]<<8|this[u+1]},d.prototype.readUint32LE=d.prototype.readUInt32LE=function(u,f){return u=u>>>0,f||be(u,4,this.length),(this[u]|this[u+1]<<8|this[u+2]<<16)+this[u+3]*16777216},d.prototype.readUint32BE=d.prototype.readUInt32BE=function(u,f){return u=u>>>0,f||be(u,4,this.length),this[u]*16777216+(this[u+1]<<16|this[u+2]<<8|this[u+3])},d.prototype.readBigUInt64LE=mt(function(u){u=u>>>0,Ft(u,"offset");const f=this[u],y=this[u+7];(f===void 0||y===void 0)&&an(u,this.length-8);const x=f+this[++u]*2**8+this[++u]*2**16+this[++u]*2**24,k=this[++u]+this[++u]*2**8+this[++u]*2**16+y*2**24;return BigInt(x)+(BigInt(k)<<BigInt(32))}),d.prototype.readBigUInt64BE=mt(function(u){u=u>>>0,Ft(u,"offset");const f=this[u],y=this[u+7];(f===void 0||y===void 0)&&an(u,this.length-8);const x=f*2**24+this[++u]*2**16+this[++u]*2**8+this[++u],k=this[++u]*2**24+this[++u]*2**16+this[++u]*2**8+y;return(BigInt(x)<<BigInt(32))+BigInt(k)}),d.prototype.readIntLE=function(u,f,y){u=u>>>0,f=f>>>0,y||be(u,f,this.length);let x=this[u],k=1,C=0;for(;++C<f&&(k*=256);)x+=this[u+C]*k;return k*=128,x>=k&&(x-=Math.pow(2,8*f)),x},d.prototype.readIntBE=function(u,f,y){u=u>>>0,f=f>>>0,y||be(u,f,this.length);let x=f,k=1,C=this[u+--x];for(;x>0&&(k*=256);)C+=this[u+--x]*k;return k*=128,C>=k&&(C-=Math.pow(2,8*f)),C},d.prototype.readInt8=function(u,f){return u=u>>>0,f||be(u,1,this.length),this[u]&128?(255-this[u]+1)*-1:this[u]},d.prototype.readInt16LE=function(u,f){u=u>>>0,f||be(u,2,this.length);const y=this[u]|this[u+1]<<8;return y&32768?y|4294901760:y},d.prototype.readInt16BE=function(u,f){u=u>>>0,f||be(u,2,this.length);const y=this[u+1]|this[u]<<8;return y&32768?y|4294901760:y},d.prototype.readInt32LE=function(u,f){return u=u>>>0,f||be(u,4,this.length),this[u]|this[u+1]<<8|this[u+2]<<16|this[u+3]<<24},d.prototype.readInt32BE=function(u,f){return u=u>>>0,f||be(u,4,this.length),this[u]<<24|this[u+1]<<16|this[u+2]<<8|this[u+3]},d.prototype.readBigInt64LE=mt(function(u){u=u>>>0,Ft(u,"offset");const f=this[u],y=this[u+7];(f===void 0||y===void 0)&&an(u,this.length-8);const x=this[u+4]+this[u+5]*2**8+this[u+6]*2**16+(y<<24);return(BigInt(x)<<BigInt(32))+BigInt(f+this[++u]*2**8+this[++u]*2**16+this[++u]*2**24)}),d.prototype.readBigInt64BE=mt(function(u){u=u>>>0,Ft(u,"offset");const f=this[u],y=this[u+7];(f===void 0||y===void 0)&&an(u,this.length-8);const x=(f<<24)+this[++u]*2**16+this[++u]*2**8+this[++u];return(BigInt(x)<<BigInt(32))+BigInt(this[++u]*2**24+this[++u]*2**16+this[++u]*2**8+y)}),d.prototype.readFloatLE=function(u,f){return u=u>>>0,f||be(u,4,this.length),n.read(this,u,!0,23,4)},d.prototype.readFloatBE=function(u,f){return u=u>>>0,f||be(u,4,this.length),n.read(this,u,!1,23,4)},d.prototype.readDoubleLE=function(u,f){return u=u>>>0,f||be(u,8,this.length),n.read(this,u,!0,52,8)},d.prototype.readDoubleBE=function(u,f){return u=u>>>0,f||be(u,8,this.length),n.read(this,u,!1,52,8)};function $e(m,u,f,y,x,k){if(!d.isBuffer(m))throw new TypeError('"buffer" argument must be a Buffer instance');if(u>x||u<k)throw new RangeError('"value" argument is out of bounds');if(f+y>m.length)throw new RangeError("Index out of range")}d.prototype.writeUintLE=d.prototype.writeUIntLE=function(u,f,y,x){if(u=+u,f=f>>>0,y=y>>>0,!x){const z=Math.pow(2,8*y)-1;$e(this,u,f,y,z,0)}let k=1,C=0;for(this[f]=u&255;++C<y&&(k*=256);)this[f+C]=u/k&255;return f+y},d.prototype.writeUintBE=d.prototype.writeUIntBE=function(u,f,y,x){if(u=+u,f=f>>>0,y=y>>>0,!x){const z=Math.pow(2,8*y)-1;$e(this,u,f,y,z,0)}let k=y-1,C=1;for(this[f+k]=u&255;--k>=0&&(C*=256);)this[f+k]=u/C&255;return f+y},d.prototype.writeUint8=d.prototype.writeUInt8=function(u,f,y){return u=+u,f=f>>>0,y||$e(this,u,f,1,255,0),this[f]=u&255,f+1},d.prototype.writeUint16LE=d.prototype.writeUInt16LE=function(u,f,y){return u=+u,f=f>>>0,y||$e(this,u,f,2,65535,0),this[f]=u&255,this[f+1]=u>>>8,f+2},d.prototype.writeUint16BE=d.prototype.writeUInt16BE=function(u,f,y){return u=+u,f=f>>>0,y||$e(this,u,f,2,65535,0),this[f]=u>>>8,this[f+1]=u&255,f+2},d.prototype.writeUint32LE=d.prototype.writeUInt32LE=function(u,f,y){return u=+u,f=f>>>0,y||$e(this,u,f,4,4294967295,0),this[f+3]=u>>>24,this[f+2]=u>>>16,this[f+1]=u>>>8,this[f]=u&255,f+4},d.prototype.writeUint32BE=d.prototype.writeUInt32BE=function(u,f,y){return u=+u,f=f>>>0,y||$e(this,u,f,4,4294967295,0),this[f]=u>>>24,this[f+1]=u>>>16,this[f+2]=u>>>8,this[f+3]=u&255,f+4};function Qo(m,u,f,y,x){si(u,y,x,m,f,7);let k=Number(u&BigInt(4294967295));m[f++]=k,k=k>>8,m[f++]=k,k=k>>8,m[f++]=k,k=k>>8,m[f++]=k;let C=Number(u>>BigInt(32)&BigInt(4294967295));return m[f++]=C,C=C>>8,m[f++]=C,C=C>>8,m[f++]=C,C=C>>8,m[f++]=C,f}function Xo(m,u,f,y,x){si(u,y,x,m,f,7);let k=Number(u&BigInt(4294967295));m[f+7]=k,k=k>>8,m[f+6]=k,k=k>>8,m[f+5]=k,k=k>>8,m[f+4]=k;let C=Number(u>>BigInt(32)&BigInt(4294967295));return m[f+3]=C,C=C>>8,m[f+2]=C,C=C>>8,m[f+1]=C,C=C>>8,m[f]=C,f+8}d.prototype.writeBigUInt64LE=mt(function(u,f=0){return Qo(this,u,f,BigInt(0),BigInt("0xffffffffffffffff"))}),d.prototype.writeBigUInt64BE=mt(function(u,f=0){return Xo(this,u,f,BigInt(0),BigInt("0xffffffffffffffff"))}),d.prototype.writeIntLE=function(u,f,y,x){if(u=+u,f=f>>>0,!x){const ae=Math.pow(2,8*y-1);$e(this,u,f,y,ae-1,-ae)}let k=0,C=1,z=0;for(this[f]=u&255;++k<y&&(C*=256);)u<0&&z===0&&this[f+k-1]!==0&&(z=1),this[f+k]=(u/C>>0)-z&255;return f+y},d.prototype.writeIntBE=function(u,f,y,x){if(u=+u,f=f>>>0,!x){const ae=Math.pow(2,8*y-1);$e(this,u,f,y,ae-1,-ae)}let k=y-1,C=1,z=0;for(this[f+k]=u&255;--k>=0&&(C*=256);)u<0&&z===0&&this[f+k+1]!==0&&(z=1),this[f+k]=(u/C>>0)-z&255;return f+y},d.prototype.writeInt8=function(u,f,y){return u=+u,f=f>>>0,y||$e(this,u,f,1,127,-128),u<0&&(u=255+u+1),this[f]=u&255,f+1},d.prototype.writeInt16LE=function(u,f,y){return u=+u,f=f>>>0,y||$e(this,u,f,2,32767,-32768),this[f]=u&255,this[f+1]=u>>>8,f+2},d.prototype.writeInt16BE=function(u,f,y){return u=+u,f=f>>>0,y||$e(this,u,f,2,32767,-32768),this[f]=u>>>8,this[f+1]=u&255,f+2},d.prototype.writeInt32LE=function(u,f,y){return u=+u,f=f>>>0,y||$e(this,u,f,4,2147483647,-2147483648),this[f]=u&255,this[f+1]=u>>>8,this[f+2]=u>>>16,this[f+3]=u>>>24,f+4},d.prototype.writeInt32BE=function(u,f,y){return u=+u,f=f>>>0,y||$e(this,u,f,4,2147483647,-2147483648),u<0&&(u=4294967295+u+1),this[f]=u>>>24,this[f+1]=u>>>16,this[f+2]=u>>>8,this[f+3]=u&255,f+4},d.prototype.writeBigInt64LE=mt(function(u,f=0){return Qo(this,u,f,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),d.prototype.writeBigInt64BE=mt(function(u,f=0){return Xo(this,u,f,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function ei(m,u,f,y,x,k){if(f+y>m.length)throw new RangeError("Index out of range");if(f<0)throw new RangeError("Index out of range")}function ti(m,u,f,y,x){return u=+u,f=f>>>0,x||ei(m,u,f,4),n.write(m,u,f,y,23,4),f+4}d.prototype.writeFloatLE=function(u,f,y){return ti(this,u,f,!0,y)},d.prototype.writeFloatBE=function(u,f,y){return ti(this,u,f,!1,y)};function ni(m,u,f,y,x){return u=+u,f=f>>>0,x||ei(m,u,f,8),n.write(m,u,f,y,52,8),f+8}d.prototype.writeDoubleLE=function(u,f,y){return ni(this,u,f,!0,y)},d.prototype.writeDoubleBE=function(u,f,y){return ni(this,u,f,!1,y)},d.prototype.copy=function(u,f,y,x){if(!d.isBuffer(u))throw new TypeError("argument should be a Buffer");if(y||(y=0),!x&&x!==0&&(x=this.length),f>=u.length&&(f=u.length),f||(f=0),x>0&&x<y&&(x=y),x===y||u.length===0||this.length===0)return 0;if(f<0)throw new RangeError("targetStart out of bounds");if(y<0||y>=this.length)throw new RangeError("Index out of range");if(x<0)throw new RangeError("sourceEnd out of bounds");x>this.length&&(x=this.length),u.length-f<x-y&&(x=u.length-f+y);const k=x-y;return this===u&&typeof o.prototype.copyWithin=="function"?this.copyWithin(f,y,x):o.prototype.set.call(u,this.subarray(y,x),f),k},d.prototype.fill=function(u,f,y,x){if(typeof u=="string"){if(typeof f=="string"?(x=f,f=0,y=this.length):typeof y=="string"&&(x=y,y=this.length),x!==void 0&&typeof x!="string")throw new TypeError("encoding must be a string");if(typeof x=="string"&&!d.isEncoding(x))throw new TypeError("Unknown encoding: "+x);if(u.length===1){const C=u.charCodeAt(0);(x==="utf8"&&C<128||x==="latin1")&&(u=C)}}else typeof u=="number"?u=u&255:typeof u=="boolean"&&(u=Number(u));if(f<0||this.length<f||this.length<y)throw new RangeError("Out of range index");if(y<=f)return this;f=f>>>0,y=y===void 0?this.length:y>>>0,u||(u=0);let k;if(typeof u=="number")for(k=f;k<y;++k)this[k]=u;else{const C=d.isBuffer(u)?u:d.from(u,x),z=C.length;if(z===0)throw new TypeError('The value "'+u+'" is invalid for argument "value"');for(k=0;k<y-f;++k)this[k+f]=C[k%z]}return this};const Lt={};function Hr(m,u,f){Lt[m]=class extends f{constructor(){super(),Object.defineProperty(this,"message",{value:u.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${m}]`,this.stack,delete this.name}get code(){return m}set code(x){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:x,writable:!0})}toString(){return`${this.name} [${m}]: ${this.message}`}}}Hr("ERR_BUFFER_OUT_OF_BOUNDS",function(m){return m?`${m} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Hr("ERR_INVALID_ARG_TYPE",function(m,u){return`The "${m}" argument must be of type number. Received type ${typeof u}`},TypeError),Hr("ERR_OUT_OF_RANGE",function(m,u,f){let y=`The value of "${m}" is out of range.`,x=f;return Number.isInteger(f)&&Math.abs(f)>2**32?x=ri(String(f)):typeof f=="bigint"&&(x=String(f),(f>BigInt(2)**BigInt(32)||f<-(BigInt(2)**BigInt(32)))&&(x=ri(x)),x+="n"),y+=` It must be ${u}. Received ${x}`,y},RangeError);function ri(m){let u="",f=m.length;const y=m[0]==="-"?1:0;for(;f>=y+4;f-=3)u=`_${m.slice(f-3,f)}${u}`;return`${m.slice(0,f)}${u}`}function ff(m,u,f){Ft(u,"offset"),(m[u]===void 0||m[u+f]===void 0)&&an(u,m.length-(f+1))}function si(m,u,f,y,x,k){if(m>f||m<u){const C=typeof u=="bigint"?"n":"";let z;throw u===0||u===BigInt(0)?z=`>= 0${C} and < 2${C} ** ${(k+1)*8}${C}`:z=`>= -(2${C} ** ${(k+1)*8-1}${C}) and < 2 ** ${(k+1)*8-1}${C}`,new Lt.ERR_OUT_OF_RANGE("value",z,m)}ff(y,x,k)}function Ft(m,u){if(typeof m!="number")throw new Lt.ERR_INVALID_ARG_TYPE(u,"number",m)}function an(m,u,f){throw Math.floor(m)!==m?(Ft(m,f),new Lt.ERR_OUT_OF_RANGE("offset","an integer",m)):u<0?new Lt.ERR_BUFFER_OUT_OF_BOUNDS:new Lt.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${u}`,m)}const pf=/[^+/0-9A-Za-z-_]/g;function hf(m){if(m=m.split("=")[0],m=m.trim().replace(pf,""),m.length<2)return"";for(;m.length%4!==0;)m=m+"=";return m}function Kr(m,u){u=u||1/0;let f;const y=m.length;let x=null;const k=[];for(let C=0;C<y;++C){if(f=m.charCodeAt(C),f>55295&&f<57344){if(!x){if(f>56319){(u-=3)>-1&&k.push(239,191,189);continue}else if(C+1===y){(u-=3)>-1&&k.push(239,191,189);continue}x=f;continue}if(f<56320){(u-=3)>-1&&k.push(239,191,189),x=f;continue}f=(x-55296<<10|f-56320)+65536}else x&&(u-=3)>-1&&k.push(239,191,189);if(x=null,f<128){if((u-=1)<0)break;k.push(f)}else if(f<2048){if((u-=2)<0)break;k.push(f>>6|192,f&63|128)}else if(f<65536){if((u-=3)<0)break;k.push(f>>12|224,f>>6&63|128,f&63|128)}else if(f<1114112){if((u-=4)<0)break;k.push(f>>18|240,f>>12&63|128,f>>6&63|128,f&63|128)}else throw new Error("Invalid code point")}return k}function mf(m){const u=[];for(let f=0;f<m.length;++f)u.push(m.charCodeAt(f)&255);return u}function gf(m,u){let f,y,x;const k=[];for(let C=0;C<m.length&&!((u-=2)<0);++C)f=m.charCodeAt(C),y=f>>8,x=f%256,k.push(x),k.push(y);return k}function oi(m){return e.toByteArray(hf(m))}function Bn(m,u,f,y){let x;for(x=0;x<y&&!(x+f>=u.length||x>=m.length);++x)u[x+f]=m[x];return x}function Ge(m,u){return m instanceof u||m!=null&&m.constructor!=null&&m.constructor.name!=null&&m.constructor.name===u.name}function Vr(m){return m!==m}const yf=function(){const m="0123456789abcdef",u=new Array(256);for(let f=0;f<16;++f){const y=f*16;for(let x=0;x<16;++x)u[y+x]=m[f]+m[x]}return u}();function mt(m){return typeof BigInt>"u"?vf:m}function vf(){throw new Error("BigInt not supported")}})(ve);const Ot=ve.Buffer,Yf=ve.Blob,Qf=ve.BlobOptions,Xf=ve.Buffer,ep=ve.File,tp=ve.FileOptions,np=ve.INSPECT_MAX_BYTES,rp=ve.SlowBuffer,sp=ve.TranscodeEncoding,op=ve.atob,ip=ve.btoa,ap=ve.constants,cp=ve.isAscii,lp=ve.isUtf8,up=ve.kMaxLength,dp=ve.kStringMaxLength,fp=ve.resolveObjectURL,pp=ve.transcode,ek=Object.freeze(Object.defineProperty({__proto__:null,Blob:Yf,BlobOptions:Qf,Buffer:Xf,File:ep,FileOptions:tp,INSPECT_MAX_BYTES:np,SlowBuffer:rp,TranscodeEncoding:sp,atob:op,btoa:ip,constants:ap,default:Ot,isAscii:cp,isUtf8:lp,kMaxLength:up,kStringMaxLength:dp,resolveObjectURL:fp,transcode:pp},Symbol.toStringTag,{value:"Module"}));var nn={exports:{}};const hp=typeof Ot<"u",ai=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,ci=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function Mc(t,e,n){n==null&&e!==null&&typeof e=="object"&&(n=e,e=void 0),hp&&Ot.isBuffer(t)&&(t=t.toString()),t&&t.charCodeAt(0)===65279&&(t=t.slice(1));const r=JSON.parse(t,e);if(r===null||typeof r!="object")return r;const s=n&&n.protoAction||"error",o=n&&n.constructorAction||"error";if(s==="ignore"&&o==="ignore")return r;if(s!=="ignore"&&o!=="ignore"){if(ai.test(t)===!1&&ci.test(t)===!1)return r}else if(s!=="ignore"&&o==="ignore"){if(ai.test(t)===!1)return r}else if(ci.test(t)===!1)return r;return Dc(r,{protoAction:s,constructorAction:o,safe:n&&n.safe})}function Dc(t,{protoAction:e="error",constructorAction:n="error",safe:r}={}){let s=[t];for(;s.length;){const o=s;s=[];for(const i of o){if(e!=="ignore"&&Object.prototype.hasOwnProperty.call(i,"__proto__")){if(r===!0)return null;if(e==="error")throw new SyntaxError("Object contains forbidden prototype property");delete i.__proto__}if(n!=="ignore"&&Object.prototype.hasOwnProperty.call(i,"constructor")&&Object.prototype.hasOwnProperty.call(i.constructor,"prototype")){if(r===!0)return null;if(n==="error")throw new SyntaxError("Object contains forbidden prototype property");delete i.constructor}for(const a in i){const l=i[a];l&&typeof l=="object"&&s.push(l)}}}return t}function fo(t,e,n){const r=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return Mc(t,e,n)}finally{Error.stackTraceLimit=r}}function mp(t,e){const n=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return Mc(t,e,{safe:!0})}catch{return null}finally{Error.stackTraceLimit=n}}nn.exports=fo;nn.exports.default=fo;nn.exports.parse=fo;nn.exports.safeParse=mp;nn.exports.scan=Dc;var gp=nn.exports;const je=bf(gp);class li extends Error{constructor(e,n){super(e),this.name="ParseError",this.type=n.type,this.field=n.field,this.value=n.value,this.line=n.line}}function Gr(t){}function yp(t){if(typeof t=="function")throw new TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");const{onEvent:e=Gr,onError:n=Gr,onRetry:r=Gr,onComment:s}=t;let o="",i=!0,a,l="",c="";function d(b){const w=i?b.replace(/^\xEF\xBB\xBF/,""):b,[S,A]=vp(`${o}${w}`);for(const O of S)h(O);o=A,i=!1}function h(b){if(b===""){g();return}if(b.startsWith(":")){s&&s(b.slice(b.startsWith(": ")?2:1));return}const w=b.indexOf(":");if(w!==-1){const S=b.slice(0,w),A=b[w+1]===" "?2:1,O=b.slice(w+A);p(S,O,b);return}p(b,"",b)}function p(b,w,S){switch(b){case"event":c=w;break;case"data":l=`${l}${w}
`;break;case"id":a=w.includes("\0")?void 0:w;break;case"retry":/^\d+$/.test(w)?r(parseInt(w,10)):n(new li(`Invalid \`retry\` value: "${w}"`,{type:"invalid-retry",value:w,line:S}));break;default:n(new li(`Unknown field "${b.length>20?`${b.slice(0,20)}â€¦`:b}"`,{type:"unknown-field",field:b,value:w,line:S}));break}}function g(){l.length>0&&e({id:a,event:c||void 0,data:l.endsWith(`
`)?l.slice(0,-1):l}),a=void 0,l="",c=""}function v(b={}){o&&b.consume&&h(o),i=!0,a=void 0,l="",c="",o=""}return{feed:d,reset:v}}function vp(t){const e=[];let n="",r=0;for(;r<t.length;){const s=t.indexOf("\r",r),o=t.indexOf(`
`,r);let i=-1;if(s!==-1&&o!==-1?i=Math.min(s,o):s!==-1?i=s:o!==-1&&(i=o),i===-1){n=t.slice(r);break}else{const a=t.slice(r,i);e.push(a),r=i+1,t[r-1]==="\r"&&t[r]===`
`&&r++}}return[e,n]}let Uc=class extends TransformStream{constructor({onError:e,onRetry:n,onComment:r}={}){let s;super({start(o){s=yp({onEvent:i=>{o.enqueue(i)},onError(i){e==="terminate"?o.error(i):typeof e=="function"&&e(i)},onRetry:n,onComment:r})},transform(o){s.feed(o)}})}};var wp={};function _t(...t){return t.reduce((e,n)=>({...e,...n??{}}),{})}function Or(t){const e={};return t.headers.forEach((n,r)=>{e[r]=n}),e}var bp=({prefix:t,size:e=16,alphabet:n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{const s=lo(n,e);if(t==null)return s;if(n.includes(r))throw new Rf({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${n}".`});return o=>`${t}${r}${s(o)}`},bt=bp();function zr(t){return t instanceof Error&&(t.name==="AbortError"||t.name==="TimeoutError")}function Lc({apiKey:t,environmentVariableName:e,apiKeyParameterName:n="apiKey",description:r}){if(typeof t=="string")return t;if(t!=null)throw new Nn({message:`${r} API key must be a string.`});if(typeof Pe>"u")throw new Nn({message:`${r} API key is missing. Pass it using the '${n}' parameter. Environment variables is not supported in this environment.`});if(t=wp[e],t==null)throw new Nn({message:`${r} API key is missing. Pass it using the '${n}' parameter or the ${e} environment variable.`});if(typeof t!="string")throw new Nn({message:`${r} API key must be a string. The value of the ${e} environment variable is not a string.`});return t}var hs=Symbol.for("vercel.ai.validator");function _p(t){return{[hs]:!0,validate:t}}function xp(t){return typeof t=="object"&&t!==null&&hs in t&&t[hs]===!0&&"validate"in t}function Ep(t){return xp(t)?t:kp(t)}function kp(t){return _p(e=>{const n=t.safeParse(e);return n.success?{success:!0,value:n.data}:{success:!1,error:n.error}})}function Sp({value:t,schema:e}){const n=Wn({value:t,schema:e});if(!n.success)throw Jn.wrap({value:t,cause:n.error});return n.value}function Wn({value:t,schema:e}){const n=Ep(e);try{if(n.validate==null)return{success:!0,value:t};const r=n.validate(t);return r.success?r:{success:!1,error:Jn.wrap({value:t,cause:r.error})}}catch(r){return{success:!1,error:Jn.wrap({value:t,cause:r})}}}function Ap({text:t,schema:e}){try{const n=je.parse(t);return e==null?n:Sp({value:n,schema:e})}catch(n){throw zn.isInstance(n)||Jn.isInstance(n)?n:new zn({text:t,cause:n})}}function Fc({text:t,schema:e}){try{const n=je.parse(t);if(e==null)return{success:!0,value:n,rawValue:n};const r=Wn({value:n,schema:e});return r.success?{...r,rawValue:n}:r}catch(n){return{success:!1,error:zn.isInstance(n)?n:new zn({text:t,cause:n})}}}function Zn(t){try{return je.parse(t),!0}catch{return!1}}function Cp(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>n!=null))}var Tp=()=>globalThis.fetch,xt=async({url:t,headers:e,body:n,failedResponseHandler:r,successfulResponseHandler:s,abortSignal:o,fetch:i})=>Ip({url:t,headers:{"Content-Type":"application/json",...e},body:{content:JSON.stringify(n),values:n},failedResponseHandler:r,successfulResponseHandler:s,abortSignal:o,fetch:i}),Ip=async({url:t,headers:e={},body:n,successfulResponseHandler:r,failedResponseHandler:s,abortSignal:o,fetch:i=Tp()})=>{try{const a=await i(t,{method:"POST",headers:Cp(e),body:n.content,signal:o}),l=Or(a);if(!a.ok){let c;try{c=await s({response:a,url:t,requestBodyValues:n.values})}catch(d){throw zr(d)||st.isInstance(d)?d:new st({message:"Failed to process error response",cause:d,statusCode:a.status,url:t,responseHeaders:l,requestBodyValues:n.values})}throw c.value}try{return await r({response:a,url:t,requestBodyValues:n.values})}catch(c){throw c instanceof Error&&(zr(c)||st.isInstance(c))?c:new st({message:"Failed to process successful response",cause:c,statusCode:a.status,url:t,responseHeaders:l,requestBodyValues:n.values})}}catch(a){if(zr(a))throw a;if(a instanceof TypeError&&a.message==="fetch failed"){const l=a.cause;if(l!=null)throw new st({message:`Cannot connect to API: ${l.message}`,cause:l,url:t,requestBodyValues:n.values,isRetryable:!0})}throw a}},jc=({errorSchema:t,errorToMessage:e,isRetryable:n})=>async({response:r,url:s,requestBodyValues:o})=>{const i=await r.text(),a=Or(r);if(i.trim()==="")return{responseHeaders:a,value:new st({message:r.statusText,url:s,requestBodyValues:o,statusCode:r.status,responseHeaders:a,responseBody:i,isRetryable:n?.(r)})};try{const l=Ap({text:i,schema:t});return{responseHeaders:a,value:new st({message:e(l),url:s,requestBodyValues:o,statusCode:r.status,responseHeaders:a,responseBody:i,data:l,isRetryable:n?.(r,l)})}}catch{return{responseHeaders:a,value:new st({message:r.statusText,url:s,requestBodyValues:o,statusCode:r.status,responseHeaders:a,responseBody:i,isRetryable:n?.(r)})}}},po=t=>async({response:e})=>{const n=Or(e);if(e.body==null)throw new Tf({});return{responseHeaders:n,value:e.body.pipeThrough(new TextDecoderStream).pipeThrough(new Uc).pipeThrough(new TransformStream({transform({data:r},s){r!=="[DONE]"&&s.enqueue(Fc({text:r,schema:t}))}}))}},Tn=t=>async({response:e,url:n,requestBodyValues:r})=>{const s=await e.text(),o=Fc({text:s,schema:t}),i=Or(e);if(!o.success)throw new st({message:"Invalid JSON response",cause:o.error,statusCode:e.status,responseHeaders:i,responseBody:s,url:n,requestBodyValues:r});return{responseHeaders:i,value:o.value,rawValue:o.rawValue}},{btoa:Rp}=globalThis;function Hc(t){let e="";for(let n=0;n<t.length;n++)e+=String.fromCodePoint(t[n]);return Rp(e)}function Kc(t){return t?.replace(/\/$/,"")}var W;(function(t){t.assertEqual=s=>{};function e(s){}t.assertIs=e;function n(s){throw new Error}t.assertNever=n,t.arrayToEnum=s=>{const o={};for(const i of s)o[i]=i;return o},t.getValidEnumValues=s=>{const o=t.objectKeys(s).filter(a=>typeof s[s[a]]!="number"),i={};for(const a of o)i[a]=s[a];return t.objectValues(i)},t.objectValues=s=>t.objectKeys(s).map(function(o){return s[o]}),t.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const o=[];for(const i in s)Object.prototype.hasOwnProperty.call(s,i)&&o.push(i);return o},t.find=(s,o)=>{for(const i of s)if(o(i))return i},t.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function r(s,o=" | "){return s.map(i=>typeof i=="string"?`'${i}'`:i).join(o)}t.joinValues=r,t.jsonStringifyReplacer=(s,o)=>typeof o=="bigint"?o.toString():o})(W||(W={}));var ui;(function(t){t.mergeShapes=(e,n)=>({...e,...n})})(ui||(ui={}));const M=W.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),wt=t=>{switch(typeof t){case"undefined":return M.undefined;case"string":return M.string;case"number":return Number.isNaN(t)?M.nan:M.number;case"boolean":return M.boolean;case"function":return M.function;case"bigint":return M.bigint;case"symbol":return M.symbol;case"object":return Array.isArray(t)?M.array:t===null?M.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?M.promise:typeof Map<"u"&&t instanceof Map?M.map:typeof Set<"u"&&t instanceof Set?M.set:typeof Date<"u"&&t instanceof Date?M.date:M.object;default:return M.unknown}},R=W.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class pt extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=e}format(e){const n=e||function(o){return o.message},r={_errors:[]},s=o=>{for(const i of o.issues)if(i.code==="invalid_union")i.unionErrors.map(s);else if(i.code==="invalid_return_type")s(i.returnTypeError);else if(i.code==="invalid_arguments")s(i.argumentsError);else if(i.path.length===0)r._errors.push(n(i));else{let a=r,l=0;for(;l<i.path.length;){const c=i.path[l];l===i.path.length-1?(a[c]=a[c]||{_errors:[]},a[c]._errors.push(n(i))):a[c]=a[c]||{_errors:[]},a=a[c],l++}}};return s(this),r}static assert(e){if(!(e instanceof pt))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,W.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=n=>n.message){const n={},r=[];for(const s of this.issues)if(s.path.length>0){const o=s.path[0];n[o]=n[o]||[],n[o].push(e(s))}else r.push(e(s));return{formErrors:r,fieldErrors:n}}get formErrors(){return this.flatten()}}pt.create=t=>new pt(t);const ms=(t,e)=>{let n;switch(t.code){case R.invalid_type:t.received===M.undefined?n="Required":n=`Expected ${t.expected}, received ${t.received}`;break;case R.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(t.expected,W.jsonStringifyReplacer)}`;break;case R.unrecognized_keys:n=`Unrecognized key(s) in object: ${W.joinValues(t.keys,", ")}`;break;case R.invalid_union:n="Invalid input";break;case R.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${W.joinValues(t.options)}`;break;case R.invalid_enum_value:n=`Invalid enum value. Expected ${W.joinValues(t.options)}, received '${t.received}'`;break;case R.invalid_arguments:n="Invalid function arguments";break;case R.invalid_return_type:n="Invalid function return type";break;case R.invalid_date:n="Invalid date";break;case R.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(n=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?n=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?n=`Invalid input: must end with "${t.validation.endsWith}"`:W.assertNever(t.validation):t.validation!=="regex"?n=`Invalid ${t.validation}`:n="Invalid";break;case R.too_small:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="bigint"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:n="Invalid input";break;case R.too_big:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?n=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:n="Invalid input";break;case R.custom:n="Invalid input";break;case R.invalid_intersection_types:n="Intersection results could not be merged";break;case R.not_multiple_of:n=`Number must be a multiple of ${t.multipleOf}`;break;case R.not_finite:n="Number must be finite";break;default:n=e.defaultError,W.assertNever(t)}return{message:n}};let $p=ms;function Op(){return $p}const Bp=t=>{const{data:e,path:n,errorMaps:r,issueData:s}=t,o=[...n,...s.path||[]],i={...s,path:o};if(s.message!==void 0)return{...s,path:o,message:s.message};let a="";const l=r.filter(c=>!!c).slice().reverse();for(const c of l)a=c(i,{data:e,defaultError:a}).message;return{...s,path:o,message:a}};function P(t,e){const n=Op(),r=Bp({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,n,n===ms?void 0:ms].filter(s=>!!s)});t.common.issues.push(r)}class Ce{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,n){const r=[];for(const s of n){if(s.status==="aborted")return j;s.status==="dirty"&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,n){const r=[];for(const s of n){const o=await s.key,i=await s.value;r.push({key:o,value:i})}return Ce.mergeObjectSync(e,r)}static mergeObjectSync(e,n){const r={};for(const s of n){const{key:o,value:i}=s;if(o.status==="aborted"||i.status==="aborted")return j;o.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),o.value!=="__proto__"&&(typeof i.value<"u"||s.alwaysSet)&&(r[o.value]=i.value)}return{status:e.value,value:r}}}const j=Object.freeze({status:"aborted"}),un=t=>({status:"dirty",value:t}),He=t=>({status:"valid",value:t}),di=t=>t.status==="aborted",fi=t=>t.status==="dirty",Wt=t=>t.status==="valid",Yn=t=>typeof Promise<"u"&&t instanceof Promise;var U;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(U||(U={}));class tt{constructor(e,n,r,s){this._cachedPath=[],this.parent=e,this.data=n,this._path=r,this._key=s}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const pi=(t,e)=>{if(Wt(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const n=new pt(t.common.issues);return this._error=n,this._error}}};function q(t){if(!t)return{};const{errorMap:e,invalid_type_error:n,required_error:r,description:s}=t;if(e&&(n||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(i,a)=>{const{message:l}=t;return i.code==="invalid_enum_value"?{message:l??a.defaultError}:typeof a.data>"u"?{message:l??r??a.defaultError}:i.code!=="invalid_type"?{message:a.defaultError}:{message:l??n??a.defaultError}},description:s}}class J{get description(){return this._def.description}_getType(e){return wt(e.data)}_getOrReturnCtx(e,n){return n||{common:e.parent.common,data:e.data,parsedType:wt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Ce,ctx:{common:e.parent.common,data:e.data,parsedType:wt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const n=this._parse(e);if(Yn(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(e){const n=this._parse(e);return Promise.resolve(n)}parse(e,n){const r=this.safeParse(e,n);if(r.success)return r.data;throw r.error}safeParse(e,n){const r={common:{issues:[],async:n?.async??!1,contextualErrorMap:n?.errorMap},path:n?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:wt(e)},s=this._parseSync({data:e,path:r.path,parent:r});return pi(r,s)}"~validate"(e){const n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:wt(e)};if(!this["~standard"].async)try{const r=this._parseSync({data:e,path:[],parent:n});return Wt(r)?{value:r.value}:{issues:n.common.issues}}catch(r){r?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:n}).then(r=>Wt(r)?{value:r.value}:{issues:n.common.issues})}async parseAsync(e,n){const r=await this.safeParseAsync(e,n);if(r.success)return r.data;throw r.error}async safeParseAsync(e,n){const r={common:{issues:[],contextualErrorMap:n?.errorMap,async:!0},path:n?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:wt(e)},s=this._parse({data:e,path:r.path,parent:r}),o=await(Yn(s)?s:Promise.resolve(s));return pi(r,o)}refine(e,n){const r=s=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(s):n;return this._refinement((s,o)=>{const i=e(s),a=()=>o.addIssue({code:R.custom,...r(s)});return typeof Promise<"u"&&i instanceof Promise?i.then(l=>l?!0:(a(),!1)):i?!0:(a(),!1)})}refinement(e,n){return this._refinement((r,s)=>e(r)?!0:(s.addIssue(typeof n=="function"?n(r,s):n),!1))}_refinement(e){return new Dt({schema:this,typeName:H.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return dt.create(this,this._def)}nullable(){return Ut.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return et.create(this)}promise(){return or.create(this,this._def)}or(e){return er.create([this,e],this._def)}and(e){return tr.create(this,e,this._def)}transform(e){return new Dt({...q(this._def),schema:this,typeName:H.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const n=typeof e=="function"?e:()=>e;return new ir({...q(this._def),innerType:this,defaultValue:n,typeName:H.ZodDefault})}brand(){return new zc({typeName:H.ZodBranded,type:this,...q(this._def)})}catch(e){const n=typeof e=="function"?e:()=>e;return new ar({...q(this._def),innerType:this,catchValue:n,typeName:H.ZodCatch})}describe(e){const n=this.constructor;return new n({...this._def,description:e})}pipe(e){return mo.create(this,e)}readonly(){return cr.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Pp=/^c[^\s-]{8,}$/i,Np=/^[0-9a-z]+$/,Mp=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Dp=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Up=/^[a-z0-9_-]{21}$/i,Lp=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Fp=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,jp=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Hp="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Jr;const Kp=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Vp=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,qp=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Gp=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,zp=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Jp=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Vc="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Wp=new RegExp(`^${Vc}$`);function qc(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);const n=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${n}`}function Zp(t){return new RegExp(`^${qc(t)}$`)}function Yp(t){let e=`${Vc}T${qc(t)}`;const n=[];return n.push(t.local?"Z?":"Z"),t.offset&&n.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${n.join("|")})`,new RegExp(`^${e}$`)}function Qp(t,e){return!!((e==="v4"||!e)&&Kp.test(t)||(e==="v6"||!e)&&qp.test(t))}function Xp(t,e){if(!Lp.test(t))return!1;try{const[n]=t.split(".");if(!n)return!1;const r=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),s=JSON.parse(atob(r));return!(typeof s!="object"||s===null||"typ"in s&&s?.typ!=="JWT"||!s.alg||e&&s.alg!==e)}catch{return!1}}function eh(t,e){return!!((e==="v4"||!e)&&Vp.test(t)||(e==="v6"||!e)&&Gp.test(t))}class ut extends J{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==M.string){const o=this._getOrReturnCtx(e);return P(o,{code:R.invalid_type,expected:M.string,received:o.parsedType}),j}const r=new Ce;let s;for(const o of this._def.checks)if(o.kind==="min")e.data.length<o.value&&(s=this._getOrReturnCtx(e,s),P(s,{code:R.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),r.dirty());else if(o.kind==="max")e.data.length>o.value&&(s=this._getOrReturnCtx(e,s),P(s,{code:R.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),r.dirty());else if(o.kind==="length"){const i=e.data.length>o.value,a=e.data.length<o.value;(i||a)&&(s=this._getOrReturnCtx(e,s),i?P(s,{code:R.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}):a&&P(s,{code:R.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}),r.dirty())}else if(o.kind==="email")jp.test(e.data)||(s=this._getOrReturnCtx(e,s),P(s,{validation:"email",code:R.invalid_string,message:o.message}),r.dirty());else if(o.kind==="emoji")Jr||(Jr=new RegExp(Hp,"u")),Jr.test(e.data)||(s=this._getOrReturnCtx(e,s),P(s,{validation:"emoji",code:R.invalid_string,message:o.message}),r.dirty());else if(o.kind==="uuid")Dp.test(e.data)||(s=this._getOrReturnCtx(e,s),P(s,{validation:"uuid",code:R.invalid_string,message:o.message}),r.dirty());else if(o.kind==="nanoid")Up.test(e.data)||(s=this._getOrReturnCtx(e,s),P(s,{validation:"nanoid",code:R.invalid_string,message:o.message}),r.dirty());else if(o.kind==="cuid")Pp.test(e.data)||(s=this._getOrReturnCtx(e,s),P(s,{validation:"cuid",code:R.invalid_string,message:o.message}),r.dirty());else if(o.kind==="cuid2")Np.test(e.data)||(s=this._getOrReturnCtx(e,s),P(s,{validation:"cuid2",code:R.invalid_string,message:o.message}),r.dirty());else if(o.kind==="ulid")Mp.test(e.data)||(s=this._getOrReturnCtx(e,s),P(s,{validation:"ulid",code:R.invalid_string,message:o.message}),r.dirty());else if(o.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),P(s,{validation:"url",code:R.invalid_string,message:o.message}),r.dirty()}else o.kind==="regex"?(o.regex.lastIndex=0,o.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),P(s,{validation:"regex",code:R.invalid_string,message:o.message}),r.dirty())):o.kind==="trim"?e.data=e.data.trim():o.kind==="includes"?e.data.includes(o.value,o.position)||(s=this._getOrReturnCtx(e,s),P(s,{code:R.invalid_string,validation:{includes:o.value,position:o.position},message:o.message}),r.dirty()):o.kind==="toLowerCase"?e.data=e.data.toLowerCase():o.kind==="toUpperCase"?e.data=e.data.toUpperCase():o.kind==="startsWith"?e.data.startsWith(o.value)||(s=this._getOrReturnCtx(e,s),P(s,{code:R.invalid_string,validation:{startsWith:o.value},message:o.message}),r.dirty()):o.kind==="endsWith"?e.data.endsWith(o.value)||(s=this._getOrReturnCtx(e,s),P(s,{code:R.invalid_string,validation:{endsWith:o.value},message:o.message}),r.dirty()):o.kind==="datetime"?Yp(o).test(e.data)||(s=this._getOrReturnCtx(e,s),P(s,{code:R.invalid_string,validation:"datetime",message:o.message}),r.dirty()):o.kind==="date"?Wp.test(e.data)||(s=this._getOrReturnCtx(e,s),P(s,{code:R.invalid_string,validation:"date",message:o.message}),r.dirty()):o.kind==="time"?Zp(o).test(e.data)||(s=this._getOrReturnCtx(e,s),P(s,{code:R.invalid_string,validation:"time",message:o.message}),r.dirty()):o.kind==="duration"?Fp.test(e.data)||(s=this._getOrReturnCtx(e,s),P(s,{validation:"duration",code:R.invalid_string,message:o.message}),r.dirty()):o.kind==="ip"?Qp(e.data,o.version)||(s=this._getOrReturnCtx(e,s),P(s,{validation:"ip",code:R.invalid_string,message:o.message}),r.dirty()):o.kind==="jwt"?Xp(e.data,o.alg)||(s=this._getOrReturnCtx(e,s),P(s,{validation:"jwt",code:R.invalid_string,message:o.message}),r.dirty()):o.kind==="cidr"?eh(e.data,o.version)||(s=this._getOrReturnCtx(e,s),P(s,{validation:"cidr",code:R.invalid_string,message:o.message}),r.dirty()):o.kind==="base64"?zp.test(e.data)||(s=this._getOrReturnCtx(e,s),P(s,{validation:"base64",code:R.invalid_string,message:o.message}),r.dirty()):o.kind==="base64url"?Jp.test(e.data)||(s=this._getOrReturnCtx(e,s),P(s,{validation:"base64url",code:R.invalid_string,message:o.message}),r.dirty()):W.assertNever(o);return{status:r.value,value:e.data}}_regex(e,n,r){return this.refinement(s=>e.test(s),{validation:n,code:R.invalid_string,...U.errToObj(r)})}_addCheck(e){return new ut({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...U.errToObj(e)})}url(e){return this._addCheck({kind:"url",...U.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...U.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...U.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...U.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...U.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...U.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...U.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...U.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...U.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...U.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...U.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...U.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...U.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...U.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...U.errToObj(e)})}regex(e,n){return this._addCheck({kind:"regex",regex:e,...U.errToObj(n)})}includes(e,n){return this._addCheck({kind:"includes",value:e,position:n?.position,...U.errToObj(n?.message)})}startsWith(e,n){return this._addCheck({kind:"startsWith",value:e,...U.errToObj(n)})}endsWith(e,n){return this._addCheck({kind:"endsWith",value:e,...U.errToObj(n)})}min(e,n){return this._addCheck({kind:"min",value:e,...U.errToObj(n)})}max(e,n){return this._addCheck({kind:"max",value:e,...U.errToObj(n)})}length(e,n){return this._addCheck({kind:"length",value:e,...U.errToObj(n)})}nonempty(e){return this.min(1,U.errToObj(e))}trim(){return new ut({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new ut({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new ut({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxLength(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}ut.create=t=>new ut({checks:[],typeName:H.ZodString,coerce:t?.coerce??!1,...q(t)});function th(t,e){const n=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,s=n>r?n:r,o=Number.parseInt(t.toFixed(s).replace(".","")),i=Number.parseInt(e.toFixed(s).replace(".",""));return o%i/10**s}class Zt extends J{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==M.number){const o=this._getOrReturnCtx(e);return P(o,{code:R.invalid_type,expected:M.number,received:o.parsedType}),j}let r;const s=new Ce;for(const o of this._def.checks)o.kind==="int"?W.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),P(r,{code:R.invalid_type,expected:"integer",received:"float",message:o.message}),s.dirty()):o.kind==="min"?(o.inclusive?e.data<o.value:e.data<=o.value)&&(r=this._getOrReturnCtx(e,r),P(r,{code:R.too_small,minimum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),s.dirty()):o.kind==="max"?(o.inclusive?e.data>o.value:e.data>=o.value)&&(r=this._getOrReturnCtx(e,r),P(r,{code:R.too_big,maximum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),s.dirty()):o.kind==="multipleOf"?th(e.data,o.value)!==0&&(r=this._getOrReturnCtx(e,r),P(r,{code:R.not_multiple_of,multipleOf:o.value,message:o.message}),s.dirty()):o.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),P(r,{code:R.not_finite,message:o.message}),s.dirty()):W.assertNever(o);return{status:s.value,value:e.data}}gte(e,n){return this.setLimit("min",e,!0,U.toString(n))}gt(e,n){return this.setLimit("min",e,!1,U.toString(n))}lte(e,n){return this.setLimit("max",e,!0,U.toString(n))}lt(e,n){return this.setLimit("max",e,!1,U.toString(n))}setLimit(e,n,r,s){return new Zt({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:r,message:U.toString(s)}]})}_addCheck(e){return new Zt({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:U.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:U.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:U.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:U.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:U.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:U.toString(n)})}finite(e){return this._addCheck({kind:"finite",message:U.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:U.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:U.toString(e)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&W.isInteger(e.value))}get isFinite(){let e=null,n=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(n===null||r.value>n)&&(n=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(n)&&Number.isFinite(e)}}Zt.create=t=>new Zt({checks:[],typeName:H.ZodNumber,coerce:t?.coerce||!1,...q(t)});class wn extends J{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==M.bigint)return this._getInvalidInput(e);let r;const s=new Ce;for(const o of this._def.checks)o.kind==="min"?(o.inclusive?e.data<o.value:e.data<=o.value)&&(r=this._getOrReturnCtx(e,r),P(r,{code:R.too_small,type:"bigint",minimum:o.value,inclusive:o.inclusive,message:o.message}),s.dirty()):o.kind==="max"?(o.inclusive?e.data>o.value:e.data>=o.value)&&(r=this._getOrReturnCtx(e,r),P(r,{code:R.too_big,type:"bigint",maximum:o.value,inclusive:o.inclusive,message:o.message}),s.dirty()):o.kind==="multipleOf"?e.data%o.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),P(r,{code:R.not_multiple_of,multipleOf:o.value,message:o.message}),s.dirty()):W.assertNever(o);return{status:s.value,value:e.data}}_getInvalidInput(e){const n=this._getOrReturnCtx(e);return P(n,{code:R.invalid_type,expected:M.bigint,received:n.parsedType}),j}gte(e,n){return this.setLimit("min",e,!0,U.toString(n))}gt(e,n){return this.setLimit("min",e,!1,U.toString(n))}lte(e,n){return this.setLimit("max",e,!0,U.toString(n))}lt(e,n){return this.setLimit("max",e,!1,U.toString(n))}setLimit(e,n,r,s){return new wn({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:r,message:U.toString(s)}]})}_addCheck(e){return new wn({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:U.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:U.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:U.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:U.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:U.toString(n)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}wn.create=t=>new wn({checks:[],typeName:H.ZodBigInt,coerce:t?.coerce??!1,...q(t)});class gs extends J{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==M.boolean){const r=this._getOrReturnCtx(e);return P(r,{code:R.invalid_type,expected:M.boolean,received:r.parsedType}),j}return He(e.data)}}gs.create=t=>new gs({typeName:H.ZodBoolean,coerce:t?.coerce||!1,...q(t)});class Qn extends J{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==M.date){const o=this._getOrReturnCtx(e);return P(o,{code:R.invalid_type,expected:M.date,received:o.parsedType}),j}if(Number.isNaN(e.data.getTime())){const o=this._getOrReturnCtx(e);return P(o,{code:R.invalid_date}),j}const r=new Ce;let s;for(const o of this._def.checks)o.kind==="min"?e.data.getTime()<o.value&&(s=this._getOrReturnCtx(e,s),P(s,{code:R.too_small,message:o.message,inclusive:!0,exact:!1,minimum:o.value,type:"date"}),r.dirty()):o.kind==="max"?e.data.getTime()>o.value&&(s=this._getOrReturnCtx(e,s),P(s,{code:R.too_big,message:o.message,inclusive:!0,exact:!1,maximum:o.value,type:"date"}),r.dirty()):W.assertNever(o);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Qn({...this._def,checks:[...this._def.checks,e]})}min(e,n){return this._addCheck({kind:"min",value:e.getTime(),message:U.toString(n)})}max(e,n){return this._addCheck({kind:"max",value:e.getTime(),message:U.toString(n)})}get minDate(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e!=null?new Date(e):null}}Qn.create=t=>new Qn({checks:[],coerce:t?.coerce||!1,typeName:H.ZodDate,...q(t)});class hi extends J{_parse(e){if(this._getType(e)!==M.symbol){const r=this._getOrReturnCtx(e);return P(r,{code:R.invalid_type,expected:M.symbol,received:r.parsedType}),j}return He(e.data)}}hi.create=t=>new hi({typeName:H.ZodSymbol,...q(t)});class ys extends J{_parse(e){if(this._getType(e)!==M.undefined){const r=this._getOrReturnCtx(e);return P(r,{code:R.invalid_type,expected:M.undefined,received:r.parsedType}),j}return He(e.data)}}ys.create=t=>new ys({typeName:H.ZodUndefined,...q(t)});class Xn extends J{_parse(e){if(this._getType(e)!==M.null){const r=this._getOrReturnCtx(e);return P(r,{code:R.invalid_type,expected:M.null,received:r.parsedType}),j}return He(e.data)}}Xn.create=t=>new Xn({typeName:H.ZodNull,...q(t)});class bn extends J{constructor(){super(...arguments),this._any=!0}_parse(e){return He(e.data)}}bn.create=t=>new bn({typeName:H.ZodAny,...q(t)});class vs extends J{constructor(){super(...arguments),this._unknown=!0}_parse(e){return He(e.data)}}vs.create=t=>new vs({typeName:H.ZodUnknown,...q(t)});class Et extends J{_parse(e){const n=this._getOrReturnCtx(e);return P(n,{code:R.invalid_type,expected:M.never,received:n.parsedType}),j}}Et.create=t=>new Et({typeName:H.ZodNever,...q(t)});class mi extends J{_parse(e){if(this._getType(e)!==M.undefined){const r=this._getOrReturnCtx(e);return P(r,{code:R.invalid_type,expected:M.void,received:r.parsedType}),j}return He(e.data)}}mi.create=t=>new mi({typeName:H.ZodVoid,...q(t)});class et extends J{_parse(e){const{ctx:n,status:r}=this._processInputParams(e),s=this._def;if(n.parsedType!==M.array)return P(n,{code:R.invalid_type,expected:M.array,received:n.parsedType}),j;if(s.exactLength!==null){const i=n.data.length>s.exactLength.value,a=n.data.length<s.exactLength.value;(i||a)&&(P(n,{code:i?R.too_big:R.too_small,minimum:a?s.exactLength.value:void 0,maximum:i?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(s.minLength!==null&&n.data.length<s.minLength.value&&(P(n,{code:R.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),s.maxLength!==null&&n.data.length>s.maxLength.value&&(P(n,{code:R.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),n.common.async)return Promise.all([...n.data].map((i,a)=>s.type._parseAsync(new tt(n,i,n.path,a)))).then(i=>Ce.mergeArray(r,i));const o=[...n.data].map((i,a)=>s.type._parseSync(new tt(n,i,n.path,a)));return Ce.mergeArray(r,o)}get element(){return this._def.type}min(e,n){return new et({...this._def,minLength:{value:e,message:U.toString(n)}})}max(e,n){return new et({...this._def,maxLength:{value:e,message:U.toString(n)}})}length(e,n){return new et({...this._def,exactLength:{value:e,message:U.toString(n)}})}nonempty(e){return this.min(1,e)}}et.create=(t,e)=>new et({type:t,minLength:null,maxLength:null,exactLength:null,typeName:H.ZodArray,...q(e)});function Kt(t){if(t instanceof ge){const e={};for(const n in t.shape){const r=t.shape[n];e[n]=dt.create(Kt(r))}return new ge({...t._def,shape:()=>e})}else return t instanceof et?new et({...t._def,type:Kt(t.element)}):t instanceof dt?dt.create(Kt(t.unwrap())):t instanceof Ut?Ut.create(Kt(t.unwrap())):t instanceof Nt?Nt.create(t.items.map(e=>Kt(e))):t}class ge extends J{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),n=W.objectKeys(e);return this._cached={shape:e,keys:n},this._cached}_parse(e){if(this._getType(e)!==M.object){const c=this._getOrReturnCtx(e);return P(c,{code:R.invalid_type,expected:M.object,received:c.parsedType}),j}const{status:r,ctx:s}=this._processInputParams(e),{shape:o,keys:i}=this._getCached(),a=[];if(!(this._def.catchall instanceof Et&&this._def.unknownKeys==="strip"))for(const c in s.data)i.includes(c)||a.push(c);const l=[];for(const c of i){const d=o[c],h=s.data[c];l.push({key:{status:"valid",value:c},value:d._parse(new tt(s,h,s.path,c)),alwaysSet:c in s.data})}if(this._def.catchall instanceof Et){const c=this._def.unknownKeys;if(c==="passthrough")for(const d of a)l.push({key:{status:"valid",value:d},value:{status:"valid",value:s.data[d]}});else if(c==="strict")a.length>0&&(P(s,{code:R.unrecognized_keys,keys:a}),r.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const d of a){const h=s.data[d];l.push({key:{status:"valid",value:d},value:c._parse(new tt(s,h,s.path,d)),alwaysSet:d in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const c=[];for(const d of l){const h=await d.key,p=await d.value;c.push({key:h,value:p,alwaysSet:d.alwaysSet})}return c}).then(c=>Ce.mergeObjectSync(r,c)):Ce.mergeObjectSync(r,l)}get shape(){return this._def.shape()}strict(e){return U.errToObj,new ge({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(n,r)=>{const s=this._def.errorMap?.(n,r).message??r.defaultError;return n.code==="unrecognized_keys"?{message:U.errToObj(e).message??s}:{message:s}}}:{}})}strip(){return new ge({...this._def,unknownKeys:"strip"})}passthrough(){return new ge({...this._def,unknownKeys:"passthrough"})}extend(e){return new ge({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new ge({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:H.ZodObject})}setKey(e,n){return this.augment({[e]:n})}catchall(e){return new ge({...this._def,catchall:e})}pick(e){const n={};for(const r of W.objectKeys(e))e[r]&&this.shape[r]&&(n[r]=this.shape[r]);return new ge({...this._def,shape:()=>n})}omit(e){const n={};for(const r of W.objectKeys(this.shape))e[r]||(n[r]=this.shape[r]);return new ge({...this._def,shape:()=>n})}deepPartial(){return Kt(this)}partial(e){const n={};for(const r of W.objectKeys(this.shape)){const s=this.shape[r];e&&!e[r]?n[r]=s:n[r]=s.optional()}return new ge({...this._def,shape:()=>n})}required(e){const n={};for(const r of W.objectKeys(this.shape))if(e&&!e[r])n[r]=this.shape[r];else{let o=this.shape[r];for(;o instanceof dt;)o=o._def.innerType;n[r]=o}return new ge({...this._def,shape:()=>n})}keyof(){return Gc(W.objectKeys(this.shape))}}ge.create=(t,e)=>new ge({shape:()=>t,unknownKeys:"strip",catchall:Et.create(),typeName:H.ZodObject,...q(e)});ge.strictCreate=(t,e)=>new ge({shape:()=>t,unknownKeys:"strict",catchall:Et.create(),typeName:H.ZodObject,...q(e)});ge.lazycreate=(t,e)=>new ge({shape:t,unknownKeys:"strip",catchall:Et.create(),typeName:H.ZodObject,...q(e)});class er extends J{_parse(e){const{ctx:n}=this._processInputParams(e),r=this._def.options;function s(o){for(const a of o)if(a.result.status==="valid")return a.result;for(const a of o)if(a.result.status==="dirty")return n.common.issues.push(...a.ctx.common.issues),a.result;const i=o.map(a=>new pt(a.ctx.common.issues));return P(n,{code:R.invalid_union,unionErrors:i}),j}if(n.common.async)return Promise.all(r.map(async o=>{const i={...n,common:{...n.common,issues:[]},parent:null};return{result:await o._parseAsync({data:n.data,path:n.path,parent:i}),ctx:i}})).then(s);{let o;const i=[];for(const l of r){const c={...n,common:{...n.common,issues:[]},parent:null},d=l._parseSync({data:n.data,path:n.path,parent:c});if(d.status==="valid")return d;d.status==="dirty"&&!o&&(o={result:d,ctx:c}),c.common.issues.length&&i.push(c.common.issues)}if(o)return n.common.issues.push(...o.ctx.common.issues),o.result;const a=i.map(l=>new pt(l));return P(n,{code:R.invalid_union,unionErrors:a}),j}}get options(){return this._def.options}}er.create=(t,e)=>new er({options:t,typeName:H.ZodUnion,...q(e)});const nt=t=>t instanceof rr?nt(t.schema):t instanceof Dt?nt(t.innerType()):t instanceof sr?[t.value]:t instanceof Mt?t.options:t instanceof bs?W.objectValues(t.enum):t instanceof ir?nt(t._def.innerType):t instanceof ys?[void 0]:t instanceof Xn?[null]:t instanceof dt?[void 0,...nt(t.unwrap())]:t instanceof Ut?[null,...nt(t.unwrap())]:t instanceof zc||t instanceof cr?nt(t.unwrap()):t instanceof ar?nt(t._def.innerType):[];class ho extends J{_parse(e){const{ctx:n}=this._processInputParams(e);if(n.parsedType!==M.object)return P(n,{code:R.invalid_type,expected:M.object,received:n.parsedType}),j;const r=this.discriminator,s=n.data[r],o=this.optionsMap.get(s);return o?n.common.async?o._parseAsync({data:n.data,path:n.path,parent:n}):o._parseSync({data:n.data,path:n.path,parent:n}):(P(n,{code:R.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),j)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,n,r){const s=new Map;for(const o of n){const i=nt(o.shape[e]);if(!i.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const a of i){if(s.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);s.set(a,o)}}return new ho({typeName:H.ZodDiscriminatedUnion,discriminator:e,options:n,optionsMap:s,...q(r)})}}function ws(t,e){const n=wt(t),r=wt(e);if(t===e)return{valid:!0,data:t};if(n===M.object&&r===M.object){const s=W.objectKeys(e),o=W.objectKeys(t).filter(a=>s.indexOf(a)!==-1),i={...t,...e};for(const a of o){const l=ws(t[a],e[a]);if(!l.valid)return{valid:!1};i[a]=l.data}return{valid:!0,data:i}}else if(n===M.array&&r===M.array){if(t.length!==e.length)return{valid:!1};const s=[];for(let o=0;o<t.length;o++){const i=t[o],a=e[o],l=ws(i,a);if(!l.valid)return{valid:!1};s.push(l.data)}return{valid:!0,data:s}}else return n===M.date&&r===M.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}class tr extends J{_parse(e){const{status:n,ctx:r}=this._processInputParams(e),s=(o,i)=>{if(di(o)||di(i))return j;const a=ws(o.value,i.value);return a.valid?((fi(o)||fi(i))&&n.dirty(),{status:n.value,value:a.data}):(P(r,{code:R.invalid_intersection_types}),j)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([o,i])=>s(o,i)):s(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}tr.create=(t,e,n)=>new tr({left:t,right:e,typeName:H.ZodIntersection,...q(n)});class Nt extends J{_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==M.array)return P(r,{code:R.invalid_type,expected:M.array,received:r.parsedType}),j;if(r.data.length<this._def.items.length)return P(r,{code:R.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),j;!this._def.rest&&r.data.length>this._def.items.length&&(P(r,{code:R.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const o=[...r.data].map((i,a)=>{const l=this._def.items[a]||this._def.rest;return l?l._parse(new tt(r,i,r.path,a)):null}).filter(i=>!!i);return r.common.async?Promise.all(o).then(i=>Ce.mergeArray(n,i)):Ce.mergeArray(n,o)}get items(){return this._def.items}rest(e){return new Nt({...this._def,rest:e})}}Nt.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Nt({items:t,typeName:H.ZodTuple,rest:null,...q(e)})};class nr extends J{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==M.object)return P(r,{code:R.invalid_type,expected:M.object,received:r.parsedType}),j;const s=[],o=this._def.keyType,i=this._def.valueType;for(const a in r.data)s.push({key:o._parse(new tt(r,a,r.path,a)),value:i._parse(new tt(r,r.data[a],r.path,a)),alwaysSet:a in r.data});return r.common.async?Ce.mergeObjectAsync(n,s):Ce.mergeObjectSync(n,s)}get element(){return this._def.valueType}static create(e,n,r){return n instanceof J?new nr({keyType:e,valueType:n,typeName:H.ZodRecord,...q(r)}):new nr({keyType:ut.create(),valueType:e,typeName:H.ZodRecord,...q(n)})}}class gi extends J{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==M.map)return P(r,{code:R.invalid_type,expected:M.map,received:r.parsedType}),j;const s=this._def.keyType,o=this._def.valueType,i=[...r.data.entries()].map(([a,l],c)=>({key:s._parse(new tt(r,a,r.path,[c,"key"])),value:o._parse(new tt(r,l,r.path,[c,"value"]))}));if(r.common.async){const a=new Map;return Promise.resolve().then(async()=>{for(const l of i){const c=await l.key,d=await l.value;if(c.status==="aborted"||d.status==="aborted")return j;(c.status==="dirty"||d.status==="dirty")&&n.dirty(),a.set(c.value,d.value)}return{status:n.value,value:a}})}else{const a=new Map;for(const l of i){const c=l.key,d=l.value;if(c.status==="aborted"||d.status==="aborted")return j;(c.status==="dirty"||d.status==="dirty")&&n.dirty(),a.set(c.value,d.value)}return{status:n.value,value:a}}}}gi.create=(t,e,n)=>new gi({valueType:e,keyType:t,typeName:H.ZodMap,...q(n)});class _n extends J{_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==M.set)return P(r,{code:R.invalid_type,expected:M.set,received:r.parsedType}),j;const s=this._def;s.minSize!==null&&r.data.size<s.minSize.value&&(P(r,{code:R.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),n.dirty()),s.maxSize!==null&&r.data.size>s.maxSize.value&&(P(r,{code:R.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),n.dirty());const o=this._def.valueType;function i(l){const c=new Set;for(const d of l){if(d.status==="aborted")return j;d.status==="dirty"&&n.dirty(),c.add(d.value)}return{status:n.value,value:c}}const a=[...r.data.values()].map((l,c)=>o._parse(new tt(r,l,r.path,c)));return r.common.async?Promise.all(a).then(l=>i(l)):i(a)}min(e,n){return new _n({...this._def,minSize:{value:e,message:U.toString(n)}})}max(e,n){return new _n({...this._def,maxSize:{value:e,message:U.toString(n)}})}size(e,n){return this.min(e,n).max(e,n)}nonempty(e){return this.min(1,e)}}_n.create=(t,e)=>new _n({valueType:t,minSize:null,maxSize:null,typeName:H.ZodSet,...q(e)});class rr extends J{get schema(){return this._def.getter()}_parse(e){const{ctx:n}=this._processInputParams(e);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}}rr.create=(t,e)=>new rr({getter:t,typeName:H.ZodLazy,...q(e)});class sr extends J{_parse(e){if(e.data!==this._def.value){const n=this._getOrReturnCtx(e);return P(n,{received:n.data,code:R.invalid_literal,expected:this._def.value}),j}return{status:"valid",value:e.data}}get value(){return this._def.value}}sr.create=(t,e)=>new sr({value:t,typeName:H.ZodLiteral,...q(e)});function Gc(t,e){return new Mt({values:t,typeName:H.ZodEnum,...q(e)})}class Mt extends J{_parse(e){if(typeof e.data!="string"){const n=this._getOrReturnCtx(e),r=this._def.values;return P(n,{expected:W.joinValues(r),received:n.parsedType,code:R.invalid_type}),j}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const n=this._getOrReturnCtx(e),r=this._def.values;return P(n,{received:n.data,code:R.invalid_enum_value,options:r}),j}return He(e.data)}get options(){return this._def.values}get enum(){const e={};for(const n of this._def.values)e[n]=n;return e}get Values(){const e={};for(const n of this._def.values)e[n]=n;return e}get Enum(){const e={};for(const n of this._def.values)e[n]=n;return e}extract(e,n=this._def){return Mt.create(e,{...this._def,...n})}exclude(e,n=this._def){return Mt.create(this.options.filter(r=>!e.includes(r)),{...this._def,...n})}}Mt.create=Gc;class bs extends J{_parse(e){const n=W.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==M.string&&r.parsedType!==M.number){const s=W.objectValues(n);return P(r,{expected:W.joinValues(s),received:r.parsedType,code:R.invalid_type}),j}if(this._cache||(this._cache=new Set(W.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const s=W.objectValues(n);return P(r,{received:r.data,code:R.invalid_enum_value,options:s}),j}return He(e.data)}get enum(){return this._def.values}}bs.create=(t,e)=>new bs({values:t,typeName:H.ZodNativeEnum,...q(e)});class or extends J{unwrap(){return this._def.type}_parse(e){const{ctx:n}=this._processInputParams(e);if(n.parsedType!==M.promise&&n.common.async===!1)return P(n,{code:R.invalid_type,expected:M.promise,received:n.parsedType}),j;const r=n.parsedType===M.promise?n.data:Promise.resolve(n.data);return He(r.then(s=>this._def.type.parseAsync(s,{path:n.path,errorMap:n.common.contextualErrorMap})))}}or.create=(t,e)=>new or({type:t,typeName:H.ZodPromise,...q(e)});class Dt extends J{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===H.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:n,ctx:r}=this._processInputParams(e),s=this._def.effect||null,o={addIssue:i=>{P(r,i),i.fatal?n.abort():n.dirty()},get path(){return r.path}};if(o.addIssue=o.addIssue.bind(o),s.type==="preprocess"){const i=s.transform(r.data,o);if(r.common.async)return Promise.resolve(i).then(async a=>{if(n.value==="aborted")return j;const l=await this._def.schema._parseAsync({data:a,path:r.path,parent:r});return l.status==="aborted"?j:l.status==="dirty"||n.value==="dirty"?un(l.value):l});{if(n.value==="aborted")return j;const a=this._def.schema._parseSync({data:i,path:r.path,parent:r});return a.status==="aborted"?j:a.status==="dirty"||n.value==="dirty"?un(a.value):a}}if(s.type==="refinement"){const i=a=>{const l=s.refinement(a,o);if(r.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(r.common.async===!1){const a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?j:(a.status==="dirty"&&n.dirty(),i(a.value),{status:n.value,value:a.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(a=>a.status==="aborted"?j:(a.status==="dirty"&&n.dirty(),i(a.value).then(()=>({status:n.value,value:a.value}))))}if(s.type==="transform")if(r.common.async===!1){const i=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!Wt(i))return j;const a=s.transform(i.value,o);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:a}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(i=>Wt(i)?Promise.resolve(s.transform(i.value,o)).then(a=>({status:n.value,value:a})):j);W.assertNever(s)}}Dt.create=(t,e,n)=>new Dt({schema:t,typeName:H.ZodEffects,effect:e,...q(n)});Dt.createWithPreprocess=(t,e,n)=>new Dt({schema:e,effect:{type:"preprocess",transform:t},typeName:H.ZodEffects,...q(n)});class dt extends J{_parse(e){return this._getType(e)===M.undefined?He(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}dt.create=(t,e)=>new dt({innerType:t,typeName:H.ZodOptional,...q(e)});class Ut extends J{_parse(e){return this._getType(e)===M.null?He(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ut.create=(t,e)=>new Ut({innerType:t,typeName:H.ZodNullable,...q(e)});class ir extends J{_parse(e){const{ctx:n}=this._processInputParams(e);let r=n.data;return n.parsedType===M.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:n.path,parent:n})}removeDefault(){return this._def.innerType}}ir.create=(t,e)=>new ir({innerType:t,typeName:H.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...q(e)});class ar extends J{_parse(e){const{ctx:n}=this._processInputParams(e),r={...n,common:{...n.common,issues:[]}},s=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return Yn(s)?s.then(o=>({status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new pt(r.common.issues)},input:r.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new pt(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}ar.create=(t,e)=>new ar({innerType:t,typeName:H.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...q(e)});class yi extends J{_parse(e){if(this._getType(e)!==M.nan){const r=this._getOrReturnCtx(e);return P(r,{code:R.invalid_type,expected:M.nan,received:r.parsedType}),j}return{status:"valid",value:e.data}}}yi.create=t=>new yi({typeName:H.ZodNaN,...q(t)});class zc extends J{_parse(e){const{ctx:n}=this._processInputParams(e),r=n.data;return this._def.type._parse({data:r,path:n.path,parent:n})}unwrap(){return this._def.type}}class mo extends J{_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const o=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?j:o.status==="dirty"?(n.dirty(),un(o.value)):this._def.out._parseAsync({data:o.value,path:r.path,parent:r})})();{const s=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?j:s.status==="dirty"?(n.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:r.path,parent:r})}}static create(e,n){return new mo({in:e,out:n,typeName:H.ZodPipeline})}}class cr extends J{_parse(e){const n=this._def.innerType._parse(e),r=s=>(Wt(s)&&(s.value=Object.freeze(s.value)),s);return Yn(n)?n.then(s=>r(s)):r(n)}unwrap(){return this._def.innerType}}cr.create=(t,e)=>new cr({innerType:t,typeName:H.ZodReadonly,...q(e)});function vi(t,e){const n=typeof t=="function"?t(e):typeof t=="string"?{message:t}:t;return typeof n=="string"?{message:n}:n}function nh(t,e={},n){return t?bn.create().superRefine((r,s)=>{const o=t(r);if(o instanceof Promise)return o.then(i=>{if(!i){const a=vi(e,r),l=a.fatal??n??!0;s.addIssue({code:"custom",...a,fatal:l})}});if(!o){const i=vi(e,r),a=i.fatal??n??!0;s.addIssue({code:"custom",...i,fatal:a})}}):bn.create()}var H;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(H||(H={}));const nk=(t,e={message:`Input not instance of ${t.name}`})=>nh(n=>n instanceof t,e),E=ut.create,T=Zt.create,rk=gs.create,sk=Xn.create,In=bn.create,Jc=vs.create;Et.create;const D=et.create,_=ge.create,Tt=er.create,Gt=ho.create;tr.create;Nt.create;const Rn=nr.create,ok=rr.create,K=sr.create,Br=Mt.create;or.create;const ik=dt.create;Ut.create;function rh({prompt:t,useLegacyFunctionCalling:e=!1,systemMessageMode:n="system"}){const r=[];for(const{role:s,content:o}of t)switch(s){case"system":{switch(n){case"system":{r.push({role:"system",content:o});break}case"developer":{r.push({role:"developer",content:o});break}case"remove":break;default:{const i=n;throw new Error(`Unsupported system message mode: ${i}`)}}break}case"user":{if(o.length===1&&o[0].type==="text"){r.push({role:"user",content:o[0].text});break}r.push({role:"user",content:o.map(i=>{var a,l,c;switch(i.type){case"text":return{type:"text",text:i.text};case"image":return{type:"image_url",image_url:{url:i.image instanceof URL?i.image.toString():`data:${(a=i.mimeType)!=null?a:"image/jpeg"};base64,${Hc(i.image)}`,detail:(c=(l=i.providerMetadata)==null?void 0:l.openai)==null?void 0:c.imageDetail}};case"file":{if(i.data instanceof URL)throw new Ee({functionality:"'File content parts with URL data' functionality not supported."});switch(i.mimeType){case"audio/wav":return{type:"input_audio",input_audio:{data:i.data,format:"wav"}};case"audio/mp3":case"audio/mpeg":return{type:"input_audio",input_audio:{data:i.data,format:"mp3"}};default:throw new Ee({functionality:`File content part type ${i.mimeType} in user messages`})}}}})});break}case"assistant":{let i="";const a=[];for(const l of o)switch(l.type){case"text":{i+=l.text;break}case"tool-call":{a.push({id:l.toolCallId,type:"function",function:{name:l.toolName,arguments:JSON.stringify(l.args)}});break}default:{const c=l;throw new Error(`Unsupported part: ${c}`)}}if(e){if(a.length>1)throw new Ee({functionality:"useLegacyFunctionCalling with multiple tool calls in one message"});r.push({role:"assistant",content:i,function_call:a.length>0?a[0].function:void 0})}else r.push({role:"assistant",content:i,tool_calls:a.length>0?a:void 0});break}case"tool":{for(const i of o)e?r.push({role:"function",name:i.toolName,content:JSON.stringify(i.result)}):r.push({role:"tool",tool_call_id:i.toolCallId,content:JSON.stringify(i.result)});break}default:{const i=s;throw new Error(`Unsupported role: ${i}`)}}return r}function wi(t){var e,n;return(n=(e=t?.content)==null?void 0:e.map(({token:r,logprob:s,top_logprobs:o})=>({token:r,logprob:s,topLogprobs:o?o.map(({token:i,logprob:a})=>({token:i,logprob:a})):[]})))!=null?n:void 0}function lr(t){switch(t){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var go=_({error:_({message:E(),type:E().nullish(),param:In().nullish(),code:Tt([E(),T()]).nullish()})}),Yt=jc({errorSchema:go,errorToMessage:t=>t.error.message});function ur({id:t,model:e,created:n}){return{id:t??void 0,modelId:e??void 0,timestamp:n!=null?new Date(n*1e3):void 0}}function sh({mode:t,useLegacyFunctionCalling:e=!1,structuredOutputs:n}){var r;const s=(r=t.tools)!=null&&r.length?t.tools:void 0,o=[];if(s==null)return{tools:void 0,tool_choice:void 0,toolWarnings:o};const i=t.toolChoice;if(e){const c=[];for(const h of s)h.type==="provider-defined"?o.push({type:"unsupported-tool",tool:h}):c.push({name:h.name,description:h.description,parameters:h.parameters});if(i==null)return{functions:c,function_call:void 0,toolWarnings:o};switch(i.type){case"auto":case"none":case void 0:return{functions:c,function_call:void 0,toolWarnings:o};case"required":throw new Ee({functionality:"useLegacyFunctionCalling and toolChoice: required"});default:return{functions:c,function_call:{name:i.toolName},toolWarnings:o}}}const a=[];for(const c of s)c.type==="provider-defined"?o.push({type:"unsupported-tool",tool:c}):a.push({type:"function",function:{name:c.name,description:c.description,parameters:c.parameters,strict:n?!0:void 0}});if(i==null)return{tools:a,tool_choice:void 0,toolWarnings:o};const l=i.type;switch(l){case"auto":case"none":case"required":return{tools:a,tool_choice:l,toolWarnings:o};case"tool":return{tools:a,tool_choice:{type:"function",function:{name:i.toolName}},toolWarnings:o};default:{const c=l;throw new Ee({functionality:`Unsupported tool choice type: ${c}`})}}}var oh=class{constructor(t,e,n){this.specificationVersion="v1",this.modelId=t,this.settings=e,this.config=n}get supportsStructuredOutputs(){var t;return(t=this.settings.structuredOutputs)!=null?t:dr(this.modelId)}get defaultObjectGenerationMode(){return ch(this.modelId)?"tool":this.supportsStructuredOutputs?"json":"tool"}get provider(){return this.config.provider}get supportsImageUrls(){return!this.settings.downloadImages}getArgs({mode:t,prompt:e,maxTokens:n,temperature:r,topP:s,topK:o,frequencyPenalty:i,presencePenalty:a,stopSequences:l,responseFormat:c,seed:d,providerMetadata:h}){var p,g,v,b,w,S,A,O;const B=t.type,$=[];o!=null&&$.push({type:"unsupported-setting",setting:"topK"}),c?.type==="json"&&c.schema!=null&&!this.supportsStructuredOutputs&&$.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is only supported with structuredOutputs"});const F=this.settings.useLegacyFunctionCalling;if(F&&this.settings.parallelToolCalls===!0)throw new Ee({functionality:"useLegacyFunctionCalling with parallelToolCalls"});if(F&&this.supportsStructuredOutputs)throw new Ee({functionality:"structuredOutputs with useLegacyFunctionCalling"});bi(this.modelId)==="remove"&&e.some(Z=>Z.role==="system")&&$.push({type:"other",message:"system messages are removed for this model"});const N={model:this.modelId,logit_bias:this.settings.logitBias,logprobs:this.settings.logprobs===!0||typeof this.settings.logprobs=="number"?!0:void 0,top_logprobs:typeof this.settings.logprobs=="number"?this.settings.logprobs:typeof this.settings.logprobs=="boolean"&&this.settings.logprobs?0:void 0,user:this.settings.user,parallel_tool_calls:this.settings.parallelToolCalls,max_tokens:n,temperature:r,top_p:s,frequency_penalty:i,presence_penalty:a,response_format:c?.type==="json"?this.supportsStructuredOutputs&&c.schema!=null?{type:"json_schema",json_schema:{schema:c.schema,strict:!0,name:(p=c.name)!=null?p:"response",description:c.description}}:{type:"json_object"}:void 0,stop:l,seed:d,max_completion_tokens:(g=h?.openai)==null?void 0:g.maxCompletionTokens,store:(v=h?.openai)==null?void 0:v.store,metadata:(b=h?.openai)==null?void 0:b.metadata,prediction:(w=h?.openai)==null?void 0:w.prediction,reasoning_effort:(A=(S=h?.openai)==null?void 0:S.reasoningEffort)!=null?A:this.settings.reasoningEffort,messages:rh({prompt:e,useLegacyFunctionCalling:F,systemMessageMode:bi(this.modelId)})};switch(dr(this.modelId)&&(N.temperature!=null&&(N.temperature=void 0,$.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),N.top_p!=null&&(N.top_p=void 0,$.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"})),N.frequency_penalty!=null&&(N.frequency_penalty=void 0,$.push({type:"unsupported-setting",setting:"frequencyPenalty",details:"frequencyPenalty is not supported for reasoning models"})),N.presence_penalty!=null&&(N.presence_penalty=void 0,$.push({type:"unsupported-setting",setting:"presencePenalty",details:"presencePenalty is not supported for reasoning models"})),N.logit_bias!=null&&(N.logit_bias=void 0,$.push({type:"other",message:"logitBias is not supported for reasoning models"})),N.logprobs!=null&&(N.logprobs=void 0,$.push({type:"other",message:"logprobs is not supported for reasoning models"})),N.top_logprobs!=null&&(N.top_logprobs=void 0,$.push({type:"other",message:"topLogprobs is not supported for reasoning models"})),N.max_tokens!=null&&(N.max_completion_tokens==null&&(N.max_completion_tokens=N.max_tokens),N.max_tokens=void 0)),B){case"regular":{const{tools:Z,tool_choice:re,functions:ie,function_call:te,toolWarnings:ue}=sh({mode:t,useLegacyFunctionCalling:F,structuredOutputs:this.supportsStructuredOutputs});return{args:{...N,tools:Z,tool_choice:re,functions:ie,function_call:te},warnings:[...$,...ue]}}case"object-json":return{args:{...N,response_format:this.supportsStructuredOutputs&&t.schema!=null?{type:"json_schema",json_schema:{schema:t.schema,strict:!0,name:(O=t.name)!=null?O:"response",description:t.description}}:{type:"json_object"}},warnings:$};case"object-tool":return{args:F?{...N,function_call:{name:t.tool.name},functions:[{name:t.tool.name,description:t.tool.description,parameters:t.tool.parameters}]}:{...N,tool_choice:{type:"function",function:{name:t.tool.name}},tools:[{type:"function",function:{name:t.tool.name,description:t.tool.description,parameters:t.tool.parameters,strict:this.supportsStructuredOutputs?!0:void 0}}]},warnings:$};default:{const Z=B;throw new Error(`Unsupported type: ${Z}`)}}}async doGenerate(t){var e,n,r,s,o,i,a,l;const{args:c,warnings:d}=this.getArgs(t),{responseHeaders:h,value:p}=await xt({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:_t(this.config.headers(),t.headers),body:c,failedResponseHandler:Yt,successfulResponseHandler:Tn(ih),abortSignal:t.abortSignal,fetch:this.config.fetch}),{messages:g,...v}=c,b=p.choices[0],w=(e=p.usage)==null?void 0:e.completion_tokens_details,S=(n=p.usage)==null?void 0:n.prompt_tokens_details,A={openai:{}};return w?.reasoning_tokens!=null&&(A.openai.reasoningTokens=w?.reasoning_tokens),w?.accepted_prediction_tokens!=null&&(A.openai.acceptedPredictionTokens=w?.accepted_prediction_tokens),w?.rejected_prediction_tokens!=null&&(A.openai.rejectedPredictionTokens=w?.rejected_prediction_tokens),S?.cached_tokens!=null&&(A.openai.cachedPromptTokens=S?.cached_tokens),{text:(r=b.message.content)!=null?r:void 0,toolCalls:this.settings.useLegacyFunctionCalling&&b.message.function_call?[{toolCallType:"function",toolCallId:bt(),toolName:b.message.function_call.name,args:b.message.function_call.arguments}]:(s=b.message.tool_calls)==null?void 0:s.map(O=>{var B;return{toolCallType:"function",toolCallId:(B=O.id)!=null?B:bt(),toolName:O.function.name,args:O.function.arguments}}),finishReason:lr(b.finish_reason),usage:{promptTokens:(i=(o=p.usage)==null?void 0:o.prompt_tokens)!=null?i:NaN,completionTokens:(l=(a=p.usage)==null?void 0:a.completion_tokens)!=null?l:NaN},rawCall:{rawPrompt:g,rawSettings:v},rawResponse:{headers:h},request:{body:JSON.stringify(c)},response:ur(p),warnings:d,logprobs:wi(b.logprobs),providerMetadata:A}}async doStream(t){var e;if((e=this.settings.simulateStreaming)!=null?e:lh(this.modelId)){const w=await this.doGenerate(t);return{stream:new ReadableStream({start(A){if(A.enqueue({type:"response-metadata",...w.response}),w.text&&A.enqueue({type:"text-delta",textDelta:w.text}),w.toolCalls)for(const O of w.toolCalls)A.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:O.toolCallId,toolName:O.toolName,argsTextDelta:O.args}),A.enqueue({type:"tool-call",...O});A.enqueue({type:"finish",finishReason:w.finishReason,usage:w.usage,logprobs:w.logprobs,providerMetadata:w.providerMetadata}),A.close()}}),rawCall:w.rawCall,rawResponse:w.rawResponse,warnings:w.warnings}}const{args:n,warnings:r}=this.getArgs(t),s={...n,stream:!0,stream_options:this.config.compatibility==="strict"?{include_usage:!0}:void 0},{responseHeaders:o,value:i}=await xt({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:_t(this.config.headers(),t.headers),body:s,failedResponseHandler:Yt,successfulResponseHandler:po(ah),abortSignal:t.abortSignal,fetch:this.config.fetch}),{messages:a,...l}=n,c=[];let d="unknown",h={promptTokens:void 0,completionTokens:void 0},p,g=!0;const{useLegacyFunctionCalling:v}=this.settings,b={openai:{}};return{stream:i.pipeThrough(new TransformStream({transform(w,S){var A,O,B,$,F,N,Z,re,ie,te,ue,de;if(!w.success){d="error",S.enqueue({type:"error",error:w.error});return}const fe=w.value;if("error"in fe){d="error",S.enqueue({type:"error",error:fe.error});return}if(g&&(g=!1,S.enqueue({type:"response-metadata",...ur(fe)})),fe.usage!=null){const{prompt_tokens:Y,completion_tokens:pe,prompt_tokens_details:we,completion_tokens_details:ne}=fe.usage;h={promptTokens:Y??void 0,completionTokens:pe??void 0},ne?.reasoning_tokens!=null&&(b.openai.reasoningTokens=ne?.reasoning_tokens),ne?.accepted_prediction_tokens!=null&&(b.openai.acceptedPredictionTokens=ne?.accepted_prediction_tokens),ne?.rejected_prediction_tokens!=null&&(b.openai.rejectedPredictionTokens=ne?.rejected_prediction_tokens),we?.cached_tokens!=null&&(b.openai.cachedPromptTokens=we?.cached_tokens)}const Q=fe.choices[0];if(Q?.finish_reason!=null&&(d=lr(Q.finish_reason)),Q?.delta==null)return;const se=Q.delta;se.content!=null&&S.enqueue({type:"text-delta",textDelta:se.content});const me=wi(Q?.logprobs);me?.length&&(p===void 0&&(p=[]),p.push(...me));const qe=v&&se.function_call!=null?[{type:"function",id:bt(),function:se.function_call,index:0}]:se.tool_calls;if(qe!=null)for(const Y of qe){const pe=Y.index;if(c[pe]==null){if(Y.type!=="function")throw new qt({data:Y,message:"Expected 'function' type."});if(Y.id==null)throw new qt({data:Y,message:"Expected 'id' to be a string."});if(((A=Y.function)==null?void 0:A.name)==null)throw new qt({data:Y,message:"Expected 'function.name' to be a string."});c[pe]={id:Y.id,type:"function",function:{name:Y.function.name,arguments:(O=Y.function.arguments)!=null?O:""},hasFinished:!1};const ne=c[pe];((B=ne.function)==null?void 0:B.name)!=null&&(($=ne.function)==null?void 0:$.arguments)!=null&&(ne.function.arguments.length>0&&S.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:ne.id,toolName:ne.function.name,argsTextDelta:ne.function.arguments}),Zn(ne.function.arguments)&&(S.enqueue({type:"tool-call",toolCallType:"function",toolCallId:(F=ne.id)!=null?F:bt(),toolName:ne.function.name,args:ne.function.arguments}),ne.hasFinished=!0));continue}const we=c[pe];we.hasFinished||(((N=Y.function)==null?void 0:N.arguments)!=null&&(we.function.arguments+=(re=(Z=Y.function)==null?void 0:Z.arguments)!=null?re:""),S.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:we.id,toolName:we.function.name,argsTextDelta:(ie=Y.function.arguments)!=null?ie:""}),((te=we.function)==null?void 0:te.name)!=null&&((ue=we.function)==null?void 0:ue.arguments)!=null&&Zn(we.function.arguments)&&(S.enqueue({type:"tool-call",toolCallType:"function",toolCallId:(de=we.id)!=null?de:bt(),toolName:we.function.name,args:we.function.arguments}),we.hasFinished=!0))}},flush(w){var S,A;w.enqueue({type:"finish",finishReason:d,logprobs:p,usage:{promptTokens:(S=h.promptTokens)!=null?S:NaN,completionTokens:(A=h.completionTokens)!=null?A:NaN},...b!=null?{providerMetadata:b}:{}})}})),rawCall:{rawPrompt:a,rawSettings:l},rawResponse:{headers:o},request:{body:JSON.stringify(s)},warnings:r}}},Wc=_({prompt_tokens:T().nullish(),completion_tokens:T().nullish(),prompt_tokens_details:_({cached_tokens:T().nullish()}).nullish(),completion_tokens_details:_({reasoning_tokens:T().nullish(),accepted_prediction_tokens:T().nullish(),rejected_prediction_tokens:T().nullish()}).nullish()}).nullish(),ih=_({id:E().nullish(),created:T().nullish(),model:E().nullish(),choices:D(_({message:_({role:K("assistant").nullish(),content:E().nullish(),function_call:_({arguments:E(),name:E()}).nullish(),tool_calls:D(_({id:E().nullish(),type:K("function"),function:_({name:E(),arguments:E()})})).nullish()}),index:T(),logprobs:_({content:D(_({token:E(),logprob:T(),top_logprobs:D(_({token:E(),logprob:T()}))})).nullable()}).nullish(),finish_reason:E().nullish()})),usage:Wc}),ah=Tt([_({id:E().nullish(),created:T().nullish(),model:E().nullish(),choices:D(_({delta:_({role:Br(["assistant"]).nullish(),content:E().nullish(),function_call:_({name:E().optional(),arguments:E().optional()}).nullish(),tool_calls:D(_({index:T(),id:E().nullish(),type:K("function").optional(),function:_({name:E().nullish(),arguments:E().nullish()})})).nullish()}).nullish(),logprobs:_({content:D(_({token:E(),logprob:T(),top_logprobs:D(_({token:E(),logprob:T()}))})).nullable()}).nullish(),finish_reason:E().nullable().optional(),index:T()})),usage:Wc}),go]);function dr(t){return t==="o1"||t.startsWith("o1-")||t==="o3"||t.startsWith("o3-")}function ch(t){return t.startsWith("gpt-4o-audio-preview")}function bi(t){var e,n;return dr(t)?(n=(e=Zc[t])==null?void 0:e.systemMessageMode)!=null?n:"developer":"system"}function lh(t){var e,n;return dr(t)?(n=(e=Zc[t])==null?void 0:e.simulateStreamingByDefault)!=null?n:!0:!1}var Zc={"o1-mini":{systemMessageMode:"remove",simulateStreamingByDefault:!1},"o1-mini-2024-09-12":{systemMessageMode:"remove",simulateStreamingByDefault:!1},"o1-preview":{systemMessageMode:"remove",simulateStreamingByDefault:!1},"o1-preview-2024-09-12":{systemMessageMode:"remove",simulateStreamingByDefault:!1}};function uh({prompt:t,inputFormat:e,user:n="user",assistant:r="assistant"}){if(e==="prompt"&&t.length===1&&t[0].role==="user"&&t[0].content.length===1&&t[0].content[0].type==="text")return{prompt:t[0].content[0].text};let s="";t[0].role==="system"&&(s+=`${t[0].content}

`,t=t.slice(1));for(const{role:o,content:i}of t)switch(o){case"system":throw new Of({message:"Unexpected system message in prompt: ${content}",prompt:t});case"user":{const a=i.map(l=>{switch(l.type){case"text":return l.text;case"image":throw new Ee({functionality:"images"})}}).join("");s+=`${n}:
${a}

`;break}case"assistant":{const a=i.map(l=>{switch(l.type){case"text":return l.text;case"tool-call":throw new Ee({functionality:"tool-call messages"})}}).join("");s+=`${r}:
${a}

`;break}case"tool":throw new Ee({functionality:"tool messages"});default:{const a=o;throw new Error(`Unsupported role: ${a}`)}}return s+=`${r}:
`,{prompt:s,stopSequences:[`
${n}:`]}}function _i(t){return t?.tokens.map((e,n)=>({token:e,logprob:t.token_logprobs[n],topLogprobs:t.top_logprobs?Object.entries(t.top_logprobs[n]).map(([r,s])=>({token:r,logprob:s})):[]}))}var dh=class{constructor(t,e,n){this.specificationVersion="v1",this.defaultObjectGenerationMode=void 0,this.modelId=t,this.settings=e,this.config=n}get provider(){return this.config.provider}getArgs({mode:t,inputFormat:e,prompt:n,maxTokens:r,temperature:s,topP:o,topK:i,frequencyPenalty:a,presencePenalty:l,stopSequences:c,responseFormat:d,seed:h}){var p;const g=t.type,v=[];i!=null&&v.push({type:"unsupported-setting",setting:"topK"}),d!=null&&d.type!=="text"&&v.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format is not supported."});const{prompt:b,stopSequences:w}=uh({prompt:n,inputFormat:e}),S=[...w??[],...c??[]],A={model:this.modelId,echo:this.settings.echo,logit_bias:this.settings.logitBias,logprobs:typeof this.settings.logprobs=="number"?this.settings.logprobs:typeof this.settings.logprobs=="boolean"&&this.settings.logprobs?0:void 0,suffix:this.settings.suffix,user:this.settings.user,max_tokens:r,temperature:s,top_p:o,frequency_penalty:a,presence_penalty:l,seed:h,prompt:b,stop:S.length>0?S:void 0};switch(g){case"regular":{if((p=t.tools)!=null&&p.length)throw new Ee({functionality:"tools"});if(t.toolChoice)throw new Ee({functionality:"toolChoice"});return{args:A,warnings:v}}case"object-json":throw new Ee({functionality:"object-json mode"});case"object-tool":throw new Ee({functionality:"object-tool mode"});default:{const O=g;throw new Error(`Unsupported type: ${O}`)}}}async doGenerate(t){const{args:e,warnings:n}=this.getArgs(t),{responseHeaders:r,value:s}=await xt({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:_t(this.config.headers(),t.headers),body:e,failedResponseHandler:Yt,successfulResponseHandler:Tn(fh),abortSignal:t.abortSignal,fetch:this.config.fetch}),{prompt:o,...i}=e,a=s.choices[0];return{text:a.text,usage:{promptTokens:s.usage.prompt_tokens,completionTokens:s.usage.completion_tokens},finishReason:lr(a.finish_reason),logprobs:_i(a.logprobs),rawCall:{rawPrompt:o,rawSettings:i},rawResponse:{headers:r},response:ur(s),warnings:n,request:{body:JSON.stringify(e)}}}async doStream(t){const{args:e,warnings:n}=this.getArgs(t),r={...e,stream:!0,stream_options:this.config.compatibility==="strict"?{include_usage:!0}:void 0},{responseHeaders:s,value:o}=await xt({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:_t(this.config.headers(),t.headers),body:r,failedResponseHandler:Yt,successfulResponseHandler:po(ph),abortSignal:t.abortSignal,fetch:this.config.fetch}),{prompt:i,...a}=e;let l="unknown",c={promptTokens:Number.NaN,completionTokens:Number.NaN},d,h=!0;return{stream:o.pipeThrough(new TransformStream({transform(p,g){if(!p.success){l="error",g.enqueue({type:"error",error:p.error});return}const v=p.value;if("error"in v){l="error",g.enqueue({type:"error",error:v.error});return}h&&(h=!1,g.enqueue({type:"response-metadata",...ur(v)})),v.usage!=null&&(c={promptTokens:v.usage.prompt_tokens,completionTokens:v.usage.completion_tokens});const b=v.choices[0];b?.finish_reason!=null&&(l=lr(b.finish_reason)),b?.text!=null&&g.enqueue({type:"text-delta",textDelta:b.text});const w=_i(b?.logprobs);w?.length&&(d===void 0&&(d=[]),d.push(...w))},flush(p){p.enqueue({type:"finish",finishReason:l,logprobs:d,usage:c})}})),rawCall:{rawPrompt:i,rawSettings:a},rawResponse:{headers:s},warnings:n,request:{body:JSON.stringify(r)}}}},fh=_({id:E().nullish(),created:T().nullish(),model:E().nullish(),choices:D(_({text:E(),finish_reason:E(),logprobs:_({tokens:D(E()),token_logprobs:D(T()),top_logprobs:D(Rn(E(),T())).nullable()}).nullish()})),usage:_({prompt_tokens:T(),completion_tokens:T()})}),ph=Tt([_({id:E().nullish(),created:T().nullish(),model:E().nullish(),choices:D(_({text:E(),finish_reason:E().nullish(),index:T(),logprobs:_({tokens:D(E()),token_logprobs:D(T()),top_logprobs:D(Rn(E(),T())).nullable()}).nullish()})),usage:_({prompt_tokens:T(),completion_tokens:T()}).nullish()}),go]),hh=class{constructor(t,e,n){this.specificationVersion="v1",this.modelId=t,this.settings=e,this.config=n}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){var t;return(t=this.settings.maxEmbeddingsPerCall)!=null?t:2048}get supportsParallelCalls(){var t;return(t=this.settings.supportsParallelCalls)!=null?t:!0}async doEmbed({values:t,headers:e,abortSignal:n}){if(t.length>this.maxEmbeddingsPerCall)throw new Lf({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:t});const{responseHeaders:r,value:s}=await xt({url:this.config.url({path:"/embeddings",modelId:this.modelId}),headers:_t(this.config.headers(),e),body:{model:this.modelId,input:t,encoding_format:"float",dimensions:this.settings.dimensions,user:this.settings.user},failedResponseHandler:Yt,successfulResponseHandler:Tn(mh),abortSignal:n,fetch:this.config.fetch});return{embeddings:s.data.map(o=>o.embedding),usage:s.usage?{tokens:s.usage.prompt_tokens}:void 0,rawResponse:{headers:r}}}},mh=_({data:D(_({embedding:D(T())})),usage:_({prompt_tokens:T()}).nullish()}),gh={"dall-e-3":1,"dall-e-2":10},yh=class{constructor(t,e,n){this.modelId=t,this.settings=e,this.config=n,this.specificationVersion="v1"}get maxImagesPerCall(){var t,e;return(e=(t=this.settings.maxImagesPerCall)!=null?t:gh[this.modelId])!=null?e:1}get provider(){return this.config.provider}async doGenerate({prompt:t,n:e,size:n,aspectRatio:r,seed:s,providerOptions:o,headers:i,abortSignal:a}){var l,c,d,h;const p=[];r!=null&&p.push({type:"unsupported-setting",setting:"aspectRatio",details:"This model does not support aspect ratio. Use `size` instead."}),s!=null&&p.push({type:"unsupported-setting",setting:"seed"});const g=(d=(c=(l=this.config._internal)==null?void 0:l.currentDate)==null?void 0:c.call(l))!=null?d:new Date,{value:v,responseHeaders:b}=await xt({url:this.config.url({path:"/images/generations",modelId:this.modelId}),headers:_t(this.config.headers(),i),body:{model:this.modelId,prompt:t,n:e,size:n,...(h=o.openai)!=null?h:{},response_format:"b64_json"},failedResponseHandler:Yt,successfulResponseHandler:Tn(vh),abortSignal:a,fetch:this.config.fetch});return{images:v.data.map(w=>w.b64_json),warnings:p,response:{timestamp:g,modelId:this.modelId,headers:b}}}},vh=_({data:D(_({b64_json:E()}))});function Ve(t={}){var e,n,r;const s=(e=Kc(t.baseURL))!=null?e:"https://api.openai.com/v1",o=(n=t.compatibility)!=null?n:"compatible",i=(r=t.name)!=null?r:"openai",a=()=>({Authorization:`Bearer ${Lc({apiKey:t.apiKey,environmentVariableName:"OPENAI_API_KEY",description:"OpenAI"})}`,"OpenAI-Organization":t.organization,"OpenAI-Project":t.project,...t.headers}),l=(v,b={})=>new oh(v,b,{provider:`${i}.chat`,url:({path:w})=>`${s}${w}`,headers:a,compatibility:o,fetch:t.fetch}),c=(v,b={})=>new dh(v,b,{provider:`${i}.completion`,url:({path:w})=>`${s}${w}`,headers:a,compatibility:o,fetch:t.fetch}),d=(v,b={})=>new hh(v,b,{provider:`${i}.embedding`,url:({path:w})=>`${s}${w}`,headers:a,fetch:t.fetch}),h=(v,b={})=>new yh(v,b,{provider:`${i}.image`,url:({path:w})=>`${s}${w}`,headers:a,fetch:t.fetch}),p=(v,b)=>{if(new.target)throw new Error("The OpenAI model function cannot be called with the new keyword.");return v==="gpt-3.5-turbo-instruct"?c(v,b):l(v,b)},g=function(v,b){return p(v,b)};return g.languageModel=p,g.chat=l,g.completion=c,g.embedding=d,g.textEmbedding=d,g.textEmbeddingModel=d,g.image=h,g}Ve({compatibility:"strict"});class ye{cachedDynamicModels;getApiKeyLink;labelForGetApiKey;icon;getProviderBaseUrlAndKey(e){const{apiKeys:n,providerSettings:r,serverEnv:s,defaultBaseUrlKey:o,defaultApiTokenKey:i}=e;let a=r?.baseUrl;const l=$t.getInstance();a&&a.length==0&&(a=void 0);const c=this.config.baseUrlKey||o;let d=a||s?.[c]||Pe?.env?.[c]||l.env?.[c]||this.config.baseUrl;d&&d.endsWith("/")&&(d=d.slice(0,-1));const h=this.config.apiTokenKey||i,p=n?.[this.name]||s?.[h]||Pe?.env?.[h]||l.env?.[h];return{baseUrl:d,apiKey:p}}getModelsFromCache(e){if(!this.cachedDynamicModels)return null;const n=this.cachedDynamicModels.cacheId,r=this.getDynamicModelsCacheKey(e);return n!==r?(this.cachedDynamicModels=void 0,null):this.cachedDynamicModels.models}getDynamicModelsCacheKey(e){return JSON.stringify({apiKeys:e.apiKeys?.[this.name],providerSettings:e.providerSettings?.[this.name],serverEnv:e.serverEnv})}storeDynamicModels(e,n){const r=this.getDynamicModelsCacheKey(e);this.cachedDynamicModels={cacheId:r,models:n}}}function Yc(t,e,n){return Ve({baseURL:t,apiKey:e})(n)}let Qc=(t,e=21)=>(n=e)=>{let r="",s=n;for(;s--;)r+=t[Math.random()*t.length|0];return r};var Xc="vercel.ai.error",wh=Symbol.for(Xc),el,bh=class tl extends Error{constructor({name:e,message:n,cause:r}){super(n),this[el]=!0,this.name=e,this.cause=r}static isInstance(e){return tl.hasMarker(e,Xc)}static hasMarker(e,n){const r=Symbol.for(n);return e!=null&&typeof e=="object"&&r in e&&typeof e[r]=="boolean"&&e[r]===!0}toJSON(){return{name:this.name,message:this.message}}};el=wh;var Fe=bh,_s="AI_APICallError",nl=`vercel.ai.error.${_s}`,_h=Symbol.for(nl),rl,ot=class extends Fe{constructor({message:e,url:n,requestBodyValues:r,statusCode:s,responseHeaders:o,responseBody:i,cause:a,isRetryable:l=s!=null&&(s===408||s===409||s===429||s>=500),data:c}){super({name:_s,message:e,cause:a}),this[rl]=!0,this.url=n,this.requestBodyValues=r,this.statusCode=s,this.responseHeaders=o,this.responseBody=i,this.isRetryable=l,this.data=c}static isInstance(e){return Fe.hasMarker(e,nl)}static isAPICallError(e){return e instanceof Error&&e.name===_s&&typeof e.url=="string"&&typeof e.requestBodyValues=="object"&&(e.statusCode==null||typeof e.statusCode=="number")&&(e.responseHeaders==null||typeof e.responseHeaders=="object")&&(e.responseBody==null||typeof e.responseBody=="string")&&(e.cause==null||typeof e.cause=="object")&&typeof e.isRetryable=="boolean"&&(e.data==null||typeof e.data=="object")}toJSON(){return{name:this.name,message:this.message,url:this.url,requestBodyValues:this.requestBodyValues,statusCode:this.statusCode,responseHeaders:this.responseHeaders,responseBody:this.responseBody,cause:this.cause,isRetryable:this.isRetryable,data:this.data}}};rl=_h;var xs="AI_EmptyResponseBodyError",sl=`vercel.ai.error.${xs}`,xh=Symbol.for(sl),ol,Eh=class extends Fe{constructor({message:e="Empty response body"}={}){super({name:xs,message:e}),this[ol]=!0}static isInstance(e){return Fe.hasMarker(e,sl)}static isEmptyResponseBodyError(e){return e instanceof Error&&e.name===xs}};ol=xh;function il(t){return t==null?"unknown error":typeof t=="string"?t:t instanceof Error?t.message:JSON.stringify(t)}var Es="AI_JSONParseError",al=`vercel.ai.error.${Es}`,kh=Symbol.for(al),cl,fr=class extends Fe{constructor({text:e,cause:n}){super({name:Es,message:`JSON parsing failed: Text: ${e}.
Error message: ${il(n)}`,cause:n}),this[cl]=!0,this.text=e}static isInstance(e){return Fe.hasMarker(e,al)}static isJSONParseError(e){return e instanceof Error&&e.name===Es&&typeof e.text=="string"&&typeof e.cause=="string"}toJSON(){return{name:this.name,message:this.message,cause:this.cause,stack:this.stack,valueText:this.text}}};cl=kh;var ks="AI_LoadAPIKeyError",ll=`vercel.ai.error.${ks}`,Sh=Symbol.for(ll),ul,Mn=class extends Fe{constructor({message:e}){super({name:ks,message:e}),this[ul]=!0}static isInstance(e){return Fe.hasMarker(e,ll)}static isLoadAPIKeyError(e){return e instanceof Error&&e.name===ks}};ul=Sh;var Ss="AI_TypeValidationError",dl=`vercel.ai.error.${Ss}`,Ah=Symbol.for(dl),fl,dn=class extends Fe{constructor({value:e,cause:n}){super({name:Ss,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${il(n)}`,cause:n}),this[fl]=!0,this.value=e}static isInstance(e){return Fe.hasMarker(e,dl)}static isTypeValidationError(e){return e instanceof Error&&e.name===Ss}toJSON(){return{name:this.name,message:this.message,cause:this.cause,stack:this.stack,value:this.value}}};fl=Ah;var As="AI_UnsupportedFunctionalityError",pl=`vercel.ai.error.${As}`,Ch=Symbol.for(pl),hl,Cs=class extends Fe{constructor({functionality:e}){super({name:As,message:`'${e}' functionality not supported.`}),this[hl]=!0,this.functionality=e}static isInstance(e){return Fe.hasMarker(e,pl)}static isUnsupportedFunctionalityError(e){return e instanceof Error&&e.name===As&&typeof e.functionality=="string"}toJSON(){return{name:this.name,message:this.message,stack:this.stack,functionality:this.functionality}}};hl=Ch;function Th(t){let e,n,r,s,o,i,a;return l(),{feed:c,reset:l};function l(){e=!0,n="",r=0,s=-1,o=void 0,i=void 0,a=""}function c(h){n=n?n+h:h,e&&Ih(n)&&(n=n.slice(ml.length)),e=!1;const p=n.length;let g=0,v=!1;for(;g<p;){v&&(n[g]===`
`&&++g,v=!1);let b=-1,w=s,S;for(let A=r;b<0&&A<p;++A)S=n[A],S===":"&&w<0?w=A-g:S==="\r"?(v=!0,b=A-g):S===`
`&&(b=A-g);if(b<0){r=p-g,s=w;break}else r=0,s=-1;d(n,g,w,b),g+=b+1}g===p?n="":g>0&&(n=n.slice(g))}function d(h,p,g,v){if(v===0){a.length>0&&(t({type:"event",id:o,event:i||void 0,data:a.slice(0,-1)}),a="",o=void 0),i=void 0;return}const b=g<0,w=h.slice(p,p+(b?v:g));let S=0;b?S=v:h[p+g+1]===" "?S=g+2:S=g+1;const A=p+S,O=v-S,B=h.slice(A,A+O).toString();if(w==="data")a+=B?"".concat(B,`
`):`
`;else if(w==="event")i=B;else if(w==="id"&&!B.includes("\0"))o=B;else if(w==="retry"){const $=parseInt(B,10);Number.isNaN($)||t({type:"reconnect-interval",value:$})}}}const ml=[239,187,191];function Ih(t){return ml.every((e,n)=>t.charCodeAt(n)===e)}class yo extends TransformStream{constructor(){let e;super({start(n){e=Th(r=>{r.type==="event"&&n.enqueue(r)})},transform(n){e.feed(n)}})}}var Rh={};function xi(...t){return t.reduce((e,n)=>({...e,...n??{}}),{})}function Pr(t){const e={};return t.headers.forEach((n,r)=>{e[r]=n}),e}function Wr(t){return t instanceof Error&&(t.name==="AbortError"||t.name==="TimeoutError")}function $h({apiKey:t,environmentVariableName:e,apiKeyParameterName:n="apiKey",description:r}){if(typeof t=="string")return t;if(t!=null)throw new Mn({message:`${r} API key must be a string.`});if(typeof Pe>"u")throw new Mn({message:`${r} API key is missing. Pass it using the '${n}' parameter. Environment variables is not supported in this environment.`});if(t=Rh[e],t==null)throw new Mn({message:`${r} API key is missing. Pass it using the '${n}' parameter or the ${e} environment variable.`});if(typeof t!="string")throw new Mn({message:`${r} API key must be a string. The value of the ${e} environment variable is not a string.`});return t}var Ts=Symbol.for("vercel.ai.validator");function Oh(t){return{[Ts]:!0,validate:t}}function Bh(t){return typeof t=="object"&&t!==null&&Ts in t&&t[Ts]===!0&&"validate"in t}function Ph(t){return Oh(e=>{const n=t.safeParse(e);return n.success?{success:!0,value:n.data}:{success:!1,error:n.error}})}function Nh({value:t,schema:e}){const n=gl({value:t,schema:e});if(!n.success)throw new dn({value:t,cause:n.error});return n.value}function gl({value:t,schema:e}){const n=Bh(e)?e:Ph(e);try{if(n.validate==null)return{success:!0,value:t};const r=n.validate(t);return r.success?r:{success:!1,error:new dn({value:t,cause:r.error})}}catch(r){return{success:!1,error:dn.isTypeValidationError(r)?r:new dn({value:t,cause:r})}}}function Mh({text:t,schema:e}){try{const n=je.parse(t);return e==null?n:Nh({value:n,schema:e})}catch(n){throw fr.isJSONParseError(n)||dn.isTypeValidationError(n)?n:new fr({text:t,cause:n})}}function yl({text:t,schema:e}){try{const n=je.parse(t);return e==null?{success:!0,value:n}:gl({value:n,schema:e})}catch(n){return{success:!1,error:fr.isJSONParseError(n)?n:new fr({text:t,cause:n})}}}function Dh(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>n!=null))}var Uh=()=>fetch,Ei=async({url:t,headers:e,body:n,failedResponseHandler:r,successfulResponseHandler:s,abortSignal:o,fetch:i})=>Lh({url:t,headers:{"Content-Type":"application/json",...e},body:{content:JSON.stringify(n),values:n},failedResponseHandler:r,successfulResponseHandler:s,abortSignal:o,fetch:i}),Lh=async({url:t,headers:e={},body:n,successfulResponseHandler:r,failedResponseHandler:s,abortSignal:o,fetch:i=Uh()})=>{try{const a=await i(t,{method:"POST",headers:Dh(e),body:n.content,signal:o}),l=Pr(a);if(!a.ok){let c;try{c=await s({response:a,url:t,requestBodyValues:n.values})}catch(d){throw Wr(d)||ot.isAPICallError(d)?d:new ot({message:"Failed to process error response",cause:d,statusCode:a.status,url:t,responseHeaders:l,requestBodyValues:n.values})}throw c.value}try{return await r({response:a,url:t,requestBodyValues:n.values})}catch(c){throw c instanceof Error&&(Wr(c)||ot.isAPICallError(c))?c:new ot({message:"Failed to process successful response",cause:c,statusCode:a.status,url:t,responseHeaders:l,requestBodyValues:n.values})}}catch(a){if(Wr(a))throw a;if(a instanceof TypeError&&a.message==="fetch failed"){const l=a.cause;if(l!=null)throw new ot({message:`Cannot connect to API: ${l.message}`,cause:l,url:t,requestBodyValues:n.values,isRetryable:!0})}throw a}},Fh=({errorSchema:t,errorToMessage:e,isRetryable:n})=>async({response:r,url:s,requestBodyValues:o})=>{const i=await r.text(),a=Pr(r);if(i.trim()==="")return{responseHeaders:a,value:new ot({message:r.statusText,url:s,requestBodyValues:o,statusCode:r.status,responseHeaders:a,responseBody:i,isRetryable:n?.(r)})};try{const l=Mh({text:i,schema:t});return{responseHeaders:a,value:new ot({message:e(l),url:s,requestBodyValues:o,statusCode:r.status,responseHeaders:a,responseBody:i,data:l,isRetryable:n?.(r,l)})}}catch{return{responseHeaders:a,value:new ot({message:r.statusText,url:s,requestBodyValues:o,statusCode:r.status,responseHeaders:a,responseBody:i,isRetryable:n?.(r)})}}},jh=t=>async({response:e})=>{const n=Pr(e);if(e.body==null)throw new Eh({});return{responseHeaders:n,value:e.body.pipeThrough(new TextDecoderStream).pipeThrough(new yo).pipeThrough(new TransformStream({transform({data:r},s){r!=="[DONE]"&&s.enqueue(yl({text:r,schema:t}))}}))}},Hh=t=>async({response:e,url:n,requestBodyValues:r})=>{const s=await e.text(),o=yl({text:s,schema:t}),i=Pr(e);if(!o.success)throw new ot({message:"Invalid JSON response",cause:o.error,statusCode:e.status,responseHeaders:i,responseBody:s,url:n,requestBodyValues:r});return{responseHeaders:i,value:o.value}};function Kh(t){let e="";for(let n=0;n<t.length;n++)e+=String.fromCodePoint(t[n]);return globalThis.btoa(e)}function Vh(t){return t?.replace(/\/$/,"")}var qh=_({type:K("error"),error:_({type:E(),message:E()})}),ki=Fh({errorSchema:qh,errorToMessage:t=>t.error.message});function Gh(t){var e;const n=zh(t);let r;const s=[];for(let o=0;o<n.length;o++){const i=n[o],a=i.type;switch(a){case"system":{if(r!=null)throw new Cs({functionality:"Multiple system messages that are separated by user/assistant messages"});r=i.messages.map(({content:l})=>l).join(`
`);break}case"user":{const l=[];for(const{role:c,content:d}of i.messages)switch(c){case"user":{for(const h of d)switch(h.type){case"text":{l.push({type:"text",text:h.text});break}case"image":{if(h.image instanceof URL)throw new Cs({functionality:"Image URLs in user messages"});l.push({type:"image",source:{type:"base64",media_type:(e=h.mimeType)!=null?e:"image/jpeg",data:Kh(h.image)}});break}}break}case"tool":{for(const h of d)l.push({type:"tool_result",tool_use_id:h.toolCallId,content:JSON.stringify(h.result),is_error:h.isError});break}default:{const h=c;throw new Error(`Unsupported role: ${h}`)}}s.push({role:"user",content:l});break}case"assistant":{const l=[];for(const{content:c}of i.messages)for(let d=0;d<c.length;d++){const h=c[d];switch(h.type){case"text":{l.push({type:"text",text:o===n.length-1&&d===i.messages.length-1?h.text.trim():h.text});break}case"tool-call":{l.push({type:"tool_use",id:h.toolCallId,name:h.toolName,input:h.args});break}}}s.push({role:"assistant",content:l});break}default:{const l=a;throw new Error(`Unsupported type: ${l}`)}}}return{system:r,messages:s}}function zh(t){const e=[];let n;for(const{role:r,content:s}of t)switch(r){case"system":{n?.type!=="system"&&(n={type:"system",messages:[]},e.push(n)),n.messages.push({role:r,content:s});break}case"assistant":{n?.type!=="assistant"&&(n={type:"assistant",messages:[]},e.push(n)),n.messages.push({role:r,content:s});break}case"user":{n?.type!=="user"&&(n={type:"user",messages:[]},e.push(n)),n.messages.push({role:r,content:s});break}case"tool":{n?.type!=="user"&&(n={type:"user",messages:[]},e.push(n)),n.messages.push({role:r,content:s});break}default:{const o=r;throw new Error(`Unsupported role: ${o}`)}}return e}function Si(t){switch(t){case"end_turn":case"stop_sequence":return"stop";case"tool_use":return"tool-calls";case"max_tokens":return"length";default:return"other"}}var Jh=class{constructor(t,e,n){this.specificationVersion="v1",this.defaultObjectGenerationMode="tool",this.supportsImageUrls=!1,this.modelId=t,this.settings=e,this.config=n}get provider(){return this.config.provider}async getArgs({mode:t,prompt:e,maxTokens:n,temperature:r,topP:s,topK:o,frequencyPenalty:i,presencePenalty:a,stopSequences:l,responseFormat:c,seed:d}){const h=t.type,p=[];i!=null&&p.push({type:"unsupported-setting",setting:"frequencyPenalty"}),a!=null&&p.push({type:"unsupported-setting",setting:"presencePenalty"}),d!=null&&p.push({type:"unsupported-setting",setting:"seed"}),c!=null&&c.type!=="text"&&p.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format is not supported."});const g=Gh(e),v={model:this.modelId,top_k:o??this.settings.topK,max_tokens:n??4096,temperature:r,top_p:s,stop_sequences:l,system:g.system,messages:g.messages};switch(h){case"regular":return{args:{...v,...Yh(t)},warnings:p};case"object-json":throw new Cs({functionality:"json-mode object generation"});case"object-tool":{const{name:b,description:w,parameters:S}=t.tool;return{args:{...v,tools:[{name:b,description:w,input_schema:S}],tool_choice:{type:"tool",name:b}},warnings:p}}default:{const b=h;throw new Error(`Unsupported type: ${b}`)}}}async doGenerate(t){const{args:e,warnings:n}=await this.getArgs(t),{responseHeaders:r,value:s}=await Ei({url:`${this.config.baseURL}/messages`,headers:xi(this.config.headers(),t.headers),body:e,failedResponseHandler:ki,successfulResponseHandler:Hh(Wh),abortSignal:t.abortSignal,fetch:this.config.fetch}),{messages:o,...i}=e;let a="";for(const c of s.content)c.type==="text"&&(a+=c.text);let l;if(s.content.some(c=>c.type==="tool_use")){l=[];for(const c of s.content)c.type==="tool_use"&&l.push({toolCallType:"function",toolCallId:c.id,toolName:c.name,args:JSON.stringify(c.input)})}return{text:a,toolCalls:l,finishReason:Si(s.stop_reason),usage:{promptTokens:s.usage.input_tokens,completionTokens:s.usage.output_tokens},rawCall:{rawPrompt:o,rawSettings:i},rawResponse:{headers:r},warnings:n}}async doStream(t){const{args:e,warnings:n}=await this.getArgs(t),{responseHeaders:r,value:s}=await Ei({url:`${this.config.baseURL}/messages`,headers:xi(this.config.headers(),t.headers),body:{...e,stream:!0},failedResponseHandler:ki,successfulResponseHandler:jh(Zh),abortSignal:t.abortSignal,fetch:this.config.fetch}),{messages:o,...i}=e;let a="other";const l={promptTokens:Number.NaN,completionTokens:Number.NaN},c={};return{stream:s.pipeThrough(new TransformStream({transform(d,h){if(!d.success){h.enqueue({type:"error",error:d.error});return}const p=d.value;switch(p.type){case"ping":return;case"content_block_start":{const g=p.content_block.type;switch(g){case"text":return;case"tool_use":{c[p.index]={toolCallId:p.content_block.id,toolName:p.content_block.name,jsonText:""};return}default:{const v=g;throw new Error(`Unsupported content block type: ${v}`)}}}case"content_block_stop":{if(c[p.index]!=null){const g=c[p.index];h.enqueue({type:"tool-call",toolCallType:"function",toolCallId:g.toolCallId,toolName:g.toolName,args:g.jsonText}),delete c[p.index]}return}case"content_block_delta":{const g=p.delta.type;switch(g){case"text_delta":{h.enqueue({type:"text-delta",textDelta:p.delta.text});return}case"input_json_delta":{const v=c[p.index];h.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:v.toolCallId,toolName:v.toolName,argsTextDelta:p.delta.partial_json}),v.jsonText+=p.delta.partial_json;return}default:{const v=g;throw new Error(`Unsupported delta type: ${v}`)}}}case"message_start":{l.promptTokens=p.message.usage.input_tokens,l.completionTokens=p.message.usage.output_tokens;return}case"message_delta":{l.completionTokens=p.usage.output_tokens,a=Si(p.delta.stop_reason);return}case"message_stop":{h.enqueue({type:"finish",finishReason:a,usage:l});return}case"error":{h.enqueue({type:"error",error:p.error});return}default:{const g=p;throw new Error(`Unsupported chunk type: ${g}`)}}}})),rawCall:{rawPrompt:o,rawSettings:i},rawResponse:{headers:r},warnings:n}}},Wh=_({type:K("message"),content:D(Gt("type",[_({type:K("text"),text:E()}),_({type:K("tool_use"),id:E(),name:E(),input:Jc()})])),stop_reason:E().optional().nullable(),usage:_({input_tokens:T(),output_tokens:T()})}),Zh=Gt("type",[_({type:K("message_start"),message:_({usage:_({input_tokens:T(),output_tokens:T()})})}),_({type:K("content_block_start"),index:T(),content_block:Gt("type",[_({type:K("text"),text:E()}),_({type:K("tool_use"),id:E(),name:E()})])}),_({type:K("content_block_delta"),index:T(),delta:Gt("type",[_({type:K("input_json_delta"),partial_json:E()}),_({type:K("text_delta"),text:E()})])}),_({type:K("content_block_stop"),index:T()}),_({type:K("error"),error:_({type:E(),message:E()})}),_({type:K("message_delta"),delta:_({stop_reason:E().optional().nullable()}),usage:_({output_tokens:T()})}),_({type:K("message_stop")}),_({type:K("ping")})]);function Yh(t){var e;const n=(e=t.tools)!=null&&e.length?t.tools:void 0;if(n==null)return{tools:void 0,tool_choice:void 0};const r=n.map(i=>({name:i.name,description:i.description,input_schema:i.parameters})),s=t.toolChoice;if(s==null)return{tools:r,tool_choice:void 0};const o=s.type;switch(o){case"auto":return{tools:r,tool_choice:{type:"auto"}};case"required":return{tools:r,tool_choice:{type:"any"}};case"none":return{tools:void 0,tool_choice:void 0};case"tool":return{tools:r,tool_choice:{type:"tool",name:s.toolName}};default:{const i=o;throw new Error(`Unsupported tool choice type: ${i}`)}}}function vl(t={}){var e,n;const r=(n=Vh((e=t.baseURL)!=null?e:t.baseUrl))!=null?n:"https://api.anthropic.com/v1",s=()=>({"anthropic-version":"2023-06-01","x-api-key":$h({apiKey:t.apiKey,environmentVariableName:"ANTHROPIC_API_KEY",description:"Anthropic"}),...t.headers}),o=(a,l={})=>new Jh(a,l,{provider:"anthropic.messages",baseURL:r,headers:s,fetch:t.fetch}),i=function(a,l){if(new.target)throw new Error("The Anthropic model function cannot be called with the new keyword.");return o(a,l)};return i.languageModel=o,i.chat=o,i.messages=o,i}vl();class Qh extends ye{name="Anthropic";getApiKeyLink="https://console.anthropic.com/settings/keys";config={apiTokenKey:"ANTHROPIC_API_KEY"};staticModels=[{name:"claude-3-5-sonnet-20241022",label:"Claude 3.5 Sonnet",provider:"Anthropic",maxTokenAllowed:2e5,maxCompletionTokens:128e3},{name:"claude-3-haiku-20240307",label:"Claude 3 Haiku",provider:"Anthropic",maxTokenAllowed:2e5,maxCompletionTokens:128e3},{name:"claude-opus-4-20250514",label:"Claude 4 Opus",provider:"Anthropic",maxTokenAllowed:2e5,maxCompletionTokens:32e3}];async getDynamicModels(e,n,r){const{apiKey:s}=this.getProviderBaseUrlAndKey({apiKeys:e,providerSettings:n,serverEnv:r,defaultBaseUrlKey:"",defaultApiTokenKey:"ANTHROPIC_API_KEY"});if(!s)throw`Missing Api Key configuration for ${this.name} provider`;const i=await(await fetch("https://api.anthropic.com/v1/models",{headers:{"x-api-key":`${s}`,"anthropic-version":"2023-06-01"}})).json(),a=this.staticModels.map(c=>c.name);return i.data.filter(c=>c.type==="model"&&!a.includes(c.id)).map(c=>{let d=32e3;c.max_tokens?d=c.max_tokens:(c.id?.includes("claude-3-5-sonnet")||c.id?.includes("claude-3-haiku")||c.id?.includes("claude-3-opus")||c.id?.includes("claude-3-sonnet"))&&(d=2e5);let h=128e3;return c.id?.includes("claude-opus-4")?h=32e3:c.id?.includes("claude-sonnet-4")?h=64e3:c.id?.includes("claude-4")&&(h=32e3),{name:c.id,label:`${c.display_name} (${Math.floor(d/1e3)}k context)`,provider:this.name,maxTokenAllowed:d,maxCompletionTokens:h}})}getModelInstance=e=>{const{apiKeys:n,providerSettings:r,serverEnv:s,model:o}=e,{apiKey:i}=this.getProviderBaseUrlAndKey({apiKeys:n,providerSettings:r,serverEnv:s,defaultBaseUrlKey:"",defaultApiTokenKey:"ANTHROPIC_API_KEY"});return vl({apiKey:i,headers:{"anthropic-beta":"output-128k-2025-02-19"}})(o)}}var wl="vercel.ai.error",Xh=Symbol.for(wl),bl,em=class _l extends Error{constructor({name:e,message:n,cause:r}){super(n),this[bl]=!0,this.name=e,this.cause=r}static isInstance(e){return _l.hasMarker(e,wl)}static hasMarker(e,n){const r=Symbol.for(n);return e!=null&&typeof e=="object"&&r in e&&typeof e[r]=="boolean"&&e[r]===!0}};bl=Xh;var ke=em,xl="AI_APICallError",El=`vercel.ai.error.${xl}`,tm=Symbol.for(El),kl,it=class extends ke{constructor({message:e,url:n,requestBodyValues:r,statusCode:s,responseHeaders:o,responseBody:i,cause:a,isRetryable:l=s!=null&&(s===408||s===409||s===429||s>=500),data:c}){super({name:xl,message:e,cause:a}),this[kl]=!0,this.url=n,this.requestBodyValues=r,this.statusCode=s,this.responseHeaders=o,this.responseBody=i,this.isRetryable=l,this.data=c}static isInstance(e){return ke.hasMarker(e,El)}};kl=tm;var Sl="AI_EmptyResponseBodyError",Al=`vercel.ai.error.${Sl}`,nm=Symbol.for(Al),Cl,rm=class extends ke{constructor({message:e="Empty response body"}={}){super({name:Sl,message:e}),this[Cl]=!0}static isInstance(e){return ke.hasMarker(e,Al)}};Cl=nm;function Tl(t){return t==null?"unknown error":typeof t=="string"?t:t instanceof Error?t.message:JSON.stringify(t)}var Il="AI_InvalidArgumentError",Rl=`vercel.ai.error.${Il}`,sm=Symbol.for(Rl),$l,om=class extends ke{constructor({message:e,cause:n,argument:r}){super({name:Il,message:e,cause:n}),this[$l]=!0,this.argument=r}static isInstance(e){return ke.hasMarker(e,Rl)}};$l=sm;var Ol="AI_JSONParseError",Bl=`vercel.ai.error.${Ol}`,im=Symbol.for(Bl),Pl,pr=class extends ke{constructor({text:e,cause:n}){super({name:Ol,message:`JSON parsing failed: Text: ${e}.
Error message: ${Tl(n)}`,cause:n}),this[Pl]=!0,this.text=e}static isInstance(e){return ke.hasMarker(e,Bl)}};Pl=im;var Nl="AI_LoadAPIKeyError",Ml=`vercel.ai.error.${Nl}`,am=Symbol.for(Ml),Dl,Dn=class extends ke{constructor({message:e}){super({name:Nl,message:e}),this[Dl]=!0}static isInstance(e){return ke.hasMarker(e,Ml)}};Dl=am;var Ul="AI_TooManyEmbeddingValuesForCallError",Ll=`vercel.ai.error.${Ul}`,cm=Symbol.for(Ll),Fl,lm=class extends ke{constructor(e){super({name:Ul,message:`Too many values for a single embedding call. The ${e.provider} model "${e.modelId}" can only embed up to ${e.maxEmbeddingsPerCall} values per call, but ${e.values.length} values were provided.`}),this[Fl]=!0,this.provider=e.provider,this.modelId=e.modelId,this.maxEmbeddingsPerCall=e.maxEmbeddingsPerCall,this.values=e.values}static isInstance(e){return ke.hasMarker(e,Ll)}};Fl=cm;var jl="AI_TypeValidationError",Hl=`vercel.ai.error.${jl}`,um=Symbol.for(Hl),Kl,dm=class Is extends ke{constructor({value:e,cause:n}){super({name:jl,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${Tl(n)}`,cause:n}),this[Kl]=!0,this.value=e}static isInstance(e){return ke.hasMarker(e,Hl)}static wrap({value:e,cause:n}){return Is.isInstance(n)&&n.value===e?n:new Is({value:e,cause:n})}};Kl=um;var hr=dm,Vl="AI_UnsupportedFunctionalityError",ql=`vercel.ai.error.${Vl}`,fm=Symbol.for(ql),Gl,zt=class extends ke{constructor({functionality:e}){super({name:Vl,message:`'${e}' functionality not supported.`}),this[Gl]=!0,this.functionality=e}static isInstance(e){return ke.hasMarker(e,ql)}};Gl=fm;var pm={};function Rs(...t){return t.reduce((e,n)=>({...e,...n??{}}),{})}function Nr(t){const e={};return t.headers.forEach((n,r)=>{e[r]=n}),e}var hm=({prefix:t,size:e=16,alphabet:n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{const s=lo(n,e);if(t==null)return s;if(n.includes(r))throw new om({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${n}".`});return o=>`${t}${r}${s(o)}`};hm();function Zr(t){return t instanceof Error&&(t.name==="AbortError"||t.name==="TimeoutError")}function mm({apiKey:t,environmentVariableName:e,apiKeyParameterName:n="apiKey",description:r}){if(typeof t=="string")return t;if(t!=null)throw new Dn({message:`${r} API key must be a string.`});if(typeof Pe>"u")throw new Dn({message:`${r} API key is missing. Pass it using the '${n}' parameter. Environment variables is not supported in this environment.`});if(t=pm[e],t==null)throw new Dn({message:`${r} API key is missing. Pass it using the '${n}' parameter or the ${e} environment variable.`});if(typeof t!="string")throw new Dn({message:`${r} API key must be a string. The value of the ${e} environment variable is not a string.`});return t}var $s=Symbol.for("vercel.ai.validator");function gm(t){return{[$s]:!0,validate:t}}function ym(t){return typeof t=="object"&&t!==null&&$s in t&&t[$s]===!0&&"validate"in t}function vm(t){return ym(t)?t:wm(t)}function wm(t){return gm(e=>{const n=t.safeParse(e);return n.success?{success:!0,value:n.data}:{success:!1,error:n.error}})}function bm({value:t,schema:e}){const n=zl({value:t,schema:e});if(!n.success)throw hr.wrap({value:t,cause:n.error});return n.value}function zl({value:t,schema:e}){const n=vm(e);try{if(n.validate==null)return{success:!0,value:t};const r=n.validate(t);return r.success?r:{success:!1,error:hr.wrap({value:t,cause:r.error})}}catch(r){return{success:!1,error:hr.wrap({value:t,cause:r})}}}function _m({text:t,schema:e}){try{const n=je.parse(t);return e==null?n:bm({value:n,schema:e})}catch(n){throw pr.isInstance(n)||hr.isInstance(n)?n:new pr({text:t,cause:n})}}function Jl({text:t,schema:e}){try{const n=je.parse(t);return e==null?{success:!0,value:n}:zl({value:n,schema:e})}catch(n){return{success:!1,error:pr.isInstance(n)?n:new pr({text:t,cause:n})}}}function xm(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>n!=null))}var Em=()=>globalThis.fetch,Os=async({url:t,headers:e,body:n,failedResponseHandler:r,successfulResponseHandler:s,abortSignal:o,fetch:i})=>km({url:t,headers:{"Content-Type":"application/json",...e},body:{content:JSON.stringify(n),values:n},failedResponseHandler:r,successfulResponseHandler:s,abortSignal:o,fetch:i}),km=async({url:t,headers:e={},body:n,successfulResponseHandler:r,failedResponseHandler:s,abortSignal:o,fetch:i=Em()})=>{try{const a=await i(t,{method:"POST",headers:xm(e),body:n.content,signal:o}),l=Nr(a);if(!a.ok){let c;try{c=await s({response:a,url:t,requestBodyValues:n.values})}catch(d){throw Zr(d)||it.isInstance(d)?d:new it({message:"Failed to process error response",cause:d,statusCode:a.status,url:t,responseHeaders:l,requestBodyValues:n.values})}throw c.value}try{return await r({response:a,url:t,requestBodyValues:n.values})}catch(c){throw c instanceof Error&&(Zr(c)||it.isInstance(c))?c:new it({message:"Failed to process successful response",cause:c,statusCode:a.status,url:t,responseHeaders:l,requestBodyValues:n.values})}}catch(a){if(Zr(a))throw a;if(a instanceof TypeError&&a.message==="fetch failed"){const l=a.cause;if(l!=null)throw new it({message:`Cannot connect to API: ${l.message}`,cause:l,url:t,requestBodyValues:n.values,isRetryable:!0})}throw a}},Sm=({errorSchema:t,errorToMessage:e,isRetryable:n})=>async({response:r,url:s,requestBodyValues:o})=>{const i=await r.text(),a=Nr(r);if(i.trim()==="")return{responseHeaders:a,value:new it({message:r.statusText,url:s,requestBodyValues:o,statusCode:r.status,responseHeaders:a,responseBody:i,isRetryable:n?.(r)})};try{const l=_m({text:i,schema:t});return{responseHeaders:a,value:new it({message:e(l),url:s,requestBodyValues:o,statusCode:r.status,responseHeaders:a,responseBody:i,data:l,isRetryable:n?.(r,l)})}}catch{return{responseHeaders:a,value:new it({message:r.statusText,url:s,requestBodyValues:o,statusCode:r.status,responseHeaders:a,responseBody:i,isRetryable:n?.(r)})}}},Am=t=>async({response:e})=>{const n=Nr(e);if(e.body==null)throw new rm({});return{responseHeaders:n,value:e.body.pipeThrough(new TextDecoderStream).pipeThrough(new Uc).pipeThrough(new TransformStream({transform({data:r},s){r!=="[DONE]"&&s.enqueue(Jl({text:r,schema:t}))}}))}},Wl=t=>async({response:e,url:n,requestBodyValues:r})=>{const s=await e.text(),o=Jl({text:s,schema:t}),i=Nr(e);if(!o.success)throw new it({message:"Invalid JSON response",cause:o.error,statusCode:e.status,responseHeaders:i,responseBody:s,url:n,requestBodyValues:r});return{responseHeaders:i,value:o.value}};function Cm(t){return t?.replace(/\/$/,"")}var Tm=_({message:E()}),Bs=Sm({errorSchema:Tm,errorToMessage:t=>t.message});function Im(t){const e=[];for(const{role:n,content:r}of t)switch(n){case"system":{e.push({role:"system",content:r});break}case"user":{e.push({role:"user",content:r.map(s=>{switch(s.type){case"text":return s.text;case"image":throw new zt({functionality:"image-part"})}}).join("")});break}case"assistant":{let s="";const o=[];for(const i of r)switch(i.type){case"text":{s+=i.text;break}case"tool-call":{o.push({id:i.toolCallId,type:"function",function:{name:i.toolName,arguments:JSON.stringify(i.args)}});break}default:{const a=i;throw new Error(`Unsupported part: ${a}`)}}e.push({role:"assistant",content:s!==""?s:"call tool",tool_calls:o.length>0?o:void 0,tool_plan:void 0});break}case"tool":{e.push(...r.map(s=>({role:"tool",content:JSON.stringify(s.result),tool_call_id:s.toolCallId})));break}default:{const s=n;throw new Error(`Unsupported role: ${s}`)}}return e}function Ai(t){switch(t){case"COMPLETE":case"STOP_SEQUENCE":return"stop";case"MAX_TOKENS":return"length";case"ERROR":case"ERROR_LIMIT":return"error";case"ERROR_TOXIC":return"content-filter";case"USER_CANCEL":return"other";default:return"unknown"}}function Rm(t){var e;const n=(e=t.tools)!=null&&e.length?t.tools:void 0,r=[];if(n==null)return{tools:void 0,tool_choice:void 0,toolWarnings:r};const s=[];for(const a of n)a.type==="provider-defined"?r.push({type:"unsupported-tool",tool:a}):s.push({type:"function",function:{name:a.name,description:a.description,parameters:a.parameters}});const o=t.toolChoice;if(o==null)return{tools:s,tool_choice:void 0,toolWarnings:r};const i=o.type;switch(i){case"auto":return{tools:s,tool_choice:i,toolWarnings:r};case"none":return{tools:void 0,tool_choice:"any",toolWarnings:r};case"required":case"tool":throw new zt({functionality:`Unsupported tool choice type: ${i}`});default:{const a=i;throw new zt({functionality:`Unsupported tool choice type: ${a}`})}}}var $m=class{constructor(t,e,n){this.specificationVersion="v1",this.defaultObjectGenerationMode=void 0,this.modelId=t,this.settings=e,this.config=n}get provider(){return this.config.provider}getArgs({mode:t,prompt:e,maxTokens:n,temperature:r,topP:s,topK:o,frequencyPenalty:i,presencePenalty:a,stopSequences:l,responseFormat:c,seed:d}){const h=t.type,p=Im(e),g={model:this.modelId,frequency_penalty:i,presence_penalty:a,max_tokens:n,temperature:r,p:s,k:o,seed:d,stop_sequences:l,response_format:c?.type==="json"?{type:"json_object",schema:c.schema}:void 0,messages:p};switch(h){case"regular":{const{tools:v,tool_choice:b,toolWarnings:w}=Rm(t);return{...g,tools:v,warnings:w}}case"object-json":throw new zt({functionality:"object-json mode"});case"object-tool":throw new zt({functionality:"object-tool mode"});default:{const v=h;throw new zt({functionality:`Unsupported mode: ${v}`})}}}concatenateMessageText(t){return t.filter(e=>"content"in e).map(e=>e.content).join("")}removeJsonSchemaExtras(t){return t.map(e=>{if(e.type==="function"&&e.function.parameters&&typeof e.function.parameters=="object"){const{additionalProperties:n,$schema:r,...s}=e.function.parameters;return{...e,function:{...e.function,parameters:s}}}return e})}async doGenerate(t){var e,n,r,s,o;const{warnings:i,...a}=this.getArgs(t);a.tools=a.tools&&this.removeJsonSchemaExtras(a.tools);const{responseHeaders:l,value:c}=await Os({url:`${this.config.baseURL}/chat`,headers:Rs(this.config.headers(),t.headers),body:a,failedResponseHandler:Bs,successfulResponseHandler:Wl(Om),abortSignal:t.abortSignal,fetch:this.config.fetch}),{messages:d,...h}=a;let p=(r=(n=(e=c.message.content)==null?void 0:e[0])==null?void 0:n.text)!=null?r:"";return p||(p=(s=c.message.tool_plan)!=null?s:""),{text:p,toolCalls:c.message.tool_calls?c.message.tool_calls.map(g=>({toolCallId:g.id,toolName:g.function.name,args:g.function.arguments,toolCallType:"function"})):[],finishReason:Ai(c.finish_reason),usage:{promptTokens:c.usage.tokens.input_tokens,completionTokens:c.usage.tokens.output_tokens},rawCall:{rawPrompt:{messages:d},rawSettings:h},response:{id:(o=c.generation_id)!=null?o:void 0},rawResponse:{headers:l},warnings:i,request:{body:JSON.stringify(a)}}}async doStream(t){const{warnings:e,...n}=this.getArgs(t);n.tools=n.tools&&this.removeJsonSchemaExtras(n.tools);const r={...n,stream:!0},{responseHeaders:s,value:o}=await Os({url:`${this.config.baseURL}/chat`,headers:Rs(this.config.headers(),t.headers),body:r,failedResponseHandler:Bs,successfulResponseHandler:Am(Bm),abortSignal:t.abortSignal,fetch:this.config.fetch}),{messages:i,...a}=n;let l="unknown",c={promptTokens:Number.NaN,completionTokens:Number.NaN},d={toolCallId:"",toolName:"",argsTextDelta:""};return{stream:o.pipeThrough(new TransformStream({transform(h,p){var g;if(!h.success){l="error",p.enqueue({type:"error",error:h.error});return}const v=h.value;switch(v.type){case"content-delta":{p.enqueue({type:"text-delta",textDelta:v.delta.message.content.text});return}case"tool-plan-delta":{p.enqueue({type:"text-delta",textDelta:v.delta.message.tool_plan});return}case"tool-call-start":{d={toolCallId:v.delta.message.tool_calls.id,toolName:v.delta.message.tool_calls.function.name,argsTextDelta:v.delta.message.tool_calls.function.arguments},p.enqueue({type:"tool-call-delta",toolCallId:d.toolCallId,toolName:d.toolName,toolCallType:"function",argsTextDelta:d.argsTextDelta});return}case"tool-call-delta":{d.argsTextDelta+=v.delta.message.tool_calls.function.arguments,p.enqueue({type:"tool-call-delta",toolCallId:d.toolCallId,toolName:d.toolName,toolCallType:"function",argsTextDelta:v.delta.message.tool_calls.function.arguments});return}case"tool-call-end":{p.enqueue({type:"tool-call",toolCallId:d.toolCallId,toolName:d.toolName,toolCallType:"function",args:JSON.stringify(JSON.parse(d.argsTextDelta))}),d={toolCallId:"",toolName:"",argsTextDelta:""};return}case"message-start":{p.enqueue({type:"response-metadata",id:(g=v.id)!=null?g:void 0});return}case"message-end":{l=Ai(v.delta.finish_reason);const w=v.delta.usage.tokens;c={promptTokens:w.input_tokens,completionTokens:w.output_tokens}}default:return}},flush(h){h.enqueue({type:"finish",finishReason:l,usage:c})}})),rawCall:{rawPrompt:{messages:i},rawSettings:a},rawResponse:{headers:s},warnings:e,request:{body:JSON.stringify(r)}}}},Om=_({generation_id:E().nullish(),message:_({role:E(),content:D(_({type:E(),text:E()})).nullish(),tool_plan:E().nullish(),tool_calls:D(_({id:E(),type:K("function"),function:_({name:E(),arguments:E()})})).nullish()}),finish_reason:E(),usage:_({billed_units:_({input_tokens:T(),output_tokens:T()}),tokens:_({input_tokens:T(),output_tokens:T()})})}),Bm=Gt("type",[_({type:K("citation-start")}),_({type:K("citation-end")}),_({type:K("content-start")}),_({type:K("content-delta"),delta:_({message:_({content:_({text:E()})})})}),_({type:K("content-end")}),_({type:K("message-start"),id:E().nullish()}),_({type:K("message-end"),delta:_({finish_reason:E(),usage:_({tokens:_({input_tokens:T(),output_tokens:T()})})})}),_({type:K("tool-plan-delta"),delta:_({message:_({tool_plan:E()})})}),_({type:K("tool-call-start"),delta:_({message:_({tool_calls:_({id:E(),type:K("function"),function:_({name:E(),arguments:E()})})})})}),_({type:K("tool-call-delta"),delta:_({message:_({tool_calls:_({function:_({arguments:E()})})})})}),_({type:K("tool-call-end")})]),Pm=class{constructor(t,e,n){this.specificationVersion="v1",this.maxEmbeddingsPerCall=96,this.supportsParallelCalls=!0,this.modelId=t,this.settings=e,this.config=n}get provider(){return this.config.provider}async doEmbed({values:t,headers:e,abortSignal:n}){var r;if(t.length>this.maxEmbeddingsPerCall)throw new lm({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:t});const{responseHeaders:s,value:o}=await Os({url:`${this.config.baseURL}/embed`,headers:Rs(this.config.headers(),e),body:{model:this.modelId,embedding_types:["float"],texts:t,input_type:(r=this.settings.inputType)!=null?r:"search_query",truncate:this.settings.truncate},failedResponseHandler:Bs,successfulResponseHandler:Wl(Nm),abortSignal:n,fetch:this.config.fetch});return{embeddings:o.embeddings.float,usage:{tokens:o.meta.billed_units.input_tokens},rawResponse:{headers:s}}}},Nm=_({embeddings:_({float:D(D(T()))}),meta:_({billed_units:_({input_tokens:T()})})});function Zl(t={}){var e;const n=(e=Cm(t.baseURL))!=null?e:"https://api.cohere.com/v2",r=()=>({Authorization:`Bearer ${mm({apiKey:t.apiKey,environmentVariableName:"COHERE_API_KEY",description:"Cohere"})}`,...t.headers}),s=(a,l={})=>new $m(a,l,{provider:"cohere.chat",baseURL:n,headers:r,fetch:t.fetch}),o=(a,l={})=>new Pm(a,l,{provider:"cohere.textEmbedding",baseURL:n,headers:r,fetch:t.fetch}),i=function(a,l){if(new.target)throw new Error("The Cohere model function cannot be called with the new keyword.");return s(a,l)};return i.languageModel=s,i.embedding=o,i.textEmbeddingModel=o,i}Zl();class Mm extends ye{name="Cohere";getApiKeyLink="https://dashboard.cohere.com/api-keys";config={apiTokenKey:"COHERE_API_KEY"};staticModels=[{name:"command-r-plus-08-2024",label:"Command R plus Latest",provider:"Cohere",maxTokenAllowed:4096,maxCompletionTokens:4e3},{name:"command-r-08-2024",label:"Command R Latest",provider:"Cohere",maxTokenAllowed:4096,maxCompletionTokens:4e3},{name:"command-r-plus",label:"Command R plus",provider:"Cohere",maxTokenAllowed:4096,maxCompletionTokens:4e3},{name:"command-r",label:"Command R",provider:"Cohere",maxTokenAllowed:4096,maxCompletionTokens:4e3},{name:"command",label:"Command",provider:"Cohere",maxTokenAllowed:4096,maxCompletionTokens:4e3},{name:"command-nightly",label:"Command Nightly",provider:"Cohere",maxTokenAllowed:4096,maxCompletionTokens:4e3},{name:"command-light",label:"Command Light",provider:"Cohere",maxTokenAllowed:4096,maxCompletionTokens:4e3},{name:"command-light-nightly",label:"Command Light Nightly",provider:"Cohere",maxTokenAllowed:4096,maxCompletionTokens:4e3},{name:"c4ai-aya-expanse-8b",label:"c4AI Aya Expanse 8b",provider:"Cohere",maxTokenAllowed:4096,maxCompletionTokens:4e3},{name:"c4ai-aya-expanse-32b",label:"c4AI Aya Expanse 32b",provider:"Cohere",maxTokenAllowed:4096,maxCompletionTokens:4e3}];getModelInstance(e){const{model:n,serverEnv:r,apiKeys:s,providerSettings:o}=e,{apiKey:i}=this.getProviderBaseUrlAndKey({apiKeys:s,providerSettings:o?.[this.name],serverEnv:r,defaultBaseUrlKey:"",defaultApiTokenKey:"COHERE_API_KEY"});if(!i)throw new Error(`Missing API key for ${this.name} provider`);return Zl({apiKey:i})(n)}}function cn(t){var e,n;return(n=(e=t?.providerMetadata)==null?void 0:e.openaiCompatible)!=null?n:{}}function Dm(t){const e=[];for(const{role:n,content:r,...s}of t){const o=cn({...s});switch(n){case"system":{e.push({role:"system",content:r,...o});break}case"user":{if(r.length===1&&r[0].type==="text"){e.push({role:"user",content:r[0].text,...cn(r[0])});break}e.push({role:"user",content:r.map(i=>{var a;const l=cn(i);switch(i.type){case"text":return{type:"text",text:i.text,...l};case"image":return{type:"image_url",image_url:{url:i.image instanceof URL?i.image.toString():`data:${(a=i.mimeType)!=null?a:"image/jpeg"};base64,${Hc(i.image)}`},...l};case"file":throw new Ee({functionality:"File content parts in user messages"})}}),...o});break}case"assistant":{let i="";const a=[];for(const l of r){const c=cn(l);switch(l.type){case"text":{i+=l.text;break}case"tool-call":{a.push({id:l.toolCallId,type:"function",function:{name:l.toolName,arguments:JSON.stringify(l.args)},...c});break}default:{const d=l;throw new Error(`Unsupported part: ${d}`)}}}e.push({role:"assistant",content:i,tool_calls:a.length>0?a:void 0,...o});break}case"tool":{for(const i of r){const a=cn(i);e.push({role:"tool",tool_call_id:i.toolCallId,content:JSON.stringify(i.result),...a})}break}default:{const i=n;throw new Error(`Unsupported role: ${i}`)}}}return e}function Ci({id:t,model:e,created:n}){return{id:t??void 0,modelId:e??void 0,timestamp:n!=null?new Date(n*1e3):void 0}}function Ti(t){switch(t){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var Um=_({error:_({message:E(),type:E().nullish(),param:In().nullish(),code:Tt([E(),T()]).nullish()})}),Lm={errorSchema:Um,errorToMessage:t=>t.error.message};function Fm({mode:t,structuredOutputs:e}){var n;const r=(n=t.tools)!=null&&n.length?t.tools:void 0,s=[];if(r==null)return{tools:void 0,tool_choice:void 0,toolWarnings:s};const o=t.toolChoice,i=[];for(const l of r)l.type==="provider-defined"?s.push({type:"unsupported-tool",tool:l}):i.push({type:"function",function:{name:l.name,description:l.description,parameters:l.parameters}});if(o==null)return{tools:i,tool_choice:void 0,toolWarnings:s};const a=o.type;switch(a){case"auto":case"none":case"required":return{tools:i,tool_choice:a,toolWarnings:s};case"tool":return{tools:i,tool_choice:{type:"function",function:{name:o.toolName}},toolWarnings:s};default:{const l=a;throw new Ee({functionality:`Unsupported tool choice type: ${l}`})}}}var jm=class{constructor(t,e,n){this.specificationVersion="v1";var r,s;this.modelId=t,this.settings=e,this.config=n;const o=(r=n.errorStructure)!=null?r:Lm;this.chunkSchema=Km(o.errorSchema),this.failedResponseHandler=jc(o),this.supportsStructuredOutputs=(s=n.supportsStructuredOutputs)!=null?s:!1}get defaultObjectGenerationMode(){return this.config.defaultObjectGenerationMode}get provider(){return this.config.provider}getArgs({mode:t,prompt:e,maxTokens:n,temperature:r,topP:s,topK:o,frequencyPenalty:i,presencePenalty:a,stopSequences:l,responseFormat:c,seed:d}){var h,p;const g=t.type,v=[];o!=null&&v.push({type:"unsupported-setting",setting:"topK"}),c?.type==="json"&&c.schema!=null&&!this.supportsStructuredOutputs&&v.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is only supported with structuredOutputs"});const b={model:this.modelId,user:this.settings.user,max_tokens:n,temperature:r,top_p:s,frequency_penalty:i,presence_penalty:a,response_format:c?.type==="json"?this.supportsStructuredOutputs===!0&&c.schema!=null?{type:"json_schema",json_schema:{schema:c.schema,name:(h=c.name)!=null?h:"response",description:c.description}}:{type:"json_object"}:void 0,stop:l,seed:d,messages:Dm(e)};switch(g){case"regular":{const{tools:w,tool_choice:S,toolWarnings:A}=Fm({mode:t,structuredOutputs:this.supportsStructuredOutputs});return{args:{...b,tools:w,tool_choice:S},warnings:[...v,...A]}}case"object-json":return{args:{...b,response_format:this.supportsStructuredOutputs===!0&&t.schema!=null?{type:"json_schema",json_schema:{schema:t.schema,name:(p=t.name)!=null?p:"response",description:t.description}}:{type:"json_object"}},warnings:v};case"object-tool":return{args:{...b,tool_choice:{type:"function",function:{name:t.tool.name}},tools:[{type:"function",function:{name:t.tool.name,description:t.tool.description,parameters:t.tool.parameters}}]},warnings:v};default:{const w=g;throw new Error(`Unsupported type: ${w}`)}}}async doGenerate(t){var e,n,r,s,o,i,a,l,c;const{args:d,warnings:h}=this.getArgs({...t}),p=JSON.stringify(d),{responseHeaders:g,value:v,rawValue:b}=await xt({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:_t(this.config.headers(),t.headers),body:d,failedResponseHandler:this.failedResponseHandler,successfulResponseHandler:Tn(Hm),abortSignal:t.abortSignal,fetch:this.config.fetch}),{messages:w,...S}=d,A=v.choices[0],O=(n=(e=this.config.metadataExtractor)==null?void 0:e.extractMetadata)==null?void 0:n.call(e,{parsedBody:b});return{text:(r=A.message.content)!=null?r:void 0,reasoning:(s=A.message.reasoning_content)!=null?s:void 0,toolCalls:(o=A.message.tool_calls)==null?void 0:o.map(B=>{var $;return{toolCallType:"function",toolCallId:($=B.id)!=null?$:bt(),toolName:B.function.name,args:B.function.arguments}}),finishReason:Ti(A.finish_reason),usage:{promptTokens:(a=(i=v.usage)==null?void 0:i.prompt_tokens)!=null?a:NaN,completionTokens:(c=(l=v.usage)==null?void 0:l.completion_tokens)!=null?c:NaN},...O&&{providerMetadata:O},rawCall:{rawPrompt:w,rawSettings:S},rawResponse:{headers:g},response:Ci(v),warnings:h,request:{body:p}}}async doStream(t){var e;if(this.settings.simulateStreaming){const v=await this.doGenerate(t);return{stream:new ReadableStream({start(w){if(w.enqueue({type:"response-metadata",...v.response}),v.reasoning&&w.enqueue({type:"reasoning",textDelta:v.reasoning}),v.text&&w.enqueue({type:"text-delta",textDelta:v.text}),v.toolCalls)for(const S of v.toolCalls)w.enqueue({type:"tool-call",...S});w.enqueue({type:"finish",finishReason:v.finishReason,usage:v.usage,logprobs:v.logprobs,providerMetadata:v.providerMetadata}),w.close()}}),rawCall:v.rawCall,rawResponse:v.rawResponse,warnings:v.warnings}}const{args:n,warnings:r}=this.getArgs({...t}),s=JSON.stringify({...n,stream:!0}),o=(e=this.config.metadataExtractor)==null?void 0:e.createStreamExtractor(),{responseHeaders:i,value:a}=await xt({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:_t(this.config.headers(),t.headers),body:{...n,stream:!0},failedResponseHandler:this.failedResponseHandler,successfulResponseHandler:po(this.chunkSchema),abortSignal:t.abortSignal,fetch:this.config.fetch}),{messages:l,...c}=n,d=[];let h="unknown",p={promptTokens:void 0,completionTokens:void 0},g=!0;return{stream:a.pipeThrough(new TransformStream({transform(v,b){var w,S,A,O,B,$,F,N,Z,re,ie,te,ue,de;if(!v.success){h="error",b.enqueue({type:"error",error:v.error});return}const fe=v.value;if(o?.processChunk(v.rawValue),"error"in fe){h="error",b.enqueue({type:"error",error:fe.error.message});return}g&&(g=!1,b.enqueue({type:"response-metadata",...Ci(fe)})),fe.usage!=null&&(p={promptTokens:(w=fe.usage.prompt_tokens)!=null?w:void 0,completionTokens:(S=fe.usage.completion_tokens)!=null?S:void 0});const Q=fe.choices[0];if(Q?.finish_reason!=null&&(h=Ti(Q.finish_reason)),Q?.delta==null)return;const se=Q.delta;if(se.reasoning_content!=null&&b.enqueue({type:"reasoning",textDelta:se.reasoning_content}),se.content!=null&&b.enqueue({type:"text-delta",textDelta:se.content}),se.tool_calls!=null)for(const me of se.tool_calls){const qe=me.index;if(d[qe]==null){if(me.type!=="function")throw new qt({data:me,message:"Expected 'function' type."});if(me.id==null)throw new qt({data:me,message:"Expected 'id' to be a string."});if(((A=me.function)==null?void 0:A.name)==null)throw new qt({data:me,message:"Expected 'function.name' to be a string."});d[qe]={id:me.id,type:"function",function:{name:me.function.name,arguments:(O=me.function.arguments)!=null?O:""},hasFinished:!1};const pe=d[qe];((B=pe.function)==null?void 0:B.name)!=null&&(($=pe.function)==null?void 0:$.arguments)!=null&&(pe.function.arguments.length>0&&b.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:pe.id,toolName:pe.function.name,argsTextDelta:pe.function.arguments}),Zn(pe.function.arguments)&&(b.enqueue({type:"tool-call",toolCallType:"function",toolCallId:(F=pe.id)!=null?F:bt(),toolName:pe.function.name,args:pe.function.arguments}),pe.hasFinished=!0));continue}const Y=d[qe];Y.hasFinished||(((N=me.function)==null?void 0:N.arguments)!=null&&(Y.function.arguments+=(re=(Z=me.function)==null?void 0:Z.arguments)!=null?re:""),b.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:Y.id,toolName:Y.function.name,argsTextDelta:(ie=me.function.arguments)!=null?ie:""}),((te=Y.function)==null?void 0:te.name)!=null&&((ue=Y.function)==null?void 0:ue.arguments)!=null&&Zn(Y.function.arguments)&&(b.enqueue({type:"tool-call",toolCallType:"function",toolCallId:(de=Y.id)!=null?de:bt(),toolName:Y.function.name,args:Y.function.arguments}),Y.hasFinished=!0))}},flush(v){var b,w;const S=o?.buildMetadata();v.enqueue({type:"finish",finishReason:h,usage:{promptTokens:(b=p.promptTokens)!=null?b:NaN,completionTokens:(w=p.completionTokens)!=null?w:NaN},...S&&{providerMetadata:S}})}})),rawCall:{rawPrompt:l,rawSettings:c},rawResponse:{headers:i},warnings:r,request:{body:s}}}},Hm=_({id:E().nullish(),created:T().nullish(),model:E().nullish(),choices:D(_({message:_({role:K("assistant").nullish(),content:E().nullish(),reasoning_content:E().nullish(),tool_calls:D(_({id:E().nullish(),type:K("function"),function:_({name:E(),arguments:E()})})).nullish()}),finish_reason:E().nullish()})),usage:_({prompt_tokens:T().nullish(),completion_tokens:T().nullish()}).nullish()}),Km=t=>Tt([_({id:E().nullish(),created:T().nullish(),model:E().nullish(),choices:D(_({delta:_({role:Br(["assistant"]).nullish(),content:E().nullish(),reasoning_content:E().nullish(),tool_calls:D(_({index:T(),id:E().nullish(),type:K("function").optional(),function:_({name:E().nullish(),arguments:E().nullish()})})).nullish()}).nullish(),finish_reason:E().nullish()})),usage:_({prompt_tokens:T().nullish(),completion_tokens:T().nullish()}).nullish()}),t]);_({id:E().nullish(),created:T().nullish(),model:E().nullish(),choices:D(_({text:E(),finish_reason:E()})),usage:_({prompt_tokens:T(),completion_tokens:T()}).nullish()});_({data:D(_({embedding:D(T())})),usage:_({prompt_tokens:T()}).nullish()});var Ii=t=>{var e,n;return t==null?void 0:{deepseek:{promptCacheHitTokens:(e=t.prompt_cache_hit_tokens)!=null?e:NaN,promptCacheMissTokens:(n=t.prompt_cache_miss_tokens)!=null?n:NaN}}},Vm={extractMetadata:({parsedBody:t})=>{const e=Wn({value:t,schema:qm});return!e.success||e.value.usage==null?void 0:Ii(e.value.usage)},createStreamExtractor:()=>{let t;return{processChunk:e=>{var n,r;const s=Wn({value:e,schema:Gm});s.success&&((r=(n=s.value.choices)==null?void 0:n[0])==null?void 0:r.finish_reason)==="stop"&&s.value.usage&&(t=s.value.usage)},buildMetadata:()=>Ii(t)}}},Yl=_({prompt_cache_hit_tokens:T().nullish(),prompt_cache_miss_tokens:T().nullish()}),qm=_({usage:Yl.nullish()}),Gm=_({choices:D(_({finish_reason:E().nullish()})).nullish(),usage:Yl.nullish()});function Ql(t={}){var e;const n=Kc((e=t.baseURL)!=null?e:"https://api.deepseek.com/v1"),r=()=>({Authorization:`Bearer ${Lc({apiKey:t.apiKey,environmentVariableName:"DEEPSEEK_API_KEY",description:"DeepSeek API key"})}`,...t.headers}),s=(i,a={})=>new jm(i,a,{provider:"deepseek.chat",url:({path:l})=>`${n}${l}`,headers:r,fetch:t.fetch,defaultObjectGenerationMode:"json",metadataExtractor:Vm}),o=(i,a)=>s(i,a);return o.languageModel=s,o.chat=s,o.textEmbeddingModel=i=>{throw new Df({modelId:i,modelType:"textEmbeddingModel"})},o}Ql();class zm extends ye{name="Deepseek";getApiKeyLink="https://platform.deepseek.com/apiKeys";config={apiTokenKey:"DEEPSEEK_API_KEY"};staticModels=[{name:"deepseek-coder",label:"Deepseek-Coder",provider:"Deepseek",maxTokenAllowed:8e3,maxCompletionTokens:8192},{name:"deepseek-chat",label:"Deepseek-Chat",provider:"Deepseek",maxTokenAllowed:8e3,maxCompletionTokens:8192},{name:"deepseek-reasoner",label:"Deepseek-Reasoner",provider:"Deepseek",maxTokenAllowed:8e3,maxCompletionTokens:8192}];getModelInstance(e){const{model:n,serverEnv:r,apiKeys:s,providerSettings:o}=e,{apiKey:i}=this.getProviderBaseUrlAndKey({apiKeys:s,providerSettings:o?.[this.name],serverEnv:r,defaultBaseUrlKey:"",defaultApiTokenKey:"DEEPSEEK_API_KEY"});if(!i)throw new Error(`Missing API key for ${this.name} provider`);return Ql({apiKey:i})(n,{})}}var Xl="vercel.ai.error",Jm=Symbol.for(Xl),eu,Wm=class tu extends Error{constructor({name:e,message:n,cause:r}){super(n),this[eu]=!0,this.name=e,this.cause=r}static isInstance(e){return tu.hasMarker(e,Xl)}static hasMarker(e,n){const r=Symbol.for(n);return e!=null&&typeof e=="object"&&r in e&&typeof e[r]=="boolean"&&e[r]===!0}toJSON(){return{name:this.name,message:this.message}}};eu=Jm;var Oe=Wm,Ps="AI_APICallError",nu=`vercel.ai.error.${Ps}`,Zm=Symbol.for(nu),ru,at=class extends Oe{constructor({message:e,url:n,requestBodyValues:r,statusCode:s,responseHeaders:o,responseBody:i,cause:a,isRetryable:l=s!=null&&(s===408||s===409||s===429||s>=500),data:c}){super({name:Ps,message:e,cause:a}),this[ru]=!0,this.url=n,this.requestBodyValues=r,this.statusCode=s,this.responseHeaders=o,this.responseBody=i,this.isRetryable=l,this.data=c}static isInstance(e){return Oe.hasMarker(e,nu)}static isAPICallError(e){return e instanceof Error&&e.name===Ps&&typeof e.url=="string"&&typeof e.requestBodyValues=="object"&&(e.statusCode==null||typeof e.statusCode=="number")&&(e.responseHeaders==null||typeof e.responseHeaders=="object")&&(e.responseBody==null||typeof e.responseBody=="string")&&(e.cause==null||typeof e.cause=="object")&&typeof e.isRetryable=="boolean"&&(e.data==null||typeof e.data=="object")}toJSON(){return{name:this.name,message:this.message,url:this.url,requestBodyValues:this.requestBodyValues,statusCode:this.statusCode,responseHeaders:this.responseHeaders,responseBody:this.responseBody,cause:this.cause,isRetryable:this.isRetryable,data:this.data}}};ru=Zm;var Ns="AI_EmptyResponseBodyError",su=`vercel.ai.error.${Ns}`,Ym=Symbol.for(su),ou,iu=class extends Oe{constructor({message:e="Empty response body"}={}){super({name:Ns,message:e}),this[ou]=!0}static isInstance(e){return Oe.hasMarker(e,su)}static isEmptyResponseBodyError(e){return e instanceof Error&&e.name===Ns}};ou=Ym;function au(t){return t==null?"unknown error":typeof t=="string"?t:t instanceof Error?t.message:JSON.stringify(t)}var Ms="AI_JSONParseError",cu=`vercel.ai.error.${Ms}`,Qm=Symbol.for(cu),lu,mr=class extends Oe{constructor({text:e,cause:n}){super({name:Ms,message:`JSON parsing failed: Text: ${e}.
Error message: ${au(n)}`,cause:n}),this[lu]=!0,this.text=e}static isInstance(e){return Oe.hasMarker(e,cu)}static isJSONParseError(e){return e instanceof Error&&e.name===Ms&&"text"in e&&typeof e.text=="string"}toJSON(){return{name:this.name,message:this.message,cause:this.cause,stack:this.stack,valueText:this.text}}};lu=Qm;var Ds="AI_LoadAPIKeyError",uu=`vercel.ai.error.${Ds}`,Xm=Symbol.for(uu),du,Un=class extends Oe{constructor({message:e}){super({name:Ds,message:e}),this[du]=!0}static isInstance(e){return Oe.hasMarker(e,uu)}static isLoadAPIKeyError(e){return e instanceof Error&&e.name===Ds}};du=Xm;var Us="AI_TooManyEmbeddingValuesForCallError",fu=`vercel.ai.error.${Us}`,eg=Symbol.for(fu),pu,vo=class extends Oe{constructor(t){super({name:Us,message:`Too many values for a single embedding call. The ${t.provider} model "${t.modelId}" can only embed up to ${t.maxEmbeddingsPerCall} values per call, but ${t.values.length} values were provided.`}),this[pu]=!0,this.provider=t.provider,this.modelId=t.modelId,this.maxEmbeddingsPerCall=t.maxEmbeddingsPerCall,this.values=t.values}static isInstance(t){return Oe.hasMarker(t,fu)}static isTooManyEmbeddingValuesForCallError(t){return t instanceof Error&&t.name===Us&&"provider"in t&&typeof t.provider=="string"&&"modelId"in t&&typeof t.modelId=="string"&&"maxEmbeddingsPerCall"in t&&typeof t.maxEmbeddingsPerCall=="number"&&"values"in t&&Array.isArray(t.values)}toJSON(){return{name:this.name,message:this.message,stack:this.stack,provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:this.values}}};pu=eg;var Ls="AI_TypeValidationError",hu=`vercel.ai.error.${Ls}`,tg=Symbol.for(hu),mu,ng=class Fs extends Oe{constructor({value:e,cause:n}){super({name:Ls,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${au(n)}`,cause:n}),this[mu]=!0,this.value=e}static isInstance(e){return Oe.hasMarker(e,hu)}static wrap({value:e,cause:n}){return Fs.isInstance(n)&&n.value===e?n:new Fs({value:e,cause:n})}static isTypeValidationError(e){return e instanceof Error&&e.name===Ls}toJSON(){return{name:this.name,message:this.message,cause:this.cause,stack:this.stack,value:this.value}}};mu=tg;var gr=ng,js="AI_UnsupportedFunctionalityError",gu=`vercel.ai.error.${js}`,rg=Symbol.for(gu),yu,fn=class extends Oe{constructor({functionality:e}){super({name:js,message:`'${e}' functionality not supported.`}),this[yu]=!0,this.functionality=e}static isInstance(e){return Oe.hasMarker(e,gu)}static isUnsupportedFunctionalityError(e){return e instanceof Error&&e.name===js&&typeof e.functionality=="string"}toJSON(){return{name:this.name,message:this.message,stack:this.stack,functionality:this.functionality}}};yu=rg;var sg={};function kt(...t){return t.reduce((e,n)=>({...e,...n??{}}),{})}function $n(t){const e={};return t.headers.forEach((n,r)=>{e[r]=n}),e}var og=({prefix:t="",size:e=7,alphabet:n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"}={})=>{const r=Qc(n,e);return s=>`${t}${r(s)}`},wo=og();function Yr(t){return t instanceof Error&&(t.name==="AbortError"||t.name==="TimeoutError")}function vu({apiKey:t,environmentVariableName:e,apiKeyParameterName:n="apiKey",description:r}){if(typeof t=="string")return t;if(t!=null)throw new Un({message:`${r} API key must be a string.`});if(typeof Pe>"u")throw new Un({message:`${r} API key is missing. Pass it using the '${n}' parameter. Environment variables is not supported in this environment.`});if(t=sg[e],t==null)throw new Un({message:`${r} API key is missing. Pass it using the '${n}' parameter or the ${e} environment variable.`});if(typeof t!="string")throw new Un({message:`${r} API key must be a string. The value of the ${e} environment variable is not a string.`});return t}var Hs=Symbol.for("vercel.ai.validator");function ig(t){return{[Hs]:!0,validate:t}}function ag(t){return typeof t=="object"&&t!==null&&Hs in t&&t[Hs]===!0&&"validate"in t}function cg(t){return ag(t)?t:lg(t)}function lg(t){return ig(e=>{const n=t.safeParse(e);return n.success?{success:!0,value:n.data}:{success:!1,error:n.error}})}function ug({value:t,schema:e}){const n=wu({value:t,schema:e});if(!n.success)throw gr.wrap({value:t,cause:n.error});return n.value}function wu({value:t,schema:e}){const n=cg(e);try{if(n.validate==null)return{success:!0,value:t};const r=n.validate(t);return r.success?r:{success:!1,error:gr.wrap({value:t,cause:r.error})}}catch(r){return{success:!1,error:gr.wrap({value:t,cause:r})}}}function dg({text:t,schema:e}){try{const n=je.parse(t);return e==null?n:ug({value:n,schema:e})}catch(n){throw mr.isJSONParseError(n)||gr.isTypeValidationError(n)?n:new mr({text:t,cause:n})}}function bo({text:t,schema:e}){try{const n=je.parse(t);return e==null?{success:!0,value:n}:wu({value:n,schema:e})}catch(n){return{success:!1,error:mr.isJSONParseError(n)?n:new mr({text:t,cause:n})}}}function fg(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>n!=null))}var pg=()=>globalThis.fetch,ht=async({url:t,headers:e,body:n,failedResponseHandler:r,successfulResponseHandler:s,abortSignal:o,fetch:i})=>hg({url:t,headers:{"Content-Type":"application/json",...e},body:{content:JSON.stringify(n),values:n},failedResponseHandler:r,successfulResponseHandler:s,abortSignal:o,fetch:i}),hg=async({url:t,headers:e={},body:n,successfulResponseHandler:r,failedResponseHandler:s,abortSignal:o,fetch:i=pg()})=>{try{const a=await i(t,{method:"POST",headers:fg(e),body:n.content,signal:o}),l=$n(a);if(!a.ok){let c;try{c=await s({response:a,url:t,requestBodyValues:n.values})}catch(d){throw Yr(d)||at.isAPICallError(d)?d:new at({message:"Failed to process error response",cause:d,statusCode:a.status,url:t,responseHeaders:l,requestBodyValues:n.values})}throw c.value}try{return await r({response:a,url:t,requestBodyValues:n.values})}catch(c){throw c instanceof Error&&(Yr(c)||at.isAPICallError(c))?c:new at({message:"Failed to process successful response",cause:c,statusCode:a.status,url:t,responseHeaders:l,requestBodyValues:n.values})}}catch(a){if(Yr(a))throw a;if(a instanceof TypeError&&a.message==="fetch failed"){const l=a.cause;if(l!=null)throw new at({message:`Cannot connect to API: ${l.message}`,cause:l,url:t,requestBodyValues:n.values,isRetryable:!0})}throw a}},_o=({errorSchema:t,errorToMessage:e,isRetryable:n})=>async({response:r,url:s,requestBodyValues:o})=>{const i=await r.text(),a=$n(r);if(i.trim()==="")return{responseHeaders:a,value:new at({message:r.statusText,url:s,requestBodyValues:o,statusCode:r.status,responseHeaders:a,responseBody:i,isRetryable:n?.(r)})};try{const l=dg({text:i,schema:t});return{responseHeaders:a,value:new at({message:e(l),url:s,requestBodyValues:o,statusCode:r.status,responseHeaders:a,responseBody:i,data:l,isRetryable:n?.(r,l)})}}catch{return{responseHeaders:a,value:new at({message:r.statusText,url:s,requestBodyValues:o,statusCode:r.status,responseHeaders:a,responseBody:i,isRetryable:n?.(r)})}}},bu=t=>async({response:e})=>{const n=$n(e);if(e.body==null)throw new iu({});return{responseHeaders:n,value:e.body.pipeThrough(new TextDecoderStream).pipeThrough(new yo).pipeThrough(new TransformStream({transform({data:r},s){r!=="[DONE]"&&s.enqueue(bo({text:r,schema:t}))}}))}},rn=t=>async({response:e,url:n,requestBodyValues:r})=>{const s=await e.text(),o=bo({text:s,schema:t}),i=$n(e);if(!o.success)throw new at({message:"Invalid JSON response",cause:o.error,statusCode:e.status,responseHeaders:i,responseBody:s,url:n,requestBodyValues:r});return{responseHeaders:i,value:o.value}},{btoa:mg}=globalThis;function xo(t){let e="";for(let n=0;n<t.length;n++)e+=String.fromCodePoint(t[n]);return mg(e)}function Eo(t){return t?.replace(/\/$/,"")}function Ze(t){if(typeof t=="boolean")return{type:"boolean",properties:{}};const{type:e,description:n,required:r,properties:s,items:o,allOf:i,anyOf:a,oneOf:l,format:c,const:d,minLength:h}=t,p={};return n&&(p.description=n),r&&(p.required=r),c&&(p.format=c),d!==void 0&&(p.enum=[d]),e&&(Array.isArray(e)?e.includes("null")?(p.type=e.filter(g=>g!=="null")[0],p.nullable=!0):p.type=e:e==="null"?p.type="null":p.type=e),s&&(p.properties=Object.entries(s).reduce((g,[v,b])=>(g[v]=Ze(b),g),{})),o&&(p.items=Array.isArray(o)?o.map(Ze):Ze(o)),i&&(p.allOf=i.map(Ze)),a&&(p.anyOf=a.map(Ze)),l&&(p.oneOf=l.map(Ze)),h!==void 0&&(p.minLength=h),p}function gg(t){var e;const n=[],r=[];let s=!0;for(const{role:o,content:i}of t)switch(o){case"system":{if(!s)throw new fn({functionality:"system messages are only supported at the beginning of the conversation"});n.push({text:i});break}case"user":{s=!1;const a=[];for(const l of i)switch(l.type){case"text":{a.push({text:l.text});break}case"image":{if(l.image instanceof URL)throw new fn({functionality:"Image URLs in user messages"});a.push({inlineData:{mimeType:(e=l.mimeType)!=null?e:"image/jpeg",data:xo(l.image)}});break}case"file":{if(l.data instanceof URL)throw new fn({functionality:"File URLs in user messages"});a.push({inlineData:{mimeType:l.mimeType,data:l.data}});break}}r.push({role:"user",parts:a});break}case"assistant":{s=!1,r.push({role:"model",parts:i.map(a=>{switch(a.type){case"text":return a.text.length===0?void 0:{text:a.text};case"tool-call":return{functionCall:{name:a.toolName,args:a.args}}}}).filter(a=>a!==void 0)});break}case"tool":{s=!1,r.push({role:"user",parts:i.map(a=>({functionResponse:{name:a.toolName,response:a.result}}))});break}default:{const a=o;throw new Error(`Unsupported role: ${a}`)}}return{systemInstruction:n.length>0?{parts:n}:void 0,contents:r}}function Ri(t){return t.includes("/")?t:`models/${t}`}var yg=_({error:_({code:T().nullable(),message:E(),status:E()})}),Ks=_o({errorSchema:yg,errorToMessage:t=>t.error.message});function $i({finishReason:t,hasToolCalls:e}){switch(t){case"STOP":return e?"tool-calls":"stop";case"MAX_TOKENS":return"length";case"RECITATION":case"SAFETY":return"content-filter";case"FINISH_REASON_UNSPECIFIED":case"OTHER":return"other";default:return"unknown"}}var vg=class{constructor(t,e,n){this.specificationVersion="v1",this.defaultObjectGenerationMode="json",this.supportsImageUrls=!1,this.modelId=t,this.settings=e,this.config=n}get supportsObjectGeneration(){return this.settings.structuredOutputs!==!1}get provider(){return this.config.provider}async getArgs({mode:t,prompt:e,maxTokens:n,temperature:r,topP:s,topK:o,frequencyPenalty:i,presencePenalty:a,stopSequences:l,responseFormat:c,seed:d}){var h;const p=t.type,g=[];d!=null&&g.push({type:"unsupported-setting",setting:"seed"});const v={maxOutputTokens:n,temperature:r,topK:o??this.settings.topK,topP:s,frequencyPenalty:i,presencePenalty:a,stopSequences:l,responseMimeType:c?.type==="json"?"application/json":void 0,responseSchema:c?.type==="json"&&c.schema!=null&&this.supportsObjectGeneration?Ze(c.schema):void 0},{contents:b,systemInstruction:w}=gg(e);switch(p){case"regular":return{args:{generationConfig:v,contents:b,systemInstruction:w,safetySettings:this.settings.safetySettings,..._g(t),cachedContent:this.settings.cachedContent},warnings:g};case"object-json":return{args:{generationConfig:{...v,responseMimeType:"application/json",responseSchema:t.schema!=null&&this.supportsObjectGeneration?Ze(t.schema):void 0},contents:b,systemInstruction:w,safetySettings:this.settings.safetySettings,cachedContent:this.settings.cachedContent},warnings:g};case"object-tool":return{args:{generationConfig:v,contents:b,tools:{functionDeclarations:[{name:t.tool.name,description:(h=t.tool.description)!=null?h:"",parameters:Ze(t.tool.parameters)}]},toolConfig:{functionCallingConfig:{mode:"ANY"}},safetySettings:this.settings.safetySettings,cachedContent:this.settings.cachedContent},warnings:g};default:{const S=p;throw new Error(`Unsupported type: ${S}`)}}}async doGenerate(t){var e,n;const{args:r,warnings:s}=await this.getArgs(t),{responseHeaders:o,value:i}=await ht({url:`${this.config.baseURL}/${Ri(this.modelId)}:generateContent`,headers:kt(this.config.headers(),t.headers),body:r,failedResponseHandler:Ks,successfulResponseHandler:rn(wg),abortSignal:t.abortSignal,fetch:this.config.fetch}),{contents:a,...l}=r,c=i.candidates[0],d=Oi({parts:c.content.parts,generateId:this.config.generateId}),h=i.usageMetadata;return{text:Bi(c.content.parts),toolCalls:d,finishReason:$i({finishReason:c.finishReason,hasToolCalls:d!=null&&d.length>0}),usage:{promptTokens:(e=h?.promptTokenCount)!=null?e:NaN,completionTokens:(n=h?.candidatesTokenCount)!=null?n:NaN},rawCall:{rawPrompt:a,rawSettings:l},rawResponse:{headers:o},warnings:s}}async doStream(t){const{args:e,warnings:n}=await this.getArgs(t),{responseHeaders:r,value:s}=await ht({url:`${this.config.baseURL}/${Ri(this.modelId)}:streamGenerateContent?alt=sse`,headers:kt(this.config.headers(),t.headers),body:e,failedResponseHandler:Ks,successfulResponseHandler:bu(bg),abortSignal:t.abortSignal,fetch:this.config.fetch}),{contents:o,...i}=e;let a="unknown",l={promptTokens:Number.NaN,completionTokens:Number.NaN};const c=this.config.generateId;let d=!1;return{stream:s.pipeThrough(new TransformStream({transform(h,p){var g,v;if(!h.success){p.enqueue({type:"error",error:h.error});return}const b=h.value,w=b.candidates[0];w?.finishReason!=null&&(a=$i({finishReason:w.finishReason,hasToolCalls:d}));const S=b.usageMetadata;S!=null&&(l={promptTokens:(g=S.promptTokenCount)!=null?g:NaN,completionTokens:(v=S.candidatesTokenCount)!=null?v:NaN});const A=w.content;if(A==null)return;const O=Bi(A.parts);O!=null&&p.enqueue({type:"text-delta",textDelta:O});const B=Oi({parts:A.parts,generateId:c});if(B!=null)for(const $ of B)p.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:$.toolCallId,toolName:$.toolName,argsTextDelta:$.args}),p.enqueue({type:"tool-call",toolCallType:"function",toolCallId:$.toolCallId,toolName:$.toolName,args:$.args}),d=!0},flush(h){h.enqueue({type:"finish",finishReason:a,usage:l})}})),rawCall:{rawPrompt:o,rawSettings:i},rawResponse:{headers:r},warnings:n}}};function Oi({parts:t,generateId:e}){const n=t.filter(r=>"functionCall"in r);return n.length===0?void 0:n.map(r=>({toolCallType:"function",toolCallId:e(),toolName:r.functionCall.name,args:JSON.stringify(r.functionCall.args)}))}function Bi(t){const e=t.filter(n=>"text"in n);return e.length===0?void 0:e.map(n=>n.text).join("")}var _u=_({role:E(),parts:D(Tt([_({text:E()}),_({functionCall:_({name:E(),args:Jc()})})]))}),wg=_({candidates:D(_({content:_u,finishReason:E().optional()})),usageMetadata:_({promptTokenCount:T(),candidatesTokenCount:T().nullish(),totalTokenCount:T()}).optional()}),bg=_({candidates:D(_({content:_u.optional(),finishReason:E().optional()})),usageMetadata:_({promptTokenCount:T(),candidatesTokenCount:T().nullish(),totalTokenCount:T()}).optional()});function _g(t){var e;const n=(e=t.tools)!=null&&e.length?t.tools:void 0;if(n==null)return{tools:void 0,toolConfig:void 0};const r={functionDeclarations:n.map(i=>{var a;return{name:i.name,description:(a=i.description)!=null?a:"",parameters:Ze(i.parameters)}})},s=t.toolChoice;if(s==null)return{tools:r,toolConfig:void 0};const o=s.type;switch(o){case"auto":return{tools:r,toolConfig:{functionCallingConfig:{mode:"AUTO"}}};case"none":return{tools:r,toolConfig:{functionCallingConfig:{mode:"NONE"}}};case"required":return{tools:r,toolConfig:{functionCallingConfig:{mode:"ANY"}}};case"tool":return{tools:r,toolConfig:{functionCallingConfig:{mode:"ANY",allowedFunctionNames:[s.toolName]}}};default:{const i=o;throw new Error(`Unsupported tool choice type: ${i}`)}}}var xg=class{constructor(t,e,n){this.specificationVersion="v1",this.modelId=t,this.settings=e,this.config=n}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){return 2048}get supportsParallelCalls(){return!0}async doEmbed({values:t,headers:e,abortSignal:n}){if(t.length>this.maxEmbeddingsPerCall)throw new vo({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:t});const{responseHeaders:r,value:s}=await ht({url:`${this.config.baseURL}/models/${this.modelId}:batchEmbedContents`,headers:kt(this.config.headers(),e),body:{requests:t.map(o=>({model:`models/${this.modelId}`,content:{role:"user",parts:[{text:o}]},outputDimensionality:this.settings.outputDimensionality}))},failedResponseHandler:Ks,successfulResponseHandler:rn(Eg),abortSignal:n,fetch:this.config.fetch});return{embeddings:s.embeddings.map(o=>o.values),usage:void 0,rawResponse:{headers:r}}}},Eg=_({embeddings:D(_({values:D(T())}))});function xu(t={}){var e,n;const r=(n=Eo((e=t.baseURL)!=null?e:t.baseUrl))!=null?n:"https://generativelanguage.googleapis.com/v1beta",s=()=>({"x-goog-api-key":vu({apiKey:t.apiKey,environmentVariableName:"GOOGLE_GENERATIVE_AI_API_KEY",description:"Google Generative AI"}),...t.headers}),o=(l,c={})=>{var d;return new vg(l,c,{provider:"google.generative-ai",baseURL:r,headers:s,generateId:(d=t.generateId)!=null?d:wo,fetch:t.fetch})},i=(l,c={})=>new xg(l,c,{provider:"google.generative-ai",baseURL:r,headers:s,fetch:t.fetch}),a=function(l,c){if(new.target)throw new Error("The Google Generative AI model function cannot be called with the new keyword.");return o(l,c)};return a.languageModel=o,a.chat=o,a.generativeAI=o,a.embedding=i,a.textEmbedding=i,a.textEmbeddingModel=i,a}xu();class kg extends ye{name="Google";getApiKeyLink="https://aistudio.google.com/app/apikey";config={apiTokenKey:"GOOGLE_GENERATIVE_AI_API_KEY"};staticModels=[{name:"gemini-1.5-pro",label:"Gemini 1.5 Pro",provider:"Google",maxTokenAllowed:2e6,maxCompletionTokens:8192},{name:"gemini-1.5-flash",label:"Gemini 1.5 Flash",provider:"Google",maxTokenAllowed:1e6,maxCompletionTokens:8192}];async getDynamicModels(e,n,r){const{apiKey:s}=this.getProviderBaseUrlAndKey({apiKeys:e,providerSettings:n,serverEnv:r,defaultBaseUrlKey:"",defaultApiTokenKey:"GOOGLE_GENERATIVE_AI_API_KEY"});if(!s)throw`Missing Api Key configuration for ${this.name} provider`;const o=await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${s}`,{headers:{"Content-Type":"application/json"}});if(!o.ok)throw new Error(`Failed to fetch models from Google API: ${o.status} ${o.statusText}`);const i=await o.json();if(!i.models||!Array.isArray(i.models))throw new Error("Invalid response format from Google API");return i.models.filter(l=>{const c=(l.outputTokenLimit||0)>8e3,d=!l.name.includes("exp")||l.name.includes("flash-exp");return c&&d}).map(l=>{const c=l.name.replace("models/","");let d=32e3;l.inputTokenLimit&&l.outputTokenLimit?d=l.inputTokenLimit:c.includes("gemini-1.5-pro")?d=2e6:c.includes("gemini-1.5-flash")||c.includes("gemini-2.0-flash")?d=1e6:(c.includes("gemini-pro")||c.includes("gemini-flash"))&&(d=32e3);const p=Math.min(d,2e6);let g=8192;return l.outputTokenLimit&&l.outputTokenLimit>0&&(g=Math.min(l.outputTokenLimit,128e3)),{name:c,label:`${l.displayName} (${p>=1e6?Math.floor(p/1e6)+"M":Math.floor(p/1e3)+"k"} context)`,provider:this.name,maxTokenAllowed:p,maxCompletionTokens:g}})}getModelInstance(e){const{model:n,serverEnv:r,apiKeys:s,providerSettings:o}=e,{apiKey:i}=this.getProviderBaseUrlAndKey({apiKeys:s,providerSettings:o?.[this.name],serverEnv:r,defaultBaseUrlKey:"",defaultApiTokenKey:"GOOGLE_GENERATIVE_AI_API_KEY"});if(!i)throw new Error(`Missing API key for ${this.name} provider`);return xu({apiKey:i})(n)}}class Sg extends ye{name="Groq";getApiKeyLink="https://console.groq.com/keys";config={apiTokenKey:"GROQ_API_KEY"};staticModels=[{name:"llama-3.1-8b-instant",label:"Llama 3.1 8B",provider:"Groq",maxTokenAllowed:128e3,maxCompletionTokens:8192},{name:"llama-3.3-70b-versatile",label:"Llama 3.3 70B",provider:"Groq",maxTokenAllowed:128e3,maxCompletionTokens:8192}];async getDynamicModels(e,n,r){const{apiKey:s}=this.getProviderBaseUrlAndKey({apiKeys:e,providerSettings:n,serverEnv:r,defaultBaseUrlKey:"",defaultApiTokenKey:"GROQ_API_KEY"});if(!s)throw`Missing Api Key configuration for ${this.name} provider`;return(await(await fetch("https://api.groq.com/openai/v1/models",{headers:{Authorization:`Bearer ${s}`}})).json()).data.filter(l=>l.object==="model"&&l.active&&l.context_window>8e3).map(l=>({name:l.id,label:`${l.id} - context ${l.context_window?Math.floor(l.context_window/1e3)+"k":"N/A"} [ by ${l.owned_by}]`,provider:this.name,maxTokenAllowed:Math.min(l.context_window||8192,16384),maxCompletionTokens:8192}))}getModelInstance(e){const{model:n,serverEnv:r,apiKeys:s,providerSettings:o}=e,{apiKey:i}=this.getProviderBaseUrlAndKey({apiKeys:s,providerSettings:o?.[this.name],serverEnv:r,defaultBaseUrlKey:"",defaultApiTokenKey:"GROQ_API_KEY"});if(!i)throw new Error(`Missing API key for ${this.name} provider`);return Ve({baseURL:"https://api.groq.com/openai/v1",apiKey:i})(n)}}class Ag extends ye{name="HuggingFace";getApiKeyLink="https://huggingface.co/settings/tokens";config={apiTokenKey:"HuggingFace_API_KEY"};staticModels=[{name:"Qwen/Qwen2.5-Coder-32B-Instruct",label:"Qwen2.5-Coder-32B-Instruct (HuggingFace)",provider:"HuggingFace",maxTokenAllowed:8e3},{name:"01-ai/Yi-1.5-34B-Chat",label:"Yi-1.5-34B-Chat (HuggingFace)",provider:"HuggingFace",maxTokenAllowed:8e3},{name:"codellama/CodeLlama-34b-Instruct-hf",label:"CodeLlama-34b-Instruct (HuggingFace)",provider:"HuggingFace",maxTokenAllowed:8e3},{name:"NousResearch/Hermes-3-Llama-3.1-8B",label:"Hermes-3-Llama-3.1-8B (HuggingFace)",provider:"HuggingFace",maxTokenAllowed:8e3},{name:"Qwen/Qwen2.5-Coder-32B-Instruct",label:"Qwen2.5-Coder-32B-Instruct (HuggingFace)",provider:"HuggingFace",maxTokenAllowed:8e3},{name:"Qwen/Qwen2.5-72B-Instruct",label:"Qwen2.5-72B-Instruct (HuggingFace)",provider:"HuggingFace",maxTokenAllowed:8e3},{name:"meta-llama/Llama-3.1-70B-Instruct",label:"Llama-3.1-70B-Instruct (HuggingFace)",provider:"HuggingFace",maxTokenAllowed:8e3},{name:"meta-llama/Llama-3.1-405B",label:"Llama-3.1-405B (HuggingFace)",provider:"HuggingFace",maxTokenAllowed:8e3},{name:"01-ai/Yi-1.5-34B-Chat",label:"Yi-1.5-34B-Chat (HuggingFace)",provider:"HuggingFace",maxTokenAllowed:8e3},{name:"codellama/CodeLlama-34b-Instruct-hf",label:"CodeLlama-34b-Instruct (HuggingFace)",provider:"HuggingFace",maxTokenAllowed:8e3},{name:"NousResearch/Hermes-3-Llama-3.1-8B",label:"Hermes-3-Llama-3.1-8B (HuggingFace)",provider:"HuggingFace",maxTokenAllowed:8e3}];getModelInstance(e){const{model:n,serverEnv:r,apiKeys:s,providerSettings:o}=e,{apiKey:i}=this.getProviderBaseUrlAndKey({apiKeys:s,providerSettings:o?.[this.name],serverEnv:r,defaultBaseUrlKey:"",defaultApiTokenKey:"HuggingFace_API_KEY"});if(!i)throw new Error(`Missing API key for ${this.name} provider`);return Ve({baseURL:"https://api-inference.huggingface.co/v1/",apiKey:i})(n)}}class Cg extends ye{name="LMStudio";getApiKeyLink="https://lmstudio.ai/";labelForGetApiKey="Get LMStudio";icon="i-ph:cloud-arrow-down";config={baseUrlKey:"LMSTUDIO_API_BASE_URL",baseUrl:"http://localhost:1234/"};staticModels=[];async getDynamicModels(e,n,r={}){let{baseUrl:s}=this.getProviderBaseUrlAndKey({apiKeys:e,providerSettings:n,serverEnv:r,defaultBaseUrlKey:"LMSTUDIO_API_BASE_URL",defaultApiTokenKey:""});if(!s)throw new Error("No baseUrl found for LMStudio provider");if(typeof window>"u"){const a=Pe?.env?.RUNNING_IN_DOCKER==="true"||r?.RUNNING_IN_DOCKER==="true";s=a?s.replace("localhost","host.docker.internal"):s,s=a?s.replace("127.0.0.1","host.docker.internal"):s}return(await(await fetch(`${s}/v1/models`)).json()).data.map(a=>({name:a.id,label:a.id,provider:this.name,maxTokenAllowed:8e3}))}getModelInstance=e=>{const{apiKeys:n,providerSettings:r,serverEnv:s,model:o}=e;let{baseUrl:i}=this.getProviderBaseUrlAndKey({apiKeys:n,providerSettings:r?.[this.name],serverEnv:s,defaultBaseUrlKey:"LMSTUDIO_API_BASE_URL",defaultApiTokenKey:""});if(!i)throw new Error("No baseUrl found for LMStudio provider");const a=Pe?.env?.RUNNING_IN_DOCKER==="true"||s?.RUNNING_IN_DOCKER==="true";return typeof window>"u"&&(i=a?i.replace("localhost","host.docker.internal"):i,i=a?i.replace("127.0.0.1","host.docker.internal"):i),Ya.debug("LMStudio Base Url used: ",i),Ve({baseURL:`${i}/v1`,apiKey:""})(o)}}function Tg(t){const e=[];for(let n=0;n<t.length;n++){const{role:r,content:s}=t[n],o=n===t.length-1;switch(r){case"system":{e.push({role:"system",content:s});break}case"user":{e.push({role:"user",content:s.map(i=>{var a;switch(i.type){case"text":return{type:"text",text:i.text};case"image":return{type:"image_url",image_url:i.image instanceof URL?i.image.toString():`data:${(a=i.mimeType)!=null?a:"image/jpeg"};base64,${xo(i.image)}`};case"file":throw new fn({functionality:"File content parts in user messages"})}})});break}case"assistant":{let i="";const a=[];for(const l of s)switch(l.type){case"text":{i+=l.text;break}case"tool-call":{a.push({id:l.toolCallId,type:"function",function:{name:l.toolName,arguments:JSON.stringify(l.args)}});break}default:{const c=l;throw new Error(`Unsupported part: ${c}`)}}e.push({role:"assistant",content:i,prefix:o?!0:void 0,tool_calls:a.length>0?a:void 0});break}case"tool":{for(const i of s)e.push({role:"tool",name:i.toolName,content:JSON.stringify(i.result),tool_call_id:i.toolCallId});break}default:{const i=r;throw new Error(`Unsupported role: ${i}`)}}}return e}function Pi(t){switch(t){case"stop":return"stop";case"length":case"model_length":return"length";case"tool_calls":return"tool-calls";default:return"unknown"}}var Ig=_({object:K("error"),message:E(),type:E(),param:E().nullable(),code:E().nullable()}),Vs=_o({errorSchema:Ig,errorToMessage:t=>t.message});function Ni({id:t,model:e,created:n}){return{id:t??void 0,modelId:e??void 0,timestamp:n!=null?new Date(n*1e3):void 0}}var Rg=class{constructor(t,e,n){this.specificationVersion="v1",this.defaultObjectGenerationMode="json",this.supportsImageUrls=!1,this.modelId=t,this.settings=e,this.config=n}get provider(){return this.config.provider}getArgs({mode:t,prompt:e,maxTokens:n,temperature:r,topP:s,topK:o,frequencyPenalty:i,presencePenalty:a,stopSequences:l,responseFormat:c,seed:d}){const h=t.type,p=[];o!=null&&p.push({type:"unsupported-setting",setting:"topK"}),i!=null&&p.push({type:"unsupported-setting",setting:"frequencyPenalty"}),a!=null&&p.push({type:"unsupported-setting",setting:"presencePenalty"}),l!=null&&p.push({type:"unsupported-setting",setting:"stopSequences"}),c!=null&&c.type==="json"&&c.schema!=null&&p.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is not supported"});const g={model:this.modelId,safe_prompt:this.settings.safePrompt,max_tokens:n,temperature:r,top_p:s,random_seed:d,response_format:c?.type==="json"?{type:"json_object"}:void 0,messages:Tg(e)};switch(h){case"regular":return{args:{...g,...Bg(t)},warnings:p};case"object-json":return{args:{...g,response_format:{type:"json_object"}},warnings:p};case"object-tool":return{args:{...g,tool_choice:"any",tools:[{type:"function",function:t.tool}]},warnings:p};default:{const v=h;throw new Error(`Unsupported type: ${v}`)}}}async doGenerate(t){var e,n;const{args:r,warnings:s}=this.getArgs(t),{responseHeaders:o,value:i}=await ht({url:`${this.config.baseURL}/chat/completions`,headers:kt(this.config.headers(),t.headers),body:r,failedResponseHandler:Vs,successfulResponseHandler:rn($g),abortSignal:t.abortSignal,fetch:this.config.fetch}),{messages:a,...l}=r,c=i.choices[0];let d=(e=c.message.content)!=null?e:void 0;const h=a[a.length-1];return h.role==="assistant"&&d?.startsWith(h.content)&&(d=d.slice(h.content.length)),{text:d,toolCalls:(n=c.message.tool_calls)==null?void 0:n.map(p=>({toolCallType:"function",toolCallId:p.id,toolName:p.function.name,args:p.function.arguments})),finishReason:Pi(c.finish_reason),usage:{promptTokens:i.usage.prompt_tokens,completionTokens:i.usage.completion_tokens},rawCall:{rawPrompt:a,rawSettings:l},rawResponse:{headers:o},response:Ni(i),warnings:s}}async doStream(t){const{args:e,warnings:n}=this.getArgs(t),{responseHeaders:r,value:s}=await ht({url:`${this.config.baseURL}/chat/completions`,headers:kt(this.config.headers(),t.headers),body:{...e,stream:!0},failedResponseHandler:Vs,successfulResponseHandler:bu(Og),abortSignal:t.abortSignal,fetch:this.config.fetch}),{messages:o,...i}=e;let a="unknown",l={promptTokens:Number.NaN,completionTokens:Number.NaN},c=0,d=!1;return{stream:s.pipeThrough(new TransformStream({transform(h,p){if(!h.success){p.enqueue({type:"error",error:h.error});return}c++;const g=h.value;c===1&&p.enqueue({type:"response-metadata",...Ni(g)}),g.usage!=null&&(l={promptTokens:g.usage.prompt_tokens,completionTokens:g.usage.completion_tokens});const v=g.choices[0];if(v?.finish_reason!=null&&(a=Pi(v.finish_reason)),v?.delta==null)return;const b=v.delta;if(c<=2){const w=o[o.length-1];if(w.role==="assistant"&&b.content===w.content.trimEnd()){b.content.length<w.content.length&&(d=!0);return}}if(b.content!=null&&(p.enqueue({type:"text-delta",textDelta:d?b.content.trimStart():b.content}),d=!1),b.tool_calls!=null)for(const w of b.tool_calls)p.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:w.id,toolName:w.function.name,argsTextDelta:w.function.arguments}),p.enqueue({type:"tool-call",toolCallType:"function",toolCallId:w.id,toolName:w.function.name,args:w.function.arguments})},flush(h){h.enqueue({type:"finish",finishReason:a,usage:l})}})),rawCall:{rawPrompt:o,rawSettings:i},rawResponse:{headers:r},warnings:n}}},$g=_({id:E().nullish(),created:T().nullish(),model:E().nullish(),choices:D(_({message:_({role:K("assistant"),content:E().nullable(),tool_calls:D(_({id:E(),function:_({name:E(),arguments:E()})})).nullish()}),index:T(),finish_reason:E().nullish()})),object:K("chat.completion"),usage:_({prompt_tokens:T(),completion_tokens:T()})}),Og=_({id:E().nullish(),created:T().nullish(),model:E().nullish(),choices:D(_({delta:_({role:Br(["assistant"]).optional(),content:E().nullish(),tool_calls:D(_({id:E(),function:_({name:E(),arguments:E()})})).nullish()}),finish_reason:E().nullish(),index:T()})),usage:_({prompt_tokens:T(),completion_tokens:T()}).nullish()});function Bg(t){var e;const n=(e=t.tools)!=null&&e.length?t.tools:void 0;if(n==null)return{tools:void 0,tool_choice:void 0};const r=n.map(i=>({type:"function",function:{name:i.name,description:i.description,parameters:i.parameters}})),s=t.toolChoice;if(s==null)return{tools:r,tool_choice:void 0};const o=s.type;switch(o){case"auto":case"none":return{tools:r,tool_choice:o};case"required":return{tools:r,tool_choice:"any"};case"tool":return{tools:r.filter(i=>i.function.name===s.toolName),tool_choice:"any"};default:{const i=o;throw new Error(`Unsupported tool choice type: ${i}`)}}}var Pg=class{constructor(t,e,n){this.specificationVersion="v1",this.modelId=t,this.settings=e,this.config=n}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){var t;return(t=this.settings.maxEmbeddingsPerCall)!=null?t:32}get supportsParallelCalls(){var t;return(t=this.settings.supportsParallelCalls)!=null?t:!1}async doEmbed({values:t,abortSignal:e,headers:n}){if(t.length>this.maxEmbeddingsPerCall)throw new vo({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:t});const{responseHeaders:r,value:s}=await ht({url:`${this.config.baseURL}/embeddings`,headers:kt(this.config.headers(),n),body:{model:this.modelId,input:t,encoding_format:"float"},failedResponseHandler:Vs,successfulResponseHandler:rn(Ng),abortSignal:e,fetch:this.config.fetch});return{embeddings:s.data.map(o=>o.embedding),usage:s.usage?{tokens:s.usage.prompt_tokens}:void 0,rawResponse:{headers:r}}}},Ng=_({data:D(_({embedding:D(T())})),usage:_({prompt_tokens:T()}).nullish()});function Eu(t={}){var e,n;const r=(n=Eo((e=t.baseURL)!=null?e:t.baseUrl))!=null?n:"https://api.mistral.ai/v1",s=()=>({Authorization:`Bearer ${vu({apiKey:t.apiKey,environmentVariableName:"MISTRAL_API_KEY",description:"Mistral"})}`,...t.headers}),o=(l,c={})=>new Rg(l,c,{provider:"mistral.chat",baseURL:r,headers:s,fetch:t.fetch}),i=(l,c={})=>new Pg(l,c,{provider:"mistral.embedding",baseURL:r,headers:s,fetch:t.fetch}),a=function(l,c){if(new.target)throw new Error("The Mistral model function cannot be called with the new keyword.");return o(l,c)};return a.languageModel=o,a.chat=o,a.embedding=i,a.textEmbedding=i,a.textEmbeddingModel=i,a}Eu();class Mg extends ye{name="Mistral";getApiKeyLink="https://console.mistral.ai/api-keys/";config={apiTokenKey:"MISTRAL_API_KEY"};staticModels=[{name:"open-mistral-7b",label:"Mistral 7B",provider:"Mistral",maxTokenAllowed:8e3,maxCompletionTokens:8192},{name:"open-mixtral-8x7b",label:"Mistral 8x7B",provider:"Mistral",maxTokenAllowed:8e3,maxCompletionTokens:8192},{name:"open-mixtral-8x22b",label:"Mistral 8x22B",provider:"Mistral",maxTokenAllowed:8e3,maxCompletionTokens:8192},{name:"open-codestral-mamba",label:"Codestral Mamba",provider:"Mistral",maxTokenAllowed:8e3,maxCompletionTokens:8192},{name:"open-mistral-nemo",label:"Mistral Nemo",provider:"Mistral",maxTokenAllowed:8e3,maxCompletionTokens:8192},{name:"ministral-8b-latest",label:"Mistral 8B",provider:"Mistral",maxTokenAllowed:8e3,maxCompletionTokens:8192},{name:"mistral-small-latest",label:"Mistral Small",provider:"Mistral",maxTokenAllowed:8e3,maxCompletionTokens:8192},{name:"codestral-latest",label:"Codestral",provider:"Mistral",maxTokenAllowed:8e3,maxCompletionTokens:8192},{name:"mistral-large-latest",label:"Mistral Large Latest",provider:"Mistral",maxTokenAllowed:8e3,maxCompletionTokens:8192}];getModelInstance(e){const{model:n,serverEnv:r,apiKeys:s,providerSettings:o}=e,{apiKey:i}=this.getProviderBaseUrlAndKey({apiKeys:s,providerSettings:o?.[this.name],serverEnv:r,defaultBaseUrlKey:"",defaultApiTokenKey:"MISTRAL_API_KEY"});if(!i)throw new Error(`Missing API key for ${this.name} provider`);return Eu({apiKey:i})(n)}}var ku={},qs={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Allow=t.ALL=t.COLLECTION=t.ATOM=t.SPECIAL=t.INF=t._INFINITY=t.INFINITY=t.NAN=t.BOOL=t.NULL=t.OBJ=t.ARR=t.NUM=t.STR=void 0,t.STR=1,t.NUM=2,t.ARR=4,t.OBJ=8,t.NULL=16,t.BOOL=32,t.NAN=64,t.INFINITY=128,t._INFINITY=256,t.INF=t.INFINITY|t._INFINITY,t.SPECIAL=t.NULL|t.BOOL|t.INF|t.NAN,t.ATOM=t.STR|t.NUM|t.SPECIAL,t.COLLECTION=t.ARR|t.OBJ,t.ALL=t.ATOM|t.COLLECTION,t.Allow={STR:t.STR,NUM:t.NUM,ARR:t.ARR,OBJ:t.OBJ,NULL:t.NULL,BOOL:t.BOOL,NAN:t.NAN,INFINITY:t.INFINITY,_INFINITY:t._INFINITY,INF:t.INF,SPECIAL:t.SPECIAL,ATOM:t.ATOM,COLLECTION:t.COLLECTION,ALL:t.ALL},t.default=t.Allow})(qs);(function(t){var e=Pn&&Pn.__createBinding||(Object.create?function(c,d,h,p){p===void 0&&(p=h);var g=Object.getOwnPropertyDescriptor(d,h);(!g||("get"in g?!d.__esModule:g.writable||g.configurable))&&(g={enumerable:!0,get:function(){return d[h]}}),Object.defineProperty(c,p,g)}:function(c,d,h,p){p===void 0&&(p=h),c[p]=d[h]}),n=Pn&&Pn.__exportStar||function(c,d){for(var h in c)h!=="default"&&!Object.prototype.hasOwnProperty.call(d,h)&&e(d,c,h)};Object.defineProperty(t,"__esModule",{value:!0}),t.Allow=t.MalformedJSON=t.PartialJSON=t.parseJSON=t.parse=void 0;const r=qs;Object.defineProperty(t,"Allow",{enumerable:!0,get:function(){return r.Allow}}),n(qs,t);class s extends Error{}t.PartialJSON=s;class o extends Error{}t.MalformedJSON=o;function i(c,d=r.Allow.ALL){if(typeof c!="string")throw new TypeError(`expecting str, got ${typeof c}`);if(!c.trim())throw new Error(`${c} is empty`);return a(c.trim(),d)}t.parseJSON=i;const a=(c,d)=>{const h=c.length;let p=0;const g=$=>{throw new s(`${$} at position ${p}`)},v=$=>{throw new o(`${$} at position ${p}`)},b=()=>(B(),p>=h&&g("Unexpected end of input"),c[p]==='"'?w():c[p]==="{"?S():c[p]==="["?A():c.substring(p,p+4)==="null"||r.Allow.NULL&d&&h-p<4&&"null".startsWith(c.substring(p))?(p+=4,null):c.substring(p,p+4)==="true"||r.Allow.BOOL&d&&h-p<4&&"true".startsWith(c.substring(p))?(p+=4,!0):c.substring(p,p+5)==="false"||r.Allow.BOOL&d&&h-p<5&&"false".startsWith(c.substring(p))?(p+=5,!1):c.substring(p,p+8)==="Infinity"||r.Allow.INFINITY&d&&h-p<8&&"Infinity".startsWith(c.substring(p))?(p+=8,1/0):c.substring(p,p+9)==="-Infinity"||r.Allow._INFINITY&d&&1<h-p&&h-p<9&&"-Infinity".startsWith(c.substring(p))?(p+=9,-1/0):c.substring(p,p+3)==="NaN"||r.Allow.NAN&d&&h-p<3&&"NaN".startsWith(c.substring(p))?(p+=3,NaN):O()),w=()=>{const $=p;let F=!1;for(p++;p<h&&(c[p]!=='"'||F&&c[p-1]==="\\");)F=c[p]==="\\"?!F:!1,p++;if(c.charAt(p)=='"')try{return JSON.parse(c.substring($,++p-Number(F)))}catch(N){v(String(N))}else if(r.Allow.STR&d)try{return JSON.parse(c.substring($,p-Number(F))+'"')}catch{return JSON.parse(c.substring($,c.lastIndexOf("\\"))+'"')}g("Unterminated string literal")},S=()=>{p++,B();const $={};try{for(;c[p]!=="}";){if(B(),p>=h&&r.Allow.OBJ&d)return $;const F=w();B(),p++;try{const N=b();$[F]=N}catch(N){if(r.Allow.OBJ&d)return $;throw N}B(),c[p]===","&&p++}}catch{if(r.Allow.OBJ&d)return $;g("Expected '}' at end of object")}return p++,$},A=()=>{p++;const $=[];try{for(;c[p]!=="]";)$.push(b()),B(),c[p]===","&&p++}catch{if(r.Allow.ARR&d)return $;g("Expected ']' at end of array")}return p++,$},O=()=>{if(p===0){c==="-"&&v("Not sure what '-' is");try{return JSON.parse(c)}catch(F){if(r.Allow.NUM&d)try{return JSON.parse(c.substring(0,c.lastIndexOf("e")))}catch{}v(String(F))}}const $=p;for(c[p]==="-"&&p++;c[p]&&",]}".indexOf(c[p])===-1;)p++;p==h&&!(r.Allow.NUM&d)&&g("Unterminated number literal");try{return JSON.parse(c.substring($,p))}catch{c.substring($,p)==="-"&&g("Not sure what '-' is");try{return JSON.parse(c.substring($,c.lastIndexOf("e")))}catch(N){v(String(N))}}},B=()=>{for(;p<h&&` 
\r	`.includes(c[p]);)p++};return b()},l=i;t.parse=l})(ku);function Qr(t){const e=[];for(const{content:n,role:r}of t)switch(r){case"system":{e.push({content:n,role:"system"});break}case"user":{e.push({...n.reduce((s,o)=>{if(o.type==="text")s.content+=o.text;else{if(o.type==="image"&&o.image instanceof URL)throw new fn({functionality:"Image URLs in user messages"});o.type==="image"&&o.image instanceof Uint8Array&&(s.images=s.images||[],s.images.push(xo(o.image)))}return s},{content:""}),role:"user"});break}case"assistant":{const s=[],o=[];for(const i of n)switch(i.type){case"text":{s.push(i.text);break}case"tool-call":{o.push({function:{arguments:i.args,name:i.toolName},id:i.toolCallId,type:"function"});break}default:{const a=i;throw new Error(`Unsupported part: ${a}`)}}e.push({content:s.join(","),role:"assistant",tool_calls:o.length>0?o:void 0});break}case"tool":{e.push(...n.map(s=>({content:typeof s.result=="object"?JSON.stringify(s.result):`${s.result}`,role:"tool",tool_call_id:s.toolCallId})));break}default:{const s=r;throw new Error(`Unsupported role: ${s}`)}}return e}var Dg=class{constructor({tools:t,type:e}){this._firstMessage=!0,this._tools=t,this._toolPartial="",this._toolCalls=[],this._type=e,this._detectedToolCall=!1}get toolCalls(){return this._toolCalls}get detectedToolCall(){return this._detectedToolCall}parse({controller:t,delta:e}){var n;if(this.detectToolCall(e),!this._detectedToolCall)return!1;this._toolPartial+=e;let r=ku.parse(this._toolPartial);Array.isArray(r)||(r=[r]);for(const[s,o]of r.entries()){const i=(n=JSON.stringify(o?.parameters))!=null?n:"";if(i==="")continue;this._toolCalls[s]||(this._toolCalls[s]={function:{arguments:"",name:o.name},id:wo(),type:"function"});const a=this._toolCalls[s];a.function.arguments=i,t.enqueue({argsTextDelta:e,toolCallId:a.id,toolCallType:"function",toolName:a.function.name,type:"tool-call-delta"})}return!0}finish({controller:t}){for(const e of this.toolCalls)t.enqueue({args:e.function.arguments,toolCallId:e.id,toolCallType:"function",toolName:e.function.name,type:"tool-call"});return this.finishReason()}detectToolCall(t){!this._tools||this._tools.length===0||this._firstMessage&&(this._type==="object-tool"?this._detectedToolCall=!0:this._type==="regular"&&(t.trim().startsWith("{")||t.trim().startsWith("["))&&(this._detectedToolCall=!0),this._firstMessage=!1)}finishReason(){return this.detectedToolCall?this._type==="object-tool"?"stop":"tool-calls":"stop"}};function Ug({finishReason:t,hasToolCalls:e}){switch(t){case"stop":return e?"tool-calls":"stop";default:return"other"}}var Lg=_({error:_({code:E().nullable(),message:E(),param:In().nullable(),type:E()})}),Gs=_o({errorSchema:Lg,errorToMessage:t=>t.error.message});function Fg(t){return Object.fromEntries(Object.entries(t).filter(([,e])=>e!==void 0))}var jg=class extends TransformStream{constructor(){super({flush:t=>{this.buffer.length!==0&&t.enqueue(this.buffer)},transform:(t,e)=>{for(t=this.buffer+t;;){const n=t.indexOf(`
`);if(n===-1)break;e.enqueue(t.slice(0,n)),t=t.slice(n+1)}this.buffer=t}}),this.buffer=""}},Hg=t=>async({response:e})=>{const n=$n(e);if(e.body===null)throw new iu({});return{responseHeaders:n,value:e.body.pipeThrough(new TextDecoderStream).pipeThrough(new jg).pipeThrough(new TransformStream({transform(r,s){s.enqueue(bo({schema:t,text:r}))}}))}},Kg=class{constructor(t,e,n){this.modelId=t,this.settings=e,this.config=n,this.specificationVersion="v1",this.defaultObjectGenerationMode="json",this.supportsImageUrls=!1}get provider(){return this.config.provider}getArguments({frequencyPenalty:t,maxTokens:e,mode:n,presencePenalty:r,prompt:s,responseFormat:o,seed:i,stopSequences:a,temperature:l,topK:c,topP:d}){var h,p,g;const v=n.type,b=[];o!==void 0&&o.type==="json"&&o.schema!==void 0&&b.push({details:"JSON response format schema is not supported",setting:"responseFormat",type:"unsupported-setting"});const w={format:o?.type,model:this.modelId,options:Fg({f16_kv:this.settings.f16Kv,frequency_penalty:t,low_vram:this.settings.lowVram,main_gpu:this.settings.mainGpu,min_p:this.settings.minP,mirostat:this.settings.mirostat,mirostat_eta:this.settings.mirostatEta,mirostat_tau:this.settings.mirostatTau,num_batch:this.settings.numBatch,num_ctx:this.settings.numCtx,num_gpu:this.settings.numGpu,num_keep:this.settings.numKeep,num_predict:e,num_thread:this.settings.numThread,numa:this.settings.numa,penalize_newline:this.settings.penalizeNewline,presence_penalty:r,repeat_last_n:this.settings.repeatLastN,repeat_penalty:this.settings.repeatPenalty,seed:i,stop:(h=this.settings.stop)!=null?h:a,temperature:l,tfs_z:this.settings.tfsZ,top_k:(p=this.settings.topK)!=null?p:c,top_p:d,typical_p:this.settings.typicalP,use_mlock:this.settings.useMlock,use_mmap:this.settings.useMmap,vocab_only:this.settings.vocabOnly})};switch(v){case"regular":{const S=(g=n.tools)!=null&&g.length?n.tools:void 0;return{args:{...w,messages:Qr(s),tools:S?.map(A=>({function:{description:A.description,name:A.name,parameters:A.parameters},type:"function"}))},type:v,warnings:b}}case"object-json":return{args:{...w,format:"json",messages:Qr(s)},type:v,warnings:b};case"object-tool":return{args:{...w,messages:Qr(s),tool_choice:{function:{name:n.tool.name},type:"function"},tools:[{function:{description:n.tool.description,name:n.tool.name,parameters:n.tool.parameters},type:"function"}]},type:v,warnings:b};default:{const S=v;throw new Error(`Unsupported type: ${S}`)}}}async doGenerate(t){var e,n;const{args:r,warnings:s}=this.getArguments(t),{responseHeaders:o,value:i}=await ht({abortSignal:t.abortSignal,body:{...r,stream:!1},failedResponseHandler:Gs,fetch:this.config.fetch,headers:kt(this.config.headers(),t.headers),successfulResponseHandler:rn(Vg),url:`${this.config.baseURL}/chat`}),{messages:a,...l}=r,c=(e=i.message.tool_calls)==null?void 0:e.map(d=>{var h;return{args:JSON.stringify(d.function.arguments),toolCallId:(h=d.id)!=null?h:wo(),toolCallType:"function",toolName:d.function.name}});return{finishReason:Ug({finishReason:i.done_reason,hasToolCalls:c!==void 0&&c.length>0}),rawCall:{rawPrompt:a,rawSettings:l},rawResponse:{headers:o},text:(n=i.message.content)!=null?n:void 0,toolCalls:c,usage:{completionTokens:i.eval_count||0,promptTokens:i.prompt_eval_count||0},warnings:s}}async doStream(t){const{args:e,type:n,warnings:r}=this.getArguments(t),{responseHeaders:s,value:o}=await ht({abortSignal:t.abortSignal,body:e,failedResponseHandler:Gs,fetch:this.config.fetch,headers:kt(this.config.headers(),t.headers),successfulResponseHandler:Hg(qg),url:`${this.config.baseURL}/chat`}),{messages:i,...a}=e,l=t.mode.type==="regular"?t.mode.tools:t.mode.type==="object-tool"?[t.mode.tool]:void 0,c=new Dg({tools:l,type:n});let d="other",h={completionTokens:Number.NaN,promptTokens:Number.NaN};const{experimentalStreamTools:p=!0}=this.settings;return{rawCall:{rawPrompt:i,rawSettings:a},rawResponse:{headers:s},stream:o.pipeThrough(new TransformStream({async flush(g){g.enqueue({finishReason:d,type:"finish",usage:h})},async transform(g,v){if(!g.success){v.enqueue({error:g.error,type:"error"});return}const b=g.value;if(b.done){d=c.finish({controller:v}),h={completionTokens:b.eval_count,promptTokens:b.prompt_eval_count||0};return}p&&c.parse({controller:v,delta:b.message.content})||b.message.content!==null&&v.enqueue({textDelta:b.message.content,type:"text-delta"})}})),warnings:r}}},Vg=_({created_at:E(),done:K(!0),done_reason:E().optional().nullable(),eval_count:T(),eval_duration:T(),load_duration:T().optional(),message:_({content:E(),role:E(),tool_calls:D(_({function:_({arguments:Rn(In()),name:E()}),id:E().optional()})).optional().nullable()}),model:E(),prompt_eval_count:T().optional(),prompt_eval_duration:T().optional(),total_duration:T()}),qg=Gt("done",[_({created_at:E(),done:K(!1),message:_({content:E(),role:E()}),model:E()}),_({created_at:E(),done:K(!0),eval_count:T(),eval_duration:T(),load_duration:T().optional(),model:E(),prompt_eval_count:T().optional(),prompt_eval_duration:T().optional(),total_duration:T()})]),Gg=class{constructor(t,e,n){this.specificationVersion="v1",this.modelId=t,this.settings=e,this.config=n}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){var t;return(t=this.settings.maxEmbeddingsPerCall)!=null?t:2048}get supportsParallelCalls(){return!1}async doEmbed({abortSignal:t,values:e}){if(e.length>this.maxEmbeddingsPerCall)throw new vo({maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,modelId:this.modelId,provider:this.provider,values:e});const{responseHeaders:n,value:r}=await ht({abortSignal:t,body:{input:e,model:this.modelId},failedResponseHandler:Gs,fetch:this.config.fetch,headers:this.config.headers(),successfulResponseHandler:rn(zg),url:`${this.config.baseURL}/embed`});return{embeddings:r.embeddings,rawResponse:{headers:n},usage:r.prompt_eval_count?{tokens:r.prompt_eval_count}:void 0}}},zg=_({embeddings:D(D(T())),prompt_eval_count:T().nullable()});function Jg(t={}){var e;const n=(e=Eo(t.baseURL))!=null?e:"http://127.0.0.1:11434/api",r=()=>({...t.headers}),s=(a,l={})=>new Kg(a,l,{baseURL:n,fetch:t.fetch,headers:r,provider:"ollama.chat"}),o=(a,l={})=>new Gg(a,l,{baseURL:n,fetch:t.fetch,headers:r,provider:"ollama.embedding"}),i=function(a,l){if(new.target)throw new Error("The Ollama model function cannot be called with the new keyword.");return s(a,l)};return i.chat=s,i.embedding=o,i.languageModel=s,i.textEmbedding=o,i.textEmbeddingModel=o,i}var Wg=Jg();class Zg extends ye{name="Ollama";getApiKeyLink="https://ollama.com/download";labelForGetApiKey="Download Ollama";icon="i-ph:cloud-arrow-down";config={baseUrlKey:"OLLAMA_API_BASE_URL"};staticModels=[];_convertEnvToRecord(e){return e?Object.entries(e).reduce((n,[r,s])=>(n[r]=String(s),n),{}):{}}getDefaultNumCtx(e){const n=this._convertEnvToRecord(e);return n.DEFAULT_NUM_CTX?parseInt(n.DEFAULT_NUM_CTX,10):32768}async getDynamicModels(e,n,r={}){let{baseUrl:s}=this.getProviderBaseUrlAndKey({apiKeys:e,providerSettings:n,serverEnv:r,defaultBaseUrlKey:"OLLAMA_API_BASE_URL",defaultApiTokenKey:""});if(!s)throw new Error("No baseUrl found for OLLAMA provider");if(typeof window>"u"){const a=Pe?.env?.RUNNING_IN_DOCKER==="true"||r?.RUNNING_IN_DOCKER==="true";s=a?s.replace("localhost","host.docker.internal"):s,s=a?s.replace("127.0.0.1","host.docker.internal"):s}return(await(await fetch(`${s}/api/tags`)).json()).models.map(a=>({name:a.name,label:`${a.name} (${a.details.parameter_size})`,provider:this.name,maxTokenAllowed:8e3}))}getModelInstance=e=>{const{apiKeys:n,providerSettings:r,serverEnv:s,model:o}=e,i=this._convertEnvToRecord(s);let{baseUrl:a}=this.getProviderBaseUrlAndKey({apiKeys:n,providerSettings:r?.[this.name],serverEnv:i,defaultBaseUrlKey:"OLLAMA_API_BASE_URL",defaultApiTokenKey:""});if(!a)throw new Error("No baseUrl found for OLLAMA provider");const l=Pe?.env?.RUNNING_IN_DOCKER==="true"||i.RUNNING_IN_DOCKER==="true";a=l?a.replace("localhost","host.docker.internal"):a,a=l?a.replace("127.0.0.1","host.docker.internal"):a,Ya.debug("Ollama Base Url used: ",a);const c=Wg(o,{numCtx:this.getDefaultNumCtx(s)});return c.config.baseURL=`${a}/api`,c}}var ct=class extends Error{constructor({message:t,url:e,requestBodyValues:n,statusCode:r,responseHeaders:s,responseBody:o,cause:i,isRetryable:a=r!=null&&(r===408||r===409||r===429||r>=500),data:l}){super(t),this.name="AI_APICallError",this.url=e,this.requestBodyValues=n,this.statusCode=r,this.responseHeaders=s,this.responseBody=o,this.cause=i,this.isRetryable=a,this.data=l}static isAPICallError(t){return t instanceof Error&&t.name==="AI_APICallError"&&typeof t.url=="string"&&typeof t.requestBodyValues=="object"&&(t.statusCode==null||typeof t.statusCode=="number")&&(t.responseHeaders==null||typeof t.responseHeaders=="object")&&(t.responseBody==null||typeof t.responseBody=="string")&&(t.cause==null||typeof t.cause=="object")&&typeof t.isRetryable=="boolean"&&(t.data==null||typeof t.data=="object")}toJSON(){return{name:this.name,message:this.message,url:this.url,requestBodyValues:this.requestBodyValues,statusCode:this.statusCode,responseHeaders:this.responseHeaders,responseBody:this.responseBody,cause:this.cause,isRetryable:this.isRetryable,data:this.data}}},Yg=class extends Error{constructor({message:t="Empty response body"}={}){super(t),this.name="AI_EmptyResponseBodyError"}static isEmptyResponseBodyError(t){return t instanceof Error&&t.name==="AI_EmptyResponseBodyError"}toJSON(){return{name:this.name,message:this.message,stack:this.stack}}},Qg=class extends Error{constructor({prompt:t,message:e}){super(`Invalid prompt: ${e}`),this.name="AI_InvalidPromptError",this.prompt=t}static isInvalidPromptError(t){return t instanceof Error&&t.name==="AI_InvalidPromptError"&&prompt!=null}toJSON(){return{name:this.name,message:this.message,stack:this.stack,prompt:this.prompt}}},Xr=class extends Error{constructor({data:t,message:e=`Invalid response data: ${JSON.stringify(t)}.`}){super(e),this.name="AI_InvalidResponseDataError",this.data=t}static isInvalidResponseDataError(t){return t instanceof Error&&t.name==="AI_InvalidResponseDataError"&&t.data!=null}toJSON(){return{name:this.name,message:this.message,stack:this.stack,data:this.data}}};function Su(t){return t==null?"unknown error":typeof t=="string"?t:t instanceof Error?t.message:JSON.stringify(t)}var yr=class extends Error{constructor({text:t,cause:e}){super(`JSON parsing failed: Text: ${t}.
Error message: ${Su(e)}`),this.name="AI_JSONParseError",this.cause=e,this.text=t}static isJSONParseError(t){return t instanceof Error&&t.name==="AI_JSONParseError"&&typeof t.text=="string"&&typeof t.cause=="string"}toJSON(){return{name:this.name,message:this.message,cause:this.cause,stack:this.stack,valueText:this.text}}},Ln=class extends Error{constructor({message:t}){super(t),this.name="AI_LoadAPIKeyError"}static isLoadAPIKeyError(t){return t instanceof Error&&t.name==="AI_LoadAPIKeyError"}toJSON(){return{name:this.name,message:this.message}}},pn=class extends Error{constructor({value:t,cause:e}){super(`Type validation failed: Value: ${JSON.stringify(t)}.
Error message: ${Su(e)}`),this.name="AI_TypeValidationError",this.cause=e,this.value=t}static isTypeValidationError(t){return t instanceof Error&&t.name==="AI_TypeValidationError"}toJSON(){return{name:this.name,message:this.message,cause:this.cause,stack:this.stack,value:this.value}}},lt=class extends Error{constructor({functionality:e}){super(`'${e}' functionality not supported.`),this.name="AI_UnsupportedFunctionalityError",this.functionality=e}static isUnsupportedFunctionalityError(e){return e instanceof Error&&e.name==="AI_UnsupportedFunctionalityError"&&typeof e.functionality=="string"}toJSON(){return{name:this.name,message:this.message,stack:this.stack,functionality:this.functionality}}},Xg={};function vr(...t){return t.reduce((e,n)=>({...e,...n??{}}),{})}function Mr(t){const e={};return t.headers.forEach((n,r)=>{e[r]=n}),e}var es=Qc("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",7);function ts(t){return t instanceof Error&&(t.name==="AbortError"||t.name==="TimeoutError")}function ey({apiKey:t,environmentVariableName:e,apiKeyParameterName:n="apiKey",description:r}){if(typeof t=="string")return t;if(t!=null)throw new Ln({message:`${r} API key must be a string.`});if(typeof Pe>"u")throw new Ln({message:`${r} API key is missing. Pass it using the '${n}' parameter. Environment variables is not supported in this environment.`});if(t=Xg[e],t==null)throw new Ln({message:`${r} API key is missing. Pass it using the '${n}' parameter or the ${e} environment variable.`});if(typeof t!="string")throw new Ln({message:`${r} API key must be a string. The value of the ${e} environment variable is not a string.`});return t}function ty({value:t,schema:e}){try{return e.parse(t)}catch(n){throw new pn({value:t,cause:n})}}function ny({value:t,schema:e}){try{const n=e.safeParse(t);return n.success?{success:!0,value:n.data}:{success:!1,error:new pn({value:t,cause:n.error})}}catch(n){return{success:!1,error:pn.isTypeValidationError(n)?n:new pn({value:t,cause:n})}}}function ry({text:t,schema:e}){try{const n=je.parse(t);return e==null?n:ty({value:n,schema:e})}catch(n){throw yr.isJSONParseError(n)||pn.isTypeValidationError(n)?n:new yr({text:t,cause:n})}}function Au({text:t,schema:e}){try{const n=je.parse(t);return e==null?{success:!0,value:n}:ny({value:n,schema:e})}catch(n){return{success:!1,error:yr.isJSONParseError(n)?n:new yr({text:t,cause:n})}}}function Mi(t){try{return je.parse(t),!0}catch{return!1}}function sy(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>n!=null))}var oy=()=>fetch,wr=async({url:t,headers:e,body:n,failedResponseHandler:r,successfulResponseHandler:s,abortSignal:o,fetch:i})=>iy({url:t,headers:{"Content-Type":"application/json",...e},body:{content:JSON.stringify(n),values:n},failedResponseHandler:r,successfulResponseHandler:s,abortSignal:o,fetch:i}),iy=async({url:t,headers:e={},body:n,successfulResponseHandler:r,failedResponseHandler:s,abortSignal:o,fetch:i=oy()})=>{try{const a=await i(t,{method:"POST",headers:sy(e),body:n.content,signal:o}),l=Mr(a);if(!a.ok){let c;try{c=await s({response:a,url:t,requestBodyValues:n.values})}catch(d){throw ts(d)||ct.isAPICallError(d)?d:new ct({message:"Failed to process error response",cause:d,statusCode:a.status,url:t,responseHeaders:l,requestBodyValues:n.values})}throw c.value}try{return await r({response:a,url:t,requestBodyValues:n.values})}catch(c){throw c instanceof Error&&(ts(c)||ct.isAPICallError(c))?c:new ct({message:"Failed to process successful response",cause:c,statusCode:a.status,url:t,responseHeaders:l,requestBodyValues:n.values})}}catch(a){if(ts(a))throw a;if(a instanceof TypeError&&a.message==="fetch failed"){const l=a.cause;if(l!=null)throw new ct({message:`Cannot connect to API: ${l.message}`,cause:l,url:t,requestBodyValues:n.values,isRetryable:!0})}throw a}},ay=({errorSchema:t,errorToMessage:e,isRetryable:n})=>async({response:r,url:s,requestBodyValues:o})=>{const i=await r.text(),a=Mr(r);if(i.trim()==="")return{responseHeaders:a,value:new ct({message:r.statusText,url:s,requestBodyValues:o,statusCode:r.status,responseHeaders:a,responseBody:i,isRetryable:n?.(r)})};try{const l=ry({text:i,schema:t});return{responseHeaders:a,value:new ct({message:e(l),url:s,requestBodyValues:o,statusCode:r.status,responseHeaders:a,responseBody:i,data:l,isRetryable:n?.(r,l)})}}catch{return{responseHeaders:a,value:new ct({message:r.statusText,url:s,requestBodyValues:o,statusCode:r.status,responseHeaders:a,responseBody:i,isRetryable:n?.(r)})}}},Cu=t=>async({response:e})=>{const n=Mr(e);if(e.body==null)throw new Yg({});return{responseHeaders:n,value:e.body.pipeThrough(new TextDecoderStream).pipeThrough(new yo).pipeThrough(new TransformStream({transform({data:r},s){r!=="[DONE]"&&s.enqueue(Au({text:r,schema:t}))}}))}},Tu=t=>async({response:e,url:n,requestBodyValues:r})=>{const s=await e.text(),o=Au({text:s,schema:t}),i=Mr(e);if(!o.success)throw new ct({message:"Invalid JSON response",cause:o.error,statusCode:e.status,responseHeaders:i,responseBody:s,url:n,requestBodyValues:r});return{responseHeaders:i,value:o.value}};function cy(t){let e="";for(let n=0;n<t.length;n++)e+=String.fromCodePoint(t[n]);return globalThis.btoa(e)}function ly(t){return t?.replace(/\/$/,"")}var uy=Object.defineProperty,dy=Object.defineProperties,fy=Object.getOwnPropertyDescriptors,br=Object.getOwnPropertySymbols,Iu=Object.prototype.hasOwnProperty,Ru=Object.prototype.propertyIsEnumerable,Di=(t,e,n)=>e in t?uy(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,rt=(t,e)=>{for(var n in e||(e={}))Iu.call(e,n)&&Di(t,n,e[n]);if(br)for(var n of br(e))Ru.call(e,n)&&Di(t,n,e[n]);return t},Vn=(t,e)=>dy(t,fy(e)),_r=(t,e)=>{var n={};for(var r in t)Iu.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&br)for(var r of br(t))e.indexOf(r)<0&&Ru.call(t,r)&&(n[r]=t[r]);return n};function py(t){var e;const n=[];for(const{role:r,content:s}of t)switch(r){case"system":{n.push({role:"system",content:s});break}case"user":{if(s.length===1&&((e=s[0])==null?void 0:e.type)==="text"){n.push({role:"user",content:s[0].text});break}n.push({role:"user",content:s.map(o=>{var i;switch(o.type){case"text":return{type:"text",text:o.text};case"image":return{type:"image_url",image_url:{url:o.image instanceof URL?o.image.toString():`data:${(i=o.mimeType)!=null?i:"image/jpeg"};base64,${cy(o.image)}`}}}})});break}case"assistant":{let o="";const i=[];for(const a of s)switch(a.type){case"text":{o+=a.text;break}case"tool-call":{i.push({id:a.toolCallId,type:"function",function:{name:a.toolName,arguments:JSON.stringify(a.args)}});break}default:{const l=a;throw new Error(`Unsupported part: ${l}`)}}n.push({role:"assistant",content:o,tool_calls:i.length>0?i:void 0});break}case"tool":{for(const o of s)n.push({role:"tool",tool_call_id:o.toolCallId,content:JSON.stringify(o.result)});break}default:{const o=r;throw new Error(`Unsupported role: ${o}`)}}return n}function Ui(t){var e,n;return(n=(e=t?.content)==null?void 0:e.map(({token:r,logprob:s,top_logprobs:o})=>({token:r,logprob:s,topLogprobs:o?o.map(({token:i,logprob:a})=>({token:i,logprob:a})):[]})))!=null?n:void 0}function xr(t){switch(t){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var ko=_({error:_({message:E(),type:E(),param:In().nullable(),code:E().nullable()})}),Er=ay({errorSchema:ko,errorToMessage:t=>t.error.message}),hy=class{constructor(t,e,n){this.specificationVersion="v1",this.defaultObjectGenerationMode="tool",this.modelId=t,this.settings=e,this.config=n}get provider(){return this.config.provider}getArgs({mode:t,prompt:e,maxTokens:n,temperature:r,topP:s,frequencyPenalty:o,presencePenalty:i,seed:a}){const l=t.type,c=rt({model:this.modelId,logit_bias:this.settings.logitBias,logprobs:this.settings.logprobs===!0||typeof this.settings.logprobs=="number"?!0:void 0,top_logprobs:typeof this.settings.logprobs=="number"?this.settings.logprobs:typeof this.settings.logprobs=="boolean"&&this.settings.logprobs?0:void 0,user:this.settings.user,parallel_tool_calls:this.settings.parallelToolCalls,max_tokens:n,temperature:r,top_p:s,frequency_penalty:o,presence_penalty:i,seed:a,messages:py(e)},this.config.extraBody);switch(l){case"regular":return rt(rt({},c),yy(t));case"object-json":return Vn(rt({},c),{response_format:{type:"json_object"}});case"object-tool":return Vn(rt({},c),{tool_choice:{type:"function",function:{name:t.tool.name}},tools:[{type:"function",function:{name:t.tool.name,description:t.tool.description,parameters:t.tool.parameters}}]});case"object-grammar":throw new lt({functionality:"object-grammar mode"});default:{const d=l;throw new Error(`Unsupported type: ${d}`)}}}async doGenerate(t){var e,n;const r=this.getArgs(t),{responseHeaders:s,value:o}=await wr({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:vr(this.config.headers(),t.headers),body:r,failedResponseHandler:Er,successfulResponseHandler:Tu(my),abortSignal:t.abortSignal,fetch:this.config.fetch}),i=r,{messages:a}=i,l=_r(i,["messages"]),c=o.choices[0];if(c==null)throw new Error("No choice in response");return{text:(e=c.message.content)!=null?e:void 0,toolCalls:(n=c.message.tool_calls)==null?void 0:n.map(d=>{var h;return{toolCallType:"function",toolCallId:(h=d.id)!=null?h:es(),toolName:d.function.name,args:d.function.arguments}}),finishReason:xr(c.finish_reason),usage:{promptTokens:o.usage.prompt_tokens,completionTokens:o.usage.completion_tokens},rawCall:{rawPrompt:a,rawSettings:l},rawResponse:{headers:s},warnings:[],logprobs:Ui(c.logprobs)}}async doStream(t){const e=this.getArgs(t),{responseHeaders:n,value:r}=await wr({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:vr(this.config.headers(),t.headers),body:Vn(rt({},e),{stream:!0,stream_options:this.config.compatibility==="strict"?{include_usage:!0}:void 0}),failedResponseHandler:Er,successfulResponseHandler:Cu(gy),abortSignal:t.abortSignal,fetch:this.config.fetch}),s=e,{messages:o}=s,i=_r(s,["messages"]),a=[];let l="other",c={promptTokens:Number.NaN,completionTokens:Number.NaN},d;return{stream:r.pipeThrough(new TransformStream({transform(h,p){var g,v,b,w,S,A,O,B,$,F,N,Z;if(!h.success){l="error",p.enqueue({type:"error",error:h.error});return}const re=h.value;if("error"in re){l="error",p.enqueue({type:"error",error:re.error});return}re.usage!=null&&(c={promptTokens:re.usage.prompt_tokens,completionTokens:re.usage.completion_tokens});const ie=re.choices[0];if(ie?.finish_reason!=null&&(l=xr(ie.finish_reason)),ie?.delta==null)return;const te=ie.delta;te.content!=null&&p.enqueue({type:"text-delta",textDelta:te.content});const ue=Ui(ie?.logprobs);if(ue?.length&&(d===void 0&&(d=[]),d.push(...ue)),te.tool_calls!=null)for(const de of te.tool_calls){const fe=de.index;if(a[fe]==null){if(de.type!=="function")throw new Xr({data:de,message:"Expected 'function' type."});if(de.id==null)throw new Xr({data:de,message:"Expected 'id' to be a string."});if(((g=de.function)==null?void 0:g.name)==null)throw new Xr({data:de,message:"Expected 'function.name' to be a string."});a[fe]={id:de.id,type:"function",function:{name:de.function.name,arguments:(v=de.function.arguments)!=null?v:""}};const se=a[fe];if(se==null)throw new Error("Tool call is missing");((b=se.function)==null?void 0:b.name)!=null&&((w=se.function)==null?void 0:w.arguments)!=null&&Mi(se.function.arguments)&&(p.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:se.id,toolName:se.function.name,argsTextDelta:se.function.arguments}),p.enqueue({type:"tool-call",toolCallType:"function",toolCallId:(S=se.id)!=null?S:es(),toolName:se.function.name,args:se.function.arguments}));continue}const Q=a[fe];if(Q==null)throw new Error("Tool call is missing");((A=de.function)==null?void 0:A.arguments)!=null&&(Q.function.arguments+=(B=(O=de.function)==null?void 0:O.arguments)!=null?B:""),p.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:Q.id,toolName:Q.function.name,argsTextDelta:($=de.function.arguments)!=null?$:""}),((F=Q.function)==null?void 0:F.name)!=null&&((N=Q.function)==null?void 0:N.arguments)!=null&&Mi(Q.function.arguments)&&p.enqueue({type:"tool-call",toolCallType:"function",toolCallId:(Z=Q.id)!=null?Z:es(),toolName:Q.function.name,args:Q.function.arguments})}},flush(h){h.enqueue({type:"finish",finishReason:l,logprobs:d,usage:c})}})),rawCall:{rawPrompt:o,rawSettings:i},rawResponse:{headers:n},warnings:[]}}},my=_({choices:D(_({message:_({role:K("assistant"),content:E().nullable().optional(),tool_calls:D(_({id:E().optional().nullable(),type:K("function"),function:_({name:E(),arguments:E()})})).optional()}),index:T(),logprobs:_({content:D(_({token:E(),logprob:T(),top_logprobs:D(_({token:E(),logprob:T()}))})).nullable()}).nullable().optional(),finish_reason:E().optional().nullable()})),usage:_({prompt_tokens:T(),completion_tokens:T()})}),gy=Tt([_({choices:D(_({delta:_({role:Br(["assistant"]).optional(),content:E().nullish(),tool_calls:D(_({index:T(),id:E().nullish(),type:K("function").optional(),function:_({name:E().nullish(),arguments:E().nullish()})})).nullish()}).nullish(),logprobs:_({content:D(_({token:E(),logprob:T(),top_logprobs:D(_({token:E(),logprob:T()}))})).nullable()}).nullish(),finish_reason:E().nullable().optional(),index:T()})),usage:_({prompt_tokens:T(),completion_tokens:T()}).nullish()}),ko]);function yy(t){var e;const n=(e=t.tools)!=null&&e.length?t.tools:void 0;if(n==null)return{tools:void 0,tool_choice:void 0};const r=n.map(i=>({type:"function",function:{name:i.name,description:i.description,parameters:i.parameters}})),s=t.toolChoice;if(s==null)return{tools:r,tool_choice:void 0};const o=s.type;switch(o){case"auto":case"none":case"required":return{tools:r,tool_choice:o};case"tool":return{tools:r,tool_choice:{type:"function",function:{name:s.toolName}}};default:{const i=o;throw new Error(`Unsupported tool choice type: ${i}`)}}}function vy({prompt:t,inputFormat:e,user:n="user",assistant:r="assistant"}){if(e==="prompt"&&t.length===1&&t[0]&&t[0].role==="user"&&t[0].content.length===1&&t[0].content[0]&&t[0].content[0].type==="text")return{prompt:t[0].content[0].text};let s="";t[0]&&t[0].role==="system"&&(s+=`${t[0].content}

`,t=t.slice(1));for(const{role:o,content:i}of t)switch(o){case"system":throw new Qg({message:"Unexpected system message in prompt: ${content}",prompt:t});case"user":{const a=i.map(l=>{switch(l.type){case"text":return l.text;case"image":throw new lt({functionality:"images"})}}).join("");s+=`${n}:
${a}

`;break}case"assistant":{const a=i.map(l=>{switch(l.type){case"text":return l.text;case"tool-call":throw new lt({functionality:"tool-call messages"})}}).join("");s+=`${r}:
${a}

`;break}case"tool":throw new lt({functionality:"tool messages"});default:{const a=o;throw new Error(`Unsupported role: ${a}`)}}return s+=`${r}:
`,{prompt:s,stopSequences:[`
${n}:`]}}function Li(t){return t?.tokens.map((e,n)=>{var r,s;return{token:e,logprob:(r=t.token_logprobs[n])!=null?r:0,topLogprobs:t.top_logprobs?Object.entries((s=t.top_logprobs[n])!=null?s:{}).map(([o,i])=>({token:o,logprob:i})):[]}})}var wy=class{constructor(t,e,n){this.specificationVersion="v1",this.defaultObjectGenerationMode=void 0,this.modelId=t,this.settings=e,this.config=n}get provider(){return this.config.provider}getArgs({mode:t,inputFormat:e,prompt:n,maxTokens:r,temperature:s,topP:o,frequencyPenalty:i,presencePenalty:a,seed:l}){var c;const d=t.type,{prompt:h,stopSequences:p}=vy({prompt:n,inputFormat:e}),g=rt({model:this.modelId,echo:this.settings.echo,logit_bias:this.settings.logitBias,logprobs:typeof this.settings.logprobs=="number"?this.settings.logprobs:typeof this.settings.logprobs=="boolean"&&this.settings.logprobs?0:void 0,suffix:this.settings.suffix,user:this.settings.user,max_tokens:r,temperature:s,top_p:o,frequency_penalty:i,presence_penalty:a,seed:l,prompt:h,stop:p},this.config.extraBody);switch(d){case"regular":{if((c=t.tools)!=null&&c.length)throw new lt({functionality:"tools"});if(t.toolChoice)throw new lt({functionality:"toolChoice"});return g}case"object-json":throw new lt({functionality:"object-json mode"});case"object-tool":throw new lt({functionality:"object-tool mode"});case"object-grammar":throw new lt({functionality:"object-grammar mode"});default:{const v=d;throw new Error(`Unsupported type: ${v}`)}}}async doGenerate(t){const e=this.getArgs(t),{responseHeaders:n,value:r}=await wr({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:vr(this.config.headers(),t.headers),body:e,failedResponseHandler:Er,successfulResponseHandler:Tu(by),abortSignal:t.abortSignal,fetch:this.config.fetch}),s=e,{prompt:o}=s,i=_r(s,["prompt"]),a=r.choices[0];if(!a)throw new Error("No choice in OpenRouter completion response");return{text:a.text,usage:{promptTokens:r.usage.prompt_tokens,completionTokens:r.usage.completion_tokens},finishReason:xr(a.finish_reason),logprobs:Li(a.logprobs),rawCall:{rawPrompt:o,rawSettings:i},rawResponse:{headers:n},warnings:[]}}async doStream(t){const e=this.getArgs(t),{responseHeaders:n,value:r}=await wr({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:vr(this.config.headers(),t.headers),body:Vn(rt({},this.getArgs(t)),{stream:!0,stream_options:this.config.compatibility==="strict"?{include_usage:!0}:void 0}),failedResponseHandler:Er,successfulResponseHandler:Cu(_y),abortSignal:t.abortSignal,fetch:this.config.fetch}),s=e,{prompt:o}=s,i=_r(s,["prompt"]);let a="other",l={promptTokens:Number.NaN,completionTokens:Number.NaN},c;return{stream:r.pipeThrough(new TransformStream({transform(d,h){if(!d.success){a="error",h.enqueue({type:"error",error:d.error});return}const p=d.value;if("error"in p){a="error",h.enqueue({type:"error",error:p.error});return}p.usage!=null&&(l={promptTokens:p.usage.prompt_tokens,completionTokens:p.usage.completion_tokens});const g=p.choices[0];g?.finish_reason!=null&&(a=xr(g.finish_reason)),g?.text!=null&&h.enqueue({type:"text-delta",textDelta:g.text});const v=Li(g?.logprobs);v?.length&&(c===void 0&&(c=[]),c.push(...v))},flush(d){d.enqueue({type:"finish",finishReason:a,logprobs:c,usage:l})}})),rawCall:{rawPrompt:o,rawSettings:i},rawResponse:{headers:n},warnings:[]}}},by=_({choices:D(_({text:E(),finish_reason:E(),logprobs:_({tokens:D(E()),token_logprobs:D(T()),top_logprobs:D(Rn(E(),T())).nullable()}).nullable().optional()})),usage:_({prompt_tokens:T(),completion_tokens:T()})}),_y=Tt([_({choices:D(_({text:E(),finish_reason:E().nullish(),index:T(),logprobs:_({tokens:D(E()),token_logprobs:D(T()),top_logprobs:D(Rn(E(),T())).nullable()}).nullable().optional()})),usage:_({prompt_tokens:T(),completion_tokens:T()}).optional().nullable()}),ko]);function $u(t={}){var e,n,r;const s=(n=ly((e=t.baseURL)!=null?e:t.baseUrl))!=null?n:"https://openrouter.ai/api/v1",o=(r=t.compatibility)!=null?r:"compatible",i=()=>rt({Authorization:`Bearer ${ey({apiKey:t.apiKey,environmentVariableName:"OPENROUTER_API_KEY",description:"OpenRouter"})}`},t.headers),a=(h,p={})=>new hy(h,p,{provider:"openrouter.chat",url:({path:g})=>`${s}${g}`,headers:i,compatibility:o,fetch:t.fetch,extraBody:t.extraBody}),l=(h,p={})=>new wy(h,p,{provider:"openrouter.completion",url:({path:g})=>`${s}${g}`,headers:i,compatibility:o,fetch:t.fetch,extraBody:t.extraBody}),c=(h,p)=>{if(new.target)throw new Error("The OpenRouter model function cannot be called with the new keyword.");return h==="openai/gpt-3.5-turbo-instruct"?l(h,p):a(h,p)},d=function(h,p){return c(h,p)};return d.languageModel=c,d.chat=a,d.completion=l,d}$u({compatibility:"strict"});class xy extends ye{name="OpenRouter";getApiKeyLink="https://openrouter.ai/settings/keys";config={apiTokenKey:"OPEN_ROUTER_API_KEY"};staticModels=[{name:"anthropic/claude-3.5-sonnet",label:"Claude 3.5 Sonnet",provider:"OpenRouter",maxTokenAllowed:2e5},{name:"openai/gpt-4o",label:"GPT-4o",provider:"OpenRouter",maxTokenAllowed:128e3}];async getDynamicModels(e,n,r={}){try{return(await(await fetch("https://openrouter.ai/api/v1/models",{headers:{"Content-Type":"application/json"}})).json()).data.sort((i,a)=>i.name.localeCompare(a.name)).map(i=>{const a=i.context_length||32e3,c=Math.min(a,1e6);return{name:i.id,label:`${i.name} - in:$${(i.pricing.prompt*1e6).toFixed(2)} out:$${(i.pricing.completion*1e6).toFixed(2)} - context ${c>=1e6?Math.floor(c/1e6)+"M":Math.floor(c/1e3)+"k"}`,provider:this.name,maxTokenAllowed:c}})}catch(s){return console.error("Error getting OpenRouter models:",s),[]}}getModelInstance(e){const{model:n,serverEnv:r,apiKeys:s,providerSettings:o}=e,{apiKey:i}=this.getProviderBaseUrlAndKey({apiKeys:s,providerSettings:o?.[this.name],serverEnv:r,defaultBaseUrlKey:"",defaultApiTokenKey:"OPEN_ROUTER_API_KEY"});if(!i)throw new Error(`Missing API key for ${this.name} provider`);return $u({apiKey:i}).chat(n)}}class Ey extends ye{name="OpenAILike";getApiKeyLink=void 0;config={baseUrlKey:"OPENAI_LIKE_API_BASE_URL",apiTokenKey:"OPENAI_LIKE_API_KEY",modelsKey:"OPENAI_LIKE_API_MODELS"};staticModels=[];async getDynamicModels(e,n,r={}){const{baseUrl:s,apiKey:o}=this.getProviderBaseUrlAndKey({apiKeys:e,providerSettings:n,serverEnv:r,defaultBaseUrlKey:"OPENAI_LIKE_API_BASE_URL",defaultApiTokenKey:"OPENAI_LIKE_API_KEY"});if(!s||!o)return[];try{const i=await fetch(`${s}/models`,{headers:{Authorization:`Bearer ${o}`}});if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);return(await i.json()).data.map(l=>({name:l.id,label:l.id,provider:this.name,maxTokenAllowed:8e3}))}catch(i){console.log(`${this.name}: Not allowed to GET /models endpoint for provider`,i);const a=r.OPENAI_LIKE_API_MODELS||n?.OPENAI_LIKE_API_MODELS;return a?(console.log(`${this.name}: OPENAI_LIKE_API_MODELS=${a}`),this._parseModelsFromEnv(a)):[]}}_parseModelsFromEnv(e){if(!e)return[];try{const n=[],r=e.split(";");for(const s of r){const o=s.trim();if(!o)continue;const[i,a]=o.split(":");if(!i)continue;const l=a?parseInt(a.trim(),10):8e3,c=i.trim(),d=this._generateModelLabel(c);n.push({name:c,label:d,provider:this.name,maxTokenAllowed:l})}return console.log(`${this.name}: Parsed Models:`,n),n}catch(n){return console.error(`${this.name}: Error parsing OPENAI_LIKE_API_MODELS:`,n),[]}}_generateModelLabel(e){const n=e.split("/");let s=n[n.length-1].replace(/^accounts\//,"").replace(/^fireworks\/models\//,"").replace(/^models\//,"").replace(/\b\w/g,o=>o.toUpperCase()).replace(/\s+/g,"-");return!s.includes("Fireworks")&&!s.includes("OpenAI")&&(s+=" (OpenAI Compatible)"),s}getModelInstance(e){const{model:n,serverEnv:r,apiKeys:s,providerSettings:o}=e,{baseUrl:i,apiKey:a}=this.getProviderBaseUrlAndKey({apiKeys:s,providerSettings:o?.[this.name],serverEnv:r,defaultBaseUrlKey:"OPENAI_LIKE_API_BASE_URL",defaultApiTokenKey:"OPENAI_LIKE_API_KEY"});if(!i||!a)throw new Error(`Missing configuration for ${this.name} provider`);return Yc(i,a,n)}}class ky extends ye{name="OpenAI";getApiKeyLink="https://platform.openai.com/api-keys";config={apiTokenKey:"OPENAI_API_KEY"};staticModels=[{name:"gpt-4o",label:"GPT-4o",provider:"OpenAI",maxTokenAllowed:128e3,maxCompletionTokens:4096},{name:"gpt-4o-mini",label:"GPT-4o Mini",provider:"OpenAI",maxTokenAllowed:128e3,maxCompletionTokens:4096},{name:"gpt-3.5-turbo",label:"GPT-3.5 Turbo",provider:"OpenAI",maxTokenAllowed:16e3,maxCompletionTokens:4096},{name:"o1-preview",label:"o1-preview",provider:"OpenAI",maxTokenAllowed:128e3,maxCompletionTokens:32e3},{name:"o1-mini",label:"o1-mini",provider:"OpenAI",maxTokenAllowed:128e3,maxCompletionTokens:65e3}];async getDynamicModels(e,n,r){const{apiKey:s}=this.getProviderBaseUrlAndKey({apiKeys:e,providerSettings:n,serverEnv:r,defaultBaseUrlKey:"",defaultApiTokenKey:"OPENAI_API_KEY"});if(!s)throw`Missing Api Key configuration for ${this.name} provider`;const i=await(await fetch("https://api.openai.com/v1/models",{headers:{Authorization:`Bearer ${s}`}})).json(),a=this.staticModels.map(c=>c.name);return i.data.filter(c=>c.object==="model"&&(c.id.startsWith("gpt-")||c.id.startsWith("o")||c.id.startsWith("chatgpt-"))&&!a.includes(c.id)).map(c=>{let d=32e3;c.context_length?d=c.context_length:c.id?.includes("gpt-4o")||c.id?.includes("gpt-4-turbo")||c.id?.includes("gpt-4-1106")?d=128e3:c.id?.includes("gpt-4")?d=8192:c.id?.includes("gpt-3.5-turbo")&&(d=16385);let h=4096;return c.id?.startsWith("o1-preview")?h=32e3:c.id?.startsWith("o1-mini")?h=65e3:c.id?.startsWith("o1")?h=32e3:c.id?.includes("o3")||c.id?.includes("o4")?h=1e5:c.id?.includes("gpt-4o")?h=4096:c.id?.includes("gpt-4")?h=8192:c.id?.includes("gpt-3.5-turbo")&&(h=4096),{name:c.id,label:`${c.id} (${Math.floor(d/1e3)}k context)`,provider:this.name,maxTokenAllowed:Math.min(d,128e3),maxCompletionTokens:h}})}getModelInstance(e){const{model:n,serverEnv:r,apiKeys:s,providerSettings:o}=e,{apiKey:i}=this.getProviderBaseUrlAndKey({apiKeys:s,providerSettings:o?.[this.name],serverEnv:r,defaultBaseUrlKey:"",defaultApiTokenKey:"OPENAI_API_KEY"});if(!i)throw new Error(`Missing API key for ${this.name} provider`);return Ve({apiKey:i})(n)}}class Sy extends ye{name="Perplexity";getApiKeyLink="https://www.perplexity.ai/settings/api";config={apiTokenKey:"PERPLEXITY_API_KEY"};staticModels=[{name:"sonar",label:"Sonar",provider:"Perplexity",maxTokenAllowed:8192},{name:"sonar-pro",label:"Sonar Pro",provider:"Perplexity",maxTokenAllowed:8192},{name:"sonar-reasoning-pro",label:"Sonar Reasoning Pro",provider:"Perplexity",maxTokenAllowed:8192}];getModelInstance(e){const{model:n,serverEnv:r,apiKeys:s,providerSettings:o}=e,{apiKey:i}=this.getProviderBaseUrlAndKey({apiKeys:s,providerSettings:o?.[this.name],serverEnv:r,defaultBaseUrlKey:"",defaultApiTokenKey:"PERPLEXITY_API_KEY"});if(!i)throw new Error(`Missing API key for ${this.name} provider`);return Ve({baseURL:"https://api.perplexity.ai/",apiKey:i})(n)}}class Ay extends ye{name="Together";getApiKeyLink="https://api.together.xyz/settings/api-keys";config={baseUrlKey:"TOGETHER_API_BASE_URL",apiTokenKey:"TOGETHER_API_KEY"};staticModels=[{name:"meta-llama/Llama-3.2-90B-Vision-Instruct-Turbo",label:"Llama 3.2 90B Vision",provider:"Together",maxTokenAllowed:128e3,maxCompletionTokens:8192},{name:"mistralai/Mixtral-8x7B-Instruct-v0.1",label:"Mixtral 8x7B Instruct",provider:"Together",maxTokenAllowed:32e3,maxCompletionTokens:8192}];async getDynamicModels(e,n,r={}){const{baseUrl:s,apiKey:o}=this.getProviderBaseUrlAndKey({apiKeys:e,providerSettings:n,serverEnv:r,defaultBaseUrlKey:"TOGETHER_API_BASE_URL",defaultApiTokenKey:"TOGETHER_API_KEY"}),i=s||"https://api.together.xyz/v1";return o?(await(await fetch(`${i}/models`,{headers:{Authorization:`Bearer ${o}`}})).json()||[]).filter(d=>d.type==="chat").map(d=>({name:d.id,label:`${d.display_name} - in:$${d.pricing.input.toFixed(2)} out:$${d.pricing.output.toFixed(2)} - context ${Math.floor(d.context_length/1e3)}k`,provider:this.name,maxTokenAllowed:8e3,maxCompletionTokens:8192})):[]}getModelInstance(e){const{model:n,serverEnv:r,apiKeys:s,providerSettings:o}=e,{baseUrl:i,apiKey:a}=this.getProviderBaseUrlAndKey({apiKeys:s,providerSettings:o?.[this.name],serverEnv:r,defaultBaseUrlKey:"TOGETHER_API_BASE_URL",defaultApiTokenKey:"TOGETHER_API_KEY"});if(!i||!a)throw new Error(`Missing configuration for ${this.name} provider`);return Yc(i,a,n)}}class Cy extends ye{name="xAI";getApiKeyLink="https://docs.x.ai/docs/quickstart#creating-an-api-key";config={apiTokenKey:"XAI_API_KEY"};staticModels=[{name:"grok-4",label:"xAI Grok 4",provider:"xAI",maxTokenAllowed:256e3},{name:"grok-4-07-09",label:"xAI Grok 4 (07-09)",provider:"xAI",maxTokenAllowed:256e3},{name:"grok-3-mini",label:"xAI Grok 3 Mini",provider:"xAI",maxTokenAllowed:131e3},{name:"grok-3-mini-fast",label:"xAI Grok 3 Mini Fast",provider:"xAI",maxTokenAllowed:131e3},{name:"grok-code-fast-1",label:"xAI Grok Code Fast 1",provider:"xAI",maxTokenAllowed:131e3}];getModelInstance(e){const{model:n,serverEnv:r,apiKeys:s,providerSettings:o}=e,{apiKey:i}=this.getProviderBaseUrlAndKey({apiKeys:s,providerSettings:o?.[this.name],serverEnv:r,defaultBaseUrlKey:"",defaultApiTokenKey:"XAI_API_KEY"});if(!i)throw new Error(`Missing API key for ${this.name} provider`);return Ve({baseURL:"https://api.x.ai/v1",apiKey:i})(n)}}class Ty extends ye{name="Hyperbolic";getApiKeyLink="https://app.hyperbolic.xyz/settings";config={apiTokenKey:"HYPERBOLIC_API_KEY"};staticModels=[{name:"Qwen/Qwen2.5-Coder-32B-Instruct",label:"Qwen 2.5 Coder 32B Instruct",provider:"Hyperbolic",maxTokenAllowed:8192},{name:"Qwen/Qwen2.5-72B-Instruct",label:"Qwen2.5-72B-Instruct",provider:"Hyperbolic",maxTokenAllowed:8192},{name:"deepseek-ai/DeepSeek-V2.5",label:"DeepSeek-V2.5",provider:"Hyperbolic",maxTokenAllowed:8192},{name:"Qwen/QwQ-32B-Preview",label:"QwQ-32B-Preview",provider:"Hyperbolic",maxTokenAllowed:8192},{name:"Qwen/Qwen2-VL-72B-Instruct",label:"Qwen2-VL-72B-Instruct",provider:"Hyperbolic",maxTokenAllowed:8192}];async getDynamicModels(e,n,r={}){const{baseUrl:s,apiKey:o}=this.getProviderBaseUrlAndKey({apiKeys:e,providerSettings:n,serverEnv:r,defaultBaseUrlKey:"",defaultApiTokenKey:"HYPERBOLIC_API_KEY"}),i=s||"https://api.hyperbolic.xyz/v1";if(!o)throw`Missing Api Key configuration for ${this.name} provider`;return(await(await fetch(`${i}/models`,{headers:{Authorization:`Bearer ${o}`}})).json()).data.filter(d=>d.object==="model"&&d.supports_chat).map(d=>({name:d.id,label:`${d.id} - context ${d.context_length?Math.floor(d.context_length/1e3)+"k":"N/A"}`,provider:this.name,maxTokenAllowed:d.context_length||8e3}))}getModelInstance(e){const{model:n,serverEnv:r,apiKeys:s,providerSettings:o}=e,{apiKey:i}=this.getProviderBaseUrlAndKey({apiKeys:s,providerSettings:o?.[this.name],serverEnv:r,defaultBaseUrlKey:"",defaultApiTokenKey:"HYPERBOLIC_API_KEY"});if(!i)throw`Missing Api Key configuration for ${this.name} provider`;return Ve({baseURL:"https://api.hyperbolic.xyz/v1/",apiKey:i})(n)}}var Ou="vercel.ai.error",Iy=Symbol.for(Ou),Bu,Ry=class Pu extends Error{constructor({name:e,message:n,cause:r}){super(n),this[Bu]=!0,this.name=e,this.cause=r}static isInstance(e){return Pu.hasMarker(e,Ou)}static hasMarker(e,n){const r=Symbol.for(n);return e!=null&&typeof e=="object"&&r in e&&typeof e[r]=="boolean"&&e[r]===!0}};Bu=Iy;var Qt=Ry,Nu="AI_InvalidArgumentError",Mu=`vercel.ai.error.${Nu}`,$y=Symbol.for(Mu),Du,Oy=class extends Qt{constructor({message:t,cause:e,argument:n}){super({name:Nu,message:t,cause:e}),this[Du]=!0,this.argument=n}static isInstance(t){return Qt.hasMarker(t,Mu)}};Du=$y;var Uu="AI_LoadSettingError",Lu=`vercel.ai.error.${Uu}`,By=Symbol.for(Lu),Fu,Fn=class extends Qt{constructor({message:t}){super({name:Uu,message:t}),this[Fu]=!0}static isInstance(t){return Qt.hasMarker(t,Lu)}};Fu=By;var ju="AI_UnsupportedFunctionalityError",Hu=`vercel.ai.error.${ju}`,Py=Symbol.for(Hu),Ku,hn=class extends Qt{constructor({functionality:t}){super({name:ju,message:`'${t}' functionality not supported.`}),this[Ku]=!0,this.functionality=t}static isInstance(t){return Qt.hasMarker(t,Hu)}};Ku=Py;var Vu={},qu=({prefix:t,size:e=16,alphabet:n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{const s=lo(n,e);if(t==null)return s;if(n.includes(r))throw new Oy({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${n}".`});return o=>`${t}${r}${s(o)}`},Ny=qu();function My({settingValue:t,environmentVariableName:e}){if(typeof t=="string")return t;if(!(t!=null||typeof Pe>"u")&&(t=Vu[e],!(t==null||typeof t!="string")))return t}function ns({settingValue:t,environmentVariableName:e,settingName:n,description:r}){if(typeof t=="string")return t;if(t!=null)throw new Fn({message:`${r} setting must be a string.`});if(typeof Pe>"u")throw new Fn({message:`${r} setting is missing. Pass it using the '${n}' parameter. Environment variables is not supported in this environment.`});if(t=Vu[e],t==null)throw new Fn({message:`${r} setting is missing. Pass it using the '${n}' parameter or the ${e} environment variable.`});if(typeof t!="string")throw new Fn({message:`${r} setting must be a string. The value of the ${e} environment variable is not a string.`});return t}function Dy(t){const e=t.signer,n=t.signer,r=Object.assign(t,{eventSigner:e,messageSigner:n}),s=r.eventStreamPayloadHandlerProvider(r);return Object.assign(r,{eventStreamPayloadHandler:s})}const Uy=t=>({setHttpHandler(e){t.httpHandler=e},httpHandler(){return t.httpHandler},updateHttpClientConfig(e,n){t.httpHandler?.updateHttpClientConfig(e,n)},httpHandlerConfigs(){return t.httpHandler.httpHandlerConfigs()}}),Ly=t=>({httpHandler:t.httpHandler()});var Fi;(function(t){t.HEADER="header",t.QUERY="query"})(Fi||(Fi={}));var ji;(function(t){t.HEADER="header",t.QUERY="query"})(ji||(ji={}));var xn;(function(t){t.HTTP="http",t.HTTPS="https"})(xn||(xn={}));var kr;(function(t){t.MD5="md5",t.CRC32="crc32",t.CRC32C="crc32c",t.SHA1="sha1",t.SHA256="sha256"})(kr||(kr={}));var Hi;(function(t){t[t.HEADER=0]="HEADER",t[t.TRAILER=1]="TRAILER"})(Hi||(Hi={}));const zs="__smithy_context";var Ki;(function(t){t.PROFILE="profile",t.SSO_SESSION="sso-session",t.SERVICES="services"})(Ki||(Ki={}));var Vi;(function(t){t.HTTP_0_9="http/0.9",t.HTTP_1_0="http/1.0",t.TDS_8_0="tds/8.0"})(Vi||(Vi={}));class Te{constructor(e){this.method=e.method||"GET",this.hostname=e.hostname||"localhost",this.port=e.port,this.query=e.query||{},this.headers=e.headers||{},this.body=e.body,this.protocol=e.protocol?e.protocol.slice(-1)!==":"?`${e.protocol}:`:e.protocol:"https:",this.path=e.path?e.path.charAt(0)!=="/"?`/${e.path}`:e.path:"/",this.username=e.username,this.password=e.password,this.fragment=e.fragment}static clone(e){const n=new Te({...e,headers:{...e.headers}});return n.query&&(n.query=Fy(n.query)),n}static isInstance(e){if(!e)return!1;const n=e;return"method"in n&&"protocol"in n&&"hostname"in n&&"path"in n&&typeof n.query=="object"&&typeof n.headers=="object"}clone(){return Te.clone(this)}}function Fy(t){return Object.keys(t).reduce((e,n)=>{const r=t[n];return{...e,[n]:Array.isArray(r)?[...r]:r}},{})}class Xt{constructor(e){this.statusCode=e.statusCode,this.reason=e.reason,this.headers=e.headers||{},this.body=e.body}static isInstance(e){if(!e)return!1;const n=e;return typeof n.statusCode=="number"&&typeof n.headers=="object"}}const jy=t=>e=>async n=>{if(!Te.isInstance(n.request))return e(n);const{request:r}=n,{handlerProtocol:s=""}=t.requestHandler.metadata||{};if(s.indexOf("h2")>=0&&!r.headers[":authority"])delete r.headers.host,r.headers[":authority"]=r.hostname+(r.port?":"+r.port:"");else if(!r.headers.host){let o=r.hostname;r.port!=null&&(o+=`:${r.port}`),r.headers.host=o}return e(n)},Hy={name:"hostHeaderMiddleware",step:"build",priority:"low",tags:["HOST"],override:!0},Ky=t=>({applyToStack:e=>{e.add(jy(t),Hy)}}),Vy=()=>(t,e)=>async n=>{try{const r=await t(n),{clientName:s,commandName:o,logger:i,dynamoDbDocumentClientOptions:a={}}=e,{overrideInputFilterSensitiveLog:l,overrideOutputFilterSensitiveLog:c}=a,d=l??e.inputFilterSensitiveLog,h=c??e.outputFilterSensitiveLog,{$metadata:p,...g}=r.output;return i?.info?.({clientName:s,commandName:o,input:d(n.input),output:h(g),metadata:p}),r}catch(r){const{clientName:s,commandName:o,logger:i,dynamoDbDocumentClientOptions:a={}}=e,{overrideInputFilterSensitiveLog:l}=a,c=l??e.inputFilterSensitiveLog;throw i?.error?.({clientName:s,commandName:o,input:c(n.input),error:r,metadata:r.$metadata}),r}},qy={name:"loggerMiddleware",tags:["LOGGER"],step:"initialize",override:!0},Gy=t=>({applyToStack:e=>{e.add(Vy(),qy)}});var qi={};const rs="X-Amzn-Trace-Id",zy="AWS_LAMBDA_FUNCTION_NAME",Jy="_X_AMZN_TRACE_ID",Wy=t=>e=>async n=>{const{request:r}=n;if(!Te.isInstance(r)||t.runtime!=="node")return e(n);const s=Object.keys(r.headers??{}).find(l=>l.toLowerCase()===rs.toLowerCase())??rs;if(r.headers.hasOwnProperty(s))return e(n);const o=qi[zy],i=qi[Jy],a=l=>typeof l=="string"&&l.length>0;return a(o)&&a(i)&&(r.headers[rs]=i),e({...n,request:r})},Zy={step:"build",tags:["RECURSION_DETECTION"],name:"recursionDetectionMiddleware",override:!0,priority:"low"},Yy=t=>({applyToStack:e=>{e.add(Wy(t),Zy)}}),Dr=t=>t[zs]||(t[zs]={}),ft=t=>{if(typeof t=="function")return t;const e=Promise.resolve(t);return()=>e},Qy=(t,e)=>{if(!e||e.length===0)return t;const n=[];for(const r of e)for(const s of t)s.schemeId.split("#")[1]===r&&n.push(s);for(const r of t)n.find(({schemeId:s})=>s===r.schemeId)||n.push(r);return n};function Xy(t){const e=new Map;for(const n of t)e.set(n.schemeId,n);return e}const ev=(t,e)=>(n,r)=>async s=>{const o=t.httpAuthSchemeProvider(await e.httpAuthSchemeParametersProvider(t,r,s.input)),i=t.authSchemePreference?await t.authSchemePreference():[],a=Qy(o,i),l=Xy(t.httpAuthSchemes),c=Dr(r),d=[];for(const h of a){const p=l.get(h.schemeId);if(!p){d.push(`HttpAuthScheme \`${h.schemeId}\` was not enabled for this service.`);continue}const g=p.identityProvider(await e.identityProviderConfigProvider(t));if(!g){d.push(`HttpAuthScheme \`${h.schemeId}\` did not have an IdentityProvider configured.`);continue}const{identityProperties:v={},signingProperties:b={}}=h.propertiesExtractor?.(t,r)||{};h.identityProperties=Object.assign(h.identityProperties||{},v),h.signingProperties=Object.assign(h.signingProperties||{},b),c.selectedHttpAuthScheme={httpAuthOption:h,identity:await g(h.identityProperties),signer:p.signer};break}if(!c.selectedHttpAuthScheme)throw new Error(d.join(`
`));return n(s)},tv={step:"serialize",tags:["HTTP_AUTH_SCHEME"],name:"httpAuthSchemeMiddleware",override:!0,relation:"before",toMiddleware:"endpointV2Middleware"},nv=(t,{httpAuthSchemeParametersProvider:e,identityProviderConfigProvider:n})=>({applyToStack:r=>{r.addRelativeTo(ev(t,{httpAuthSchemeParametersProvider:e,identityProviderConfigProvider:n}),tv)}}),rv=(t,e)=>(n,r)=>async s=>{const{response:o}=await n(s);try{const i=await e(o,t);return{response:o,output:i}}catch(i){if(Object.defineProperty(i,"$response",{value:o}),!("$metadata"in i)){const a="Deserialization error: to see the raw response, inspect the hidden field {error}.$response on this object.";try{i.message+=`
  `+a}catch{!r.logger||r.logger?.constructor?.name==="NoOpLogger"?console.warn(a):r.logger?.warn?.(a)}typeof i.$responseBodyText<"u"&&i.$response&&(i.$response.body=i.$responseBodyText);try{if(Xt.isInstance(o)){const{headers:l={}}=o,c=Object.entries(l);i.$metadata={httpStatusCode:o.statusCode,requestId:ss(/^x-[\w-]+-request-?id$/,c),extendedRequestId:ss(/^x-[\w-]+-id-2$/,c),cfId:ss(/^x-[\w-]+-cf-id$/,c)}}}catch{}}throw i}},ss=(t,e)=>(e.find(([n])=>n.match(t))||[void 0,void 0])[1],sv=(t,e)=>(n,r)=>async s=>{const o=t,i=r.endpointV2?.url&&o.urlParser?async()=>o.urlParser(r.endpointV2.url):o.endpoint;if(!i)throw new Error("No valid endpoint provider available.");const a=await e(s.input,{...t,endpoint:i});return n({...s,request:a})},ov={name:"deserializerMiddleware",step:"deserialize",tags:["DESERIALIZER"],override:!0},Gu={name:"serializerMiddleware",step:"serialize",tags:["SERIALIZER"],override:!0};function So(t,e,n){return{applyToStack:r=>{r.add(rv(t,n),ov),r.add(sv(t,e),Gu)}}}const iv=t=>e=>{throw e},av=(t,e)=>{},cv=t=>(e,n)=>async r=>{if(!Te.isInstance(r.request))return e(r);const o=Dr(n).selectedHttpAuthScheme;if(!o)throw new Error("No HttpAuthScheme was selected: unable to sign request");const{httpAuthOption:{signingProperties:i={}},identity:a,signer:l}=o,c=await e({...r,request:await l.sign(r.request,a,i)}).catch((l.errorHandler||iv)(i));return(l.successHandler||av)(c.response,i),c},lv={step:"finalizeRequest",tags:["HTTP_SIGNING"],name:"httpSigningMiddleware",aliases:["apiKeyMiddleware","tokenMiddleware","awsAuthMiddleware"],override:!0,relation:"after",toMiddleware:"retryMiddleware"},uv=t=>({applyToStack:e=>{e.addRelativeTo(cv(),lv)}}),mn=t=>{if(typeof t=="function")return t;const e=Promise.resolve(t);return()=>e},St={},sn=new Array(64);for(let t=0,e=65,n=90;t+e<=n;t++){const r=String.fromCharCode(t+e);St[r]=t,sn[t]=r}for(let t=0,e=97,n=122;t+e<=n;t++){const r=String.fromCharCode(t+e),s=t+26;St[r]=s,sn[s]=r}for(let t=0;t<10;t++){St[t.toString(10)]=t+52;const e=t.toString(10),n=t+52;St[e]=n,sn[n]=e}St["+"]=62;sn[62]="+";St["/"]=63;sn[63]="/";const Jt=6,gn=8,dv=63,Ao=t=>{let e=t.length/4*3;t.slice(-2)==="=="?e-=2:t.slice(-1)==="="&&e--;const n=new ArrayBuffer(e),r=new DataView(n);for(let s=0;s<t.length;s+=4){let o=0,i=0;for(let c=s,d=s+3;c<=d;c++)if(t[c]!=="="){if(!(t[c]in St))throw new TypeError(`Invalid character ${t[c]} in base64 string.`);o|=St[t[c]]<<(d-c)*Jt,i+=Jt}else o>>=Jt;const a=s/4*3;o>>=i%gn;const l=Math.floor(i/gn);for(let c=0;c<l;c++){const d=(l-c-1)*gn;r.setUint8(a+c,(o&255<<d)>>d)}}return new Uint8Array(n)},en=t=>new TextEncoder().encode(t),En=t=>typeof t=="string"?en(t):ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(t),zu=t=>{if(typeof t=="string")return t;if(typeof t!="object"||typeof t.byteOffset!="number"||typeof t.byteLength!="number")throw new Error("@smithy/util-utf8: toUtf8 encoder function only accepts string | Uint8Array.");return new TextDecoder("utf-8").decode(t)};function Ju(t){let e;typeof t=="string"?e=en(t):e=t;const n=typeof e=="object"&&typeof e.length=="number",r=typeof e=="object"&&typeof e.byteOffset=="number"&&typeof e.byteLength=="number";if(!n&&!r)throw new Error("@smithy/util-base64: toBase64 encoder function only accepts string | Uint8Array.");let s="";for(let o=0;o<e.length;o+=3){let i=0,a=0;for(let c=o,d=Math.min(o+3,e.length);c<d;c++)i|=e[c]<<(d-c-1)*gn,a+=gn;const l=Math.ceil(a/Jt);i<<=l*Jt-a;for(let c=1;c<=l;c++){const d=(l-c)*Jt;s+=sn[(i&dv<<d)>>d]}s+="==".slice(0,4-l)}return s}function fv(t,e="utf-8"){return e==="base64"?Ju(t):zu(t)}function pv(t,e){return e==="base64"?Bt.mutate(Ao(t)):Bt.mutate(en(t))}class Bt extends Uint8Array{static fromString(e,n="utf-8"){switch(typeof e){case"string":return pv(e,n);default:throw new Error(`Unsupported conversion from ${typeof e} to Uint8ArrayBlobAdapter.`)}}static mutate(e){return Object.setPrototypeOf(e,Bt.prototype),e}transformToString(e="utf-8"){return fv(this,e)}}const Pt=t=>encodeURIComponent(t).replace(/[!'()*]/g,hv),hv=t=>`%${t.charCodeAt(0).toString(16).toUpperCase()}`;function Wu(t){const e=[];for(let n of Object.keys(t).sort()){const r=t[n];if(n=Pt(n),Array.isArray(r))for(let s=0,o=r.length;s<o;s++)e.push(`${n}=${Pt(r[s])}`);else{let s=n;(r||typeof r=="string")&&(s+=`=${Pt(r)}`),e.push(s)}}return e.join("&")}function Gi(t,e){return new Request(t,e)}function mv(t=0){return new Promise((e,n)=>{t&&setTimeout(()=>{const r=new Error(`Request did not complete within ${t} ms`);r.name="TimeoutError",n(r)},t)})}const os={supported:void 0};class kn{static create(e){return typeof e?.handle=="function"?e:new kn(e)}constructor(e){typeof e=="function"?this.configProvider=e().then(n=>n||{}):(this.config=e??{},this.configProvider=Promise.resolve(this.config)),os.supported===void 0&&(os.supported=typeof Request<"u"&&"keepalive"in Gi("https://[::1]"))}destroy(){}async handle(e,{abortSignal:n,requestTimeout:r}={}){this.config||(this.config=await this.configProvider);const s=r??this.config.requestTimeout,o=this.config.keepAlive===!0,i=this.config.credentials;if(n?.aborted){const A=new Error("Request aborted");return A.name="AbortError",Promise.reject(A)}let a=e.path;const l=Wu(e.query||{});l&&(a+=`?${l}`),e.fragment&&(a+=`#${e.fragment}`);let c="";if(e.username!=null||e.password!=null){const A=e.username??"",O=e.password??"";c=`${A}:${O}@`}const{port:d,method:h}=e,p=`${e.protocol}//${c}${e.hostname}${d?`:${d}`:""}${a}`,g=h==="GET"||h==="HEAD"?void 0:e.body,v={body:g,headers:new Headers(e.headers),method:h,credentials:i};this.config?.cache&&(v.cache=this.config.cache),g&&(v.duplex="half"),typeof AbortController<"u"&&(v.signal=n),os.supported&&(v.keepalive=o),typeof this.config.requestInit=="function"&&Object.assign(v,this.config.requestInit(e));let b=()=>{};const w=Gi(p,v),S=[fetch(w).then(A=>{const O=A.headers,B={};for(const F of O.entries())B[F[0]]=F[1];return A.body!=null?{response:new Xt({headers:B,reason:A.statusText,statusCode:A.status,body:A.body})}:A.blob().then(F=>({response:new Xt({headers:B,reason:A.statusText,statusCode:A.status,body:F})}))}),mv(s)];return n&&S.push(new Promise((A,O)=>{const B=()=>{const $=new Error("Request aborted");$.name="AbortError",O($)};if(typeof n.addEventListener=="function"){const $=n;$.addEventListener("abort",B,{once:!0}),b=()=>$.removeEventListener("abort",B)}else n.onabort=B})),Promise.race(S).finally(b)}updateHttpClientConfig(e,n){this.config=void 0,this.configProvider=this.configProvider.then(r=>(r[e]=n,r))}httpHandlerConfigs(){return this.config??{}}}const gv=async t=>typeof Blob=="function"&&t instanceof Blob||t.constructor?.name==="Blob"?Blob.prototype.arrayBuffer!==void 0?new Uint8Array(await t.arrayBuffer()):yv(t):vv(t);async function yv(t){const e=await wv(t),n=Ao(e);return new Uint8Array(n)}async function vv(t){const e=[],n=t.getReader();let r=!1,s=0;for(;!r;){const{done:a,value:l}=await n.read();l&&(e.push(l),s+=l.length),r=a}const o=new Uint8Array(s);let i=0;for(const a of e)o.set(a,i),i+=a.length;return o}function wv(t){return new Promise((e,n)=>{const r=new FileReader;r.onloadend=()=>{if(r.readyState!==2)return n(new Error("Reader aborted too early"));const s=r.result??"",o=s.indexOf(","),i=o>-1?o+1:s.length;e(s.substring(i))},r.onabort=()=>n(new Error("Read aborted")),r.onerror=()=>n(r.error),r.readAsDataURL(t)})}const Zu={},Js={};for(let t=0;t<256;t++){let e=t.toString(16).toLowerCase();e.length===1&&(e=`0${e}`),Zu[t]=e,Js[e]=t}function Co(t){if(t.length%2!==0)throw new Error("Hex encoded strings must have an even number length");const e=new Uint8Array(t.length/2);for(let n=0;n<t.length;n+=2){const r=t.slice(n,n+2).toLowerCase();if(r in Js)e[n/2]=Js[r];else throw new Error(`Cannot decode unrecognized sequence ${r} as hexadecimal`)}return e}function Be(t){let e="";for(let n=0;n<t.byteLength;n++)e+=Zu[t[n]];return e}const Yu=async(t=new Uint8Array,e)=>{if(t instanceof Uint8Array)return Bt.mutate(t);if(!t)return Bt.mutate(new Uint8Array);const n=e.streamCollector(t);return Bt.mutate(await n)};function zi(t){return encodeURIComponent(t).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}const bv=t=>{if(t!=null){if(typeof t=="number"){if((t===0||t===1)&&Ar.warn(Sr(`Expected boolean, got ${typeof t}: ${t}`)),t===0)return!1;if(t===1)return!0}if(typeof t=="string"){const e=t.toLowerCase();if((e==="false"||e==="true")&&Ar.warn(Sr(`Expected boolean, got ${typeof t}: ${t}`)),e==="false")return!1;if(e==="true")return!0}if(typeof t=="boolean")return t;throw new TypeError(`Expected boolean, got ${typeof t}: ${t}`)}},_v=t=>{if(t!=null){if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return String(e)!==String(t)&&Ar.warn(Sr(`Expected number but observed string: ${t}`)),e}if(typeof t=="number")return t;throw new TypeError(`Expected number, got ${typeof t}: ${t}`)}},xv=t=>{if(t!=null){if(Number.isInteger(t)&&!Number.isNaN(t))return t;throw new TypeError(`Expected integer, got ${typeof t}: ${t}`)}},To=t=>Ev(t,32),Ev=(t,e)=>{const n=xv(t);if(n!==void 0&&kv(n,e)!==n)throw new TypeError(`Expected ${e}-bit integer, got ${t}`);return n},kv=(t,e)=>{switch(e){case 32:return Int32Array.of(t)[0];case 16:return Int16Array.of(t)[0];case 8:return Int8Array.of(t)[0]}},Sv=(t,e)=>{if(t==null)throw new TypeError(`Expected a non-null value for ${e}`);return t},Qu=t=>{if(t==null)return;if(typeof t=="object"&&!Array.isArray(t))return t;const e=Array.isArray(t)?"array":typeof t;throw new TypeError(`Expected object, got ${e}: ${t}`)},V=t=>{if(t!=null){if(typeof t=="string")return t;if(["boolean","number","bigint"].includes(typeof t))return Ar.warn(Sr(`Expected string, got ${typeof t}: ${t}`)),String(t);throw new TypeError(`Expected string, got ${typeof t}: ${t}`)}},Av=t=>{if(t==null)return;const e=Qu(t),n=Object.entries(e).filter(([,r])=>r!=null).map(([r])=>r);if(n.length===0)throw new TypeError("Unions must have exactly one non-null member. None were found.");if(n.length>1)throw new TypeError(`Unions must have exactly one non-null member. Keys ${n} were not null.`);return e},Ji=t=>typeof t=="string"?Cv(t):_v(t),Cv=t=>{switch(t){case"NaN":return NaN;case"Infinity":return 1/0;case"-Infinity":return-1/0;default:throw new Error(`Unable to parse float value: ${t}`)}},Sr=t=>String(new TypeError(t).stack||t).split(`
`).slice(0,5).filter(e=>!e.includes("stackTraceWarning")).join(`
`),Ar={warn:console.warn},Tv=(t,e,n,r,s,o)=>{if(e!=null&&e[n]!==void 0){const i=r();if(i.length<=0)throw new Error("Empty value provided for input HTTP label: "+n+".");t=t.replace(s,o?i.split("/").map(a=>zi(a)).join("/"):zi(i))}else throw new Error("No value provided for input HTTP label: "+n+".");return t};function Io(t,e){return new Iv(t,e)}class Iv{constructor(e,n){this.input=e,this.context=n,this.query={},this.method="",this.headers={},this.path="",this.body=null,this.hostname="",this.resolvePathStack=[]}async build(){const{hostname:e,protocol:n="https",port:r,path:s}=await this.context.endpoint();this.path=s;for(const o of this.resolvePathStack)o(this.path);return new Te({protocol:n,hostname:this.hostname||e,port:r,method:this.method,path:this.path,query:this.query,body:this.body,headers:this.headers})}hn(e){return this.hostname=e,this}bp(e){return this.resolvePathStack.push(n=>{this.path=`${n?.endsWith("/")?n.slice(0,-1):n||""}`+e}),this}p(e,n,r,s){return this.resolvePathStack.push(o=>{this.path=Tv(o,this.input,e,n,r,s)}),this}h(e){return this.headers=e,this}q(e){return this.query=e,this}b(e){return this.body=e,this}m(e){return this.method=e,this}}function Rv(t,e,n){t.__smithy_context?t.__smithy_context.features||(t.__smithy_context.features={}):t.__smithy_context={features:{}},t.__smithy_context.features[e]=n}class $v{constructor(e){this.authSchemes=new Map;for(const[n,r]of Object.entries(e))r!==void 0&&this.authSchemes.set(n,r)}getIdentityProvider(e){return this.authSchemes.get(e)}}class Ov{async sign(e,n,r){const s=Te.clone(e);if(!n.token)throw new Error("request could not be signed with `token` since the `token` is not defined");return s.headers.Authorization=`Bearer ${n.token}`,s}}const Bv=t=>e=>Ro(e)&&e.expiration.getTime()-Date.now()<t,Pv=3e5,Xu=Bv(Pv),Ro=t=>t.expiration!==void 0,ed=(t,e,n)=>{if(t===void 0)return;const r=typeof t!="function"?async()=>Promise.resolve(t):t;let s,o,i,a=!1;const l=async c=>{o||(o=r(c));try{s=await o,i=!0,a=!1}finally{o=void 0}return s};return e===void 0?async c=>((!i||c?.forceRefresh)&&(s=await l(c)),s):async c=>((!i||c?.forceRefresh)&&(s=await l(c)),a?s:n(s)?(e(s)&&await l(c),s):(a=!0,s))},Nv=void 0;function Mv(t){return t===void 0?!0:typeof t=="string"&&t.length<=50}function Dv(t){const e=mn(t.userAgentAppId??Nv),{customUserAgent:n}=t;return Object.assign(t,{customUserAgent:typeof n=="string"?[[n]]:n,userAgentAppId:async()=>{const r=await e();if(!Mv(r)){const s=t.logger?.constructor?.name==="NoOpLogger"||!t.logger?console:t.logger;typeof r!="string"?s?.warn("userAgentAppId must be a string or undefined."):r.length>50&&s?.warn("The provided userAgentAppId exceeds the maximum length of 50 characters.")}return r}})}class Uv{constructor({size:e,params:n}){this.data=new Map,this.parameters=[],this.capacity=e??50,n&&(this.parameters=n)}get(e,n){const r=this.hash(e);if(r===!1)return n();if(!this.data.has(r)){if(this.data.size>this.capacity+10){const s=this.data.keys();let o=0;for(;;){const{value:i,done:a}=s.next();if(this.data.delete(i),a||++o>10)break}}this.data.set(r,n())}return this.data.get(r)}size(){return this.data.size}hash(e){let n="";const{parameters:r}=this;if(r.length===0)return!1;for(const s of r){const o=String(e[s]??"");if(o.includes("|;"))return!1;n+=o+"|;"}return n}}const Lv=new RegExp("^(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}$"),td=t=>Lv.test(t)||t.startsWith("[")&&t.endsWith("]"),Fv=new RegExp("^(?!.*-$)(?!-)[a-zA-Z0-9-]{1,63}$"),$o=(t,e=!1)=>{if(!e)return Fv.test(t);const n=t.split(".");for(const r of n)if(!$o(r))return!1;return!0},Cr={},Sn="endpoints";function At(t){return typeof t!="object"||t==null?t:"ref"in t?`$${At(t.ref)}`:"fn"in t?`${t.fn}(${(t.argv||[]).map(At).join(", ")})`:JSON.stringify(t,null,2)}class Ne extends Error{constructor(e){super(e),this.name="EndpointError"}}const jv=(t,e)=>t===e,Hv=t=>{const e=t.split("."),n=[];for(const r of e){const s=r.indexOf("[");if(s!==-1){if(r.indexOf("]")!==r.length-1)throw new Ne(`Path: '${t}' does not end with ']'`);const o=r.slice(s+1,-1);if(Number.isNaN(parseInt(o)))throw new Ne(`Invalid array index: '${o}' in path: '${t}'`);s!==0&&n.push(r.slice(0,s)),n.push(o)}else n.push(r)}return n},nd=(t,e)=>Hv(e).reduce((n,r)=>{if(typeof n!="object")throw new Ne(`Index '${r}' in '${e}' not found in '${JSON.stringify(t)}'`);return Array.isArray(n)?n[parseInt(r)]:n[r]},t),Kv=t=>t!=null,Vv=t=>!t,is={[xn.HTTP]:80,[xn.HTTPS]:443},qv=t=>{const e=(()=>{try{if(t instanceof URL)return t;if(typeof t=="object"&&"hostname"in t){const{hostname:p,port:g,protocol:v="",path:b="",query:w={}}=t,S=new URL(`${v}//${p}${g?`:${g}`:""}${b}`);return S.search=Object.entries(w).map(([A,O])=>`${A}=${O}`).join("&"),S}return new URL(t)}catch{return null}})();if(!e)return console.error(`Unable to parse ${JSON.stringify(t)} as a whatwg URL.`),null;const n=e.href,{host:r,hostname:s,pathname:o,protocol:i,search:a}=e;if(a)return null;const l=i.slice(0,-1);if(!Object.values(xn).includes(l))return null;const c=td(s),d=n.includes(`${r}:${is[l]}`)||typeof t=="string"&&t.includes(`${r}:${is[l]}`),h=`${r}${d?`:${is[l]}`:""}`;return{scheme:l,authority:h,path:o,normalizedPath:o.endsWith("/")?o:`${o}/`,isIp:c}},Gv=(t,e)=>t===e,zv=(t,e,n,r)=>e>=n||t.length<n?null:r?t.substring(t.length-n,t.length-e):t.substring(e,n),Jv=t=>encodeURIComponent(t).replace(/[!*'()]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`),Wv={booleanEquals:jv,getAttr:nd,isSet:Kv,isValidHostLabel:$o,not:Vv,parseURL:qv,stringEquals:Gv,substring:zv,uriEncode:Jv},rd=(t,e)=>{const n=[],r={...e.endpointParams,...e.referenceRecord};let s=0;for(;s<t.length;){const o=t.indexOf("{",s);if(o===-1){n.push(t.slice(s));break}n.push(t.slice(s,o));const i=t.indexOf("}",o);if(i===-1){n.push(t.slice(o));break}t[o+1]==="{"&&t[i+1]==="}"&&(n.push(t.slice(o+1,i)),s=i+2);const a=t.substring(o+1,i);if(a.includes("#")){const[l,c]=a.split("#");n.push(nd(r[l],c))}else n.push(r[a]);s=i+1}return n.join("")},Zv=({ref:t},e)=>({...e.endpointParams,...e.referenceRecord})[t],Ur=(t,e,n)=>{if(typeof t=="string")return rd(t,n);if(t.fn)return sd(t,n);if(t.ref)return Zv(t,n);throw new Ne(`'${e}': ${String(t)} is not a string, function or reference.`)},sd=({fn:t,argv:e},n)=>{const r=e.map(o=>["boolean","number"].includes(typeof o)?o:Ur(o,"arg",n)),s=t.split(".");return s[0]in Cr&&s[1]!=null?Cr[s[0]][s[1]](...r):Wv[t](...r)},Yv=({assign:t,...e},n)=>{if(t&&t in n.referenceRecord)throw new Ne(`'${t}' is already defined in Reference Record.`);const r=sd(e,n);return n.logger?.debug?.(`${Sn} evaluateCondition: ${At(e)} = ${At(r)}`),{result:r===""?!0:!!r,...t!=null&&{toAssign:{name:t,value:r}}}},Oo=(t=[],e)=>{const n={};for(const r of t){const{result:s,toAssign:o}=Yv(r,{...e,referenceRecord:{...e.referenceRecord,...n}});if(!s)return{result:s};o&&(n[o.name]=o.value,e.logger?.debug?.(`${Sn} assign: ${o.name} := ${At(o.value)}`))}return{result:!0,referenceRecord:n}},Qv=(t,e)=>Object.entries(t).reduce((n,[r,s])=>({...n,[r]:s.map(o=>{const i=Ur(o,"Header value entry",e);if(typeof i!="string")throw new Ne(`Header '${r}' value '${i}' is not a string`);return i})}),{}),od=(t,e)=>{if(Array.isArray(t))return t.map(n=>od(n,e));switch(typeof t){case"string":return rd(t,e);case"object":if(t===null)throw new Ne(`Unexpected endpoint property: ${t}`);return id(t,e);case"boolean":return t;default:throw new Ne(`Unexpected endpoint property type: ${typeof t}`)}},id=(t,e)=>Object.entries(t).reduce((n,[r,s])=>({...n,[r]:od(s,e)}),{}),Xv=(t,e)=>{const n=Ur(t,"Endpoint URL",e);if(typeof n=="string")try{return new URL(n)}catch(r){throw console.error(`Failed to construct URL with ${n}`,r),r}throw new Ne(`Endpoint URL must be a string, got ${typeof n}`)},ew=(t,e)=>{const{conditions:n,endpoint:r}=t,{result:s,referenceRecord:o}=Oo(n,e);if(!s)return;const i={...e,referenceRecord:{...e.referenceRecord,...o}},{url:a,properties:l,headers:c}=r;return e.logger?.debug?.(`${Sn} Resolving endpoint from template: ${At(r)}`),{...c!=null&&{headers:Qv(c,i)},...l!=null&&{properties:id(l,i)},url:Xv(a,i)}},tw=(t,e)=>{const{conditions:n,error:r}=t,{result:s,referenceRecord:o}=Oo(n,e);if(s)throw new Ne(Ur(r,"Error",{...e,referenceRecord:{...e.referenceRecord,...o}}))},nw=(t,e)=>{const{conditions:n,rules:r}=t,{result:s,referenceRecord:o}=Oo(n,e);if(s)return ad(r,{...e,referenceRecord:{...e.referenceRecord,...o}})},ad=(t,e)=>{for(const n of t)if(n.type==="endpoint"){const r=ew(n,e);if(r)return r}else if(n.type==="error")tw(n,e);else if(n.type==="tree"){const r=nw(n,e);if(r)return r}else throw new Ne(`Unknown endpoint rule: ${n}`);throw new Ne("Rules evaluation failed")},rw=(t,e)=>{const{endpointParams:n,logger:r}=e,{parameters:s,rules:o}=t;e.logger?.debug?.(`${Sn} Initial EndpointParams: ${At(n)}`);const i=Object.entries(s).filter(([,c])=>c.default!=null).map(([c,d])=>[c,d.default]);if(i.length>0)for(const[c,d]of i)n[c]=n[c]??d;const a=Object.entries(s).filter(([,c])=>c.required).map(([c])=>c);for(const c of a)if(n[c]==null)throw new Ne(`Missing required parameter: '${c}'`);const l=ad(o,{endpointParams:n,logger:r,referenceRecord:{}});return e.logger?.debug?.(`${Sn} Resolved endpoint: ${At(l)}`),l},cd=(t,e=!1)=>{if(e){for(const n of t.split("."))if(!cd(n))return!1;return!0}return!(!$o(t)||t.length<3||t.length>63||t!==t.toLowerCase()||td(t))},Wi=":",sw="/",ow=t=>{const e=t.split(Wi);if(e.length<6)return null;const[n,r,s,o,i,...a]=e;if(n!=="arn"||r===""||s===""||a.join(Wi)==="")return null;const l=a.map(c=>c.split(sw)).flat();return{partition:r,service:s,region:o,accountId:i,resourceId:l}},iw=[{id:"aws",outputs:{dnsSuffix:"amazonaws.com",dualStackDnsSuffix:"api.aws",implicitGlobalRegion:"us-east-1",name:"aws",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^(us|eu|ap|sa|ca|me|af|il|mx)\\-\\w+\\-\\d+$",regions:{"af-south-1":{description:"Africa (Cape Town)"},"ap-east-1":{description:"Asia Pacific (Hong Kong)"},"ap-east-2":{description:"Asia Pacific (Taipei)"},"ap-northeast-1":{description:"Asia Pacific (Tokyo)"},"ap-northeast-2":{description:"Asia Pacific (Seoul)"},"ap-northeast-3":{description:"Asia Pacific (Osaka)"},"ap-south-1":{description:"Asia Pacific (Mumbai)"},"ap-south-2":{description:"Asia Pacific (Hyderabad)"},"ap-southeast-1":{description:"Asia Pacific (Singapore)"},"ap-southeast-2":{description:"Asia Pacific (Sydney)"},"ap-southeast-3":{description:"Asia Pacific (Jakarta)"},"ap-southeast-4":{description:"Asia Pacific (Melbourne)"},"ap-southeast-5":{description:"Asia Pacific (Malaysia)"},"ap-southeast-7":{description:"Asia Pacific (Thailand)"},"aws-global":{description:"AWS Standard global region"},"ca-central-1":{description:"Canada (Central)"},"ca-west-1":{description:"Canada West (Calgary)"},"eu-central-1":{description:"Europe (Frankfurt)"},"eu-central-2":{description:"Europe (Zurich)"},"eu-north-1":{description:"Europe (Stockholm)"},"eu-south-1":{description:"Europe (Milan)"},"eu-south-2":{description:"Europe (Spain)"},"eu-west-1":{description:"Europe (Ireland)"},"eu-west-2":{description:"Europe (London)"},"eu-west-3":{description:"Europe (Paris)"},"il-central-1":{description:"Israel (Tel Aviv)"},"me-central-1":{description:"Middle East (UAE)"},"me-south-1":{description:"Middle East (Bahrain)"},"mx-central-1":{description:"Mexico (Central)"},"sa-east-1":{description:"South America (Sao Paulo)"},"us-east-1":{description:"US East (N. Virginia)"},"us-east-2":{description:"US East (Ohio)"},"us-west-1":{description:"US West (N. California)"},"us-west-2":{description:"US West (Oregon)"}}},{id:"aws-cn",outputs:{dnsSuffix:"amazonaws.com.cn",dualStackDnsSuffix:"api.amazonwebservices.com.cn",implicitGlobalRegion:"cn-northwest-1",name:"aws-cn",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^cn\\-\\w+\\-\\d+$",regions:{"aws-cn-global":{description:"AWS China global region"},"cn-north-1":{description:"China (Beijing)"},"cn-northwest-1":{description:"China (Ningxia)"}}},{id:"aws-us-gov",outputs:{dnsSuffix:"amazonaws.com",dualStackDnsSuffix:"api.aws",implicitGlobalRegion:"us-gov-west-1",name:"aws-us-gov",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^us\\-gov\\-\\w+\\-\\d+$",regions:{"aws-us-gov-global":{description:"AWS GovCloud (US) global region"},"us-gov-east-1":{description:"AWS GovCloud (US-East)"},"us-gov-west-1":{description:"AWS GovCloud (US-West)"}}},{id:"aws-iso",outputs:{dnsSuffix:"c2s.ic.gov",dualStackDnsSuffix:"c2s.ic.gov",implicitGlobalRegion:"us-iso-east-1",name:"aws-iso",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-iso\\-\\w+\\-\\d+$",regions:{"aws-iso-global":{description:"AWS ISO (US) global region"},"us-iso-east-1":{description:"US ISO East"},"us-iso-west-1":{description:"US ISO WEST"}}},{id:"aws-iso-b",outputs:{dnsSuffix:"sc2s.sgov.gov",dualStackDnsSuffix:"sc2s.sgov.gov",implicitGlobalRegion:"us-isob-east-1",name:"aws-iso-b",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-isob\\-\\w+\\-\\d+$",regions:{"aws-iso-b-global":{description:"AWS ISOB (US) global region"},"us-isob-east-1":{description:"US ISOB East (Ohio)"}}},{id:"aws-iso-e",outputs:{dnsSuffix:"cloud.adc-e.uk",dualStackDnsSuffix:"cloud.adc-e.uk",implicitGlobalRegion:"eu-isoe-west-1",name:"aws-iso-e",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^eu\\-isoe\\-\\w+\\-\\d+$",regions:{"aws-iso-e-global":{description:"AWS ISOE (Europe) global region"},"eu-isoe-west-1":{description:"EU ISOE West"}}},{id:"aws-iso-f",outputs:{dnsSuffix:"csp.hci.ic.gov",dualStackDnsSuffix:"csp.hci.ic.gov",implicitGlobalRegion:"us-isof-south-1",name:"aws-iso-f",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-isof\\-\\w+\\-\\d+$",regions:{"aws-iso-f-global":{description:"AWS ISOF global region"},"us-isof-east-1":{description:"US ISOF EAST"},"us-isof-south-1":{description:"US ISOF SOUTH"}}},{id:"aws-eusc",outputs:{dnsSuffix:"amazonaws.eu",dualStackDnsSuffix:"amazonaws.eu",implicitGlobalRegion:"eusc-de-east-1",name:"aws-eusc",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^eusc\\-(de)\\-\\w+\\-\\d+$",regions:{"eusc-de-east-1":{description:"EU (Germany)"}}}],aw={partitions:iw};let cw=aw;const lw=t=>{const{partitions:e}=cw;for(const r of e){const{regions:s,outputs:o}=r;for(const[i,a]of Object.entries(s))if(i===t)return{...o,...a}}for(const r of e){const{regionRegex:s,outputs:o}=r;if(new RegExp(s).test(t))return{...o}}const n=e.find(r=>r.id==="aws");if(!n)throw new Error("Provided region was not found in the partition array or regex, and default partition with id 'aws' doesn't exist.");return{...n.outputs}},ld={isVirtualHostableS3Bucket:cd,parseArn:ow,partition:lw};Cr.aws=ld;function uw(t){const e={};if(t=t.replace(/^\?/,""),t)for(const n of t.split("&")){let[r,s=null]=n.split("=");r=decodeURIComponent(r),s&&(s=decodeURIComponent(s)),r in e?Array.isArray(e[r])?e[r].push(s):e[r]=[e[r],s]:e[r]=s}return e}const Tr=t=>{if(typeof t=="string")return Tr(new URL(t));const{hostname:e,pathname:n,port:r,protocol:s,search:o}=t;let i;return o&&(i=uw(o)),{hostname:e,port:r?parseInt(r):void 0,protocol:s,path:n,query:i}};function dw(t,e,n){return t.$source||(t.$source={}),t.$source[e]=n,t}function ze(t,e,n){t.__aws_sdk_context?t.__aws_sdk_context.features||(t.__aws_sdk_context.features={}):t.__aws_sdk_context={features:{}},t.__aws_sdk_context.features[e]=n}const Zi=t=>Xt.isInstance(t)?t.headers?.date??t.headers?.Date:void 0,ud=t=>new Date(Date.now()+t),fw=(t,e)=>Math.abs(ud(e).getTime()-t)>=3e5,Yi=(t,e)=>{const n=Date.parse(t);return fw(n,e)?n-Date.now():e},yn=(t,e)=>{if(!e)throw new Error(`Property \`${t}\` is not resolved for AWS SDK SigV4Auth`);return e},pw=async t=>{const e=yn("context",t.context),n=yn("config",t.config),r=e.endpointV2?.properties?.authSchemes?.[0],o=await yn("signer",n.signer)(r),i=t?.signingRegion,a=t?.signingRegionSet,l=t?.signingName;return{config:n,signer:o,signingRegion:i,signingRegionSet:a,signingName:l}};class hw{async sign(e,n,r){if(!Te.isInstance(e))throw new Error("The request is not an instance of `HttpRequest` and cannot be signed");const s=await pw(r),{config:o,signer:i}=s;let{signingRegion:a,signingName:l}=s;const c=r.context;if(c?.authSchemes?.length??!1){const[h,p]=c.authSchemes;h?.name==="sigv4a"&&p?.name==="sigv4"&&(a=p?.signingRegion??a,l=p?.signingName??l)}return await i.sign(e,{signingDate:ud(o.systemClockOffset),signingRegion:a,signingService:l})}errorHandler(e){return n=>{const r=n.ServerTime??Zi(n.$response);if(r){const s=yn("config",e.config),o=s.systemClockOffset;s.systemClockOffset=Yi(r,s.systemClockOffset),s.systemClockOffset!==o&&n.$metadata&&(n.$metadata.clockSkewCorrected=!0)}throw n}}successHandler(e,n){const r=Zi(e);if(r){const s=yn("config",n.config);s.systemClockOffset=Yi(r,s.systemClockOffset)}}}const mw=(t,e,n)=>{let r,s,o,i=!1;const a=async()=>{s||(s=t());try{r=await s,o=!0,i=!1}finally{s=void 0}return r};return async l=>((!o||l?.forceRefresh)&&(r=await a()),r)},gw="X-Amz-Algorithm",yw="X-Amz-Credential",dd="X-Amz-Date",vw="X-Amz-SignedHeaders",ww="X-Amz-Expires",fd="X-Amz-Signature",pd="X-Amz-Security-Token",hd="authorization",md=dd.toLowerCase(),bw="date",_w=[hd,md,bw],xw=fd.toLowerCase(),Ws="x-amz-content-sha256",Ew=pd.toLowerCase(),kw={authorization:!0,"cache-control":!0,connection:!0,expect:!0,from:!0,"keep-alive":!0,"max-forwards":!0,pragma:!0,referer:!0,te:!0,trailer:!0,"transfer-encoding":!0,upgrade:!0,"user-agent":!0,"x-amzn-trace-id":!0},Sw=/^proxy-/,Aw=/^sec-/,as="AWS4-HMAC-SHA256",Cw="AWS4-HMAC-SHA256-PAYLOAD",Tw="UNSIGNED-PAYLOAD",Iw=50,gd="aws4_request",Rw=60*60*24*7,jn={},cs=[],ls=(t,e,n)=>`${t}/${e}/${n}/${gd}`,$w=async(t,e,n,r,s)=>{const o=await Qi(t,e.secretAccessKey,e.accessKeyId),i=`${n}:${r}:${s}:${Be(o)}:${e.sessionToken}`;if(i in jn)return jn[i];for(cs.push(i);cs.length>Iw;)delete jn[cs.shift()];let a=`AWS4${e.secretAccessKey}`;for(const l of[n,r,s,gd])a=await Qi(t,a,l);return jn[i]=a},Qi=(t,e,n)=>{const r=new t(e);return r.update(En(n)),r.digest()},Xi=({headers:t},e,n)=>{const r={};for(const s of Object.keys(t).sort()){if(t[s]==null)continue;const o=s.toLowerCase();(o in kw||e?.has(o)||Sw.test(o)||Aw.test(o))&&(!n||n&&!n.has(o))||(r[o]=t[s].trim().replace(/\s+/g," "))}return r},Ow=t=>typeof ArrayBuffer=="function"&&t instanceof ArrayBuffer||Object.prototype.toString.call(t)==="[object ArrayBuffer]",us=async({headers:t,body:e},n)=>{for(const r of Object.keys(t))if(r.toLowerCase()===Ws)return t[r];if(e==null)return"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855";if(typeof e=="string"||ArrayBuffer.isView(e)||Ow(e)){const r=new n;return r.update(En(e)),Be(await r.digest())}return Tw};class Bw{format(e){const n=[];for(const o of Object.keys(e)){const i=en(o);n.push(Uint8Array.from([i.byteLength]),i,this.formatHeaderValue(e[o]))}const r=new Uint8Array(n.reduce((o,i)=>o+i.byteLength,0));let s=0;for(const o of n)r.set(o,s),s+=o.byteLength;return r}formatHeaderValue(e){switch(e.type){case"boolean":return Uint8Array.from([e.value?0:1]);case"byte":return Uint8Array.from([2,e.value]);case"short":const n=new DataView(new ArrayBuffer(3));return n.setUint8(0,3),n.setInt16(1,e.value,!1),new Uint8Array(n.buffer);case"integer":const r=new DataView(new ArrayBuffer(5));return r.setUint8(0,4),r.setInt32(1,e.value,!1),new Uint8Array(r.buffer);case"long":const s=new Uint8Array(9);return s[0]=5,s.set(e.value.bytes,1),s;case"binary":const o=new DataView(new ArrayBuffer(3+e.value.byteLength));o.setUint8(0,6),o.setUint16(1,e.value.byteLength,!1);const i=new Uint8Array(o.buffer);return i.set(e.value,3),i;case"string":const a=en(e.value),l=new DataView(new ArrayBuffer(3+a.byteLength));l.setUint8(0,7),l.setUint16(1,a.byteLength,!1);const c=new Uint8Array(l.buffer);return c.set(a,3),c;case"timestamp":const d=new Uint8Array(9);return d[0]=8,d.set(Nw.fromNumber(e.value.valueOf()).bytes,1),d;case"uuid":if(!Pw.test(e.value))throw new Error(`Invalid UUID received: ${e.value}`);const h=new Uint8Array(17);return h[0]=9,h.set(Co(e.value.replace(/\-/g,"")),1),h}}}var ea;(function(t){t[t.boolTrue=0]="boolTrue",t[t.boolFalse=1]="boolFalse",t[t.byte=2]="byte",t[t.short=3]="short",t[t.integer=4]="integer",t[t.long=5]="long",t[t.byteArray=6]="byteArray",t[t.string=7]="string",t[t.timestamp=8]="timestamp",t[t.uuid=9]="uuid"})(ea||(ea={}));const Pw=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/;let Nw=class yd{constructor(e){if(this.bytes=e,e.byteLength!==8)throw new Error("Int64 buffers must be exactly 8 bytes")}static fromNumber(e){if(e>9223372036854776e3||e<-9223372036854776e3)throw new Error(`${e} is too large (or, if negative, too small) to represent as an Int64`);const n=new Uint8Array(8);for(let r=7,s=Math.abs(Math.round(e));r>-1&&s>0;r--,s/=256)n[r]=s;return e<0&&ta(n),new yd(n)}valueOf(){const e=this.bytes.slice(0),n=e[0]&128;return n&&ta(e),parseInt(Be(e),16)*(n?-1:1)}toString(){return String(this.valueOf())}};function ta(t){for(let e=0;e<8;e++)t[e]^=255;for(let e=7;e>-1&&(t[e]++,t[e]===0);e--);}const Mw=(t,e)=>{t=t.toLowerCase();for(const n of Object.keys(e))if(t===n.toLowerCase())return!0;return!1},Dw=(t,e={})=>{const{headers:n,query:r={}}=Te.clone(t);for(const s of Object.keys(n)){const o=s.toLowerCase();(o.slice(0,6)==="x-amz-"&&!e.unhoistableHeaders?.has(o)||e.hoistableHeaders?.has(o))&&(r[s]=n[s],delete n[s])}return{...t,headers:n,query:r}},na=t=>{t=Te.clone(t);for(const e of Object.keys(t.headers))_w.indexOf(e.toLowerCase())>-1&&delete t.headers[e];return t},Uw=({query:t={}})=>{const e=[],n={};for(const r of Object.keys(t)){if(r.toLowerCase()===xw)continue;const s=Pt(r);e.push(s);const o=t[r];typeof o=="string"?n[s]=`${s}=${Pt(o)}`:Array.isArray(o)&&(n[s]=o.slice(0).reduce((i,a)=>i.concat([`${s}=${Pt(a)}`]),[]).sort().join("&"))}return e.sort().map(r=>n[r]).filter(r=>r).join("&")},Lw=t=>Fw(t).toISOString().replace(/\.\d{3}Z$/,"Z"),Fw=t=>typeof t=="number"?new Date(t*1e3):typeof t=="string"?Number(t)?new Date(Number(t)*1e3):new Date(t):t;class jw{constructor({applyChecksum:e,credentials:n,region:r,service:s,sha256:o,uriEscapePath:i=!0}){this.service=s,this.sha256=o,this.uriEscapePath=i,this.applyChecksum=typeof e=="boolean"?e:!0,this.regionProvider=ft(r),this.credentialProvider=ft(n)}createCanonicalRequest(e,n,r){const s=Object.keys(n).sort();return`${e.method}
${this.getCanonicalPath(e)}
${Uw(e)}
${s.map(o=>`${o}:${n[o]}`).join(`
`)}

${s.join(";")}
${r}`}async createStringToSign(e,n,r,s){const o=new this.sha256;o.update(En(r));const i=await o.digest();return`${s}
${e}
${n}
${Be(i)}`}getCanonicalPath({path:e}){if(this.uriEscapePath){const n=[];for(const o of e.split("/"))o?.length!==0&&o!=="."&&(o===".."?n.pop():n.push(o));const r=`${e?.startsWith("/")?"/":""}${n.join("/")}${n.length>0&&e?.endsWith("/")?"/":""}`;return Pt(r).replace(/%2F/g,"/")}return e}validateResolvedCredentials(e){if(typeof e!="object"||typeof e.accessKeyId!="string"||typeof e.secretAccessKey!="string")throw new Error("Resolved credential object is not valid")}formatDate(e){const n=Lw(e).replace(/[\-:]/g,"");return{longDate:n,shortDate:n.slice(0,8)}}getCanonicalHeaderList(e){return Object.keys(e).sort().join(";")}}class ra extends jw{constructor({applyChecksum:e,credentials:n,region:r,service:s,sha256:o,uriEscapePath:i=!0}){super({applyChecksum:e,credentials:n,region:r,service:s,sha256:o,uriEscapePath:i}),this.headerFormatter=new Bw}async presign(e,n={}){const{signingDate:r=new Date,expiresIn:s=3600,unsignableHeaders:o,unhoistableHeaders:i,signableHeaders:a,hoistableHeaders:l,signingRegion:c,signingService:d}=n,h=await this.credentialProvider();this.validateResolvedCredentials(h);const p=c??await this.regionProvider(),{longDate:g,shortDate:v}=this.formatDate(r);if(s>Rw)return Promise.reject("Signature version 4 presigned URLs must have an expiration date less than one week in the future");const b=ls(v,p,d??this.service),w=Dw(na(e),{unhoistableHeaders:i,hoistableHeaders:l});h.sessionToken&&(w.query[pd]=h.sessionToken),w.query[gw]=as,w.query[yw]=`${h.accessKeyId}/${b}`,w.query[dd]=g,w.query[ww]=s.toString(10);const S=Xi(w,o,a);return w.query[vw]=this.getCanonicalHeaderList(S),w.query[fd]=await this.getSignature(g,b,this.getSigningKey(h,p,v,d),this.createCanonicalRequest(w,S,await us(e,this.sha256))),w}async sign(e,n){return typeof e=="string"?this.signString(e,n):e.headers&&e.payload?this.signEvent(e,n):e.message?this.signMessage(e,n):this.signRequest(e,n)}async signEvent({headers:e,payload:n},{signingDate:r=new Date,priorSignature:s,signingRegion:o,signingService:i}){const a=o??await this.regionProvider(),{shortDate:l,longDate:c}=this.formatDate(r),d=ls(l,a,i??this.service),h=await us({headers:{},body:n},this.sha256),p=new this.sha256;p.update(e);const g=Be(await p.digest()),v=[Cw,c,d,s,g,h].join(`
`);return this.signString(v,{signingDate:r,signingRegion:a,signingService:i})}async signMessage(e,{signingDate:n=new Date,signingRegion:r,signingService:s}){return this.signEvent({headers:this.headerFormatter.format(e.message.headers),payload:e.message.body},{signingDate:n,signingRegion:r,signingService:s,priorSignature:e.priorSignature}).then(i=>({message:e.message,signature:i}))}async signString(e,{signingDate:n=new Date,signingRegion:r,signingService:s}={}){const o=await this.credentialProvider();this.validateResolvedCredentials(o);const i=r??await this.regionProvider(),{shortDate:a}=this.formatDate(n),l=new this.sha256(await this.getSigningKey(o,i,a,s));return l.update(En(e)),Be(await l.digest())}async signRequest(e,{signingDate:n=new Date,signableHeaders:r,unsignableHeaders:s,signingRegion:o,signingService:i}={}){const a=await this.credentialProvider();this.validateResolvedCredentials(a);const l=o??await this.regionProvider(),c=na(e),{longDate:d,shortDate:h}=this.formatDate(n),p=ls(h,l,i??this.service);c.headers[md]=d,a.sessionToken&&(c.headers[Ew]=a.sessionToken);const g=await us(c,this.sha256);!Mw(Ws,c.headers)&&this.applyChecksum&&(c.headers[Ws]=g);const v=Xi(c,s,r),b=await this.getSignature(d,p,this.getSigningKey(a,l,h,i),this.createCanonicalRequest(c,v,g));return c.headers[hd]=`${as} Credential=${a.accessKeyId}/${p}, SignedHeaders=${this.getCanonicalHeaderList(v)}, Signature=${b}`,c}async getSignature(e,n,r,s){const o=await this.createStringToSign(e,n,s,as),i=new this.sha256(await r);return i.update(En(o)),Be(await i.digest())}getSigningKey(e,n,r,s){return $w(this.sha256,e,r,n,s||this.service)}}const Hw=t=>{let e=t.credentials,n=!!t.credentials,r;Object.defineProperty(t,"credentials",{set(c){c&&c!==e&&c!==r&&(n=!0),e=c;const d=Kw(t,{credentials:e,credentialDefaultProvider:t.credentialDefaultProvider}),h=Vw(t,d);n&&!h.attributed?(r=async p=>h(p).then(g=>dw(g,"CREDENTIALS_CODE","e")),r.memoized=h.memoized,r.configBound=h.configBound,r.attributed=!0):r=h},get(){return r},enumerable:!0,configurable:!0}),t.credentials=e;const{signingEscapePath:s=!0,systemClockOffset:o=t.systemClockOffset||0,sha256:i}=t;let a;return t.signer?a=mn(t.signer):t.regionInfoProvider?a=()=>mn(t.region)().then(async c=>[await t.regionInfoProvider(c,{useFipsEndpoint:await t.useFipsEndpoint(),useDualstackEndpoint:await t.useDualstackEndpoint()})||{},c]).then(([c,d])=>{const{signingRegion:h,signingService:p}=c;t.signingRegion=t.signingRegion||h||d,t.signingName=t.signingName||p||t.serviceId;const g={...t,credentials:t.credentials,region:t.signingRegion,service:t.signingName,sha256:i,uriEscapePath:s},v=t.signerConstructor||ra;return new v(g)}):a=async c=>{c=Object.assign({},{name:"sigv4",signingName:t.signingName||t.defaultSigningName,signingRegion:await mn(t.region)(),properties:{}},c);const d=c.signingRegion,h=c.signingName;t.signingRegion=t.signingRegion||d,t.signingName=t.signingName||h||t.serviceId;const p={...t,credentials:t.credentials,region:t.signingRegion,service:t.signingName,sha256:i,uriEscapePath:s},g=t.signerConstructor||ra;return new g(p)},Object.assign(t,{systemClockOffset:o,signingEscapePath:s,signer:a})};function Kw(t,{credentials:e,credentialDefaultProvider:n}){let r;return e?e?.memoized?r=e:r=ed(e,Xu,Ro):n?r=mn(n(Object.assign({},t,{parentClientConfig:t}))):r=async()=>{throw new Error("@aws-sdk/core::resolveAwsSdkSigV4Config - `credentials` not provided and no credentialDefaultProvider was configured.")},r.memoized=!0,r}function Vw(t,e){if(e.configBound)return e;const n=async r=>e({...r,callerClientConfig:t});return n.memoized=e.memoized,n.configBound=!0,n}const sa=typeof TextEncoder=="function"?new TextEncoder:null,qw=t=>{if(typeof t=="string"){if(sa)return sa.encode(t).byteLength;let e=t.length;for(let n=e-1;n>=0;n--){const r=t.charCodeAt(n);r>127&&r<=2047?e++:r>2047&&r<=65535&&(e+=2),r>=56320&&r<=57343&&n--}return e}else{if(typeof t.byteLength=="number")return t.byteLength;if(typeof t.size=="number")return t.size}throw new Error(`Body Length computation failed for ${t}`)},It=(t,e)=>{const n=[];if(t&&n.push(t),e)for(const r of e)n.push(r);return n},gt=(t,e)=>`${t||"anonymous"}${e&&e.length>0?` (a.k.a. ${e.join(",")})`:""}`,Ir=()=>{let t=[],e=[],n=!1;const r=new Set,s=h=>h.sort((p,g)=>oa[g.step]-oa[p.step]||ia[g.priority||"normal"]-ia[p.priority||"normal"]),o=h=>{let p=!1;const g=v=>{const b=It(v.name,v.aliases);if(b.includes(h)){p=!0;for(const w of b)r.delete(w);return!1}return!0};return t=t.filter(g),e=e.filter(g),p},i=h=>{let p=!1;const g=v=>{if(v.middleware===h){p=!0;for(const b of It(v.name,v.aliases))r.delete(b);return!1}return!0};return t=t.filter(g),e=e.filter(g),p},a=h=>(t.forEach(p=>{h.add(p.middleware,{...p})}),e.forEach(p=>{h.addRelativeTo(p.middleware,{...p})}),h.identifyOnResolve?.(d.identifyOnResolve()),h),l=h=>{const p=[];return h.before.forEach(g=>{g.before.length===0&&g.after.length===0?p.push(g):p.push(...l(g))}),p.push(h),h.after.reverse().forEach(g=>{g.before.length===0&&g.after.length===0?p.push(g):p.push(...l(g))}),p},c=(h=!1)=>{const p=[],g=[],v={};return t.forEach(w=>{const S={...w,before:[],after:[]};for(const A of It(S.name,S.aliases))v[A]=S;p.push(S)}),e.forEach(w=>{const S={...w,before:[],after:[]};for(const A of It(S.name,S.aliases))v[A]=S;g.push(S)}),g.forEach(w=>{if(w.toMiddleware){const S=v[w.toMiddleware];if(S===void 0){if(h)return;throw new Error(`${w.toMiddleware} is not found when adding ${gt(w.name,w.aliases)} middleware ${w.relation} ${w.toMiddleware}`)}w.relation==="after"&&S.after.push(w),w.relation==="before"&&S.before.push(w)}}),s(p).map(l).reduce((w,S)=>(w.push(...S),w),[])},d={add:(h,p={})=>{const{name:g,override:v,aliases:b}=p,w={step:"initialize",priority:"normal",middleware:h,...p},S=It(g,b);if(S.length>0){if(S.some(A=>r.has(A))){if(!v)throw new Error(`Duplicate middleware name '${gt(g,b)}'`);for(const A of S){const O=t.findIndex($=>$.name===A||$.aliases?.some(F=>F===A));if(O===-1)continue;const B=t[O];if(B.step!==w.step||w.priority!==B.priority)throw new Error(`"${gt(B.name,B.aliases)}" middleware with ${B.priority} priority in ${B.step} step cannot be overridden by "${gt(g,b)}" middleware with ${w.priority} priority in ${w.step} step.`);t.splice(O,1)}}for(const A of S)r.add(A)}t.push(w)},addRelativeTo:(h,p)=>{const{name:g,override:v,aliases:b}=p,w={middleware:h,...p},S=It(g,b);if(S.length>0){if(S.some(A=>r.has(A))){if(!v)throw new Error(`Duplicate middleware name '${gt(g,b)}'`);for(const A of S){const O=e.findIndex($=>$.name===A||$.aliases?.some(F=>F===A));if(O===-1)continue;const B=e[O];if(B.toMiddleware!==w.toMiddleware||B.relation!==w.relation)throw new Error(`"${gt(B.name,B.aliases)}" middleware ${B.relation} "${B.toMiddleware}" middleware cannot be overridden by "${gt(g,b)}" middleware ${w.relation} "${w.toMiddleware}" middleware.`);e.splice(O,1)}}for(const A of S)r.add(A)}e.push(w)},clone:()=>a(Ir()),use:h=>{h.applyToStack(d)},remove:h=>typeof h=="string"?o(h):i(h),removeByTag:h=>{let p=!1;const g=v=>{const{tags:b,name:w,aliases:S}=v;if(b&&b.includes(h)){const A=It(w,S);for(const O of A)r.delete(O);return p=!0,!1}return!0};return t=t.filter(g),e=e.filter(g),p},concat:h=>{const p=a(Ir());return p.use(h),p.identifyOnResolve(n||p.identifyOnResolve()||(h.identifyOnResolve?.()??!1)),p},applyToStack:a,identify:()=>c(!0).map(h=>{const p=h.step??h.relation+" "+h.toMiddleware;return gt(h.name,h.aliases)+" - "+p}),identifyOnResolve(h){return typeof h=="boolean"&&(n=h),n},resolve:(h,p)=>{for(const g of c().map(v=>v.middleware).reverse())h=g(h,p);return n&&console.log(d.identify()),h}};return d},oa={initialize:5,serialize:4,build:3,finalizeRequest:2,deserialize:1},ia={high:3,normal:2,low:1};class Gw{constructor(e){this.config=e,this.middlewareStack=Ir()}send(e,n,r){const s=typeof n!="function"?n:void 0,o=typeof n=="function"?n:r,i=s===void 0&&this.config.cacheMiddleware===!0;let a;if(i){this.handlers||(this.handlers=new WeakMap);const l=this.handlers;l.has(e.constructor)?a=l.get(e.constructor):(a=e.resolveMiddleware(this.middlewareStack,this.config,s),l.set(e.constructor,a))}else delete this.handlers,a=e.resolveMiddleware(this.middlewareStack,this.config,s);if(o)a(e).then(l=>o(null,l.output),l=>o(l)).catch(()=>{});else return a(e).then(l=>l.output)}destroy(){this.config?.requestHandler?.destroy?.(),delete this.handlers}}class Lr{constructor(){this.middlewareStack=Ir()}static classBuilder(){return new zw}resolveMiddlewareWithContext(e,n,r,{middlewareFn:s,clientName:o,commandName:i,inputFilterSensitiveLog:a,outputFilterSensitiveLog:l,smithyContext:c,additionalContext:d,CommandCtor:h}){for(const w of s.bind(this)(h,e,n,r))this.middlewareStack.use(w);const p=e.concat(this.middlewareStack),{logger:g}=n,v={logger:g,clientName:o,commandName:i,inputFilterSensitiveLog:a,outputFilterSensitiveLog:l,[zs]:{commandInstance:this,...c},...d},{requestHandler:b}=n;return p.resolve(w=>b.handle(w.request,r||{}),v)}}class zw{constructor(){this._init=()=>{},this._ep={},this._middlewareFn=()=>[],this._commandName="",this._clientName="",this._additionalContext={},this._smithyContext={},this._inputFilterSensitiveLog=e=>e,this._outputFilterSensitiveLog=e=>e,this._serializer=null,this._deserializer=null}init(e){this._init=e}ep(e){return this._ep=e,this}m(e){return this._middlewareFn=e,this}s(e,n,r={}){return this._smithyContext={service:e,operation:n,...r},this}c(e={}){return this._additionalContext=e,this}n(e,n){return this._clientName=e,this._commandName=n,this}f(e=r=>r,n=r=>r){return this._inputFilterSensitiveLog=e,this._outputFilterSensitiveLog=n,this}ser(e){return this._serializer=e,this}de(e){return this._deserializer=e,this}sc(e){return this._operationSchema=e,this._smithyContext.operationSchema=e,this}build(){const e=this;let n;return n=class extends Lr{static getEndpointParameterInstructions(){return e._ep}constructor(...[r]){super(),this.serialize=e._serializer,this.deserialize=e._deserializer,this.input=r??{},e._init(this),this.schema=e._operationSchema}resolveMiddleware(r,s,o){return this.resolveMiddlewareWithContext(r,s,o,{CommandCtor:n,middlewareFn:e._middlewareFn,clientName:e._clientName,commandName:e._commandName,inputFilterSensitiveLog:e._inputFilterSensitiveLog,outputFilterSensitiveLog:e._outputFilterSensitiveLog,smithyContext:e._smithyContext,additionalContext:e._additionalContext})}}}}const Ct="***SensitiveInformation***";class Vt extends Error{constructor(e){super(e.message),Object.setPrototypeOf(this,Object.getPrototypeOf(this).constructor.prototype),this.name=e.name,this.$fault=e.$fault,this.$metadata=e.$metadata}static isInstance(e){if(!e)return!1;const n=e;return Vt.prototype.isPrototypeOf(n)||!!n.$fault&&!!n.$metadata&&(n.$fault==="client"||n.$fault==="server")}static[Symbol.hasInstance](e){if(!e)return!1;const n=e;return this===Vt?Vt.isInstance(e):Vt.isInstance(e)?n.name&&this.name?this.prototype.isPrototypeOf(e)||n.name===this.name:this.prototype.isPrototypeOf(e):!1}}const Me=(t,e={})=>{Object.entries(e).filter(([,r])=>r!==void 0).forEach(([r,s])=>{(t[r]==null||t[r]==="")&&(t[r]=s)});const n=t.message||t.Message||"UnknownError";return t.message=n,delete t.Message,t},Jw=({output:t,parsedBody:e,exceptionCtor:n,errorCode:r})=>{const s=Zw(t),o=s.httpStatusCode?s.httpStatusCode+"":void 0,i=new n({name:e?.code||e?.Code||r||o||"UnknownError",$fault:"client",$metadata:s});throw Me(i,e)},Ww=t=>({output:e,parsedBody:n,errorCode:r})=>{Jw({output:e,parsedBody:n,exceptionCtor:t,errorCode:r})},Zw=t=>({httpStatusCode:t.statusCode,requestId:t.headers["x-amzn-requestid"]??t.headers["x-amzn-request-id"]??t.headers["x-amz-request-id"],extendedRequestId:t.headers["x-amz-id-2"],cfId:t.headers["x-amz-cf-id"]}),Yw=t=>{switch(t){case"standard":return{retryMode:"standard",connectionTimeout:3100};case"in-region":return{retryMode:"standard",connectionTimeout:1100};case"cross-region":return{retryMode:"standard",connectionTimeout:3100};case"mobile":return{retryMode:"standard",connectionTimeout:3e4};default:return{}}},Qw=t=>{const e=[];for(const n in kr){const r=kr[n];t[r]!==void 0&&e.push({algorithmId:()=>r,checksumConstructor:()=>t[r]})}return{addChecksumAlgorithm(n){e.push(n)},checksumAlgorithms(){return e}}},Xw=t=>{const e={};return t.checksumAlgorithms().forEach(n=>{e[n.algorithmId()]=n.checksumConstructor()}),e},eb=t=>({setRetryStrategy(e){t.retryStrategy=e},retryStrategy(){return t.retryStrategy}}),tb=t=>{const e={};return e.retryStrategy=t.retryStrategy(),e},nb=t=>Object.assign(Qw(t),eb(t)),rb=t=>Object.assign(Xw(t),tb(t)),sb=t=>t!=null;class vd{trace(){}debug(){}info(){}warn(){}error(){}}function xe(t,e,n){let r,s,o;if(typeof e>"u"&&typeof n>"u")r={},o=t;else{if(r=t,typeof e=="function")return s=e,o=n,ob(r,s,o);o=e}for(const i of Object.keys(o)){if(!Array.isArray(o[i])){r[i]=o[i];continue}wd(r,null,o,i)}return r}const G=(t,e)=>{const n={};for(const r in e)wd(n,t,e,r);return n},ob=(t,e,n)=>xe(t,Object.entries(n).reduce((r,[s,o])=>(Array.isArray(o)?r[s]=o:typeof o=="function"?r[s]=[e,o()]:r[s]=[e,o],r),{})),wd=(t,e,n,r)=>{if(e!==null){let i=n[r];typeof i=="function"&&(i=[,i]);const[a=ib,l=ab,c=r]=i;(typeof a=="function"&&a(e[c])||typeof a!="function"&&a)&&(t[r]=l(e[c]));return}let[s,o]=n[r];if(typeof o=="function"){let i;const a=s===void 0&&(i=o())!=null,l=typeof s=="function"&&!!s(void 0)||typeof s!="function"&&!!s;a?t[r]=i:l&&(t[r]=o())}else{const i=s===void 0&&o!=null,a=typeof s=="function"&&!!s(o)||typeof s!="function"&&!!s;(i||a)&&(t[r]=o)}},ib=t=>t!=null,ab=t=>t,aa=t=>{if(t!==t)return"NaN";switch(t){case 1/0:return"Infinity";case-1/0:return"-Infinity";default:return t}},L=t=>{if(t==null)return{};if(Array.isArray(t))return t.filter(e=>e!=null).map(L);if(typeof t=="object"){const e={};for(const n of Object.keys(t))t[n]!=null&&(e[n]=L(t[n]));return e}return t},cb=(t,e)=>Yu(t,e).then(n=>e.utf8Encoder(n)),De=(t,e)=>cb(t,e).then(n=>{if(n.length)try{return JSON.parse(n)}catch(r){throw r?.name==="SyntaxError"&&Object.defineProperty(r,"$responseBodyText",{value:n}),r}return{}}),lb=async(t,e)=>{const n=await De(t,e);return n.message=n.message??n.Message,n},ub=(t,e)=>{const n=(o,i)=>Object.keys(o).find(a=>a.toLowerCase()===i.toLowerCase()),r=o=>{let i=o;return typeof i=="number"&&(i=i.toString()),i.indexOf(",")>=0&&(i=i.split(",")[0]),i.indexOf(":")>=0&&(i=i.split(":")[0]),i.indexOf("#")>=0&&(i=i.split("#")[1]),i},s=n(t.headers,"x-amzn-errortype");if(s!==void 0)return r(t.headers[s]);if(e&&typeof e=="object"){const o=n(e,"code");if(o&&e[o]!==void 0)return r(e[o]);if(e.__type!==void 0)return r(e.__type)}},Ke=t=>{if(t!=null)return typeof t=="object"&&"__type"in t&&delete t.__type,Av(t)},db=/\d{12}\.ddb/;async function fb(t,e,n){if(n.request?.headers?.["smithy-protocol"]==="rpc-v2-cbor"&&ze(t,"PROTOCOL_RPC_V2_CBOR","M"),typeof e.retryStrategy=="function"){const o=await e.retryStrategy();typeof o.acquireInitialRetryToken=="function"?o.constructor?.name?.includes("Adaptive")?ze(t,"RETRY_MODE_ADAPTIVE","F"):ze(t,"RETRY_MODE_STANDARD","E"):ze(t,"RETRY_MODE_LEGACY","D")}if(typeof e.accountIdEndpointMode=="function"){const o=t.endpointV2;switch(String(o?.url?.hostname).match(db)&&ze(t,"ACCOUNT_ID_ENDPOINT","O"),await e.accountIdEndpointMode?.()){case"disabled":ze(t,"ACCOUNT_ID_MODE_DISABLED","Q");break;case"preferred":ze(t,"ACCOUNT_ID_MODE_PREFERRED","P");break;case"required":ze(t,"ACCOUNT_ID_MODE_REQUIRED","R");break}}const s=t.__smithy_context?.selectedHttpAuthScheme?.identity;if(s?.$source){const o=s;o.accountId&&ze(t,"RESOLVED_ACCOUNT_ID","T");for(const[i,a]of Object.entries(o.$source??{}))ze(t,i,a)}}const ca="user-agent",ds="x-amz-user-agent",la=" ",fs="/",pb=/[^\!\$\%\&\'\*\+\-\.\^\_\`\|\~\d\w]/g,hb=/[^\!\$\%\&\'\*\+\-\.\^\_\`\|\~\d\w\#]/g,ua="-",mb=1024;function gb(t){let e="";for(const n in t){const r=t[n];if(e.length+r.length+1<=mb){e.length?e+=","+r:e+=r;continue}break}return e}const yb=t=>(e,n)=>async r=>{const{request:s}=r;if(!Te.isInstance(s))return e(r);const{headers:o}=s,i=n?.userAgent?.map(Hn)||[],a=(await t.defaultUserAgentProvider()).map(Hn);await fb(n,t,r);const l=n;a.push(`m/${gb(Object.assign({},n.__smithy_context?.features,l.__aws_sdk_context?.features))}`);const c=t?.customUserAgent?.map(Hn)||[],d=await t.userAgentAppId();d&&a.push(Hn([`app/${d}`]));const h=[].concat([...a,...i,...c]).join(la),p=[...a.filter(g=>g.startsWith("aws-sdk-")),...c].join(la);return t.runtime!=="browser"?(p&&(o[ds]=o[ds]?`${o[ca]} ${p}`:p),o[ca]=h):o[ds]=h,e({...r,request:s})},Hn=t=>{const e=t[0].split(fs).map(i=>i.replace(pb,ua)).join(fs),n=t[1]?.replace(hb,ua),r=e.indexOf(fs),s=e.substring(0,r);let o=e.substring(r+1);return s==="api"&&(o=o.toLowerCase()),[s,o,n].filter(i=>i&&i.length>0).reduce((i,a,l)=>{switch(l){case 0:return a;case 1:return`${i}/${a}`;default:return`${i}#${a}`}},"")},vb={name:"getUserAgentMiddleware",step:"build",priority:"low",tags:["SET_USER_AGENT","USER_AGENT"],override:!0},wb=t=>({applyToStack:e=>{e.add(yb(t),vb)}}),bb=t=>new TextEncoder().encode(t);var _b=typeof Ot<"u"&&Ot.from?function(t){return Ot.from(t,"utf8")}:bb;function An(t){return t instanceof Uint8Array?t:typeof t=="string"?_b(t):ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(t)}function Zs(t){return typeof t=="string"?t.length===0:t.byteLength===0}function xb(t){if(!Uint32Array.from){for(var e=new Uint32Array(t.length),n=0;n<t.length;)e[n]=t[n],n+=1;return e}return Uint32Array.from(t)}var bd=function(){function t(){this.checksum=4294967295}return t.prototype.update=function(e){var n,r;try{for(var s=Ef(e),o=s.next();!o.done;o=s.next()){var i=o.value;this.checksum=this.checksum>>>8^kb[(this.checksum^i)&255]}}catch(a){n={error:a}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return this},t.prototype.digest=function(){return(this.checksum^4294967295)>>>0},t}(),Eb=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],kb=xb(Eb);class vn{constructor(e){if(this.bytes=e,e.byteLength!==8)throw new Error("Int64 buffers must be exactly 8 bytes")}static fromNumber(e){if(e>9223372036854776e3||e<-9223372036854776e3)throw new Error(`${e} is too large (or, if negative, too small) to represent as an Int64`);const n=new Uint8Array(8);for(let r=7,s=Math.abs(Math.round(e));r>-1&&s>0;r--,s/=256)n[r]=s;return e<0&&da(n),new vn(n)}valueOf(){const e=this.bytes.slice(0),n=e[0]&128;return n&&da(e),parseInt(Be(e),16)*(n?-1:1)}toString(){return String(this.valueOf())}}function da(t){for(let e=0;e<8;e++)t[e]^=255;for(let e=7;e>-1&&(t[e]++,t[e]===0);e--);}class Sb{constructor(e,n){this.toUtf8=e,this.fromUtf8=n}format(e){const n=[];for(const o of Object.keys(e)){const i=this.fromUtf8(o);n.push(Uint8Array.from([i.byteLength]),i,this.formatHeaderValue(e[o]))}const r=new Uint8Array(n.reduce((o,i)=>o+i.byteLength,0));let s=0;for(const o of n)r.set(o,s),s+=o.byteLength;return r}formatHeaderValue(e){switch(e.type){case"boolean":return Uint8Array.from([e.value?0:1]);case"byte":return Uint8Array.from([2,e.value]);case"short":const n=new DataView(new ArrayBuffer(3));return n.setUint8(0,3),n.setInt16(1,e.value,!1),new Uint8Array(n.buffer);case"integer":const r=new DataView(new ArrayBuffer(5));return r.setUint8(0,4),r.setInt32(1,e.value,!1),new Uint8Array(r.buffer);case"long":const s=new Uint8Array(9);return s[0]=5,s.set(e.value.bytes,1),s;case"binary":const o=new DataView(new ArrayBuffer(3+e.value.byteLength));o.setUint8(0,6),o.setUint16(1,e.value.byteLength,!1);const i=new Uint8Array(o.buffer);return i.set(e.value,3),i;case"string":const a=this.fromUtf8(e.value),l=new DataView(new ArrayBuffer(3+a.byteLength));l.setUint8(0,7),l.setUint16(1,a.byteLength,!1);const c=new Uint8Array(l.buffer);return c.set(a,3),c;case"timestamp":const d=new Uint8Array(9);return d[0]=8,d.set(vn.fromNumber(e.value.valueOf()).bytes,1),d;case"uuid":if(!Pb.test(e.value))throw new Error(`Invalid UUID received: ${e.value}`);const h=new Uint8Array(17);return h[0]=9,h.set(Co(e.value.replace(/\-/g,"")),1),h}}parse(e){const n={};let r=0;for(;r<e.byteLength;){const s=e.getUint8(r++),o=this.toUtf8(new Uint8Array(e.buffer,e.byteOffset+r,s));switch(r+=s,e.getUint8(r++)){case 0:n[o]={type:pa,value:!0};break;case 1:n[o]={type:pa,value:!1};break;case 2:n[o]={type:Ab,value:e.getInt8(r++)};break;case 3:n[o]={type:Cb,value:e.getInt16(r,!1)},r+=2;break;case 4:n[o]={type:Tb,value:e.getInt32(r,!1)},r+=4;break;case 5:n[o]={type:Ib,value:new vn(new Uint8Array(e.buffer,e.byteOffset+r,8))},r+=8;break;case 6:const i=e.getUint16(r,!1);r+=2,n[o]={type:Rb,value:new Uint8Array(e.buffer,e.byteOffset+r,i)},r+=i;break;case 7:const a=e.getUint16(r,!1);r+=2,n[o]={type:$b,value:this.toUtf8(new Uint8Array(e.buffer,e.byteOffset+r,a))},r+=a;break;case 8:n[o]={type:Ob,value:new Date(new vn(new Uint8Array(e.buffer,e.byteOffset+r,8)).valueOf())},r+=8;break;case 9:const l=new Uint8Array(e.buffer,e.byteOffset+r,16);r+=16,n[o]={type:Bb,value:`${Be(l.subarray(0,4))}-${Be(l.subarray(4,6))}-${Be(l.subarray(6,8))}-${Be(l.subarray(8,10))}-${Be(l.subarray(10))}`};break;default:throw new Error("Unrecognized header type tag")}}return n}}var fa;(function(t){t[t.boolTrue=0]="boolTrue",t[t.boolFalse=1]="boolFalse",t[t.byte=2]="byte",t[t.short=3]="short",t[t.integer=4]="integer",t[t.long=5]="long",t[t.byteArray=6]="byteArray",t[t.string=7]="string",t[t.timestamp=8]="timestamp",t[t.uuid=9]="uuid"})(fa||(fa={}));const pa="boolean",Ab="byte",Cb="short",Tb="integer",Ib="long",Rb="binary",$b="string",Ob="timestamp",Bb="uuid",Pb=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/,_d=4,yt=_d*2,Rt=4,Nb=yt+Rt*2;function Mb({byteLength:t,byteOffset:e,buffer:n}){if(t<Nb)throw new Error("Provided message too short to accommodate event stream message overhead");const r=new DataView(n,e,t),s=r.getUint32(0,!1);if(t!==s)throw new Error("Reported message length does not match received message length");const o=r.getUint32(_d,!1),i=r.getUint32(yt,!1),a=r.getUint32(t-Rt,!1),l=new bd().update(new Uint8Array(n,e,yt));if(i!==l.digest())throw new Error(`The prelude checksum specified in the message (${i}) does not match the calculated CRC32 checksum (${l.digest()})`);if(l.update(new Uint8Array(n,e+yt,t-(yt+Rt))),a!==l.digest())throw new Error(`The message checksum (${l.digest()}) did not match the expected value of ${a}`);return{headers:new DataView(n,e+yt+Rt,o),body:new Uint8Array(n,e+yt+Rt+o,s-o-(yt+Rt+Rt))}}class xd{constructor(e,n){this.headerMarshaller=new Sb(e,n),this.messageBuffer=[],this.isEndOfStream=!1}feed(e){this.messageBuffer.push(this.decode(e))}endOfStream(){this.isEndOfStream=!0}getMessage(){const e=this.messageBuffer.pop(),n=this.isEndOfStream;return{getMessage(){return e},isEndOfStream(){return n}}}getAvailableMessages(){const e=this.messageBuffer;this.messageBuffer=[];const n=this.isEndOfStream;return{getMessages(){return e},isEndOfStream(){return n}}}encode({headers:e,body:n}){const r=this.headerMarshaller.format(e),s=r.byteLength+n.byteLength+16,o=new Uint8Array(s),i=new DataView(o.buffer,o.byteOffset,o.byteLength),a=new bd;return i.setUint32(0,s,!1),i.setUint32(4,r.byteLength,!1),i.setUint32(8,a.update(o.subarray(0,8)).digest(),!1),o.set(r,12),o.set(n,r.byteLength+12),i.setUint32(s-4,a.update(o.subarray(8,s-4)).digest(),!1),o}decode(e){const{headers:n,body:r}=Mb(e);return{headers:this.headerMarshaller.parse(n),body:r}}formatHeaders(e){return this.headerMarshaller.format(e)}}class Db{constructor(e){this.options=e}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(const e of this.options.inputStream)yield this.options.decoder.decode(e)}}class Ub{constructor(e){this.options=e}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(const e of this.options.messageStream)yield this.options.encoder.encode(e);this.options.includeEndFrame&&(yield new Uint8Array(0))}}class Lb{constructor(e){this.options=e}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(const e of this.options.messageStream){const n=await this.options.deserializer(e);n!==void 0&&(yield n)}}}class Fb{constructor(e){this.options=e}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(const e of this.options.inputStream)yield this.options.serializer(e)}}const jb=(t,e,n,r)=>{let s=t;const o={start(){},async transform(i,a){try{const l=new Date(Date.now()+await r()),c={":date":{type:"timestamp",value:l}},d=await e.sign({message:{body:i,headers:c},priorSignature:s},{signingDate:l});s=d.signature;const h=n.encode({headers:{...c,":chunk-signature":{type:"binary",value:Co(d.signature)}},body:i});a.enqueue(h)}catch(l){a.error(l)}}};return new TransformStream({...o})};class Hb{messageSigner;eventStreamCodec;systemClockOffsetProvider;constructor(e){this.messageSigner=e.messageSigner,this.eventStreamCodec=new xd(e.utf8Encoder,e.utf8Decoder),this.systemClockOffsetProvider=async()=>e.systemClockOffset??0}async handle(e,n,r={}){const s=n.request,{body:o,headers:i,query:a}=s;if(!(o instanceof ReadableStream))throw new Error("Eventstream payload must be a ReadableStream.");const l=new TransformStream;s.body=l.readable;let c;try{c=await e(n)}catch(v){throw s.body.cancel(),v}const h=((i.authorization||"").match(/Signature=([\w]+)$/)||[])[1]||a&&a["X-Amz-Signature"]||"",p=jb(h,await this.messageSigner(),this.eventStreamCodec,this.systemClockOffsetProvider);return o.pipeThrough(p).pipeThrough(l),c}}const Kb=t=>new Hb(t),Ed=t=>t.protocol==="ws:"||t.protocol==="wss:";class Vb{signer;constructor(e){this.signer=e.signer}presign(e,n={}){return this.signer.presign(e,n)}async sign(e,n){return Te.isInstance(e)&&Ed(e)?{...await this.signer.presign({...e,body:""},{...n,expiresIn:60,unsignableHeaders:new Set(Object.keys(e.headers).filter(s=>s!=="host"))}),body:e.body}:this.signer.sign(e,n)}}const qb=t=>{const{signer:e}=t;return Object.assign(t,{signer:async n=>{const r=await e(n);if(Gb(r))return new Vb({signer:r});throw new Error("Expected WebsocketSignatureV4 signer, please check the client constructor.")}})},Gb=t=>!!t;function zb(t){const{port:e,query:n}=t;let{protocol:r,path:s,hostname:o}=t;r&&r.slice(-1)!==":"&&(r+=":"),e&&(o+=`:${e}`),s&&s.charAt(0)!=="/"&&(s=`/${s}`);let i=n?Wu(n):"";i&&i[0]!=="?"&&(i=`?${i}`);let a="";if(t.username!=null||t.password!=null){const c=t.username??"",d=t.password??"";a=`${c}:${d}@`}let l="";return t.fragment&&(l=`#${t.fragment}`),`${r}//${a}${o}${s}${i}${l}`}function Jb(t){let e=0,n=0,r=null,s=null;const o=a=>{if(typeof a!="number")throw new Error("Attempted to allocate an event message where size was not a number: "+a);e=a,n=4,r=new Uint8Array(a),new DataView(r.buffer).setUint32(0,a,!1)},i=async function*(){const a=t[Symbol.asyncIterator]();for(;;){const{value:l,done:c}=await a.next();if(c){if(e)if(e===n)yield r;else throw new Error("Truncated event message received.");else return;return}const d=l.length;let h=0;for(;h<d;){if(!r){const g=d-h;s||(s=new Uint8Array(4));const v=Math.min(4-n,g);if(s.set(l.slice(h,h+v),n),n+=v,h+=v,n<4)break;o(new DataView(s.buffer).getUint32(0,!1)),s=null}const p=Math.min(e-n,d-h);r.set(l.slice(h,h+p),n),n+=p,h+=p,e&&e===n&&(yield r,r=null,e=0,n=0)}}};return{[Symbol.asyncIterator]:i}}function Wb(t,e){return async function(n){const{value:r}=n.headers[":message-type"];if(r==="error"){const s=new Error(n.headers[":error-message"].value||"UnknownError");throw s.name=n.headers[":error-code"].value,s}else if(r==="exception"){const s=n.headers[":exception-type"].value,o={[s]:n},i=await t(o);if(i.$unknown){const a=new Error(e(n.body));throw a.name=s,a}throw i[s]}else if(r==="event"){const s={[n.headers[":event-type"].value]:n},o=await t(s);return o.$unknown?void 0:o}else throw Error(`Unrecognizable event type: ${n.headers[":event-type"].value}`)}}let Zb=class{constructor({utf8Encoder:e,utf8Decoder:n}){this.eventStreamCodec=new xd(e,n),this.utfEncoder=e}deserialize(e,n){const r=Jb(e);return new Lb({messageStream:new Db({inputStream:r,decoder:this.eventStreamCodec}),deserializer:Wb(n,this.utfEncoder)})}serialize(e,n){return new Ub({messageStream:new Fb({inputStream:e,serializer:n}),encoder:this.eventStreamCodec,includeEndFrame:!0})}};const kd=t=>({[Symbol.asyncIterator]:async function*(){const e=t.getReader();try{for(;;){const{done:n,value:r}=await e.read();if(n)return;yield r}}finally{e.releaseLock()}}}),Sd=t=>{const e=t[Symbol.asyncIterator]();return new ReadableStream({async pull(n){const{done:r,value:s}=await e.next();if(r)return n.close();n.enqueue(s)}})};class Yb{constructor({utf8Encoder:e,utf8Decoder:n}){this.universalMarshaller=new Zb({utf8Decoder:n,utf8Encoder:e})}deserialize(e,n){const r=Qb(e)?kd(e):e;return this.universalMarshaller.deserialize(r,n)}serialize(e,n){const r=this.universalMarshaller.serialize(e,n);return typeof ReadableStream=="function"?Sd(r):r}}const Qb=t=>typeof ReadableStream=="function"&&t instanceof ReadableStream,Xb=t=>new Yb(t),e0=2e3;class Bo{metadata={handlerProtocol:"websocket/h1.1"};config;configPromise;httpHandler;sockets={};static create(e,n=new kn){return typeof e?.handle=="function"?e:new Bo(e,n)}constructor(e,n=new kn){this.httpHandler=n,typeof e=="function"?(this.config={},this.configPromise=e().then(r=>this.config=r??{})):(this.config=e??{},this.configPromise=Promise.resolve(this.config))}destroy(){for(const[e,n]of Object.entries(this.sockets)){for(const r of n)r.close(1e3,"Socket closed through destroy() call");delete this.sockets[e]}}async handle(e){if(!Ed(e))return this.httpHandler.handle(e);const n=zb(e),r=new WebSocket(n);this.sockets[n]||(this.sockets[n]=[]),this.sockets[n].push(r),r.binaryType="arraybuffer",this.config=await this.configPromise;const{connectionTimeout:s=e0}=this.config;await this.waitForReady(r,s);const{body:o}=e,i=t0(o),a=this.connect(r,i),l=n0(a);return{response:new Xt({statusCode:200,body:l})}}updateHttpClientConfig(e,n){this.configPromise=this.configPromise.then(r=>(r[e]=n,r))}httpHandlerConfigs(){return this.config??{}}removeNotUsableSockets(e){this.sockets[e]=(this.sockets[e]??[]).filter(n=>![WebSocket.CLOSING,WebSocket.CLOSED].includes(n.readyState))}waitForReady(e,n){return new Promise((r,s)=>{const o=setTimeout(()=>{this.removeNotUsableSockets(e.url),s({$metadata:{httpStatusCode:500}})},n);e.onopen=()=>{clearTimeout(o),r()}})}connect(e,n){let r,s=!1,o=()=>{},i=()=>{};e.onmessage=c=>{i({done:!1,value:new Uint8Array(c.data)})},e.onerror=c=>{s=!0,e.close(),o(c)},e.onclose=()=>{this.removeNotUsableSockets(e.url),!s&&(r?o(r):i({done:!0,value:void 0}))};const a={[Symbol.asyncIterator]:()=>({next:()=>new Promise((c,d)=>{i=c,o=d})})};return(async()=>{try{for await(const c of n)e.send(c)}catch(c){r=c}finally{e.close(1e3)}})(),a}}const t0=t=>t[Symbol.asyncIterator]?t:r0(t)?kd(t):{[Symbol.asyncIterator]:async function*(){yield t}},n0=t=>typeof ReadableStream=="function"?Sd(t):t,r0=t=>typeof ReadableStream=="function"&&t instanceof ReadableStream;var ha;(function(t){t.ENV="env",t.CONFIG="shared config entry"})(ha||(ha={}));const s0=!1,o0=!1,Ad=t=>typeof t=="string"&&(t.startsWith("fips-")||t.endsWith("-fips")),ma=t=>Ad(t)?["fips-aws-global","aws-fips"].includes(t)?"us-east-1":t.replace(/fips-(dkr-|prod-)?|-fips/,""):t,i0=t=>{const{region:e,useFipsEndpoint:n}=t;if(!e)throw new Error("Region is missing");return Object.assign(t,{region:async()=>{if(typeof e=="string")return ma(e);const r=await e();return ma(r)},useFipsEndpoint:async()=>{const r=typeof e=="string"?e:await e();return Ad(r)?!0:typeof n!="function"?Promise.resolve(!!n):n()}})},a0=t=>Object.assign(t,{eventStreamMarshaller:t.eventStreamSerdeProvider(t)}),ga="content-length";function c0(t){return e=>async n=>{const r=n.request;if(Te.isInstance(r)){const{body:s,headers:o}=r;if(s&&Object.keys(o).map(i=>i.toLowerCase()).indexOf(ga)===-1)try{const i=t(s);r.headers={...r.headers,[ga]:String(i)}}catch{}}return e({...n,request:r})}}const l0={step:"build",tags:["SET_CONTENT_LENGTH","CONTENT_LENGTH"],name:"contentLengthMiddleware",override:!0},u0=t=>({applyToStack:e=>{e.add(c0(t.bodyLengthChecker),l0)}}),d0=async t=>{const e=t?.Bucket||"";if(typeof t.Bucket=="string"&&(t.Bucket=e.replace(/#/g,encodeURIComponent("#")).replace(/\?/g,encodeURIComponent("?"))),g0(e)){if(t.ForcePathStyle===!0)throw new Error("Path-style addressing cannot be used with ARN buckets")}else(!m0(e)||e.indexOf(".")!==-1&&!String(t.Endpoint).startsWith("http:")||e.toLowerCase()!==e||e.length<3)&&(t.ForcePathStyle=!0);return t.DisableMultiRegionAccessPoints&&(t.disableMultiRegionAccessPoints=!0,t.DisableMRAP=!0),t},f0=/^[a-z0-9][a-z0-9\.\-]{1,61}[a-z0-9]$/,p0=/(\d+\.){3}\d+/,h0=/\.\./,m0=t=>f0.test(t)&&!p0.test(t)&&!h0.test(t),g0=t=>{const[e,n,r,,,s]=t.split(":"),o=e==="arn"&&t.split(":").length>=6,i=!!(o&&n&&r&&s);if(o&&!i)throw new Error(`Invalid ARN: ${t} was an invalid ARN.`);return i},y0=(t,e,n)=>{const r=async()=>{const s=n[t]??n[e];return typeof s=="function"?s():s};return t==="credentialScope"||e==="CredentialScope"?async()=>{const s=typeof n.credentials=="function"?await n.credentials():n.credentials;return s?.credentialScope??s?.CredentialScope}:t==="accountId"||e==="AccountId"?async()=>{const s=typeof n.credentials=="function"?await n.credentials():n.credentials;return s?.accountId??s?.AccountId}:t==="endpoint"||e==="endpoint"?async()=>{if(n.isCustomEndpoint===!1)return;const s=await r();if(s&&typeof s=="object"){if("url"in s)return s.url.href;if("hostname"in s){const{protocol:o,hostname:i,port:a,path:l}=s;return`${o}//${i}${a?":"+a:""}${l}`}}return s}:r},Cd=async t=>{},Td=t=>typeof t=="object"?"url"in t?Tr(t.url):t:Tr(t),v0=async(t,e,n,r)=>{if(!n.isCustomEndpoint){let i;n.serviceConfiguredEndpoint?i=await n.serviceConfiguredEndpoint():i=await Cd(n.serviceId),i&&(n.endpoint=()=>Promise.resolve(Td(i)),n.isCustomEndpoint=!0)}const s=await w0(t,e,n);if(typeof n.endpointProvider!="function")throw new Error("config.endpointProvider is not set.");return n.endpointProvider(s,r)},w0=async(t,e,n)=>{const r={},s=e?.getEndpointParameterInstructions?.()||{};for(const[o,i]of Object.entries(s))switch(i.type){case"staticContextParams":r[o]=i.value;break;case"contextParams":r[o]=t[i.name];break;case"clientContextParams":case"builtInParams":r[o]=await y0(i.name,o,n)();break;case"operationContextParams":r[o]=i.get(t);break;default:throw new Error("Unrecognized endpoint parameter instruction: "+JSON.stringify(i))}return Object.keys(s).length===0&&Object.assign(r,n),String(n.serviceId).toLowerCase()==="s3"&&await d0(r),r},b0=({config:t,instructions:e})=>(n,r)=>async s=>{t.isCustomEndpoint&&Rv(r,"ENDPOINT_OVERRIDE","N");const o=await v0(s.input,{getEndpointParameterInstructions(){return e}},{...t},r);r.endpointV2=o,r.authSchemes=o.properties?.authSchemes;const i=r.authSchemes?.[0];if(i){r.signing_region=i.signingRegion,r.signing_service=i.signingName;const l=Dr(r)?.selectedHttpAuthScheme?.httpAuthOption;l&&(l.signingProperties=Object.assign(l.signingProperties||{},{signing_region:i.signingRegion,signingRegion:i.signingRegion,signing_service:i.signingName,signingName:i.signingName,signingRegionSet:i.signingRegionSet},i.properties))}return n({...s})},_0={step:"serialize",tags:["ENDPOINT_PARAMETERS","ENDPOINT_V2","ENDPOINT"],name:"endpointV2Middleware",override:!0,relation:"before",toMiddleware:Gu.name},Po=(t,e)=>({applyToStack:n=>{n.addRelativeTo(b0({config:t,instructions:e}),_0)}}),x0=t=>{const e=t.tls??!0,{endpoint:n,useDualstackEndpoint:r,useFipsEndpoint:s}=t,o=n!=null?async()=>Td(await ft(n)()):void 0,a=Object.assign(t,{endpoint:o,tls:e,isCustomEndpoint:!!n,useDualstackEndpoint:ft(r??!1),useFipsEndpoint:ft(s??!1)});let l;return a.serviceConfiguredEndpoint=async()=>(t.serviceId&&!l&&(l=Cd(t.serviceId)),l),a};var tn;(function(t){t.STANDARD="standard",t.ADAPTIVE="adaptive"})(tn||(tn={}));const Rr=3,E0=tn.STANDARD,k0=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException","TransactionInProgressException"],S0=["TimeoutError","RequestTimeout","RequestTimeoutException"],A0=[500,502,503,504],C0=["ECONNRESET","ECONNREFUSED","EPIPE","ETIMEDOUT"],T0=["EHOSTUNREACH","ENETUNREACH","ENOTFOUND"],I0=t=>t.$metadata?.clockSkewCorrected,R0=t=>{const e=new Set(["Failed to fetch","NetworkError when attempting to fetch resource","The Internet connection appears to be offline","Load failed","Network request failed"]);return t&&t instanceof TypeError?e.has(t.message):!1},Id=t=>t.$metadata?.httpStatusCode===429||k0.includes(t.name)||t.$retryable?.throttling==!0,No=(t,e=0)=>I0(t)||S0.includes(t.name)||C0.includes(t?.code||"")||T0.includes(t?.code||"")||A0.includes(t.$metadata?.httpStatusCode||0)||R0(t)||t.cause!==void 0&&e<=10&&No(t.cause,e+1),$0=t=>{if(t.$metadata?.httpStatusCode!==void 0){const e=t.$metadata.httpStatusCode;return 500<=e&&e<=599&&!No(t)}return!1};class Fr{constructor(e){this.currentCapacity=0,this.enabled=!1,this.lastMaxRate=0,this.measuredTxRate=0,this.requestCount=0,this.lastTimestamp=0,this.timeWindow=0,this.beta=e?.beta??.7,this.minCapacity=e?.minCapacity??1,this.minFillRate=e?.minFillRate??.5,this.scaleConstant=e?.scaleConstant??.4,this.smooth=e?.smooth??.8;const n=this.getCurrentTimeInSeconds();this.lastThrottleTime=n,this.lastTxRateBucket=Math.floor(this.getCurrentTimeInSeconds()),this.fillRate=this.minFillRate,this.maxCapacity=this.minCapacity}getCurrentTimeInSeconds(){return Date.now()/1e3}async getSendToken(){return this.acquireTokenBucket(1)}async acquireTokenBucket(e){if(this.enabled){if(this.refillTokenBucket(),e>this.currentCapacity){const n=(e-this.currentCapacity)/this.fillRate*1e3;await new Promise(r=>Fr.setTimeoutFn(r,n))}this.currentCapacity=this.currentCapacity-e}}refillTokenBucket(){const e=this.getCurrentTimeInSeconds();if(!this.lastTimestamp){this.lastTimestamp=e;return}const n=(e-this.lastTimestamp)*this.fillRate;this.currentCapacity=Math.min(this.maxCapacity,this.currentCapacity+n),this.lastTimestamp=e}updateClientSendingRate(e){let n;if(this.updateMeasuredRate(),Id(e)){const s=this.enabled?Math.min(this.measuredTxRate,this.fillRate):this.measuredTxRate;this.lastMaxRate=s,this.calculateTimeWindow(),this.lastThrottleTime=this.getCurrentTimeInSeconds(),n=this.cubicThrottle(s),this.enableTokenBucket()}else this.calculateTimeWindow(),n=this.cubicSuccess(this.getCurrentTimeInSeconds());const r=Math.min(n,2*this.measuredTxRate);this.updateTokenBucketRate(r)}calculateTimeWindow(){this.timeWindow=this.getPrecise(Math.pow(this.lastMaxRate*(1-this.beta)/this.scaleConstant,1/3))}cubicThrottle(e){return this.getPrecise(e*this.beta)}cubicSuccess(e){return this.getPrecise(this.scaleConstant*Math.pow(e-this.lastThrottleTime-this.timeWindow,3)+this.lastMaxRate)}enableTokenBucket(){this.enabled=!0}updateTokenBucketRate(e){this.refillTokenBucket(),this.fillRate=Math.max(e,this.minFillRate),this.maxCapacity=Math.max(e,this.minCapacity),this.currentCapacity=Math.min(this.currentCapacity,this.maxCapacity)}updateMeasuredRate(){const e=this.getCurrentTimeInSeconds(),n=Math.floor(e*2)/2;if(this.requestCount++,n>this.lastTxRateBucket){const r=this.requestCount/(n-this.lastTxRateBucket);this.measuredTxRate=this.getPrecise(r*this.smooth+this.measuredTxRate*(1-this.smooth)),this.requestCount=0,this.lastTxRateBucket=n}}getPrecise(e){return parseFloat(e.toFixed(8))}}Fr.setTimeoutFn=setTimeout;const Ys=100,Rd=20*1e3,O0=500,ya=500,B0=5,P0=10,N0=1,M0="amz-sdk-invocation-id",D0="amz-sdk-request",U0=()=>{let t=Ys;return{computeNextBackoffDelay:r=>Math.floor(Math.min(Rd,Math.random()*2**r*t)),setDelayBase:r=>{t=r}}},va=({retryDelay:t,retryCount:e,retryCost:n})=>({getRetryCount:()=>e,getRetryDelay:()=>Math.min(Rd,t),getRetryCost:()=>n});class $d{constructor(e){this.maxAttempts=e,this.mode=tn.STANDARD,this.capacity=ya,this.retryBackoffStrategy=U0(),this.maxAttemptsProvider=typeof e=="function"?e:async()=>e}async acquireInitialRetryToken(e){return va({retryDelay:Ys,retryCount:0})}async refreshRetryTokenForRetry(e,n){const r=await this.getMaxAttempts();if(this.shouldRetry(e,n,r)){const s=n.errorType;this.retryBackoffStrategy.setDelayBase(s==="THROTTLING"?O0:Ys);const o=this.retryBackoffStrategy.computeNextBackoffDelay(e.getRetryCount()),i=n.retryAfterHint?Math.max(n.retryAfterHint.getTime()-Date.now()||0,o):o,a=this.getCapacityCost(s);return this.capacity-=a,va({retryDelay:i,retryCount:e.getRetryCount()+1,retryCost:a})}throw new Error("No retry token available")}recordSuccess(e){this.capacity=Math.max(ya,this.capacity+(e.getRetryCost()??N0))}getCapacity(){return this.capacity}async getMaxAttempts(){try{return await this.maxAttemptsProvider()}catch{return console.warn(`Max attempts provider could not resolve. Using default of ${Rr}`),Rr}}shouldRetry(e,n,r){return e.getRetryCount()+1<r&&this.capacity>=this.getCapacityCost(n.errorType)&&this.isRetryableError(n.errorType)}getCapacityCost(e){return e==="TRANSIENT"?P0:B0}isRetryableError(e){return e==="THROTTLING"||e==="TRANSIENT"}}class L0{constructor(e,n){this.maxAttemptsProvider=e,this.mode=tn.ADAPTIVE;const{rateLimiter:r}=n??{};this.rateLimiter=r??new Fr,this.standardRetryStrategy=new $d(e)}async acquireInitialRetryToken(e){return await this.rateLimiter.getSendToken(),this.standardRetryStrategy.acquireInitialRetryToken(e)}async refreshRetryTokenForRetry(e,n){return this.rateLimiter.updateClientSendingRate(n),this.standardRetryStrategy.refreshRetryTokenForRetry(e,n)}recordSuccess(e){this.rateLimiter.updateClientSendingRate({}),this.standardRetryStrategy.recordSuccess(e)}}let Kn;const F0=new Uint8Array(16);function j0(){if(!Kn&&(Kn=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Kn))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Kn(F0)}const _e=[];for(let t=0;t<256;++t)_e.push((t+256).toString(16).slice(1));function H0(t,e=0){return _e[t[e+0]]+_e[t[e+1]]+_e[t[e+2]]+_e[t[e+3]]+"-"+_e[t[e+4]]+_e[t[e+5]]+"-"+_e[t[e+6]]+_e[t[e+7]]+"-"+_e[t[e+8]]+_e[t[e+9]]+"-"+_e[t[e+10]]+_e[t[e+11]]+_e[t[e+12]]+_e[t[e+13]]+_e[t[e+14]]+_e[t[e+15]]}const K0=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),wa={randomUUID:K0};function V0(t,e,n){if(wa.randomUUID&&!t)return wa.randomUUID();t=t||{};const r=t.random||(t.rng||j0)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,H0(r)}const q0=t=>t instanceof Error?t:t instanceof Object?Object.assign(new Error,t):typeof t=="string"?new Error(t):new Error(`AWS SDK error wrapper for ${t}`),G0=t=>{const{retryStrategy:e,retryMode:n,maxAttempts:r}=t,s=ft(r??Rr);return Object.assign(t,{maxAttempts:s,retryStrategy:async()=>e||(await ft(n)()===tn.ADAPTIVE?new L0(s):new $d(s))})},z0=t=>t?.body instanceof ReadableStream,J0=t=>(e,n)=>async r=>{let s=await t.retryStrategy();const o=await t.maxAttempts();if(W0(s)){s=s;let i=await s.acquireInitialRetryToken(n.partition_id),a=new Error,l=0,c=0;const{request:d}=r,h=Te.isInstance(d);for(h&&(d.headers[M0]=V0());;)try{h&&(d.headers[D0]=`attempt=${l+1}; max=${o}`);const{response:p,output:g}=await e(r);return s.recordSuccess(i),g.$metadata.attempts=l+1,g.$metadata.totalRetryDelay=c,{response:p,output:g}}catch(p){const g=Z0(p);if(a=q0(p),h&&z0(d))throw(n.logger instanceof vd?console:n.logger)?.warn("An error was encountered in a non-retryable streaming request."),a;try{i=await s.refreshRetryTokenForRetry(i,g)}catch{throw a.$metadata||(a.$metadata={}),a.$metadata.attempts=l+1,a.$metadata.totalRetryDelay=c,a}l=i.getRetryCount();const v=i.getRetryDelay();c+=v,await new Promise(b=>setTimeout(b,v))}}else return s=s,s?.mode&&(n.userAgent=[...n.userAgent||[],["cfg/retry-mode",s.mode]]),s.retry(e,r)},W0=t=>typeof t.acquireInitialRetryToken<"u"&&typeof t.refreshRetryTokenForRetry<"u"&&typeof t.recordSuccess<"u",Z0=t=>{const e={error:t,errorType:Y0(t)},n=e_(t.$response);return n&&(e.retryAfterHint=n),e},Y0=t=>Id(t)?"THROTTLING":No(t)?"TRANSIENT":$0(t)?"SERVER_ERROR":"CLIENT_ERROR",Q0={name:"retryMiddleware",tags:["RETRY"],step:"finalizeRequest",priority:"high",override:!0},X0=t=>({applyToStack:e=>{e.add(J0(t),Q0)}}),e_=t=>{if(!Xt.isInstance(t))return;const e=Object.keys(t.headers).find(o=>o.toLowerCase()==="retry-after");if(!e)return;const n=t.headers[e],r=Number(n);return Number.isNaN(r)?new Date(n):new Date(r*1e3)},t_=async(t,e,n)=>({operation:Dr(e).operation,region:await ft(t.region)()||(()=>{throw new Error("expected `region` to be configured for `aws.auth#sigv4`")})()});function n_(t){return{schemeId:"aws.auth#sigv4",signingProperties:{name:"bedrock",region:t.region},propertiesExtractor:(e,n)=>({signingProperties:{config:e,context:n}})}}function r_(t){return{schemeId:"smithy.api#httpBearerAuth",propertiesExtractor:({profile:e,filepath:n,configFilepath:r,ignoreCache:s},o)=>({identityProperties:{profile:e,filepath:n,configFilepath:r,ignoreCache:s}})}}const s_=t=>{const e=[];switch(t.operation){default:e.push(n_(t)),e.push(r_())}return e},o_=t=>{const e=ed(t.token,Xu,Ro),n=Hw(t);return Object.assign(n,{authSchemePreference:ft(t.authSchemePreference??[]),token:e})},i_=t=>Object.assign(t,{useDualstackEndpoint:t.useDualstackEndpoint??!1,useFipsEndpoint:t.useFipsEndpoint??!1,defaultSigningName:"bedrock"}),Mo={UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}},a_="3.848.0",c_={version:a_};var Od={name:"SHA-256"},ba={name:"HMAC",hash:Od},l_=new Uint8Array([227,176,196,66,152,252,28,20,154,251,244,200,153,111,185,36,39,174,65,228,100,155,147,76,164,149,153,27,120,82,184,85]);const u_={};function qn(){return typeof window<"u"?window:typeof self<"u"?self:u_}var d_=function(){function t(e){this.toHash=new Uint8Array(0),this.secret=e,this.reset()}return t.prototype.update=function(e){if(!Zs(e)){var n=An(e),r=new Uint8Array(this.toHash.byteLength+n.byteLength);r.set(this.toHash,0),r.set(n,this.toHash.byteLength),this.toHash=r}},t.prototype.digest=function(){var e=this;return this.key?this.key.then(function(n){return qn().crypto.subtle.sign(ba,n,e.toHash).then(function(r){return new Uint8Array(r)})}):Zs(this.toHash)?Promise.resolve(l_):Promise.resolve().then(function(){return qn().crypto.subtle.digest(Od,e.toHash)}).then(function(n){return Promise.resolve(new Uint8Array(n))})},t.prototype.reset=function(){var e=this;this.toHash=new Uint8Array(0),this.secret&&this.secret!==void 0&&(this.key=new Promise(function(n,r){qn().crypto.subtle.importKey("raw",An(e.secret),ba,!1,["sign"]).then(n,r)}),this.key.catch(function(){}))},t}(),Le=64,f_=32,p_=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),h_=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],m_=Math.pow(2,53)-1,Gn=function(){function t(){this.state=Int32Array.from(h_),this.temp=new Int32Array(64),this.buffer=new Uint8Array(64),this.bufferLength=0,this.bytesHashed=0,this.finished=!1}return t.prototype.update=function(e){if(this.finished)throw new Error("Attempted to update an already finished hash.");var n=0,r=e.byteLength;if(this.bytesHashed+=r,this.bytesHashed*8>m_)throw new Error("Cannot hash more than 2^53 - 1 bits");for(;r>0;)this.buffer[this.bufferLength++]=e[n++],r--,this.bufferLength===Le&&(this.hashBuffer(),this.bufferLength=0)},t.prototype.digest=function(){if(!this.finished){var e=this.bytesHashed*8,n=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.byteLength),r=this.bufferLength;if(n.setUint8(this.bufferLength++,128),r%Le>=Le-8){for(var s=this.bufferLength;s<Le;s++)n.setUint8(s,0);this.hashBuffer(),this.bufferLength=0}for(var s=this.bufferLength;s<Le-8;s++)n.setUint8(s,0);n.setUint32(Le-8,Math.floor(e/4294967296),!0),n.setUint32(Le-4,e),this.hashBuffer(),this.finished=!0}for(var o=new Uint8Array(f_),s=0;s<8;s++)o[s*4]=this.state[s]>>>24&255,o[s*4+1]=this.state[s]>>>16&255,o[s*4+2]=this.state[s]>>>8&255,o[s*4+3]=this.state[s]>>>0&255;return o},t.prototype.hashBuffer=function(){for(var e=this,n=e.buffer,r=e.state,s=r[0],o=r[1],i=r[2],a=r[3],l=r[4],c=r[5],d=r[6],h=r[7],p=0;p<Le;p++){if(p<16)this.temp[p]=(n[p*4]&255)<<24|(n[p*4+1]&255)<<16|(n[p*4+2]&255)<<8|n[p*4+3]&255;else{var g=this.temp[p-2],v=(g>>>17|g<<15)^(g>>>19|g<<13)^g>>>10;g=this.temp[p-15];var b=(g>>>7|g<<25)^(g>>>18|g<<14)^g>>>3;this.temp[p]=(v+this.temp[p-7]|0)+(b+this.temp[p-16]|0)}var w=(((l>>>6|l<<26)^(l>>>11|l<<21)^(l>>>25|l<<7))+(l&c^~l&d)|0)+(h+(p_[p]+this.temp[p]|0)|0)|0,S=((s>>>2|s<<30)^(s>>>13|s<<19)^(s>>>22|s<<10))+(s&o^s&i^o&i)|0;h=d,d=c,c=l,l=a+w|0,a=i,i=o,o=s,s=w+S|0}r[0]+=s,r[1]+=o,r[2]+=i,r[3]+=a,r[4]+=l,r[5]+=c,r[6]+=d,r[7]+=h},t}(),g_=function(){function t(e){this.secret=e,this.hash=new Gn,this.reset()}return t.prototype.update=function(e){if(!(Zs(e)||this.error))try{this.hash.update(An(e))}catch(n){this.error=n}},t.prototype.digestSync=function(){if(this.error)throw this.error;return this.outer?(this.outer.finished||this.outer.update(this.hash.digest()),this.outer.digest()):this.hash.digest()},t.prototype.digest=function(){return _f(this,void 0,void 0,function(){return xf(this,function(e){return[2,this.digestSync()]})})},t.prototype.reset=function(){if(this.hash=new Gn,this.secret){this.outer=new Gn;var e=y_(this.secret),n=new Uint8Array(Le);n.set(e);for(var r=0;r<Le;r++)e[r]^=54,n[r]^=92;this.hash.update(e),this.outer.update(n);for(var r=0;r<e.byteLength;r++)e[r]=0}},t}();function y_(t){var e=An(t);if(e.byteLength>Le){var n=new Gn;n.update(e),e=n.digest()}var r=new Uint8Array(Le);return r.set(e),r}var v_=["decrypt","digest","encrypt","exportKey","generateKey","importKey","sign","verify"];function w_(t){if(b_(t)&&typeof t.crypto.subtle=="object"){var e=t.crypto.subtle;return __(e)}return!1}function b_(t){if(typeof t=="object"&&typeof t.crypto=="object"){var e=t.crypto.getRandomValues;return typeof e=="function"}return!1}function __(t){return t&&v_.every(function(e){return typeof t[e]=="function"})}var x_=function(){function t(e){w_(qn())?this.hash=new d_(e):this.hash=new g_(e)}return t.prototype.update=function(e,n){this.hash.update(An(e))},t.prototype.digest=function(){return this.hash.digest()},t.prototype.reset=function(){this.hash.reset()},t}();const E_={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},Bd={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},he={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},Ae={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},vt={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"};class I{static getFirstMatch(e,n){const r=n.match(e);return r&&r.length>0&&r[1]||""}static getSecondMatch(e,n){const r=n.match(e);return r&&r.length>1&&r[2]||""}static matchAndReturnConst(e,n,r){if(e.test(n))return r}static getWindowsVersionName(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}static getMacOSVersionName(e){const n=e.split(".").splice(0,2).map(r=>parseInt(r,10)||0);if(n.push(0),n[0]===10)switch(n[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}}static getAndroidVersionName(e){const n=e.split(".").splice(0,2).map(r=>parseInt(r,10)||0);if(n.push(0),!(n[0]===1&&n[1]<5)){if(n[0]===1&&n[1]<6)return"Cupcake";if(n[0]===1&&n[1]>=6)return"Donut";if(n[0]===2&&n[1]<2)return"Eclair";if(n[0]===2&&n[1]===2)return"Froyo";if(n[0]===2&&n[1]>2)return"Gingerbread";if(n[0]===3)return"Honeycomb";if(n[0]===4&&n[1]<1)return"Ice Cream Sandwich";if(n[0]===4&&n[1]<4)return"Jelly Bean";if(n[0]===4&&n[1]>=4)return"KitKat";if(n[0]===5)return"Lollipop";if(n[0]===6)return"Marshmallow";if(n[0]===7)return"Nougat";if(n[0]===8)return"Oreo";if(n[0]===9)return"Pie"}}static getVersionPrecision(e){return e.split(".").length}static compareVersions(e,n,r=!1){const s=I.getVersionPrecision(e),o=I.getVersionPrecision(n);let i=Math.max(s,o),a=0;const l=I.map([e,n],c=>{const d=i-I.getVersionPrecision(c),h=c+new Array(d+1).join(".0");return I.map(h.split("."),p=>new Array(20-p.length).join("0")+p).reverse()});for(r&&(a=i-Math.min(s,o)),i-=1;i>=a;){if(l[0][i]>l[1][i])return 1;if(l[0][i]===l[1][i]){if(i===a)return 0;i-=1}else if(l[0][i]<l[1][i])return-1}}static map(e,n){const r=[];let s;if(Array.prototype.map)return Array.prototype.map.call(e,n);for(s=0;s<e.length;s+=1)r.push(n(e[s]));return r}static find(e,n){let r,s;if(Array.prototype.find)return Array.prototype.find.call(e,n);for(r=0,s=e.length;r<s;r+=1){const o=e[r];if(n(o,r))return o}}static assign(e,...n){const r=e;let s,o;if(Object.assign)return Object.assign(e,...n);for(s=0,o=n.length;s<o;s+=1){const i=n[s];typeof i=="object"&&i!==null&&Object.keys(i).forEach(l=>{r[l]=i[l]})}return e}static getBrowserAlias(e){return E_[e]}static getBrowserTypeByAlias(e){return Bd[e]||""}}const ee=/version\/(\d+(\.?_?\d+)+)/i,k_=[{test:[/googlebot/i],describe(t){const e={name:"Googlebot"},n=I.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,t)||I.getFirstMatch(ee,t);return n&&(e.version=n),e}},{test:[/opera/i],describe(t){const e={name:"Opera"},n=I.getFirstMatch(ee,t)||I.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/opr\/|opios/i],describe(t){const e={name:"Opera"},n=I.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,t)||I.getFirstMatch(ee,t);return n&&(e.version=n),e}},{test:[/SamsungBrowser/i],describe(t){const e={name:"Samsung Internet for Android"},n=I.getFirstMatch(ee,t)||I.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/Whale/i],describe(t){const e={name:"NAVER Whale Browser"},n=I.getFirstMatch(ee,t)||I.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/MZBrowser/i],describe(t){const e={name:"MZ Browser"},n=I.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,t)||I.getFirstMatch(ee,t);return n&&(e.version=n),e}},{test:[/focus/i],describe(t){const e={name:"Focus"},n=I.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,t)||I.getFirstMatch(ee,t);return n&&(e.version=n),e}},{test:[/swing/i],describe(t){const e={name:"Swing"},n=I.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,t)||I.getFirstMatch(ee,t);return n&&(e.version=n),e}},{test:[/coast/i],describe(t){const e={name:"Opera Coast"},n=I.getFirstMatch(ee,t)||I.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe(t){const e={name:"Opera Touch"},n=I.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,t)||I.getFirstMatch(ee,t);return n&&(e.version=n),e}},{test:[/yabrowser/i],describe(t){const e={name:"Yandex Browser"},n=I.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,t)||I.getFirstMatch(ee,t);return n&&(e.version=n),e}},{test:[/ucbrowser/i],describe(t){const e={name:"UC Browser"},n=I.getFirstMatch(ee,t)||I.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/Maxthon|mxios/i],describe(t){const e={name:"Maxthon"},n=I.getFirstMatch(ee,t)||I.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/epiphany/i],describe(t){const e={name:"Epiphany"},n=I.getFirstMatch(ee,t)||I.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/puffin/i],describe(t){const e={name:"Puffin"},n=I.getFirstMatch(ee,t)||I.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/sleipnir/i],describe(t){const e={name:"Sleipnir"},n=I.getFirstMatch(ee,t)||I.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/k-meleon/i],describe(t){const e={name:"K-Meleon"},n=I.getFirstMatch(ee,t)||I.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/micromessenger/i],describe(t){const e={name:"WeChat"},n=I.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,t)||I.getFirstMatch(ee,t);return n&&(e.version=n),e}},{test:[/qqbrowser/i],describe(t){const e={name:/qqbrowserlite/i.test(t)?"QQ Browser Lite":"QQ Browser"},n=I.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,t)||I.getFirstMatch(ee,t);return n&&(e.version=n),e}},{test:[/msie|trident/i],describe(t){const e={name:"Internet Explorer"},n=I.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/\sedg\//i],describe(t){const e={name:"Microsoft Edge"},n=I.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/edg([ea]|ios)/i],describe(t){const e={name:"Microsoft Edge"},n=I.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/vivaldi/i],describe(t){const e={name:"Vivaldi"},n=I.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/seamonkey/i],describe(t){const e={name:"SeaMonkey"},n=I.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/sailfish/i],describe(t){const e={name:"Sailfish"},n=I.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,t);return n&&(e.version=n),e}},{test:[/silk/i],describe(t){const e={name:"Amazon Silk"},n=I.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/phantom/i],describe(t){const e={name:"PhantomJS"},n=I.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/slimerjs/i],describe(t){const e={name:"SlimerJS"},n=I.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(t){const e={name:"BlackBerry"},n=I.getFirstMatch(ee,t)||I.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/(web|hpw)[o0]s/i],describe(t){const e={name:"WebOS Browser"},n=I.getFirstMatch(ee,t)||I.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/bada/i],describe(t){const e={name:"Bada"},n=I.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/tizen/i],describe(t){const e={name:"Tizen"},n=I.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,t)||I.getFirstMatch(ee,t);return n&&(e.version=n),e}},{test:[/qupzilla/i],describe(t){const e={name:"QupZilla"},n=I.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,t)||I.getFirstMatch(ee,t);return n&&(e.version=n),e}},{test:[/firefox|iceweasel|fxios/i],describe(t){const e={name:"Firefox"},n=I.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/electron/i],describe(t){const e={name:"Electron"},n=I.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/MiuiBrowser/i],describe(t){const e={name:"Miui"},n=I.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/chromium/i],describe(t){const e={name:"Chromium"},n=I.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,t)||I.getFirstMatch(ee,t);return n&&(e.version=n),e}},{test:[/chrome|crios|crmo/i],describe(t){const e={name:"Chrome"},n=I.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/GSA/i],describe(t){const e={name:"Google Search"},n=I.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test(t){const e=!t.test(/like android/i),n=t.test(/android/i);return e&&n},describe(t){const e={name:"Android Browser"},n=I.getFirstMatch(ee,t);return n&&(e.version=n),e}},{test:[/playstation 4/i],describe(t){const e={name:"PlayStation 4"},n=I.getFirstMatch(ee,t);return n&&(e.version=n),e}},{test:[/safari|applewebkit/i],describe(t){const e={name:"Safari"},n=I.getFirstMatch(ee,t);return n&&(e.version=n),e}},{test:[/.*/i],describe(t){const e=/^(.*)\/(.*) /,n=/^(.*)\/(.*)[ \t]\((.*)/,s=t.search("\\(")!==-1?n:e;return{name:I.getFirstMatch(s,t),version:I.getSecondMatch(s,t)}}}],S_=[{test:[/Roku\/DVP/],describe(t){const e=I.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,t);return{name:Ae.Roku,version:e}}},{test:[/windows phone/i],describe(t){const e=I.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,t);return{name:Ae.WindowsPhone,version:e}}},{test:[/windows /i],describe(t){const e=I.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,t),n=I.getWindowsVersionName(e);return{name:Ae.Windows,version:e,versionName:n}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe(t){const e={name:Ae.iOS},n=I.getSecondMatch(/(Version\/)(\d[\d.]+)/,t);return n&&(e.version=n),e}},{test:[/macintosh/i],describe(t){const e=I.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,t).replace(/[_\s]/g,"."),n=I.getMacOSVersionName(e),r={name:Ae.MacOS,version:e};return n&&(r.versionName=n),r}},{test:[/(ipod|iphone|ipad)/i],describe(t){const e=I.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,t).replace(/[_\s]/g,".");return{name:Ae.iOS,version:e}}},{test(t){const e=!t.test(/like android/i),n=t.test(/android/i);return e&&n},describe(t){const e=I.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,t),n=I.getAndroidVersionName(e),r={name:Ae.Android,version:e};return n&&(r.versionName=n),r}},{test:[/(web|hpw)[o0]s/i],describe(t){const e=I.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,t),n={name:Ae.WebOS};return e&&e.length&&(n.version=e),n}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(t){const e=I.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,t)||I.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,t)||I.getFirstMatch(/\bbb(\d+)/i,t);return{name:Ae.BlackBerry,version:e}}},{test:[/bada/i],describe(t){const e=I.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,t);return{name:Ae.Bada,version:e}}},{test:[/tizen/i],describe(t){const e=I.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,t);return{name:Ae.Tizen,version:e}}},{test:[/linux/i],describe(){return{name:Ae.Linux}}},{test:[/CrOS/],describe(){return{name:Ae.ChromeOS}}},{test:[/PlayStation 4/],describe(t){const e=I.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,t);return{name:Ae.PlayStation4,version:e}}}],A_=[{test:[/googlebot/i],describe(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe(t){const e=I.getFirstMatch(/(can-l01)/i,t)&&"Nova",n={type:he.mobile,vendor:"Huawei"};return e&&(n.model=e),n}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe(){return{type:he.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe(){return{type:he.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe(){return{type:he.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe(){return{type:he.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe(){return{type:he.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe(){return{type:he.tablet}}},{test(t){const e=t.test(/ipod|iphone/i),n=t.test(/like (ipod|iphone)/i);return e&&!n},describe(t){const e=I.getFirstMatch(/(ipod|iphone)/i,t);return{type:he.mobile,vendor:"Apple",model:e}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe(){return{type:he.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe(){return{type:he.mobile}}},{test(t){return t.getBrowserName(!0)==="blackberry"},describe(){return{type:he.mobile,vendor:"BlackBerry"}}},{test(t){return t.getBrowserName(!0)==="bada"},describe(){return{type:he.mobile}}},{test(t){return t.getBrowserName()==="windows phone"},describe(){return{type:he.mobile,vendor:"Microsoft"}}},{test(t){const e=Number(String(t.getOSVersion()).split(".")[0]);return t.getOSName(!0)==="android"&&e>=3},describe(){return{type:he.tablet}}},{test(t){return t.getOSName(!0)==="android"},describe(){return{type:he.mobile}}},{test(t){return t.getOSName(!0)==="macos"},describe(){return{type:he.desktop,vendor:"Apple"}}},{test(t){return t.getOSName(!0)==="windows"},describe(){return{type:he.desktop}}},{test(t){return t.getOSName(!0)==="linux"},describe(){return{type:he.desktop}}},{test(t){return t.getOSName(!0)==="playstation 4"},describe(){return{type:he.tv}}},{test(t){return t.getOSName(!0)==="roku"},describe(){return{type:he.tv}}}],C_=[{test(t){return t.getBrowserName(!0)==="microsoft edge"},describe(t){if(/\sedg\//i.test(t))return{name:vt.Blink};const n=I.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,t);return{name:vt.EdgeHTML,version:n}}},{test:[/trident/i],describe(t){const e={name:vt.Trident},n=I.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test(t){return t.test(/presto/i)},describe(t){const e={name:vt.Presto},n=I.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test(t){const e=t.test(/gecko/i),n=t.test(/like gecko/i);return e&&!n},describe(t){const e={name:vt.Gecko},n=I.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/(apple)?webkit\/537\.36/i],describe(){return{name:vt.Blink}}},{test:[/(apple)?webkit/i],describe(t){const e={name:vt.WebKit},n=I.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}}];class _a{constructor(e,n=!1){if(e==null||e==="")throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},n!==!0&&this.parse()}getUA(){return this._ua}test(e){return e.test(this._ua)}parseBrowser(){this.parsedResult.browser={};const e=I.find(k_,n=>{if(typeof n.test=="function")return n.test(this);if(n.test instanceof Array)return n.test.some(r=>this.test(r));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.browser=e.describe(this.getUA())),this.parsedResult.browser}getBrowser(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()}getBrowserName(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""}getBrowserVersion(){return this.getBrowser().version}getOS(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()}parseOS(){this.parsedResult.os={};const e=I.find(S_,n=>{if(typeof n.test=="function")return n.test(this);if(n.test instanceof Array)return n.test.some(r=>this.test(r));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.os=e.describe(this.getUA())),this.parsedResult.os}getOSName(e){const{name:n}=this.getOS();return e?String(n).toLowerCase()||"":n||""}getOSVersion(){return this.getOS().version}getPlatform(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()}getPlatformType(e=!1){const{type:n}=this.getPlatform();return e?String(n).toLowerCase()||"":n||""}parsePlatform(){this.parsedResult.platform={};const e=I.find(A_,n=>{if(typeof n.test=="function")return n.test(this);if(n.test instanceof Array)return n.test.some(r=>this.test(r));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.platform=e.describe(this.getUA())),this.parsedResult.platform}getEngine(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()}getEngineName(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""}parseEngine(){this.parsedResult.engine={};const e=I.find(C_,n=>{if(typeof n.test=="function")return n.test(this);if(n.test instanceof Array)return n.test.some(r=>this.test(r));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.engine=e.describe(this.getUA())),this.parsedResult.engine}parse(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this}getResult(){return I.assign({},this.parsedResult)}satisfies(e){const n={};let r=0;const s={};let o=0;if(Object.keys(e).forEach(a=>{const l=e[a];typeof l=="string"?(s[a]=l,o+=1):typeof l=="object"&&(n[a]=l,r+=1)}),r>0){const a=Object.keys(n),l=I.find(a,d=>this.isOS(d));if(l){const d=this.satisfies(n[l]);if(d!==void 0)return d}const c=I.find(a,d=>this.isPlatform(d));if(c){const d=this.satisfies(n[c]);if(d!==void 0)return d}}if(o>0){const a=Object.keys(s),l=I.find(a,c=>this.isBrowser(c,!0));if(l!==void 0)return this.compareVersion(s[l])}}isBrowser(e,n=!1){const r=this.getBrowserName().toLowerCase();let s=e.toLowerCase();const o=I.getBrowserTypeByAlias(s);return n&&o&&(s=o.toLowerCase()),s===r}compareVersion(e){let n=[0],r=e,s=!1;const o=this.getBrowserVersion();if(typeof o=="string")return e[0]===">"||e[0]==="<"?(r=e.substr(1),e[1]==="="?(s=!0,r=e.substr(2)):n=[],e[0]===">"?n.push(1):n.push(-1)):e[0]==="="?r=e.substr(1):e[0]==="~"&&(s=!0,r=e.substr(1)),n.indexOf(I.compareVersions(o,r,s))>-1}isOS(e){return this.getOSName(!0)===String(e).toLowerCase()}isPlatform(e){return this.getPlatformType(!0)===String(e).toLowerCase()}isEngine(e){return this.getEngineName(!0)===String(e).toLowerCase()}is(e,n=!1){return this.isBrowser(e,n)||this.isOS(e)||this.isPlatform(e)}some(e=[]){return e.some(n=>this.is(n))}}/*!
 * Bowser - a browser detector
 * https://github.com/lancedikson/bowser
 * MIT License | (c) Dustin Diaz 2012-2015
 * MIT License | (c) Denis Demchenko 2015-2019
 */class Pd{static getParser(e,n=!1){if(typeof e!="string")throw new Error("UserAgent should be a string");return new _a(e,n)}static parse(e){return new _a(e).getResult()}static get BROWSER_MAP(){return Bd}static get ENGINE_MAP(){return vt}static get OS_MAP(){return Ae}static get PLATFORMS_MAP(){return he}}const T_=({serviceId:t,clientVersion:e})=>async n=>{const r=typeof window<"u"&&window?.navigator?.userAgent?Pd.parse(window.navigator.userAgent):void 0,s=[["aws-sdk-js",e],["ua","2.1"],[`os/${r?.os?.name||"other"}`,r?.os?.version],["lang/js"],["md/browser",`${r?.browser?.name??"unknown"}_${r?.browser?.version??"unknown"}`]];t&&s.push([`api/${t}`,e]);const o=await n?.userAgentAppId?.();return o&&s.push([`app/${o}`]),s},I_=t=>()=>Promise.reject(t),Nd="required",Qe="fn",Xe="argv",on="ref",xa=!0,Ea="isSet",Cn="booleanEquals",Ht="error",ln="endpoint",Se="tree",Do="PartitionResult",ka={[Nd]:!1,type:"String"},Sa={[Nd]:!0,default:!1,type:"Boolean"},Aa={[on]:"Endpoint"},Md={[Qe]:Cn,[Xe]:[{[on]:"UseFIPS"},!0]},Dd={[Qe]:Cn,[Xe]:[{[on]:"UseDualStack"},!0]},Je={},Ca={[Qe]:"getAttr",[Xe]:[{[on]:Do},"supportsFIPS"]},Ta={[Qe]:Cn,[Xe]:[!0,{[Qe]:"getAttr",[Xe]:[{[on]:Do},"supportsDualStack"]}]},Ia=[Md],Ra=[Dd],$a=[{[on]:"Region"}],R_={parameters:{Region:ka,UseDualStack:Sa,UseFIPS:Sa,Endpoint:ka},rules:[{conditions:[{[Qe]:Ea,[Xe]:[Aa]}],rules:[{conditions:Ia,error:"Invalid Configuration: FIPS and custom endpoint are not supported",type:Ht},{rules:[{conditions:Ra,error:"Invalid Configuration: Dualstack and custom endpoint are not supported",type:Ht},{endpoint:{url:Aa,properties:Je,headers:Je},type:ln}],type:Se}],type:Se},{rules:[{conditions:[{[Qe]:Ea,[Xe]:$a}],rules:[{conditions:[{[Qe]:"aws.partition",[Xe]:$a,assign:Do}],rules:[{conditions:[Md,Dd],rules:[{conditions:[{[Qe]:Cn,[Xe]:[xa,Ca]},Ta],rules:[{rules:[{endpoint:{url:"https://bedrock-runtime-fips.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:Je,headers:Je},type:ln}],type:Se}],type:Se},{error:"FIPS and DualStack are enabled, but this partition does not support one or both",type:Ht}],type:Se},{conditions:Ia,rules:[{conditions:[{[Qe]:Cn,[Xe]:[Ca,xa]}],rules:[{rules:[{endpoint:{url:"https://bedrock-runtime-fips.{Region}.{PartitionResult#dnsSuffix}",properties:Je,headers:Je},type:ln}],type:Se}],type:Se},{error:"FIPS is enabled but this partition does not support FIPS",type:Ht}],type:Se},{conditions:Ra,rules:[{conditions:[Ta],rules:[{rules:[{endpoint:{url:"https://bedrock-runtime.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:Je,headers:Je},type:ln}],type:Se}],type:Se},{error:"DualStack is enabled but this partition does not support DualStack",type:Ht}],type:Se},{rules:[{endpoint:{url:"https://bedrock-runtime.{Region}.{PartitionResult#dnsSuffix}",properties:Je,headers:Je},type:ln}],type:Se}],type:Se}],type:Se},{error:"Invalid Configuration: Missing Region",type:Ht}],type:Se}]},$_=R_,O_=new Uv({size:50,params:["Endpoint","Region","UseDualStack","UseFIPS"]}),B_=(t,e={})=>O_.get(t,()=>rw($_,{endpointParams:t,logger:e.logger}));Cr.aws=ld;const P_=t=>({apiVersion:"2023-09-30",base64Decoder:t?.base64Decoder??Ao,base64Encoder:t?.base64Encoder??Ju,disableHostPrefix:t?.disableHostPrefix??!1,endpointProvider:t?.endpointProvider??B_,extensions:t?.extensions??[],httpAuthSchemeProvider:t?.httpAuthSchemeProvider??s_,httpAuthSchemes:t?.httpAuthSchemes??[{schemeId:"aws.auth#sigv4",identityProvider:e=>e.getIdentityProvider("aws.auth#sigv4"),signer:new hw},{schemeId:"smithy.api#httpBearerAuth",identityProvider:e=>e.getIdentityProvider("smithy.api#httpBearerAuth"),signer:new Ov}],logger:t?.logger??new vd,serviceId:t?.serviceId??"Bedrock Runtime",urlParser:t?.urlParser??Tr,utf8Decoder:t?.utf8Decoder??en,utf8Encoder:t?.utf8Encoder??zu}),N_=["in-region","cross-region","mobile","standard","legacy"],M_=({defaultsMode:t}={})=>mw(async()=>{const e=typeof t=="function"?await t():t;switch(e?.toLowerCase()){case"auto":return Promise.resolve(D_()?"mobile":"standard");case"mobile":case"in-region":case"cross-region":case"standard":case"legacy":return Promise.resolve(e?.toLocaleLowerCase());case void 0:return Promise.resolve("legacy");default:throw new Error(`Invalid parameter for "defaultsMode", expect ${N_.join(", ")}, got ${e}`)}}),D_=()=>{const e=(typeof window<"u"&&window?.navigator?.userAgent?Pd.parse(window.navigator.userAgent):void 0)?.platform?.type;return e==="tablet"||e==="mobile"},U_=t=>{const e=M_(t),n=()=>e().then(Yw),r=P_(t);return{...r,...t,runtime:"browser",defaultsMode:e,bodyLengthChecker:t?.bodyLengthChecker??qw,credentialDefaultProvider:t?.credentialDefaultProvider??(s=>()=>Promise.reject(new Error("Credential is missing"))),defaultUserAgentProvider:t?.defaultUserAgentProvider??T_({serviceId:r.serviceId,clientVersion:c_.version}),eventStreamPayloadHandlerProvider:t?.eventStreamPayloadHandlerProvider??Kb,eventStreamSerdeProvider:t?.eventStreamSerdeProvider??Xb,maxAttempts:t?.maxAttempts??Rr,region:t?.region??I_("Region is missing"),requestHandler:Bo.create(t?.requestHandler??n,kn.create(n)),retryMode:t?.retryMode??(async()=>(await n()).retryMode||E0),sha256:t?.sha256??x_,streamCollector:t?.streamCollector??gv,useDualstackEndpoint:t?.useDualstackEndpoint??(()=>Promise.resolve(s0)),useFipsEndpoint:t?.useFipsEndpoint??(()=>Promise.resolve(o0))}},L_=t=>({setRegion(e){t.region=e},region(){return t.region}}),F_=t=>({region:t.region()}),j_=t=>{const e=t.httpAuthSchemes;let n=t.httpAuthSchemeProvider,r=t.credentials,s=t.token;return{setHttpAuthScheme(o){const i=e.findIndex(a=>a.schemeId===o.schemeId);i===-1?e.push(o):e.splice(i,1,o)},httpAuthSchemes(){return e},setHttpAuthSchemeProvider(o){n=o},httpAuthSchemeProvider(){return n},setCredentials(o){r=o},credentials(){return r},setToken(o){s=o},token(){return s}}},H_=t=>({httpAuthSchemes:t.httpAuthSchemes(),httpAuthSchemeProvider:t.httpAuthSchemeProvider(),credentials:t.credentials(),token:t.token()}),K_=(t,e)=>{const n=Object.assign(L_(t),nb(t),Uy(t),j_(t));return e.forEach(r=>r.configure(n)),Object.assign(t,F_(n),rb(n),Ly(n),H_(n))};class V_ extends Gw{config;constructor(...[e]){const n=U_(e||{});super(n),this.initConfig=n;const r=i_(n),s=Dv(r),o=G0(s),i=i0(o),a=i,l=x0(a),c=a0(l),d=o_(c),h=Dy(d),p=qb(h),g=K_(p,e?.extensions||[]);this.config=g,this.middlewareStack.use(wb(this.config)),this.middlewareStack.use(X0(this.config)),this.middlewareStack.use(u0(this.config)),this.middlewareStack.use(Ky(this.config)),this.middlewareStack.use(Gy(this.config)),this.middlewareStack.use(Yy(this.config)),this.middlewareStack.use(nv(this.config,{httpAuthSchemeParametersProvider:t_,identityProviderConfigProvider:async v=>new $v({"aws.auth#sigv4":v.credentials,"smithy.api#httpBearerAuth":v.token})})),this.middlewareStack.use(uv(this.config))}destroy(){super.destroy()}}class Ie extends Vt{constructor(e){super(e),Object.setPrototypeOf(this,Ie.prototype)}}class Uo extends Ie{name="AccessDeniedException";$fault="client";constructor(e){super({name:"AccessDeniedException",$fault:"client",...e}),Object.setPrototypeOf(this,Uo.prototype)}}var Oa;(function(t){t.visit=(e,n)=>e.s3OutputDataConfig!==void 0?n.s3OutputDataConfig(e.s3OutputDataConfig):n._(e.$unknown[0],e.$unknown[1])})(Oa||(Oa={}));class Lo extends Ie{name="InternalServerException";$fault="server";constructor(e){super({name:"InternalServerException",$fault:"server",...e}),Object.setPrototypeOf(this,Lo.prototype)}}class Fo extends Ie{name="ThrottlingException";$fault="client";constructor(e){super({name:"ThrottlingException",$fault:"client",...e}),Object.setPrototypeOf(this,Fo.prototype)}}class jo extends Ie{name="ValidationException";$fault="client";constructor(e){super({name:"ValidationException",$fault:"client",...e}),Object.setPrototypeOf(this,jo.prototype)}}class Ho extends Ie{name="ConflictException";$fault="client";constructor(e){super({name:"ConflictException",$fault:"client",...e}),Object.setPrototypeOf(this,Ho.prototype)}}class Ko extends Ie{name="ResourceNotFoundException";$fault="client";constructor(e){super({name:"ResourceNotFoundException",$fault:"client",...e}),Object.setPrototypeOf(this,Ko.prototype)}}class Vo extends Ie{name="ServiceQuotaExceededException";$fault="client";constructor(e){super({name:"ServiceQuotaExceededException",$fault:"client",...e}),Object.setPrototypeOf(this,Vo.prototype)}}class qo extends Ie{name="ServiceUnavailableException";$fault="server";constructor(e){super({name:"ServiceUnavailableException",$fault:"server",...e}),Object.setPrototypeOf(this,qo.prototype)}}var Ba;(function(t){t.visit=(e,n)=>e.bytes!==void 0?n.bytes(e.bytes):n._(e.$unknown[0],e.$unknown[1])})(Ba||(Ba={}));var Pa;(function(t){t.visit=(e,n)=>e.text!==void 0?n.text(e.text):e.image!==void 0?n.image(e.image):n._(e.$unknown[0],e.$unknown[1])})(Pa||(Pa={}));var Na;(function(t){t.visit=(e,n)=>e.documentChar!==void 0?n.documentChar(e.documentChar):e.documentPage!==void 0?n.documentPage(e.documentPage):e.documentChunk!==void 0?n.documentChunk(e.documentChunk):n._(e.$unknown[0],e.$unknown[1])})(Na||(Na={}));var Ma;(function(t){t.visit=(e,n)=>e.text!==void 0?n.text(e.text):n._(e.$unknown[0],e.$unknown[1])})(Ma||(Ma={}));var Da;(function(t){t.visit=(e,n)=>e.text!==void 0?n.text(e.text):n._(e.$unknown[0],e.$unknown[1])})(Da||(Da={}));var Ua;(function(t){t.visit=(e,n)=>e.text!==void 0?n.text(e.text):n._(e.$unknown[0],e.$unknown[1])})(Ua||(Ua={}));var Qs;(function(t){t.visit=(e,n)=>e.bytes!==void 0?n.bytes(e.bytes):e.s3Location!==void 0?n.s3Location(e.s3Location):e.text!==void 0?n.text(e.text):e.content!==void 0?n.content(e.content):n._(e.$unknown[0],e.$unknown[1])})(Qs||(Qs={}));var Xs;(function(t){t.visit=(e,n)=>e.bytes!==void 0?n.bytes(e.bytes):n._(e.$unknown[0],e.$unknown[1])})(Xs||(Xs={}));var eo;(function(t){t.visit=(e,n)=>e.text!==void 0?n.text(e.text):e.image!==void 0?n.image(e.image):n._(e.$unknown[0],e.$unknown[1])})(eo||(eo={}));var to;(function(t){t.visit=(e,n)=>e.bytes!==void 0?n.bytes(e.bytes):e.s3Location!==void 0?n.s3Location(e.s3Location):n._(e.$unknown[0],e.$unknown[1])})(to||(to={}));var no;(function(t){t.visit=(e,n)=>e.reasoningText!==void 0?n.reasoningText(e.reasoningText):e.redactedContent!==void 0?n.redactedContent(e.redactedContent):n._(e.$unknown[0],e.$unknown[1])})(no||(no={}));var ro;(function(t){t.visit=(e,n)=>e.bytes!==void 0?n.bytes(e.bytes):e.s3Location!==void 0?n.s3Location(e.s3Location):n._(e.$unknown[0],e.$unknown[1])})(ro||(ro={}));var so;(function(t){t.visit=(e,n)=>e.json!==void 0?n.json(e.json):e.text!==void 0?n.text(e.text):e.image!==void 0?n.image(e.image):e.document!==void 0?n.document(e.document):e.video!==void 0?n.video(e.video):n._(e.$unknown[0],e.$unknown[1])})(so||(so={}));var oo;(function(t){t.visit=(e,n)=>e.text!==void 0?n.text(e.text):e.image!==void 0?n.image(e.image):e.document!==void 0?n.document(e.document):e.video!==void 0?n.video(e.video):e.toolUse!==void 0?n.toolUse(e.toolUse):e.toolResult!==void 0?n.toolResult(e.toolResult):e.guardContent!==void 0?n.guardContent(e.guardContent):e.cachePoint!==void 0?n.cachePoint(e.cachePoint):e.reasoningContent!==void 0?n.reasoningContent(e.reasoningContent):e.citationsContent!==void 0?n.citationsContent(e.citationsContent):n._(e.$unknown[0],e.$unknown[1])})(oo||(oo={}));var La;(function(t){t.visit=(e,n)=>e.text!==void 0?n.text(e.text):n._(e.$unknown[0],e.$unknown[1])})(La||(La={}));var io;(function(t){t.visit=(e,n)=>e.text!==void 0?n.text(e.text):e.guardContent!==void 0?n.guardContent(e.guardContent):e.cachePoint!==void 0?n.cachePoint(e.cachePoint):n._(e.$unknown[0],e.$unknown[1])})(io||(io={}));var Fa;(function(t){t.visit=(e,n)=>e.auto!==void 0?n.auto(e.auto):e.any!==void 0?n.any(e.any):e.tool!==void 0?n.tool(e.tool):n._(e.$unknown[0],e.$unknown[1])})(Fa||(Fa={}));var ao;(function(t){t.visit=(e,n)=>e.json!==void 0?n.json(e.json):n._(e.$unknown[0],e.$unknown[1])})(ao||(ao={}));var co;(function(t){t.visit=(e,n)=>e.toolSpec!==void 0?n.toolSpec(e.toolSpec):e.cachePoint!==void 0?n.cachePoint(e.cachePoint):n._(e.$unknown[0],e.$unknown[1])})(co||(co={}));var ja;(function(t){t.visit=(e,n)=>e.message!==void 0?n.message(e.message):n._(e.$unknown[0],e.$unknown[1])})(ja||(ja={}));class Go extends Ie{name="ModelErrorException";$fault="client";originalStatusCode;resourceName;constructor(e){super({name:"ModelErrorException",$fault:"client",...e}),Object.setPrototypeOf(this,Go.prototype),this.originalStatusCode=e.originalStatusCode,this.resourceName=e.resourceName}}class zo extends Ie{name="ModelNotReadyException";$fault="client";$retryable={};constructor(e){super({name:"ModelNotReadyException",$fault:"client",...e}),Object.setPrototypeOf(this,zo.prototype)}}class Jo extends Ie{name="ModelTimeoutException";$fault="client";constructor(e){super({name:"ModelTimeoutException",$fault:"client",...e}),Object.setPrototypeOf(this,Jo.prototype)}}var Ha;(function(t){t.visit=(e,n)=>e.text!==void 0?n.text(e.text):e.redactedContent!==void 0?n.redactedContent(e.redactedContent):e.signature!==void 0?n.signature(e.signature):n._(e.$unknown[0],e.$unknown[1])})(Ha||(Ha={}));var Ka;(function(t){t.visit=(e,n)=>e.text!==void 0?n.text(e.text):e.toolUse!==void 0?n.toolUse(e.toolUse):e.reasoningContent!==void 0?n.reasoningContent(e.reasoningContent):e.citation!==void 0?n.citation(e.citation):n._(e.$unknown[0],e.$unknown[1])})(Ka||(Ka={}));var Va;(function(t){t.visit=(e,n)=>e.toolUse!==void 0?n.toolUse(e.toolUse):n._(e.$unknown[0],e.$unknown[1])})(Va||(Va={}));class Wo extends Ie{name="ModelStreamErrorException";$fault="client";originalStatusCode;originalMessage;constructor(e){super({name:"ModelStreamErrorException",$fault:"client",...e}),Object.setPrototypeOf(this,Wo.prototype),this.originalStatusCode=e.originalStatusCode,this.originalMessage=e.originalMessage}}var qa;(function(t){t.visit=(e,n)=>e.messageStart!==void 0?n.messageStart(e.messageStart):e.contentBlockStart!==void 0?n.contentBlockStart(e.contentBlockStart):e.contentBlockDelta!==void 0?n.contentBlockDelta(e.contentBlockDelta):e.contentBlockStop!==void 0?n.contentBlockStop(e.contentBlockStop):e.messageStop!==void 0?n.messageStop(e.messageStop):e.metadata!==void 0?n.metadata(e.metadata):e.internalServerException!==void 0?n.internalServerException(e.internalServerException):e.modelStreamErrorException!==void 0?n.modelStreamErrorException(e.modelStreamErrorException):e.validationException!==void 0?n.validationException(e.validationException):e.throttlingException!==void 0?n.throttlingException(e.throttlingException):e.serviceUnavailableException!==void 0?n.serviceUnavailableException(e.serviceUnavailableException):n._(e.$unknown[0],e.$unknown[1])})(qa||(qa={}));var Ga;(function(t){t.visit=(e,n)=>e.chunk!==void 0?n.chunk(e.chunk):n._(e.$unknown[0],e.$unknown[1])})(Ga||(Ga={}));var za;(function(t){t.visit=(e,n)=>e.chunk!==void 0?n.chunk(e.chunk):e.internalServerException!==void 0?n.internalServerException(e.internalServerException):e.modelStreamErrorException!==void 0?n.modelStreamErrorException(e.modelStreamErrorException):e.validationException!==void 0?n.validationException(e.validationException):e.throttlingException!==void 0?n.throttlingException(e.throttlingException):e.modelTimeoutException!==void 0?n.modelTimeoutException(e.modelTimeoutException):e.serviceUnavailableException!==void 0?n.serviceUnavailableException(e.serviceUnavailableException):n._(e.$unknown[0],e.$unknown[1])})(za||(za={}));var Ja;(function(t){t.visit=(e,n)=>e.chunk!==void 0?n.chunk(e.chunk):e.internalServerException!==void 0?n.internalServerException(e.internalServerException):e.modelStreamErrorException!==void 0?n.modelStreamErrorException(e.modelStreamErrorException):e.validationException!==void 0?n.validationException(e.validationException):e.throttlingException!==void 0?n.throttlingException(e.throttlingException):e.modelTimeoutException!==void 0?n.modelTimeoutException(e.modelTimeoutException):e.serviceUnavailableException!==void 0?n.serviceUnavailableException(e.serviceUnavailableException):n._(e.$unknown[0],e.$unknown[1])})(Ja||(Ja={}));const Ud=t=>{if(t.text!==void 0)return{text:t.text};if(t.image!==void 0)return{image:Ct};if(t.$unknown!==void 0)return{[t.$unknown[0]]:"UNKNOWN"}},q_=t=>{if(t.text!==void 0)return{text:t.text};if(t.image!==void 0)return{image:t.image};if(t.document!==void 0)return{document:t.document};if(t.video!==void 0)return{video:t.video};if(t.toolUse!==void 0)return{toolUse:t.toolUse};if(t.toolResult!==void 0)return{toolResult:t.toolResult};if(t.guardContent!==void 0)return{guardContent:Ud(t.guardContent)};if(t.cachePoint!==void 0)return{cachePoint:t.cachePoint};if(t.reasoningContent!==void 0)return{reasoningContent:Ct};if(t.citationsContent!==void 0)return{citationsContent:t.citationsContent};if(t.$unknown!==void 0)return{[t.$unknown[0]]:"UNKNOWN"}},Zo=t=>({...t,...t.content&&{content:t.content.map(e=>q_(e))}}),Ld=t=>{if(t.text!==void 0)return{text:t.text};if(t.guardContent!==void 0)return{guardContent:Ud(t.guardContent)};if(t.cachePoint!==void 0)return{cachePoint:t.cachePoint};if(t.$unknown!==void 0)return{[t.$unknown[0]]:"UNKNOWN"}},G_=t=>({...t,...t.messages&&{messages:t.messages.map(e=>Zo(e))},...t.system&&{system:t.system.map(e=>Ld(e))},...t.toolConfig&&{toolConfig:t.toolConfig},...t.promptVariables&&{promptVariables:Ct},...t.requestMetadata&&{requestMetadata:Ct}}),z_=t=>{if(t.message!==void 0)return{message:Zo(t.message)};if(t.$unknown!==void 0)return{[t.$unknown[0]]:"UNKNOWN"}},J_=t=>({...t,...t.output&&{output:z_(t.output)}}),W_=t=>({...t,...t.messages&&{messages:t.messages.map(e=>Zo(e))},...t.system&&{system:t.system.map(e=>Ld(e))},...t.toolConfig&&{toolConfig:t.toolConfig},...t.promptVariables&&{promptVariables:Ct},...t.requestMetadata&&{requestMetadata:Ct}}),Z_=t=>({...t,...t.stream&&{stream:"STREAMING_CONTENT"}}),Y_=t=>({...t,...t.body&&{body:Ct}}),Q_=t=>({...t,...t.body&&{body:Ct}}),X_=async(t,e)=>{const n=Io(t,e),r={"content-type":"application/json"};n.bp("/model/{modelId}/converse"),n.p("modelId",()=>t.modelId,"{modelId}",!1);let s;return s=JSON.stringify(G(t,{additionalModelRequestFields:o=>On(o),additionalModelResponseFieldPaths:o=>L(o),guardrailConfig:o=>L(o),inferenceConfig:o=>Jd(o),messages:o=>Wd(o,e),performanceConfig:o=>L(o),promptVariables:o=>L(o),requestMetadata:o=>L(o),system:o=>Zd(o,e),toolConfig:o=>Yd(o)})),n.m("POST").h(r).b(s),n.build()},ex=async(t,e)=>{const n=Io(t,e),r={"content-type":"application/json"};n.bp("/model/{modelId}/converse-stream"),n.p("modelId",()=>t.modelId,"{modelId}",!1);let s;return s=JSON.stringify(G(t,{additionalModelRequestFields:o=>On(o),additionalModelResponseFieldPaths:o=>L(o),guardrailConfig:o=>L(o),inferenceConfig:o=>Jd(o),messages:o=>Wd(o,e),performanceConfig:o=>L(o),promptVariables:o=>L(o),requestMetadata:o=>L(o),system:o=>Zd(o,e),toolConfig:o=>Yd(o)})),n.m("POST").h(r).b(s),n.build()},tx=async(t,e)=>{const n=Io(t,e),r=xe({},sb,{[of]:t[sf]||"application/octet-stream",[Wa]:t[Wa],[xE]:t[wE],[bE]:t[yE],[_E]:t[vE],[cf]:t[af]});n.bp("/model/{modelId}/invoke"),n.p("modelId",()=>t.modelId,"{modelId}",!1);let s;return t.body!==void 0&&(s=t.body),n.m("POST").h(r).b(s),n.build()},nx=async(t,e)=>{if(t.statusCode!==200&&t.statusCode>=300)return Yo(t,e);const n=xe({$metadata:Re(t)}),r=Sv(Qu(await De(t.body,e)),"body"),s=G(r,{additionalModelResponseFields:o=>jr(o),metrics:L,output:o=>zx(Ke(o),e),performanceConfig:L,stopReason:V,trace:o=>Zx(o),usage:L});return Object.assign(n,s),n},rx=async(t,e)=>{if(t.statusCode!==200&&t.statusCode>=300)return Yo(t,e);const n=xe({$metadata:Re(t)}),r=t.body;return n.stream=px(r,e),n},sx=async(t,e)=>{if(t.statusCode!==200&&t.statusCode>=300)return Yo(t,e);const n=xe({$metadata:Re(t),[sf]:[,t.headers[of]],[af]:[,t.headers[cf]]}),r=await Yu(t.body,e);return n.body=r,n},Yo=async(t,e)=>{const n={...t,body:await lb(t.body,e)},r=ub(t,n.body);switch(r){case"AccessDeniedException":case"com.amazonaws.bedrockruntime#AccessDeniedException":throw await ix(n);case"InternalServerException":case"com.amazonaws.bedrockruntime#InternalServerException":throw await Fd(n);case"ResourceNotFoundException":case"com.amazonaws.bedrockruntime#ResourceNotFoundException":throw await dx(n);case"ServiceQuotaExceededException":case"com.amazonaws.bedrockruntime#ServiceQuotaExceededException":throw await fx(n);case"ThrottlingException":case"com.amazonaws.bedrockruntime#ThrottlingException":throw await Kd(n);case"ValidationException":case"com.amazonaws.bedrockruntime#ValidationException":throw await Vd(n);case"ModelErrorException":case"com.amazonaws.bedrockruntime#ModelErrorException":throw await cx(n);case"ModelNotReadyException":case"com.amazonaws.bedrockruntime#ModelNotReadyException":throw await lx(n);case"ModelTimeoutException":case"com.amazonaws.bedrockruntime#ModelTimeoutException":throw await ux(n);case"ServiceUnavailableException":case"com.amazonaws.bedrockruntime#ServiceUnavailableException":throw await Hd(n);case"ModelStreamErrorException":case"com.amazonaws.bedrockruntime#ModelStreamErrorException":throw await jd(n);case"ConflictException":case"com.amazonaws.bedrockruntime#ConflictException":throw await ax(n);default:const s=n.body;return ox({output:t,parsedBody:s,errorCode:r})}},ox=Ww(Ie),ix=async(t,e)=>{const n=xe({}),r=t.body,s=G(r,{message:V});Object.assign(n,s);const o=new Uo({$metadata:Re(t),...n});return Me(o,t.body)},ax=async(t,e)=>{const n=xe({}),r=t.body,s=G(r,{message:V});Object.assign(n,s);const o=new Ho({$metadata:Re(t),...n});return Me(o,t.body)},Fd=async(t,e)=>{const n=xe({}),r=t.body,s=G(r,{message:V});Object.assign(n,s);const o=new Lo({$metadata:Re(t),...n});return Me(o,t.body)},cx=async(t,e)=>{const n=xe({}),r=t.body,s=G(r,{message:V,originalStatusCode:To,resourceName:V});Object.assign(n,s);const o=new Go({$metadata:Re(t),...n});return Me(o,t.body)},lx=async(t,e)=>{const n=xe({}),r=t.body,s=G(r,{message:V});Object.assign(n,s);const o=new zo({$metadata:Re(t),...n});return Me(o,t.body)},jd=async(t,e)=>{const n=xe({}),r=t.body,s=G(r,{message:V,originalMessage:V,originalStatusCode:To});Object.assign(n,s);const o=new Wo({$metadata:Re(t),...n});return Me(o,t.body)},ux=async(t,e)=>{const n=xe({}),r=t.body,s=G(r,{message:V});Object.assign(n,s);const o=new Jo({$metadata:Re(t),...n});return Me(o,t.body)},dx=async(t,e)=>{const n=xe({}),r=t.body,s=G(r,{message:V});Object.assign(n,s);const o=new Ko({$metadata:Re(t),...n});return Me(o,t.body)},fx=async(t,e)=>{const n=xe({}),r=t.body,s=G(r,{message:V});Object.assign(n,s);const o=new Vo({$metadata:Re(t),...n});return Me(o,t.body)},Hd=async(t,e)=>{const n=xe({}),r=t.body,s=G(r,{message:V});Object.assign(n,s);const o=new qo({$metadata:Re(t),...n});return Me(o,t.body)},Kd=async(t,e)=>{const n=xe({}),r=t.body,s=G(r,{message:V});Object.assign(n,s);const o=new Fo({$metadata:Re(t),...n});return Me(o,t.body)},Vd=async(t,e)=>{const n=xe({}),r=t.body,s=G(r,{message:V});Object.assign(n,s);const o=new jo({$metadata:Re(t),...n});return Me(o,t.body)},px=(t,e)=>e.eventStreamMarshaller.deserialize(t,async n=>n.messageStart!=null?{messageStart:await wx(n.messageStart,e)}:n.contentBlockStart!=null?{contentBlockStart:await mx(n.contentBlockStart,e)}:n.contentBlockDelta!=null?{contentBlockDelta:await hx(n.contentBlockDelta,e)}:n.contentBlockStop!=null?{contentBlockStop:await gx(n.contentBlockStop,e)}:n.messageStop!=null?{messageStop:await bx(n.messageStop,e)}:n.metadata!=null?{metadata:await yx(n.metadata,e)}:n.internalServerException!=null?{internalServerException:await vx(n.internalServerException,e)}:n.modelStreamErrorException!=null?{modelStreamErrorException:await _x(n.modelStreamErrorException,e)}:n.validationException!=null?{validationException:await kx(n.validationException,e)}:n.throttlingException!=null?{throttlingException:await Ex(n.throttlingException,e)}:n.serviceUnavailableException!=null?{serviceUnavailableException:await xx(n.serviceUnavailableException,e)}:{$unknown:n}),hx=async(t,e)=>{const n={},r=await De(t.body,e);return Object.assign(n,qx(r,e)),n},mx=async(t,e)=>{const n={},r=await De(t.body,e);return Object.assign(n,L(r)),n},gx=async(t,e)=>{const n={},r=await De(t.body,e);return Object.assign(n,L(r)),n},yx=async(t,e)=>{const n={},r=await De(t.body,e);return Object.assign(n,Jx(r)),n},vx=async(t,e)=>{const n={...t,body:await De(t.body,e)};return Fd(n)},wx=async(t,e)=>{const n={},r=await De(t.body,e);return Object.assign(n,L(r)),n},bx=async(t,e)=>{const n={},r=await De(t.body,e);return Object.assign(n,lE(r)),n},_x=async(t,e)=>{const n={...t,body:await De(t.body,e)};return jd(n)},xx=async(t,e)=>{const n={...t,body:await De(t.body,e)};return Hd(n)},Ex=async(t,e)=>{const n={...t,body:await De(t.body,e)};return Kd(n)},kx=async(t,e)=>{const n={...t,body:await De(t.body,e)};return Vd(n)},Sx=(t,e)=>oo.visit(t,{cachePoint:n=>({cachePoint:L(n)}),citationsContent:n=>({citationsContent:L(n)}),document:n=>({document:qd(n,e)}),guardContent:n=>({guardContent:Gd(n,e)}),image:n=>({image:zd(n,e)}),reasoningContent:n=>({reasoningContent:Ox(n,e)}),text:n=>({text:n}),toolResult:n=>({toolResult:Mx(n,e)}),toolUse:n=>({toolUse:jx(n)}),video:n=>({video:Qd(n,e)}),_:(n,r)=>({[n]:r})}),Ax=(t,e)=>t.filter(n=>n!=null).map(n=>Sx(n,e)),qd=(t,e)=>G(t,{citations:L,context:[],format:[],name:[],source:n=>Cx(n,e)}),Cx=(t,e)=>Qs.visit(t,{bytes:n=>({bytes:e.base64Encoder(n)}),content:n=>({content:L(n)}),s3Location:n=>({s3Location:L(n)}),text:n=>({text:n}),_:(n,r)=>({[n]:r})}),Gd=(t,e)=>eo.visit(t,{image:n=>({image:Tx(n,e)}),text:n=>({text:L(n)}),_:(n,r)=>({[n]:r})}),Tx=(t,e)=>G(t,{format:[],source:n=>Ix(n,e)}),Ix=(t,e)=>Xs.visit(t,{bytes:n=>({bytes:e.base64Encoder(n)}),_:(n,r)=>({[n]:r})}),zd=(t,e)=>G(t,{format:[],source:n=>Rx(n,e)}),Rx=(t,e)=>to.visit(t,{bytes:n=>({bytes:e.base64Encoder(n)}),s3Location:n=>({s3Location:L(n)}),_:(n,r)=>({[n]:r})}),Jd=(t,e)=>G(t,{maxTokens:[],stopSequences:L,temperature:aa,topP:aa}),$x=(t,e)=>G(t,{content:n=>Ax(n,e),role:[]}),Wd=(t,e)=>t.filter(n=>n!=null).map(n=>$x(n,e)),Ox=(t,e)=>no.visit(t,{reasoningText:n=>({reasoningText:L(n)}),redactedContent:n=>({redactedContent:e.base64Encoder(n)}),_:(n,r)=>({[n]:r})}),Bx=(t,e)=>io.visit(t,{cachePoint:n=>({cachePoint:L(n)}),guardContent:n=>({guardContent:Gd(n,e)}),text:n=>({text:n}),_:(n,r)=>({[n]:r})}),Zd=(t,e)=>t.filter(n=>n!=null).map(n=>Bx(n,e)),Px=(t,e)=>co.visit(t,{cachePoint:n=>({cachePoint:L(n)}),toolSpec:n=>({toolSpec:Fx(n)}),_:(n,r)=>({[n]:r})}),Yd=(t,e)=>G(t,{toolChoice:L,tools:n=>Lx(n)}),Nx=(t,e)=>ao.visit(t,{json:n=>({json:On(n)}),_:(n,r)=>({[n]:r})}),Mx=(t,e)=>G(t,{content:n=>Ux(n,e),status:[],toolUseId:[]}),Dx=(t,e)=>so.visit(t,{document:n=>({document:qd(n,e)}),image:n=>({image:zd(n,e)}),json:n=>({json:On(n)}),text:n=>({text:n}),video:n=>({video:Qd(n,e)}),_:(n,r)=>({[n]:r})}),Ux=(t,e)=>t.filter(n=>n!=null).map(n=>Dx(n,e)),Lx=(t,e)=>t.filter(n=>n!=null).map(n=>Px(n)),Fx=(t,e)=>G(t,{description:[],inputSchema:n=>Nx(n),name:[]}),jx=(t,e)=>G(t,{input:n=>On(n),name:[],toolUseId:[]}),Qd=(t,e)=>G(t,{format:[],source:n=>Hx(n,e)}),Hx=(t,e)=>ro.visit(t,{bytes:n=>({bytes:e.base64Encoder(n)}),s3Location:n=>({s3Location:L(n)}),_:(n,r)=>({[n]:r})}),On=(t,e)=>t,Kx=(t,e)=>t.cachePoint!=null?{cachePoint:L(t.cachePoint)}:t.citationsContent!=null?{citationsContent:L(t.citationsContent)}:t.document!=null?{document:Xd(t.document,e)}:t.guardContent!=null?{guardContent:sE(Ke(t.guardContent),e)}:t.image!=null?{image:nf(t.image,e)}:t.reasoningContent!=null?{reasoningContent:uE(Ke(t.reasoningContent),e)}:V(t.text)!==void 0?{text:V(t.text)}:t.toolResult!=null?{toolResult:fE(t.toolResult,e)}:t.toolUse!=null?{toolUse:mE(t.toolUse)}:t.video!=null?{video:rf(t.video,e)}:{$unknown:Object.entries(t)[0]},Vx=(t,e)=>t.citation!=null?{citation:L(t.citation)}:t.reasoningContent!=null?{reasoningContent:dE(Ke(t.reasoningContent),e)}:V(t.text)!==void 0?{text:V(t.text)}:t.toolUse!=null?{toolUse:L(t.toolUse)}:{$unknown:Object.entries(t)[0]},qx=(t,e)=>G(t,{contentBlockIndex:To,delta:n=>Vx(Ke(n),e)}),Gx=(t,e)=>(t||[]).filter(r=>r!=null).map(r=>Kx(Ke(r),e)),zx=(t,e)=>t.message!=null?{message:cE(t.message,e)}:{$unknown:Object.entries(t)[0]},Jx=(t,e)=>G(t,{metrics:L,performanceConfig:L,trace:n=>Wx(n),usage:L}),Wx=(t,e)=>G(t,{guardrail:n=>tf(n),promptRouter:L}),Zx=(t,e)=>G(t,{guardrail:n=>tf(n),promptRouter:L}),Xd=(t,e)=>G(t,{citations:L,context:V,format:V,name:V,source:n=>Yx(Ke(n),e)}),Yx=(t,e)=>t.bytes!=null?{bytes:e.base64Decoder(t.bytes)}:t.content!=null?{content:L(t.content)}:t.s3Location!=null?{s3Location:L(t.s3Location)}:V(t.text)!==void 0?{text:V(t.text)}:{$unknown:Object.entries(t)[0]},ef=(t,e)=>G(t,{contentPolicy:L,contextualGroundingPolicy:n=>rE(n),invocationMetrics:L,sensitiveInformationPolicy:L,topicPolicy:L,wordPolicy:L}),Qx=(t,e)=>(t||[]).filter(r=>r!=null).map(r=>ef(r)),Xx=(t,e)=>Object.entries(t).reduce((n,[r,s])=>(s===null||(n[r]=Qx(s)),n),{}),eE=(t,e)=>Object.entries(t).reduce((n,[r,s])=>(s===null||(n[r]=ef(s)),n),{}),tE=(t,e)=>G(t,{action:V,detected:bv,score:Ji,threshold:Ji,type:V}),nE=(t,e)=>(t||[]).filter(r=>r!=null).map(r=>tE(r)),rE=(t,e)=>G(t,{filters:n=>nE(n)}),sE=(t,e)=>t.image!=null?{image:oE(t.image,e)}:t.text!=null?{text:L(t.text)}:{$unknown:Object.entries(t)[0]},oE=(t,e)=>G(t,{format:V,source:n=>iE(Ke(n),e)}),iE=(t,e)=>t.bytes!=null?{bytes:e.base64Decoder(t.bytes)}:{$unknown:Object.entries(t)[0]},tf=(t,e)=>G(t,{actionReason:V,inputAssessment:n=>eE(n),modelOutput:L,outputAssessments:n=>Xx(n)}),nf=(t,e)=>G(t,{format:V,source:n=>aE(Ke(n),e)}),aE=(t,e)=>t.bytes!=null?{bytes:e.base64Decoder(t.bytes)}:t.s3Location!=null?{s3Location:L(t.s3Location)}:{$unknown:Object.entries(t)[0]},cE=(t,e)=>G(t,{content:n=>Gx(n,e),role:V}),lE=(t,e)=>G(t,{additionalModelResponseFields:n=>jr(n),stopReason:V}),uE=(t,e)=>t.reasoningText!=null?{reasoningText:L(t.reasoningText)}:t.redactedContent!=null?{redactedContent:e.base64Decoder(t.redactedContent)}:{$unknown:Object.entries(t)[0]},dE=(t,e)=>t.redactedContent!=null?{redactedContent:e.base64Decoder(t.redactedContent)}:V(t.signature)!==void 0?{signature:V(t.signature)}:V(t.text)!==void 0?{text:V(t.text)}:{$unknown:Object.entries(t)[0]},fE=(t,e)=>G(t,{content:n=>hE(n,e),status:V,toolUseId:V}),pE=(t,e)=>t.document!=null?{document:Xd(t.document,e)}:t.image!=null?{image:nf(t.image,e)}:t.json!=null?{json:jr(t.json)}:V(t.text)!==void 0?{text:V(t.text)}:t.video!=null?{video:rf(t.video,e)}:{$unknown:Object.entries(t)[0]},hE=(t,e)=>(t||[]).filter(r=>r!=null).map(r=>pE(Ke(r),e)),mE=(t,e)=>G(t,{input:n=>jr(n),name:V,toolUseId:V}),rf=(t,e)=>G(t,{format:V,source:n=>gE(Ke(n),e)}),gE=(t,e)=>t.bytes!=null?{bytes:e.base64Decoder(t.bytes)}:t.s3Location!=null?{s3Location:L(t.s3Location)}:{$unknown:Object.entries(t)[0]},jr=(t,e)=>t,Re=t=>({httpStatusCode:t.statusCode,requestId:t.headers["x-amzn-requestid"]??t.headers["x-amzn-request-id"]??t.headers["x-amz-request-id"],extendedRequestId:t.headers["x-amz-id-2"],cfId:t.headers["x-amz-cf-id"]}),Wa="accept",sf="contentType",of="content-type",yE="guardrailIdentifier",vE="guardrailVersion",af="performanceConfigLatency",wE="trace",bE="x-amzn-bedrock-guardrailidentifier",_E="x-amzn-bedrock-guardrailversion",cf="x-amzn-bedrock-performanceconfig-latency",xE="x-amzn-bedrock-trace";class EE extends Lr.classBuilder().ep(Mo).m(function(e,n,r,s){return[So(r,this.serialize,this.deserialize),Po(r,e.getEndpointParameterInstructions())]}).s("AmazonBedrockFrontendService","Converse",{}).n("BedrockRuntimeClient","ConverseCommand").f(G_,J_).ser(X_).de(nx).build(){}class kE extends Lr.classBuilder().ep(Mo).m(function(e,n,r,s){return[So(r,this.serialize,this.deserialize),Po(r,e.getEndpointParameterInstructions())]}).s("AmazonBedrockFrontendService","ConverseStream",{eventStream:{output:!0}}).n("BedrockRuntimeClient","ConverseStreamCommand").f(W_,Z_).ser(ex).de(rx).build(){}class SE extends Lr.classBuilder().ep(Mo).m(function(e,n,r,s){return[So(r,this.serialize,this.deserialize),Po(r,e.getEndpointParameterInstructions())]}).s("AmazonBedrockFrontendService","InvokeModel",{}).n("BedrockRuntimeClient","InvokeModelCommand").f(Y_,Q_).ser(tx).de(sx).build(){}function AE(t){var e;const n=(e=t.tools)!=null&&e.length?t.tools:void 0;if(n==null)return{toolConfig:{tools:void 0,toolChoice:void 0},toolWarnings:[]};const r=[],s=[];for(const a of n)a.type==="provider-defined"?r.push({type:"unsupported-tool",tool:a}):s.push({toolSpec:{name:a.name,description:a.description,inputSchema:{json:a.parameters}}});const o=t.toolChoice;if(o==null)return{toolConfig:{tools:s,toolChoice:void 0},toolWarnings:r};const i=o.type;switch(i){case"auto":return{toolConfig:{tools:s,toolChoice:{auto:{}}},toolWarnings:r};case"required":return{toolConfig:{tools:s,toolChoice:{any:{}}},toolWarnings:r};case"none":return{toolConfig:{tools:void 0,toolChoice:void 0},toolWarnings:r};case"tool":return{toolConfig:{tools:s,toolChoice:{tool:{name:o.toolName}}},toolWarnings:r};default:{const a=i;throw new hn({functionality:`Unsupported tool choice type: ${a}`})}}}var CE=qu({prefix:"file",size:16});function TE(t){var e,n,r,s,o;const i=IE(t);let a;const l=[];for(let c=0;c<i.length;c++){const d=i[c],h=c===i.length-1,p=d.type;switch(p){case"system":{if(l.length>0)throw new hn({functionality:"Multiple system messages that are separated by user/assistant messages"});a=d.messages.map(({content:g})=>g).join(`
`);break}case"user":{const g=[];for(const v of d.messages){const{role:b,content:w}=v;switch(b){case"user":{for(let S=0;S<w.length;S++){const A=w[S];switch(A.type){case"text":{g.push({text:A.text});break}case"image":{if(A.image instanceof URL)throw new hn({functionality:"Image URLs in user messages"});g.push({image:{format:(n=(e=A.mimeType)==null?void 0:e.split("/"))==null?void 0:n[1],source:{bytes:(r=A.image)!=null?r:A.image}}});break}case"file":{if(A.data instanceof URL)throw new hn({functionality:"File URLs in user messages"});g.push({document:{format:(o=(s=A.mimeType)==null?void 0:s.split("/"))==null?void 0:o[1],name:CE(),source:{bytes:Ot.from(A.data,"base64")}}});break}}}break}case"tool":{for(let S=0;S<w.length;S++){const A=w[S];g.push({toolResult:{toolUseId:A.toolCallId,content:[{text:JSON.stringify(A.result)}]}})}break}default:{const S=b;throw new Error(`Unsupported role: ${S}`)}}}l.push({role:"user",content:g});break}case"assistant":{const g=[];for(let v=0;v<d.messages.length;v++){const b=d.messages[v],w=v===d.messages.length-1,{content:S}=b;for(let A=0;A<S.length;A++){const O=S[A],B=A===S.length-1;switch(O.type){case"text":{g.push({text:h&&w&&B?O.text.trim():O.text});break}case"tool-call":{g.push({toolUse:{toolUseId:O.toolCallId,name:O.toolName,input:O.args}});break}}}}l.push({role:"assistant",content:g});break}default:{const g=p;throw new Error(`Unsupported type: ${g}`)}}}return{system:a,messages:l}}function IE(t){const e=[];let n;for(const r of t){const{role:s}=r;switch(s){case"system":{n?.type!=="system"&&(n={type:"system",messages:[]},e.push(n)),n.messages.push(r);break}case"assistant":{n?.type!=="assistant"&&(n={type:"assistant",messages:[]},e.push(n)),n.messages.push(r);break}case"user":{n?.type!=="user"&&(n={type:"user",messages:[]},e.push(n)),n.messages.push(r);break}case"tool":{n?.type!=="user"&&(n={type:"user",messages:[]},e.push(n)),n.messages.push(r);break}default:{const o=s;throw new Error(`Unsupported role: ${o}`)}}}return e}function Za(t){switch(t){case"stop_sequence":case"end_turn":return"stop";case"max_tokens":return"length";case"content_filtered":case"guardrail_intervened":return"content-filter";case"tool_use":return"tool-calls";default:return"unknown"}}var RE=class{constructor(t,e,n){this.specificationVersion="v1",this.provider="amazon-bedrock",this.defaultObjectGenerationMode="tool",this.supportsImageUrls=!1,this.modelId=t,this.settings=e,this.config=n}getArgs({mode:t,prompt:e,maxTokens:n,temperature:r,topP:s,topK:o,frequencyPenalty:i,presencePenalty:a,stopSequences:l,responseFormat:c,seed:d,providerMetadata:h,headers:p}){var g,v;const b=t.type,w=[];i!=null&&w.push({type:"unsupported-setting",setting:"frequencyPenalty"}),a!=null&&w.push({type:"unsupported-setting",setting:"presencePenalty"}),d!=null&&w.push({type:"unsupported-setting",setting:"seed"}),p!=null&&w.push({type:"unsupported-setting",setting:"headers"}),o!=null&&w.push({type:"unsupported-setting",setting:"topK"}),c!=null&&c.type!=="text"&&w.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format is not supported."});const{system:S,messages:A}=TE(e),O={modelId:this.modelId,system:S?[{text:S}]:void 0,additionalModelRequestFields:this.settings.additionalModelRequestFields,inferenceConfig:{maxTokens:n,temperature:r,topP:s,stopSequences:l},messages:A,guardrailConfig:(g=h?.bedrock)==null?void 0:g.guardrailConfig};switch(b){case"regular":{const{toolConfig:B,toolWarnings:$}=AE(t);return{command:{...O,...(v=B.tools)!=null&&v.length?{toolConfig:B}:{}},warnings:[...w,...$]}}case"object-json":throw new hn({functionality:"json-mode object generation"});case"object-tool":return{command:{...O,toolConfig:{tools:[{toolSpec:{name:t.tool.name,description:t.tool.description,inputSchema:{json:t.tool.parameters}}}],toolChoice:{tool:{name:t.tool.name}}}},warnings:w};default:{const B=b;throw new Error(`Unsupported type: ${B}`)}}}async doGenerate(t){var e,n,r,s,o,i,a,l,c,d,h,p;const{command:g,warnings:v}=this.getArgs(t),b=await this.config.client.send(new EE(g)),{messages:w,...S}=g,A=b.trace?{bedrock:{trace:b.trace}}:void 0;return{text:(s=(r=(n=(e=b.output)==null?void 0:e.message)==null?void 0:n.content)==null?void 0:r.map(O=>{var B;return(B=O.text)!=null?B:""}).join(""))!=null?s:void 0,toolCalls:(l=(a=(i=(o=b.output)==null?void 0:o.message)==null?void 0:i.content)==null?void 0:a.filter(O=>!!O.toolUse))==null?void 0:l.map(O=>{var B,$,F,N,Z,re;return{toolCallType:"function",toolCallId:($=(B=O.toolUse)==null?void 0:B.toolUseId)!=null?$:this.config.generateId(),toolName:(N=(F=O.toolUse)==null?void 0:F.name)!=null?N:`tool-${this.config.generateId()}`,args:JSON.stringify((re=(Z=O.toolUse)==null?void 0:Z.input)!=null?re:"")}}),finishReason:Za(b.stopReason),usage:{promptTokens:(d=(c=b.usage)==null?void 0:c.inputTokens)!=null?d:Number.NaN,completionTokens:(p=(h=b.usage)==null?void 0:h.outputTokens)!=null?p:Number.NaN},rawCall:{rawPrompt:w,rawSettings:S},warnings:v,providerMetadata:A}}async doStream(t){const{command:e,warnings:n}=this.getArgs(t),r=await this.config.client.send(new kE(e)),{messages:s,...o}=e;let i="unknown",a={promptTokens:Number.NaN,completionTokens:Number.NaN},l;if(!r.stream)throw new Error("No stream found");const c=new ReadableStream({async start(h){for await(const p of r.stream)h.enqueue({success:!0,value:p});h.close()}}),d={};return{stream:c.pipeThrough(new TransformStream({transform(h,p){var g,v,b,w,S,A,O,B,$;function F(te){i="error",p.enqueue({type:"error",error:te})}if(!h.success){F(h.error);return}const N=h.value;if(N.internalServerException){F(N.internalServerException);return}if(N.modelStreamErrorException){F(N.modelStreamErrorException);return}if(N.throttlingException){F(N.throttlingException);return}if(N.validationException){F(N.validationException);return}N.messageStop&&(i=Za(N.messageStop.stopReason)),N.metadata&&(a={promptTokens:(v=(g=N.metadata.usage)==null?void 0:g.inputTokens)!=null?v:Number.NaN,completionTokens:(w=(b=N.metadata.usage)==null?void 0:b.outputTokens)!=null?w:Number.NaN},N.metadata.trace&&(l={bedrock:{trace:N.metadata.trace}})),(A=(S=N.contentBlockDelta)==null?void 0:S.delta)!=null&&A.text&&p.enqueue({type:"text-delta",textDelta:N.contentBlockDelta.delta.text});const Z=N.contentBlockStart;if(((O=Z?.start)==null?void 0:O.toolUse)!=null){const te=Z.start.toolUse;d[Z.contentBlockIndex]={toolCallId:te.toolUseId,toolName:te.name,jsonText:""}}const re=N.contentBlockDelta;if((B=re?.delta)!=null&&B.toolUse){const te=d[re.contentBlockIndex],ue=($=re.delta.toolUse.input)!=null?$:"";p.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:te.toolCallId,toolName:te.toolName,argsTextDelta:ue}),te.jsonText+=ue}const ie=N.contentBlockStop;if(ie!=null){const te=ie.contentBlockIndex,ue=d[te];ue!=null&&(p.enqueue({type:"tool-call",toolCallType:"function",toolCallId:ue.toolCallId,toolName:ue.toolName,args:ue.jsonText}),delete d[te])}},flush(h){h.enqueue({type:"finish",finishReason:i,usage:a,providerMetadata:l})}})),rawCall:{rawPrompt:s,rawSettings:o},warnings:n}}},$E=class{constructor(t,e,n){this.specificationVersion="v1",this.provider="amazon-bedrock",this.maxEmbeddingsPerCall=void 0,this.supportsParallelCalls=!0,this.modelId=t,this.config=n,this.settings=e}async doEmbed({values:t}){const e=async s=>{const o={inputText:s,dimensions:this.settings.dimensions,normalize:this.settings.normalize},i=new SE({contentType:"application/json",body:JSON.stringify(o),modelId:this.modelId}),a=await this.config.client.send(i);return JSON.parse(new TextDecoder().decode(a.body))};return(await Promise.all(t.map(e))).reduce((s,o)=>(s.embeddings.push(o.embedding),s.usage.tokens+=o.inputTextTokenCount,s),{embeddings:[],usage:{tokens:0}})}};function lf(t={}){const e=()=>{var o;return new V_((o=t.bedrockOptions)!=null?o:{region:ns({settingValue:t.region,settingName:"region",environmentVariableName:"AWS_REGION",description:"AWS region"}),credentials:{accessKeyId:ns({settingValue:t.accessKeyId,settingName:"accessKeyId",environmentVariableName:"AWS_ACCESS_KEY_ID",description:"AWS access key ID"}),secretAccessKey:ns({settingValue:t.secretAccessKey,settingName:"secretAccessKey",environmentVariableName:"AWS_SECRET_ACCESS_KEY",description:"AWS secret access key"}),sessionToken:My({settingValue:t.sessionToken,environmentVariableName:"AWS_SESSION_TOKEN"})}})},n=(o,i={})=>new RE(o,i,{client:e(),generateId:Ny}),r=function(o,i){if(new.target)throw new Error("The Amazon Bedrock model function cannot be called with the new keyword.");return n(o,i)},s=(o,i={})=>new $E(o,i,{client:e()});return r.languageModel=n,r.embedding=s,r.textEmbedding=s,r.textEmbeddingModel=s,r}lf();class OE extends ye{name="AmazonBedrock";getApiKeyLink="https://console.aws.amazon.com/iam/home";config={apiTokenKey:"AWS_BEDROCK_CONFIG"};staticModels=[{name:"anthropic.claude-3-5-sonnet-20241022-v2:0",label:"Claude 3.5 Sonnet v2 (Bedrock)",provider:"AmazonBedrock",maxTokenAllowed:2e5},{name:"anthropic.claude-3-5-sonnet-20240620-v1:0",label:"Claude 3.5 Sonnet (Bedrock)",provider:"AmazonBedrock",maxTokenAllowed:4096},{name:"anthropic.claude-3-sonnet-20240229-v1:0",label:"Claude 3 Sonnet (Bedrock)",provider:"AmazonBedrock",maxTokenAllowed:4096},{name:"anthropic.claude-3-haiku-20240307-v1:0",label:"Claude 3 Haiku (Bedrock)",provider:"AmazonBedrock",maxTokenAllowed:4096},{name:"amazon.nova-pro-v1:0",label:"Amazon Nova Pro (Bedrock)",provider:"AmazonBedrock",maxTokenAllowed:5120},{name:"amazon.nova-lite-v1:0",label:"Amazon Nova Lite (Bedrock)",provider:"AmazonBedrock",maxTokenAllowed:5120},{name:"mistral.mistral-large-2402-v1:0",label:"Mistral Large 24.02 (Bedrock)",provider:"AmazonBedrock",maxTokenAllowed:8192}];_parseAndValidateConfig(e){let n;try{n=JSON.parse(e)}catch{throw new Error("Invalid AWS Bedrock configuration format. Please provide a valid JSON string containing region, accessKeyId, and secretAccessKey.")}const{region:r,accessKeyId:s,secretAccessKey:o,sessionToken:i}=n;if(!r||!s||!o)throw new Error("Missing required AWS credentials. Configuration must include region, accessKeyId, and secretAccessKey.");return{region:r,accessKeyId:s,secretAccessKey:o,...i&&{sessionToken:i}}}getModelInstance(e){const{model:n,serverEnv:r,apiKeys:s,providerSettings:o}=e,{apiKey:i}=this.getProviderBaseUrlAndKey({apiKeys:s,providerSettings:o?.[this.name],serverEnv:r,defaultBaseUrlKey:"",defaultApiTokenKey:"AWS_BEDROCK_CONFIG"});if(!i)throw new Error(`Missing API key for ${this.name} provider`);const a=this._parseAndValidateConfig(i);return lf(a)(n)}}class BE extends ye{name="Github";getApiKeyLink="https://github.com/settings/personal-access-tokens";config={apiTokenKey:"GITHUB_API_KEY"};staticModels=[{name:"openai/gpt-4o",label:"GPT-4o",provider:"Github",maxTokenAllowed:131072,maxCompletionTokens:4096},{name:"openai/gpt-4o-mini",label:"GPT-4o Mini",provider:"Github",maxTokenAllowed:131072,maxCompletionTokens:4096},{name:"openai/o1-preview",label:"o1-preview",provider:"Github",maxTokenAllowed:128e3,maxCompletionTokens:32e3},{name:"openai/o1-mini",label:"o1-mini",provider:"Github",maxTokenAllowed:128e3,maxCompletionTokens:65e3},{name:"openai/o1",label:"o1",provider:"Github",maxTokenAllowed:2e5,maxCompletionTokens:1e5},{name:"openai/gpt-4.1",label:"GPT-4.1",provider:"Github",maxTokenAllowed:1048576,maxCompletionTokens:32768},{name:"openai/gpt-4.1-mini",label:"GPT-4.1-mini",provider:"Github",maxTokenAllowed:1048576,maxCompletionTokens:32768},{name:"deepseek/deepseek-r1",label:"DeepSeek-R1",provider:"Github",maxTokenAllowed:128e3,maxCompletionTokens:4096}];async getDynamicModels(e,n,r){const{apiKey:s}=this.getProviderBaseUrlAndKey({apiKeys:e,providerSettings:n,serverEnv:r,defaultBaseUrlKey:"",defaultApiTokenKey:"GITHUB_API_KEY"});if(!s)return console.log("GitHub: No API key found. Make sure GITHUB_API_KEY is set in your .env.local file"),this.staticModels;console.log("GitHub: API key found, attempting to fetch dynamic models...");try{const o=await fetch("https://models.github.ai/v1/models",{headers:{Authorization:`Bearer ${s}`}});if(o.ok){const i=await o.json();if(console.log("GitHub: Successfully fetched models from API"),i.data&&Array.isArray(i.data))return i.data.map(a=>({name:a.id,label:a.name||a.id.split("/").pop()||a.id,provider:"Github",maxTokenAllowed:a.limits?.max_input_tokens||128e3,maxCompletionTokens:a.limits?.max_output_tokens||16384}))}else console.warn("GitHub: API request failed with status:",o.status,o.statusText)}catch(o){console.warn("GitHub: Failed to fetch models, using static models:",o)}return console.log("GitHub: Using static models as fallback"),this.staticModels}getModelInstance(e){const{model:n,serverEnv:r,apiKeys:s,providerSettings:o}=e;console.log(`GitHub: Creating model instance for ${n}`);const{apiKey:i}=this.getProviderBaseUrlAndKey({apiKeys:s,providerSettings:o?.[this.name],serverEnv:r,defaultBaseUrlKey:"",defaultApiTokenKey:"GITHUB_API_KEY"});if(!i)throw console.error("GitHub: No API key found"),new Error(`Missing API key for ${this.name} provider`);console.log(`GitHub: Using API key (first 8 chars): ${i.substring(0,8)}...`);const a=Ve({baseURL:"https://models.github.ai/inference",apiKey:i});return console.log(`GitHub: Created OpenAI client, requesting model: ${n}`),a(n)}}class PE extends ye{name="Moonshot";getApiKeyLink="https://platform.moonshot.ai/console/api-keys";config={apiTokenKey:"MOONSHOT_API_KEY"};staticModels=[{name:"moonshot-v1-8k",label:"Moonshot v1 8K",provider:"Moonshot",maxTokenAllowed:8e3},{name:"moonshot-v1-32k",label:"Moonshot v1 32K",provider:"Moonshot",maxTokenAllowed:32e3},{name:"moonshot-v1-128k",label:"Moonshot v1 128K",provider:"Moonshot",maxTokenAllowed:128e3},{name:"moonshot-v1-auto",label:"Moonshot v1 Auto",provider:"Moonshot",maxTokenAllowed:128e3},{name:"moonshot-v1-8k-vision-preview",label:"Moonshot v1 8K Vision",provider:"Moonshot",maxTokenAllowed:8e3},{name:"moonshot-v1-32k-vision-preview",label:"Moonshot v1 32K Vision",provider:"Moonshot",maxTokenAllowed:32e3},{name:"moonshot-v1-128k-vision-preview",label:"Moonshot v1 128K Vision",provider:"Moonshot",maxTokenAllowed:128e3},{name:"kimi-latest",label:"Kimi Latest",provider:"Moonshot",maxTokenAllowed:128e3},{name:"kimi-k2-0711-preview",label:"Kimi K2 Preview",provider:"Moonshot",maxTokenAllowed:128e3},{name:"kimi-k2-turbo-preview",label:"Kimi K2 Turbo",provider:"Moonshot",maxTokenAllowed:128e3},{name:"kimi-thinking-preview",label:"Kimi Thinking",provider:"Moonshot",maxTokenAllowed:128e3}];getModelInstance(e){const{model:n,serverEnv:r,apiKeys:s,providerSettings:o}=e,{apiKey:i}=this.getProviderBaseUrlAndKey({apiKeys:s,providerSettings:o?.[this.name],serverEnv:r,defaultBaseUrlKey:"",defaultApiTokenKey:"MOONSHOT_API_KEY"});if(!i)throw new Error(`Missing API key for ${this.name} provider`);return Ve({baseURL:"https://api.moonshot.ai/v1",apiKey:i})(n)}}const NE=Object.freeze(Object.defineProperty({__proto__:null,AmazonBedrockProvider:OE,AnthropicProvider:Qh,CohereProvider:Mm,DeepseekProvider:zm,GithubProvider:BE,GoogleProvider:kg,GroqProvider:Sg,HuggingFaceProvider:Ag,HyperbolicProvider:Ty,LMStudioProvider:Cg,MistralProvider:Mg,MoonshotProvider:PE,OllamaProvider:Zg,OpenAILikeProvider:Ey,OpenAIProvider:ky,OpenRouterProvider:xy,PerplexityProvider:Sy,TogetherProvider:Ay,XAIProvider:Cy},Symbol.toStringTag,{value:"Module"})),We=wf("LLMManager");class $t{static _instance;_providers=new Map;_modelList=[];_env={};constructor(e){this._registerProvidersFromDirectory(),this._env=e}static getInstance(e={}){return $t._instance||($t._instance=new $t(e)),$t._instance}get env(){return this._env}async _registerProvidersFromDirectory(){try{for(const e of Object.values(NE))if(typeof e=="function"&&e.prototype instanceof ye){const n=new e;try{this.registerProvider(n)}catch(r){We.warn("Failed To Register Provider: ",n.name,"error:",r.message)}}}catch(e){We.error("Error registering providers:",e)}}registerProvider(e){if(this._providers.has(e.name)){We.warn(`Provider ${e.name} is already registered. Skipping.`);return}We.info("Registering Provider: ",e.name),this._providers.set(e.name,e),this._modelList=[...this._modelList,...e.staticModels]}getProvider(e){return this._providers.get(e)}getAllProviders(){return Array.from(this._providers.values())}getModelList(){return this._modelList}async updateModelList(e){const{apiKeys:n,providerSettings:r,serverEnv:s}=e;let o=Array.from(this._providers.values()).map(p=>p.name);r&&Object.keys(r).length>0&&(o=o.filter(p=>r[p].enabled));const i=await Promise.all(Array.from(this._providers.values()).filter(p=>o.includes(p.name)).filter(p=>!!p.getDynamicModels).map(async p=>{const g=p.getModelsFromCache(e);return g||await p.getDynamicModels(n,r?.[p.name],s).then(b=>(We.info(`Caching ${b.length} dynamic models for ${p.name}`),p.storeDynamicModels(e,b),b)).catch(b=>(We.error(`Error getting dynamic models ${p.name} :`,b),[]))})),a=Array.from(this._providers.values()).flatMap(p=>p.staticModels||[]),l=i.flat(),c=l.map(p=>`${p.name}-${p.provider}`),d=a.filter(p=>!c.includes(`${p.name}-${p.provider}`)),h=[...l,...d];return h.sort((p,g)=>p.name.localeCompare(g.name)),this._modelList=h,h}getStaticModelList(){return[...this._providers.values()].flatMap(e=>e.staticModels||[])}async getModelListFromProvider(e,n){const r=this._providers.get(e.name);if(!r)throw new Error(`Provider ${e.name} not found`);const s=r.staticModels||[];if(!r.getDynamicModels)return s;const{apiKeys:o,providerSettings:i,serverEnv:a}=n,l=r.getModelsFromCache({apiKeys:o,providerSettings:i,serverEnv:a});if(l)return We.info(`Found ${l.length} cached models for ${r.name}`),[...l,...s];We.info(`Getting dynamic models for ${r.name}`);const c=await r.getDynamicModels?.(o,i?.[r.name],a).then(g=>(We.info(`Got ${g.length} dynamic models for ${r.name}`),r.storeDynamicModels(n,g),g)).catch(g=>(We.error(`Error getting dynamic models ${r.name} :`,g),[])),d=c.map(g=>g.name),h=s.filter(g=>!d.includes(g.name)),p=[...c,...h];return p.sort((g,v)=>g.name.localeCompare(v.name)),p}getStaticModelListFromProvider(e){const n=this._providers.get(e.name);if(!n)throw new Error(`Provider ${e.name} not found`);return[...n.staticModels||[]]}getDefaultProvider(){const e=this._providers.values().next().value;if(!e)throw new Error("No providers registered");return e}}const ME={BASE_URL:"/",DEV:!1,LMSTUDIO_API_BASE_URL:"",MODE:"production",OLLAMA_API_BASE_URL:"",OPENAI_LIKE_API_BASE_URL:"",PROD:!0,SSR:!1,TOGETHER_API_BASE_URL:"",VITE_GITHUB_ACCESS_TOKEN:"",VITE_GITHUB_TOKEN_TYPE:"",VITE_GITLAB_ACCESS_TOKEN:"",VITE_GITLAB_TOKEN_TYPE:"personal-access-token",VITE_GITLAB_URL:"https://gitlab.com",VITE_LOG_LEVEL:"",VITE_NETLIFY_ACCESS_TOKEN:"",VITE_SUPABASE_ACCESS_TOKEN:"",VITE_SUPABASE_ANON_KEY:"",VITE_SUPABASE_URL:"",VITE_VERCEL_ACCESS_TOKEN:""},DE="project",Ck=`/home/${DE}`,Tk=/^\[Model: (.*?)\]\n\n/,Ik=/\[Provider: (.*?)\]\n\n/,Rk="claude-3-5-sonnet-latest",$k="cachedPrompt",Ok={APPROVE:"Yes, approved.",REJECT:"No, rejected."},Bk="Error: No execute function found on tool",Pk="Error: User denied access to tool execution",Nk="Error: An error occured while calling tool",uf=$t.getInstance(ME),UE=uf.getAllProviders(),Mk=uf.getDefaultProvider(),LE={};UE.forEach(t=>{LE[t.name]={baseUrlKey:t.config.baseUrlKey,apiTokenKey:t.config.apiTokenKey}});const Dk=[{name:"Expo App",label:"Expo App",description:"Expo starter template for building cross-platform mobile apps",githubRepo:"xKevIsDev/bolt-expo-template",tags:["mobile","expo","mobile-app","android","iphone"],icon:"i-bolt:expo"},{name:"Basic Astro",label:"Astro Basic",description:"Lightweight Astro starter template for building fast static websites",githubRepo:"xKevIsDev/bolt-astro-basic-template",tags:["astro","blog","performance"],icon:"i-bolt:astro"},{name:"NextJS Shadcn",label:"Next.js with shadcn/ui",description:"Next.js starter fullstack template integrated with shadcn/ui components and styling system",githubRepo:"xKevIsDev/bolt-nextjs-shadcn-template",tags:["nextjs","react","typescript","shadcn","tailwind"],icon:"i-bolt:nextjs"},{name:"Vite Shadcn",label:"Vite with shadcn/ui",description:"Vite starter fullstack template integrated with shadcn/ui components and styling system",githubRepo:"xKevIsDev/vite-shadcn",tags:["vite","react","typescript","shadcn","tailwind"],icon:"i-bolt:shadcn"},{name:"Qwik Typescript",label:"Qwik TypeScript",description:"Qwik framework starter with TypeScript for building resumable applications",githubRepo:"xKevIsDev/bolt-qwik-ts-template",tags:["qwik","typescript","performance","resumable"],icon:"i-bolt:qwik"},{name:"Remix Typescript",label:"Remix TypeScript",description:"Remix framework starter with TypeScript for full-stack web applications",githubRepo:"xKevIsDev/bolt-remix-ts-template",tags:["remix","typescript","fullstack","react"],icon:"i-bolt:remix"},{name:"Slidev",label:"Slidev Presentation",description:"Slidev starter template for creating developer-friendly presentations using Markdown",githubRepo:"xKevIsDev/bolt-slidev-template",tags:["slidev","presentation","markdown"],icon:"i-bolt:slidev"},{name:"Sveltekit",label:"SvelteKit",description:"SvelteKit starter template for building fast, efficient web applications",githubRepo:"bolt-sveltekit-template",tags:["svelte","sveltekit","typescript"],icon:"i-bolt:svelte"},{name:"Vanilla Vite",label:"Vanilla + Vite",description:"Minimal Vite starter template for vanilla JavaScript projects",githubRepo:"xKevIsDev/vanilla-vite-template",tags:["vite","vanilla-js","minimal"],icon:"i-bolt:vite"},{name:"Vite React",label:"React + Vite + typescript",description:"React starter template powered by Vite for fast development experience",githubRepo:"xKevIsDev/bolt-vite-react-ts-template",tags:["react","vite","frontend","website","app"],icon:"i-bolt:react"},{name:"Vite Typescript",label:"Vite + TypeScript",description:"Vite starter template with TypeScript configuration for type-safe development",githubRepo:"xKevIsDev/bolt-vite-ts-template",tags:["vite","typescript","minimal"],icon:"i-bolt:typescript"},{name:"Vue",label:"Vue.js",description:"Vue.js starter template with modern tooling and best practices",githubRepo:"xKevIsDev/bolt-vue-template",tags:["vue","typescript","frontend"],icon:"i-bolt:vue"},{name:"Angular",label:"Angular Starter",description:"A modern Angular starter template with TypeScript support and best practices configuration",githubRepo:"xKevIsDev/bolt-angular-template",tags:["angular","typescript","frontend","spa"],icon:"i-bolt:angular"},{name:"SolidJS",label:"SolidJS Tailwind",description:"Lightweight SolidJS starter template for building fast static websites",githubRepo:"xKevIsDev/solidjs-ts-tw",tags:["solidjs"],icon:"i-bolt:solidjs"}],Uk=typeof navigator<"u"?navigator.platform.toLowerCase().includes("mac"):!1,Lk=typeof navigator<"u"?navigator.platform.toLowerCase().includes("win"):!1,Fk=typeof navigator<"u"?navigator.platform.toLowerCase().includes("linux"):!1;function jk(){return globalThis.innerWidth<640}export{Nk as A,Xf as B,Ik as C,Rk as D,ek as E,Dk as F,Mk as G,$k as H,Tk as M,UE as P,je as S,Ok as T,DE as W,H as Z,ii as _,Uk as a,Lk as b,Fk as c,HE as d,KE as e,lo as f,nk as g,nh as h,jk as i,T as j,rk as k,ok as l,D as m,sk as n,_ as o,K as p,Jc as q,Rn as r,E as s,ik as t,Tt as u,Ck as v,Ot as w,LE as x,Bk as y,Pk as z};
