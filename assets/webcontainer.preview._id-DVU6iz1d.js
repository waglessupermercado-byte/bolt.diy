import{u as f,r as s,j as c}from"./components-CE_o6jZX.js";const d="preview-updates";function m(){const{previewId:t}=f(),e=s.useRef(null),r=s.useRef(),[a,u]=s.useState(""),l=s.useCallback(()=>{e.current&&a&&(e.current.src="",requestAnimationFrame(()=>{e.current&&(e.current.src=a)}))},[a]),n=s.useCallback(()=>{r.current&&a&&r.current.postMessage({type:"preview-ready",previewId:t,url:a,timestamp:Date.now()})},[t,a]);return s.useEffect(()=>{typeof window<"u"&&typeof window.BroadcastChannel=="function"?(r.current=new window.BroadcastChannel(d),r.current.onmessage=o=>{o.data.previewId===t&&(o.data.type==="refresh-preview"||o.data.type==="file-change")&&l()}):r.current=void 0;const i=`https://${t}.local-credentialless.webcontainer-api.io`;return u(i),e.current&&(e.current.src=i),n(),()=>{r.current?.close()}},[t,l,n]),c.jsx("div",{className:"w-full h-full",children:c.jsx("iframe",{ref:e,title:"WebContainer Preview",className:"w-full h-full border-none",sandbox:"allow-scripts allow-forms allow-popups allow-modals allow-storage-access-by-user-activation allow-same-origin",allow:"cross-origin-isolated",loading:"eager",onLoad:n})})}export{m as default};
